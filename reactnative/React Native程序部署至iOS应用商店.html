<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-04-11T09:44:05Z"/><meta name="updated" content="2017-04-11T09:44:15Z"/><title>React Native程序部署至iOS应用商店</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><h2 style="margin:0px 0px 0.5em;font-family:'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif;line-height:1.6em;color:#333333;text-rendering:optimizelegibility;font-size:18px;text-indent:1em;font-variant-ligatures:normal;orphans:2;widows:2;background-color:#fefefe;">React Native程序部署至iOS应用商店</h2>
<p style="margin-top:0px;margin-bottom:0.75em;font-size:16px;line-height:1.7em;text-indent:1em;color:#333333;font-family:'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif;font-variant-ligatures:normal;orphans:2;widows:2;background-color:#fefefe;">在我们写RN程序时，可以在模拟器直接测试，也可以手机连接电脑真机测试，还可以把RN程序通过Xcode安装到苹果手机以后，只要保持手机和电脑的Wi-Fi在同一个网断就可以正常使用，但是我们上传到App Store或者给客户打包一个ipa包以便客户安装并且走到哪都能够正常测试这个程序时，就需要做一些额外的配置。</p>
<h2 style="margin:0px 0px 0.5em;font-family:'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif;line-height:1.6em;color:#333333;text-rendering:optimizelegibility;font-size:18px;text-indent:1em;font-variant-ligatures:normal;orphans:2;widows:2;background-color:#fefefe;">1、更新AppDelegate.m文件里面的代码</h2>
<p style="margin-top:0px;margin-bottom:0.75em;font-size:16px;line-height:1.7em;text-indent:1em;color:#333333;font-family:'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif;font-variant-ligatures:normal;orphans:2;widows:2;background-color:#fefefe;"><img src="http://img0.tuicool.com/BNR3qiR.jpg!web" class="alignCenter" style="max-width:96%;height:auto;vertical-align:middle;border:0px none;margin:0px auto 10px;text-align:center;display:block;" /></p>
<p style="margin-top:0px;margin-bottom:0.75em;font-size:16px;line-height:1.7em;text-indent:1em;color:#333333;font-family:'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif;font-variant-ligatures:normal;orphans:2;widows:2;background-color:#fefefe;">上图中1是测试时候的代码，如果要给客户打包或者部署到App Store时把1的代码替换成2即可。</p>
<h2 style="margin:0px 0px 0.5em;font-family:'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif;line-height:1.6em;color:#333333;text-rendering:optimizelegibility;font-size:18px;text-indent:1em;font-variant-ligatures:normal;orphans:2;widows:2;background-color:#fefefe;">2、终端命令配置</h2>
<div style="font-size:16px;line-height:1.7em;color:#333333;font-family:'Helvetica Neue', Helvetica, Tahoma, Arial, STXihei, 'Microsoft YaHei', 微软雅黑, sans-serif;font-variant-ligatures:normal;orphans:2;widows:2;background-color:#fefefe;"><p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">（1）终端切换到项目路径</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;"><img src="http://img2.tuicool.com/bYJjyiF.jpg!web" class="alignCenter" style="max-width:96%;height:auto;vertical-align:middle;border:0px none;margin:0px auto 10px;text-align:center;display:block;" />（2）终端执行“&nbsp;<code style="padding:2px 4px;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-color:#f7f7f9;border:none;font-weight:600;font-size:14px;">react-native&nbsp;bundle&nbsp;--minify&nbsp;--entry-file index.ios.js&nbsp;--bundle-output main.jsbundle”命令</code><code style="padding:2px 4px;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-color:#f7f7f9;border:none;font-weight:600;font-size:14px;"></code></p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;"><img src="http://img2.tuicool.com/jaMZneV.jpg!web" class="alignCenter" style="max-width:96%;height:auto;vertical-align:middle;border:0px none;margin:0px auto 10px;text-align:center;display:block;" /></p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">PS：&nbsp;有些文章或者博客会告诉你终端执行&nbsp;react–native&nbsp;bundle&nbsp;—minify 命令即可，但是经常会出现&nbsp;React native to app store missing required arguments 这个错误。</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">以上配置没问题以后，就按照iOS正常的配置打包ipa安装或者上传到App Store即可。</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">React Native应用生成release版本的APK</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">为了部署Android应用，我们需要生成release版本的APK(APK文件是Android应用安装包文件，iOS安装包文件是ipa，该格式用于发布安装应用)。通常讲，有以下五个步骤：</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">（1）生成签名秘钥</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">（2）设置gradle变量</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">（3）添加签名到应用的build.gradle配置中</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">（4）生成release版本的APK</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">（5）在设备上安装release版本的APK</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">首先需要向你的应用生成一个keystore和key，首先先在终端切换到桌面，再输入“&nbsp;keytool -genkey -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000”命令，如下图所示：</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;"><img src="http://img1.tuicool.com/BVJNZfa.jpg!web" class="alignCenter" style="max-width:96%;height:auto;vertical-align:middle;border:0px none;margin:0px auto 10px;text-align:center;display:block;" /></p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">按照上图执行完以后会在桌面生成一个“my-release-key.keystore”文件，将此文件拷贝到项目的android/app/目录下：</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;"><img src="http://img2.tuicool.com/RJb6Rzn.jpg!web" class="alignCenter" style="max-width:96%;height:auto;vertical-align:middle;border:0px none;margin:0px auto 10px;text-align:center;display:block;" /></p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">接着在终端输入&nbsp;vi ~/.gradle/gradle.properties命令，在&nbsp;vi ~/.gradle/gradle.properties文件中添加如下内容：</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">MYAPP_RELEASE_STORE_FILE=my-release-key.keystore</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">MYAPP_RELEASE_KEY_ALIAS=my-key-alias</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">MYAPP_RELEASE_STORE_PASSWORD=liyuechun</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">MYAPP_RELEASE_KEY_PASSWORD=liyuechun</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">需要把上面的liyuechun替换成你之前调用keytool时使用的密码。</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">在~/.gradle/gradle.properties文件中添加上面的信息后，我们就成功的把她们加入到gradle通用配置中了，PS：gradle是用来构建React Native项目的工具。</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">现在我们已经设置好了gradle变量，接着需要把我们的签名配置添加到应用的gradle配置中。用Sublime打开android/app/build.gradle文件，然后添加如下签名配置，PS：我用红线框起来的内容是需要添加的，这里使用了之前在~/.gradle/gradle.properties文件中定义的变量。</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;"><img src="http://img1.tuicool.com/bmMRZbe.jpg!web" class="alignCenter" style="max-width:96%;height:auto;vertical-align:middle;border:0px none;margin:0px auto 10px;text-align:center;display:block;" /></p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">OK，接下来到了我们声明签名版APK的时候了</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">进入项目根目录，在终端运行npm start命令</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">$npm start</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">然后在项目根目录下再次运行下列命令：</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">$mkdir -p android/app/src/main/assets</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">$&nbsp;curl “http://localhost:8081/index.android.bundle?platform=android&amp;dev=false&amp;minify=true” -o “android/app/src/main/assets/index.android.bundle”</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">$cd android</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">$./gradlew assembleRelease</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">上面的代码中，首先我们创建了一个assets/ 目录来存储打包的JavaScript文件。然后，通过curl从React Native包管理器获取了打包的JavaScript文件。最后，使用gradlew来构建release版本的APK</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">如何确认Release版本的APK包生成成功，在终端执行如下命令：</p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;"><img src="http://img1.tuicool.com/QFvmEzy.jpg!web" class="alignCenter" style="max-width:96%;height:auto;vertical-align:middle;border:0px none;margin:0px auto 10px;text-align:center;display:block;" /></p>
<p style="margin-top:0px;margin-bottom:0.75em;line-height:1.7em;text-indent:1em;">也可以直接将手机通过数据线和电脑连接，并且打开调试模式，切换到项目根目录路径下面，通过react-native run-android直接安装在手机上。</p>
</div></body></html>