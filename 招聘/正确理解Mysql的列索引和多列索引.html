<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-05-15T03:10:03Z"/><meta name="updated" content="2017-05-15T03:10:09Z"/><title>正确理解Mysql的列索引和多列索引</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><h2 style="margin:0px 0px 4px;font-size:20px;font-family:Verdana, Arial, Helvetica, sans-serif;font-variant-ligatures:normal;orphans:2;widows:2;"><br />
</h2>
<div class="postbody" style="font-family:Verdana, Arial, Helvetica, sans-serif;font-variant-ligatures:normal;orphans:2;widows:2;"><div id="cnblogs_post_body" style="margin-bottom:20px;word-break:break-word;"><p style="margin:10px auto;">本文转自：http://blog.csdn.net/lovelyhermione/article/details/4580866</p>
<p style="margin:10px auto;">Mysql数据库提供两种类型的索引，如果没正确设置，索引的利用效率会大打折扣却完全不知问题出在这。</p>
<div class="cnblogs_code" style="background-color:#f5f5f5;border:1px solid #cccccc;padding:5px;overflow:auto;margin:5px 0px;font-family:'Courier New' !important;font-size:12px !important;"><div class="cnblogs_code_toolbar" style="margin-top:5px;"><span class="cnblogs_code_copy" style="padding-right:5px;line-height:1.5 !important;"><a title="复制代码" style="color:#1d58d1;border:none !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px;border:none !important;" /></a></span></div>
<pre style="margin-top:0px;margin-bottom:0px;margin-left:22px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New' !important;"><span style="line-height:1.5 !important;">CREATE TABLE test (  
    id         INT NOT NULL,  
    last_name  CHAR(</span><span style="color:#800080;line-height:1.5 !important;">30</span><span style="line-height:1.5 !important;">) NOT NULL,  
    first_name CHAR(</span><span style="color:#800080;line-height:1.5 !important;">30</span><span style="line-height:1.5 !important;">) NOT NULL,  
    PRIMARY KEY (id),  
    INDEX name (last_name,first_name)  
);  </span></pre><div class="cnblogs_code_toolbar" style="margin-top:5px;"><span class="cnblogs_code_copy" style="padding-right:5px;line-height:1.5 !important;"><a title="复制代码" style="color:#1d58d1;border:none !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px;border:none !important;" /></a></span></div>
</div>
<p style="margin:10px auto;">以上创建的其实是一个多列索引，创建列索引的代码如下：</p>
<div class="cnblogs_code" style="background-color:#f5f5f5;border:1px solid #cccccc;padding:5px;overflow:auto;margin:5px 0px;font-family:'Courier New' !important;font-size:12px !important;"><div class="cnblogs_code_toolbar" style="margin-top:5px;"><span class="cnblogs_code_copy" style="padding-right:5px;line-height:1.5 !important;"><a title="复制代码" style="color:#1d58d1;border:none !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px;border:none !important;" /></a></span></div>
<pre style="margin-top:0px;margin-bottom:0px;margin-left:22px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New' !important;"><span style="line-height:1.5 !important;">CREATE TABLE test (  
    id         INT NOT NULL,  
    last_name  CHAR(</span><span style="color:#800080;line-height:1.5 !important;">30</span><span style="line-height:1.5 !important;">) NOT NULL,  
    first_name CHAR(</span><span style="color:#800080;line-height:1.5 !important;">30</span><span style="line-height:1.5 !important;">) NOT NULL,  
    PRIMARY KEY (id),  
    INDEX name (last_name),  
     INDEX_2 name (first_name)  
);  </span></pre><div class="cnblogs_code_toolbar" style="margin-top:5px;"><span class="cnblogs_code_copy" style="padding-right:5px;line-height:1.5 !important;"><a title="复制代码" style="color:#1d58d1;border:none !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px;border:none !important;" /></a></span></div>
</div>
<p style="margin:10px auto;">一个多列索引可以认为是包含通过合并(concatenate)索引列值创建的值的一个排序数组。 当查询语句的条件中包含last_name 和 first_name时，例如：</p>
<div class="cnblogs_code" style="background-color:#f5f5f5;border:1px solid #cccccc;padding:5px;overflow:auto;margin:5px 0px;font-family:'Courier New' !important;font-size:12px !important;"><pre style="margin-top:0px;margin-bottom:0px;margin-left:22px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New' !important;">SELECT * FROM test WHERE last_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Kun</span><span style="color:#800000;line-height:1.5 !important;">'</span> AND first_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Li</span><span style="color:#800000;line-height:1.5 !important;">'</span>;</pre></div>
<p style="margin:10px auto;">sql会先过滤出last_name符合条件的记录，在其基础上在过滤first_name符合条件的记录。那如果我们分别在last_name和first_name上创建两个列索引，mysql的处理方式就不一样了，它会选择一个最严格的索引来进行检索，可以理解为检索能力最强的那个索引来检索，另外一个利用不上了，这样效果就不如多列索引了。</p>
<p style="margin:10px auto;">但是多列索引的利用也是需要条件的，以下形式的查询语句能够利用上多列索引：</p>
<div class="cnblogs_code" style="background-color:#f5f5f5;border:1px solid #cccccc;padding:5px;overflow:auto;margin:5px 0px;font-family:'Courier New' !important;font-size:12px !important;"><div class="cnblogs_code_toolbar" style="margin-top:5px;"><span class="cnblogs_code_copy" style="padding-right:5px;line-height:1.5 !important;"><a title="复制代码" style="color:#1d58d1;border:none !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px;border:none !important;" /></a></span></div>
<pre style="margin-top:0px;margin-bottom:0px;margin-left:22px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New' !important;">SELECT * FROM test WHERE last_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Widenius</span><span style="color:#800000;line-height:1.5 !important;">'</span><span style="line-height:1.5 !important;">;  
  
SELECT </span>* FROM test WHERE last_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Widenius</span><span style="color:#800000;line-height:1.5 !important;">'</span> AND first_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Michael</span><span style="color:#800000;line-height:1.5 !important;">'</span><span style="line-height:1.5 !important;">;  
  
SELECT </span>* FROM test WHERE last_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Widenius</span><span style="color:#800000;line-height:1.5 !important;">'</span> AND (first_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Michael</span><span style="color:#800000;line-height:1.5 !important;">'</span> OR first_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Monty</span><span style="color:#800000;line-height:1.5 !important;">'</span><span style="line-height:1.5 !important;">);  
  
SELECT </span>* FROM test WHERE last_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Widenius</span><span style="color:#800000;line-height:1.5 !important;">'</span> AND first_name &gt;=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">M</span><span style="color:#800000;line-height:1.5 !important;">'</span> AND first_name &lt; <span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">N</span><span style="color:#800000;line-height:1.5 !important;">'</span>;  </pre><div class="cnblogs_code_toolbar" style="margin-top:5px;"><span class="cnblogs_code_copy" style="padding-right:5px;line-height:1.5 !important;"><a title="复制代码" style="color:#1d58d1;border:none !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="max-width:900px;border:none !important;" /></a></span></div>
</div>
<p style="margin:10px auto;">以下形式的查询语句利用不上多列索引：</p>
<div class="cnblogs_code" style="background-color:#f5f5f5;border:1px solid #cccccc;padding:5px;overflow:auto;margin:5px 0px;font-family:'Courier New' !important;font-size:12px !important;"><pre style="margin-top:0px;margin-bottom:0px;margin-left:22px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New' !important;">SELECT * FROM test WHERE first_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Michael</span><span style="color:#800000;line-height:1.5 !important;">'</span><span style="line-height:1.5 !important;">;  
  
SELECT </span>* FROM test WHERE last_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Widenius</span><span style="color:#800000;line-height:1.5 !important;">'</span> OR first_name=<span style="color:#800000;line-height:1.5 !important;">'</span><span style="color:#800000;line-height:1.5 !important;">Michael</span><span style="color:#800000;line-height:1.5 !important;">'</span>;  </pre></div>
<p style="margin:10px auto;">多列建索引比对每个列分别建索引更有优势，因为索引建立得越多就越占磁盘空间，在更新数据的时候速度会更慢。</p>
<p style="margin:10px auto;">另外建立多列索引时，顺序也是需要注意的，应该将严格的索引放在前面，这样筛选的力度会更大，效率更高。</p>
</div>
</div></body></html>