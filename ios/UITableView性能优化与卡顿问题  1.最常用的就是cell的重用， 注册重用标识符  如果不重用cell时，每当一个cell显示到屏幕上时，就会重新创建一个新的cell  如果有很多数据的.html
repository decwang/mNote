<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2016-09-09T08:10:50Z"/><meta name="updated" content="2016-09-09T08:10:53Z"/><title>UITableView性能优化与卡顿问题  1.最常用的就是cell的重用， 注册重用标识符  如果不重用cell时，每当一个cell显示到屏幕上时，就会重新创建一个新的cell  如果有很多数据的</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;text-align:center;"><span style="padding:0px;font-size:18pt;">UITableView性能优化与卡顿问题</span></p>
<p class="li1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">1.最常用的就是cell的重用， 注册重用标识符</strong></span></p>
<ul style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:30px;widows:1;"><li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">如果不重用cell时，每当一个cell显示到屏幕上时，就会重新创建一个新的cell</span></li>
<li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">如果有很多数据的时候，就会堆积很多cell。如果重用cell，为cell创建一个ID</span></li>
<li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">每当需要显示cell 的时候，都会先去缓冲池中寻找可循环利用的cell，如果没有再重新创建cell</span></li>
</ul>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">2.避免cell的重新布局</strong></span></p>
<ul style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:30px;widows:1;"><li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">cell的布局填充等操作 比较耗时，一般创建时就布局好</span></li>
<li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">如可以将cell单独放到一个自定义类，初始化时就布局好</span></li>
</ul>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">3.提前计算并缓存cell的属性及内容</strong></span></p>
<ul style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:30px;widows:1;"><li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">当我们创建cell的数据源方法时，编译器并不是先创建cell 再定cell的高度</span></li>
<li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">而是先根据内容一次确定每一个cell的高度，高度确定后，再创建要显示的cell，滚动时，每当cell进入凭虚都会计算高度，提前估算高度告诉编译器，编译器知道高度后，紧接着就会创建cell，这时再调用高度的具体计算方法，这样可以方式浪费时间去计算显示以外的cell</span></li>
</ul>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">4.减少cell中控件的数量</strong></span></p>
<ul style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:30px;widows:1;"><li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">尽量使cell得布局大致相同，不同风格的cell可以使用不用的重用标识符，初始化时添加控件，</span></li>
<li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">不适用的可以先隐藏</span></li>
</ul>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">5.不要使用ClearColor，无背景色，透明度也不要设置为0</strong></span></p>
<ul style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:30px;widows:1;"><li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">渲染耗时比较长</span></li>
</ul>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">6.使用局部更新</strong></span></p>
<ul style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:30px;widows:1;"><li class="p1" style="padding:0px;table-layout:fixed;word-break:break-all;word-wrap:break-word;"><span class="s1" style="padding:0px;">如果只是更新某组的话，使用reloadSection进行局部更新</span></li>
</ul>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">7.加载网络数据，下载图片，使用异步加载，并缓存</strong></span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">&nbsp;</p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">8.少使用addView 给cell动态添加view</strong></span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">&nbsp;</p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">9.按需加载cell，cell滚动很快时，只加载范围内的cell</strong></span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">&nbsp;</p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">10.不要实现无用的代理方法，tableView只遵守两个协议</strong></span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">&nbsp;</p>
<p class="p2" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s2" style="padding:0px;"><strong style="padding:0px;">11.缓存行高：</strong><span class="s3" style="padding:0px;">estimatedHeightForRow不能和HeightForRow里面的layoutIfNeed同时存在，这两者同时存在才会出现“窜动”的bug。所以我的建议是：只要是固定行高就写预估行高来减少行高调用次数提升性能。如果是动态行高就不要写预估方法了，用一个行高的缓存字典来减少代码的调用次数即可</span></span></p>
<p class="p3" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p3" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">有了上面的问题，我们在优化tableView的时候就能好解决一个卡顿的问题了。</p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">在iOS应用中，UITableView应该是使用率最高的视图之一了。iPod、时钟、日历、备忘录、Mail、天气、照片、电话、短信、 Safari、App Store、iTunes、Game Center…几乎所有自带的应用中都能看到它的身影，可见它的重要性。</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">然而在使用第三方应用时，却经常遇到性能上的问题，普遍表现在滚动时比较卡，特别是table cell中包含图片的情况时。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">实际上只要针对性地优化一下，这种问题就不会有了。有兴趣的可以看看 LazyTableImages这个官方的例子程序，虽然也要从网上下载图片并显示，但滚动时丝毫不卡。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">下面就说说我对UITableView的了解。不过由于我也是初学者，或许会说错或遗漏一些，因此仅供参考。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">首先说下UITableView的原理。有兴趣的可以看看 《About Table Views in iOS-Based Applications》。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">UITableView是UIScrollView的子类，因此它可以自动响应滚动事件（一般为上下滚动）。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">它 内部包含0到多个UITableViewCell对象，每个table cell展示各自的内容。当新cell需要被显示时，就会调用tableView:cellForRowAtIndexPath:方法来获取或创建一个 cell；而不可视时，它又会被释放。由此可见，同一时间其实只需要存在一屏幕的cell对象即可，不需要为每一行创建一个cell。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">此 外，UITableView还可以分为多个sections，每个区段都可以有自己的head、foot和cells。而在定位一个cell时，就需要2 个字段了：在哪个section，以及在这个section的第几行。这在iOS SDK中是用NSIndexPath来表述的，UIKit为其添加了indexPathForRow:inSection:这个创建方法。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">其他诸如编辑之类的就不提了，因为和本文无关。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;"><strong style="padding:0px;">介绍完原理，接下来就开始优化吧。&nbsp;</strong></span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">使用不透明视图。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">不透明的视图可以极大地提高渲染的速度。因此如非必要，可以将table cell及其子视图的opaque属性设为YES（默认值）。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">其中的特例包括背景色，它的alpha值应该为1（例如不要使用clearColor）；图像的alpha值也应该为1，或者在画图时设为不透明。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">不要重复创建不必要的table cell。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">前面说了，UITableView只需要一屏幕的UITableViewCell对象即可。因此在cell不可见时，可以将其缓存起来，而在需要时继续使用它即可。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">而UITableView也提供了这种机制，只需要简单地设置一个identifier即可：</span></p>
<div class="cnblogs_code" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><pre style="font-family:Arial, Helvetica, sans-serif;padding:5px;border:1px dotted #aaaaaa;table-layout:fixed;word-break:break-all;word-wrap:break-word;white-space:pre-wrap;background-color:#f6f6f6;"><span style="padding:0px;color:#008080;">1</span>     <span style="padding:0px;color:#0000ff;">static</span> NSString *CellIdentifier = <span style="padding:0px;color:#800000;">@"</span><span style="padding:0px;color:#800000;">xxx</span><span style="padding:0px;color:#800000;">"</span><span style="padding:0px;color:#000000;">;</span><span style="padding:0px;color:#008080;">2</span>     UITableViewCell *cell =<span style="padding:0px;color:#000000;"> [tableView dequeueReusableCellWithIdentifier:CellIdentifier];</span><span style="padding:0px;color:#008080;">3</span>     <span style="padding:0px;color:#0000ff;">if</span> (cell ==<span style="padding:0px;color:#000000;"> nil) {</span><span style="padding:0px;color:#008080;">4</span>         cell =<span style="padding:0px;color:#000000;"> [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];</span><span style="padding:0px;color:#008080;">5</span>     }</pre></div>
<p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">&nbsp;</p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">值得一提的是，cell被重用时，它内部绘制的内容并不会被自动清除，因此你可能需要调用setNeedsDisplayInRect:或setNeedsDisplay方法。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">此 外，在添加table cell的时候，如果不需要动画效果，最好不要使用insertRowsAtIndexPaths:withRowAnimation:方法，而是直接调 用reloadData方法。因为前者会对所有indexPaths调用tableView:cellForRowAtIndexPath:方法，即便该 cell并不需要显示（不知道是不是bug），这就可能创建大量多余的cell。勘误：只是在模拟器上测试如此，真机调试时没有这种bug。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">减少视图的数目。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">UITableViewCell包含了textLabel、detailTextLabel和imageView等view，而你还可以自定义一些视图放在它的contentView里。然而view是很大的对象，创建它会消耗较多资源，并且也影响渲染的性能。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">如果你的table cell包含图片，且数目较多，使用默认的UITableViewCell会非常影响性能。奇怪的是，使用自定义的view，而非预定义的view，明显会快些。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">当然，最佳的解决办法还是继承UITableViewCell，并在其drawRect:中自行绘制：</span></p>
<div class="cnblogs_code" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><pre style="font-family:Arial, Helvetica, sans-serif;padding:5px;border:1px dotted #aaaaaa;table-layout:fixed;word-break:break-all;word-wrap:break-word;white-space:pre-wrap;background-color:#f6f6f6;"><span style="padding:0px;color:#008080;"> 1</span>     - (<span style="padding:0px;color:#0000ff;">void</span><span style="padding:0px;color:#000000;">)drawRect:(CGRect)rect</span><span style="padding:0px;color:#008080;"> 2</span> <span style="padding:0px;color:#000000;">    {</span><span style="padding:0px;color:#008080;"> 3</span>         <span style="padding:0px;color:#0000ff;">if</span><span style="padding:0px;color:#000000;"> (image)</span><span style="padding:0px;color:#008080;"> 4</span> <span style="padding:0px;color:#000000;">        {</span><span style="padding:0px;color:#008080;"> 5</span> <span style="padding:0px;color:#000000;">            [image drawAtPoint:imagePoint];</span><span style="padding:0px;color:#008080;"> 6</span>             self.image =<span style="padding:0px;color:#000000;"> nil;</span><span style="padding:0px;color:#008080;"> 7</span>         } <span style="padding:0px;color:#0000ff;">else</span><span style="padding:0px;color:#000000;"> {</span><span style="padding:0px;color:#008080;"> 8</span> <span style="padding:0px;color:#000000;">            [placeHolder drawAtPoint:imagePoint];</span><span style="padding:0px;color:#008080;"> 9</span> <span style="padding:0px;color:#000000;">        }</span><span style="padding:0px;color:#008080;">10</span> <span style="padding:0px;color:#000000;">        [text drawInRect:textRect withFont:font lineBreakMode:UILineBreakModeTailTruncation];</span><span style="padding:0px;color:#008080;">11</span>     }</pre></div>
<p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">&nbsp;</p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">不过这样一来，你会发现选中一行后，这个cell就变蓝了，其中的内容就被挡住了。最简单的方法就是将cell的selectionStyle属性设为UITableViewCellSelectionStyleNone，这样就不会被高亮了。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">此 外还可以创建CALayer，将内容绘制到layer上，然后对cell的contentView.layer调用addSublayer:方法。这个例 子中，layer并不会显著影响性能，但如果layer透明，或者有圆角、变形等效果，就会影响到绘制速度了。解决办法可参见后面的预渲染图像。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">不要做多余的绘制工作。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">在实现drawRect:的时候，它的rect参数就是需要绘制的区域，这个区域之外的不需要进行绘制。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">例如上例中，就可以用CGRectIntersectsRect、CGRectIntersection或CGRectContainsRect判断是否需要绘制image和text，然后再调用绘制方法。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">预渲染图像。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">你会发现即使做到了上述几点，当新的图像出现时，仍然会有短暂的停顿现象。解决的办法就是在bitmap context里先将其画一遍，导出成UIImage对象，然后再绘制到屏幕，详细做法可见《利用预渲染加速iOS设备的图像显示》。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">不要阻塞主线程。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">做到前几点后，你的table view滚动时应该足够流畅了，不过你仍可能让用户感到不爽。常见的现象就是在更新数据时，整个界面卡住不动，完全不响应用户请求。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">出现这种现象的原因就是主线程执行了耗时很长的函数或方法，在其执行完毕前，无法绘制屏幕和响应用户请求。其中最常见的就是网络请求了，它通常都需要花费数秒的时间，而你不应该让用户等待那么久。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">解 决办法就是使用多线程，让子线程去执行这些函数或方法。这里面还有一个学问，当下载线程数超过2时，会显著影响主线程的性能。因此在使用 ASIHTTPRequest时，可以用一个NSOperationQueue来维护下载请求，并将其 maxConcurrentOperationCount设为2。而NSURLRequest则可以配合GCD来实现，或者使用NSURLConnection的setDelegateQueue:方法。</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">当然，在不需要响应用户请求时，也可以增加下载线程数，以加快下载速度：</span></p>
<div class="cnblogs_code" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><pre style="font-family:Arial, Helvetica, sans-serif;padding:5px;border:1px dotted #aaaaaa;table-layout:fixed;word-break:break-all;word-wrap:break-word;white-space:pre-wrap;background-color:#f6f6f6;"><span style="padding:0px;color:#008080;">1</span> - (<span style="padding:0px;color:#0000ff;">void</span>)scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate { <span style="padding:0px;color:#0000ff;">if</span> (!decelerate) { queue.maxConcurrentOperationCount = <span style="padding:0px;color:#800080;">5</span>; } } - (<span style="padding:0px;color:#0000ff;">void</span>)scrollViewDidEndDecelerating:(UIScrollView *)scrollView { queue.maxConcurrentOperationCount = <span style="padding:0px;color:#800080;">5</span>; } - (<span style="padding:0px;color:#0000ff;">void</span>)scrollViewWillBeginDragging:(UIScrollView *)scrollView { queue.maxConcurrentOperationCount = <span style="padding:0px;color:#800080;">2</span>; } </pre></div>
<p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">&nbsp;</p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">此外，自动载入更新数据对用户来说也很友好，这减少了用户等待下载的时间。例如每次载入50条信息，那就可以在滚动到倒数第10条以内时，加载更多信息：</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath { if (count - indexPath.row &lt; 10 &amp;&amp; !updating) { updating = YES; [self update]; } }// update方法获取到结果后，设置updating为NO</span></p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">还有一点要注意的就是当图片下载完成后，如果cell是可见的，还需要更新图像：</span></p>
<p class="p4" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">&nbsp;</span></p>
<div class="cnblogs_code" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><pre style="font-family:Arial, Helvetica, sans-serif;padding:5px;border:1px dotted #aaaaaa;table-layout:fixed;word-break:break-all;word-wrap:break-word;white-space:pre-wrap;background-color:#f6f6f6;"><span style="padding:0px;color:#008080;">1</span> NSArray *indexPaths =<span style="padding:0px;color:#000000;"> [self.tableView indexPathsForVisibleRows];</span><span style="padding:0px;color:#008080;">2</span> <span style="padding:0px;color:#0000ff;">for</span> (NSIndexPath *visibleIndexPath <span style="padding:0px;color:#0000ff;">in</span><span style="padding:0px;color:#000000;"> indexPaths) {</span><span style="padding:0px;color:#008080;">3</span>  <span style="padding:0px;color:#0000ff;">if</span> (indexPath ==<span style="padding:0px;color:#000000;"> visibleIndexPath) { </span><span style="padding:0px;color:#008080;">4</span> MyTableViewCell *cell = (MyTableViewCell *<span style="padding:0px;color:#000000;">)[self.tableView cellForRowAtIndexPath:indexPath];</span><span style="padding:0px;color:#008080;">5</span>  cell.image =<span style="padding:0px;color:#000000;"> image; </span><span style="padding:0px;color:#008080;">6</span> [cell setNeedsDisplayInRect:imageRect]; <span style="padding:0px;color:#0000ff;">break</span><span style="padding:0px;color:#000000;">; </span><span style="padding:0px;color:#008080;">7</span> <span style="padding:0px;color:#000000;">}</span><span style="padding:0px;color:#008080;">8</span>  }<span style="padding:0px;color:#008000;">//</span><span style="padding:0px;color:#008000;"> 也可不遍历，直接与头尾相比较，看是否在中间即可。 </span></pre></div>
<p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;">&nbsp;</p>
<p class="p1" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:#3f3f3f;line-height:30px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><span class="s1" style="padding:0px;">最后还是前面所说过的insertRowsAtIndexPaths:withRowAnimation:方法，插入新行需要在主线程执行，而一次插入很多行的话（例如50行），会长时间阻塞主线程。而换成reloadData方法的话，瞬间就处理完了。</span></p></body></html>