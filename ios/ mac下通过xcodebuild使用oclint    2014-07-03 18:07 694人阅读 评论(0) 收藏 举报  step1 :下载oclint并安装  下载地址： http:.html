<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2014-12-12T15:30:34Z"/><meta name="updated" content="2014-12-12T15:30:36Z"/><title> mac下通过xcodebuild使用oclint    2014-07-03 18:07 694人阅读 评论(0) 收藏 举报  step1 :下载oclint并安装  下载地址： http://</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="article_title" style="margin:5px 0px;font-size:20px;line-height:30px;font-family:'Microsoft YaHei';">&nbsp;<h1 style="margin:0px;padding:0px;display:inline;font-weight:normal;font-size:20px;vertical-align:middle;"><span class="link_title"><a href="http://blog.csdn.net/openglnewbee/article/details/36675797" style="color:#000000;text-decoration:none;">mac下通过xcodebuild使用oclint</a></span></h1>
</div>
<div class="article_manage" style="padding:5px 0px;color:#999999;font-size:12px;line-height:24px;font-family:Arial;text-align:right;"><span class="link_postdate" style="margin:0px 5px 0px 0px;">2014-07-03 18:07</span>&nbsp;<span class="link_view" title="阅读次数" style="margin:0px 5px;padding:0px 0px 0px 14px;background-image:url(http://static.blog.csdn.net/images/ico_view.png);background-position:0% 50%;background-repeat:no-repeat no-repeat;">694人阅读</span>&nbsp;<span class="link_comments" title="评论次数" style="margin:0px 5px;padding:0px 0px 0px 14px;background-image:url(http://static.blog.csdn.net/images/ico_comm.png);background-position:0% 50%;background-repeat:no-repeat no-repeat;"><a href="http://blog.csdn.net/openglnewbee/article/details/36675797#comments" style="color:#336699;text-decoration:none;">评论</a>(0)</span>&nbsp;<span class="link_collect" style="margin:0px 5px;"><a title="收藏" style="color:#336699;">收藏</a></span>&nbsp;<span class="link_report" style="margin:0px 5px;"><a href="http://blog.csdn.net/openglnewbee/article/details/36675797#report" title="举报" style="color:#336699;text-decoration:none;">举报</a></span></div>
<div id="article_content" class="article_content" style="margin:20px 0px 0px;line-height:26px;font-family:Arial;color:#333333;"><p>step1 :下载oclint并安装</p>
<p>下载地址：&nbsp;http://oclint.org/downloads.html</p>
<p>选择mac os x或者darwin的包，下载到本地。</p>
<p>目录类似下面：</p>
<p></p>
<pre style="white-space:pre-wrap;word-wrap:break-word;">oclint-release
|-bin
|-lib
|---clang
|-----3.4
|-------include
|-------lib
|---oclint
|-----rules
|-----reporters</pre><pre style="white-space:pre-wrap;word-wrap:break-word;"></pre><pre style="white-space:pre-wrap;word-wrap:break-word;">安装官方指南： http://docs.oclint.org/en/dev/intro/installation.html</pre><p></p>
<p>我们此时在bash（终端terminal）中运行oclint会告诉我们命令找不到，我们需要把它的执行文件路径加入到环境变量或者把执行文件拷贝到系统目录。</p>
<p>方法1（推荐）：把路径加到环境变量中（实际是.bash_profile或者.bashrc文件中，关于这两者有不知道的同学可以搜索之）</p>
<p></p>
<pre style="white-space:pre-wrap;word-wrap:break-word;"><span class="nv">OCLINT_HOME</span><span class="o">=</span>/path/to/oclint-release   // <span style="font-family:Arial, Helvetica, sans-serif;">/path/to/oclint-release 是执行文件存放路径，例如：/Users/xxx/Desktop/oclint-0.9.dev.a6ffa25</span> <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$OCLINT_HOME</span>/bin:<span class="nv">$PATH</span></pre><pre style="white-space:pre-wrap;word-wrap:break-word;">关于.bash_profile,mac系统里本身可能不存在，创建和编辑的步骤见下文：</pre><pre style="white-space:pre-wrap;word-wrap:break-word;">http://blog.csdn.net/openglnewbee/article/details/36663591</pre><pre style="white-space:pre-wrap;word-wrap:break-word;">关于bashrc，位于/etc目录下，使用command+shift+g 可以前往/etc，找到bashrc文件修改权限后可以编辑。</pre><pre style="white-space:pre-wrap;word-wrap:break-word;"></pre><pre style="white-space:pre-wrap;word-wrap:break-word;">方法2:把执行文件拷贝到系统目录(请自行尝试)</pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><p>A few directories are supposed to be in the system <tt class="docutils literal">PATH</tt> already, to mention a few, <tt class="docutils literal">/usr/local/bin</tt>, <tt class="docutils literal">/usr/bin</tt>, <tt class="docutils literal">/bin</tt>, etc. Therefore, it’s also possible to copy the OCLint binaries into one of these folders, and move the dependencies over. As an example, presumes <tt class="docutils literal">/usr/local/bin</tt> is in the <tt class="docutils literal">PATH</tt> (may require root permission).</p>
<ol class="arabic simple"><li><tt class="docutils literal"><span class="pre">cp</span> <span class="pre">bin/oclint*</span> <span class="pre">/usr/local/bin/</span></tt></li>
<li><tt class="docutils literal"><span class="pre">cp</span> <span class="pre">-rp</span> <span class="pre">lib/*</span> <span class="pre">/usr/local/lib/</span></tt></li>
</ol>
<p>Dependency libraries are required to be put into appropriate directory, because <tt class="docutils literal">oclint</tt> executable searches <tt class="docutils literal">$(/path/to/bin/oclint)/../lib/clang</tt>, <tt class="docutils literal">$(/path/to/bin/oclint)/../lib/oclint/rules</tt> and <tt class="docutils literal">$(/path/to/bin/oclint)/../lib/oclint/reporters</tt> for builtin headers and dynamic libraries by default.</p>
<p>以上两个方法执行完其中1个我们就可以说oclint已经安装完成了，此时在bash中运行oclint应该得到如下提示：</p>
<p></p>
<pre style="white-space:pre-wrap;word-wrap:break-word;">oclint: Not enough positional command line arguments specified!</pre><pre style="white-space:pre-wrap;word-wrap:break-word;"></pre><pre style="white-space:pre-wrap;word-wrap:break-word;">step 2:通过xcodebuild执行oclint命令</pre><pre style="white-space:pre-wrap;word-wrap:break-word;">1.在bash中通过cd命令进到需要lint的工程路径下</pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code>2.在bash中执行：xcodebuild | tee xcodebuild.log&nbsp;</code></pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code>（若工程中存在多个不同的target，按照如下格式输入： <span style="font-family:Arial, Helvetica, sans-serif;">xcodebuild  －target selectedTargetName | tee xcodebuild.log,将需要跑的target名字填入到命令中&nbsp; </span>）</code></pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code> 此命令调用xcodebuild进行了编译并把相关日志信息输入到xcodebuild.log，该log文件是后续步骤的必要条件，生成在当前的工程目录中.官方解释如下：</code></pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code>We need to save the <tt class="docutils literal">xcodebuild</tt> output to a log file, by convention, name it <tt class="docutils literal">xcodebuild.log</tt>. We can use <tt class="docutils literal"><span class="pre">xcodebuild</span> <span class="pre">&lt;options&gt;</span> <span class="pre">|</span> <span class="pre">tee</span> <span class="pre">xcodebuild.log</span></tt> to pipe every line of the output to <tt class="docutils literal">xcodebuild.log</tt> file.</code></pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code> 3.在bash中执行 oclint-xcodebuild xcodebuild.log</code></pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code>此步骤是利用之前的.log文件通过<span style="font-family:Arial, Helvetica, sans-serif;">oclint-xcodebuild的可执行文件生成了名为compile_commands.json的json格式文件，该文件应该包含了多组内容，其中的key分别为directory、command、file，该文件不应该为空。此文件是下一步输入的必要条件。</span> 4. <span style="font-family:Arial, Helvetica, sans-serif;">在bash中执行 </span>oclint-json-compilation-database，此步骤是真正执行了lint，执行完应该在终端输出结果。</code> </pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code>若希望输出报告到文件中，运行如下命令：</code></pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code><code>oclint-json-compilation-database -- -o=report.html</code> </code></pre><pre style="white-space:pre-wrap;word-wrap:break-word;"><code> </code></pre><pre style="white-space:pre-wrap;word-wrap:break-word;">官方参考指南：http://docs.oclint.org/en/dev/guide/xcodebuild.html</pre><pre style="white-space:pre-wrap;word-wrap:break-word;"></pre><pre style="white-space:pre-wrap;word-wrap:break-word;">注意事项：</pre><pre style="white-space:pre-wrap;word-wrap:break-word;">1.octool 0.7及以前的版本不支持xcode5.</pre><pre style="white-space:pre-wrap;word-wrap:break-word;">2.在运行前注意执行clean,也可在step2中的第二步执行如下命令：<p class="p1">xcodebuild -dry-run | tee xcodebuild.log  说明如下：</p>
<p class="p1"></p>
<p>If a source file has been built by <tt class="docutils literal">xcodebuild</tt>, and it’s not been modified since last build, then it might not be compiled again when you invoke <tt class="docutils literal">xcodebuild</tt> the second time. In other words, if it happens, this file won’t be shown in the log. So we won’t see it in the <tt class="docutils literal">compile_commands.json</tt>. To avoid that, use clean build by removing all build products and intermediate files from the build directory.</p>
<p>However, cleaning and building the entire project takes longer time, especially for those big projects. In this case, if file structure hasn’t been changed, and build settings haven’t been modified, then it’s okay to keep the existing <tt class="docutils literal">xcodebuild.log</tt> and <tt class="docutils literal">compile_commands.json</tt> to save time.</p>
<p>If the <tt class="docutils literal">xcodebuild</tt> build can be guaranteed to be successful with the options specified, then we could also use <tt class="docutils literal">-dry-run</tt> option to <em>build</em> the project without actually running the commands, so that we can still capture the <tt class="docutils literal">xcodebuild</tt> log but with reduced time.</p>
</pre></pre></div></body></html>