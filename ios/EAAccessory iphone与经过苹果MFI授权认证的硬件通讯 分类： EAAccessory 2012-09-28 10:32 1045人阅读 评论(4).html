<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2014-09-12T05:36:46Z"/><meta name="updated" content="2014-09-12T05:36:57Z"/><title>EAAccessory iphone与经过苹果MFI授权认证的硬件通讯 分类： EAAccessory 2012-09-28 10:32 1045人阅读 评论(4)</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="article_title">

    <h1>
        <span class="link_title"><a href="http://blog.csdn.net/kaizi318/article/details/8027607">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EAAccessory  iphone与经过苹果MFI授权认证的硬件通讯
        </a></span>     </h1>
</div>
    <div class="article_manage">
        <span class="link_categories">         分类：
            <a href="http://blog.csdn.net/kaizi318/article/category/1247856">EAAccessory</a> 
        </span>     <span class="link_postdate">2012-09-28 10:32</span>     <span class="link_view" title="阅读次数">1045人阅读</span>     <span class="link_comments" title="评论次数"><a href="http://blog.csdn.net/kaizi318/article/details/8027607#comments">评论</a>(4)</span>     <span class="link_collect">收藏</span>     <span class="link_report"><a href="http://blog.csdn.net/kaizi318/article/details/8027607#report" title="举报">举报</a></span>     </div>
<div class="tag2box"><a href="http://www.csdn.net/tag/iphone" target="_blank">iphone</a><a href="http://www.csdn.net/tag/%e9%80%9a%e8%ae%af" target="_blank">通讯</a><a href="http://www.csdn.net/tag/apple" target="_blank">apple</a><a href="http://www.csdn.net/tag/string" target="_blank">string</a><a href="http://www.csdn.net/tag/html" target="_blank">html</a><a href="http://www.csdn.net/tag/%e6%96%87%e6%a1%a3" target="_blank">文档</a></div>
  
    <div id="article_content" class="article_content">

<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
&nbsp; &nbsp;首先，要拿到苹果公司的MFI认证，然后要定义至少一种命令<strong>协议</strong>，让配件支持，Apple 并不负责提供协议的注册机制，制造商必须自己决定支持哪些协议，为了防止命名冲</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
突，协议的名字是反向的 DNS 字符串，类似<code>com.apple.myProtocol</code>。</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 定义好协议后，要在工程中声明协议，在Info.plist的<code>UISupportedExternalAccessoryProtocols键中声明。</code></p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 工程里要添加ExternalAccessory 框架。</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 通过EAAccessoryManager获取配件列表，通过EAAccessory与配件建立连接，就可以创建一个<code>EASession回话，与配件进行通讯</code>。</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 具体的可以参照苹果官方文档<a href="http://www.apple.com.cn/developer/library/ios/featuredarticles/ExternalAccessoryPT/Introduction/Introduction.html" style="color:#ff9900;text-decoration:none;">http://www.apple.com.cn/developer/library/ios/featuredarticles/ExternalAccessoryPT/Introduction/Introduction.html</a>。</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 详细代码参照官方EADemo实例，里面实现的很清楚。</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 我的任务是将图片读进去，提取它的raw数据，但由于图片是96x96像素，就是说raw数据大小有96x96x4个bit，大约40k，输出到配件后要进行写入，速度太慢，所以将raw数</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
据经过处理，去掉透明度，RGB分别取5位，6位，5位，这样大约剩20k，即使这样也要将每个数据包分段发送，每段256个字节，发送数据前，加上一个文件头，每一段加上一个</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
段头，每一段发送之后等待硬件响应，响应之后才能发送下一段，1s之内没有接受响应则终止发送。部分代码如下：</p>
<p style="margin-top:0px;margin-bottom:0px;padding-top:0px;padding-bottom:0px;font-family:Arial;line-height:26px;">
</p>
<div class="dp-highlighter bg_html" style="font-family:Consolas,'Courier New',Courier,mono,serif;background-color:#e7e5dc;width:959.2999877929688px;overflow:auto;padding-top:1px;margin:18px 0px!important;line-height:26px;">
<div class="bar" style="padding-left:45px;">
<div class="tools" style="padding:3px 8px 10px 10px;font-size:9px;line-height:normal;font-family:Verdana,Geneva,Arial,Helvetica,sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;">
<strong>[html]</strong>&nbsp;<a href="http://blog.csdn.net/hwj2012/article/details/7883711#" class="ViewSource" title="view plain" style="color:#a0a0a0;text-decoration:none;background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;display:inline-block;width:16px;height:16px;text-indent:-2000px;">view
 plain</a><a href="http://blog.csdn.net/hwj2012/article/details/7883711#" class="CopyToClipboard" title="copy" style="color:#a0a0a0;text-decoration:none;background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;display:inline-block;width:16px;height:16px;text-indent:-2000px;">copy</a> <div style="position:absolute;left:383px;top:810px;width:18px;height:18px;z-index:99;">
</div>
<div style="position:absolute;left:787px;top:812px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_1" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="ZeroClipboardMovie_1" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=18&amp;height=18" wmode="transparent" align="middle" height="18" width="18" /></div>
</div>
</div>
<ol start="1" class="dp-xml" style="margin:0px 0px 1px 45px!important;padding:0px;border:none;list-style-position:initial;background-color:#ffffff;color:#5c5c5c;">
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;UIImage&nbsp;*</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">img</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=[UIImage&nbsp;imageNamed:myFilePath];//myFilePath位图片路径&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;CGImageRef&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">cgimage</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">img</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">.CGImage;&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;CFDataRef&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">dataref</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">CGDataProviderCopyData</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">(CGImageGetDataProvider(cgimage));//获取图片cfdata数据&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">cgdatalength</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">CFDataGetLength</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">(dataref);&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;UInt8&nbsp;*<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">pixelByteData</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=(UInt8&nbsp;*)malloc(cgdatalength);&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;CFDataGetBytes(dataref,&nbsp;CFRangeMake(0,cgdatalength),pixelByteData);&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">eachgroupnum</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">256</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;//每一段数据大小为256bit&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">groumpcount</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">cgdatalength</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">/(eachgroupnum*2);//分段总数&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;NSMutableData&nbsp;*<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">data1</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;[NSMutableData&nbsp;data];&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">buf</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;[self.ID&nbsp;UTF8String];//将命令头处理为字节流&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(buf)&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint32_t&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">len</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">strlen</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">(buf);&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;singleNumberString[3]&nbsp;=&nbsp;{'\0',&nbsp;'\0',&nbsp;'\0'};&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint32_t&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">singleNumber</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">0</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(uint32_t&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">i</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">0</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;;&nbsp;i&nbsp;</span><span class="tag" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">&lt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">len</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;&nbsp;i+=2)&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;((i+1)&nbsp;<span class="tag" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">&lt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">len</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">)&nbsp;&amp;&amp;&nbsp;isxdigit(buf[i])&nbsp;&amp;&amp;&nbsp;(isxdigit(buf[i+1]))&nbsp;)&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleNumberString[0]&nbsp;=&nbsp;buf[i];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;singleNumberString[1]&nbsp;=&nbsp;buf[i&nbsp;+&nbsp;1];&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sscanf(singleNumberString,&nbsp;"%x",&nbsp;&amp;singleNumber);&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">tmp</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;(uint8_t)(singleNumber&nbsp;&amp;&nbsp;0x000000FF);&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[data1&nbsp;appendBytes:(void&nbsp;*)(&amp;tmp)&nbsp;length:1];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;[data1&nbsp;appendBytes:(void&nbsp;*)(&amp;groumpcount)&nbsp;length:1];//将分段总数添加到字节流中&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;[[EADSessionController&nbsp;sharedController]&nbsp;writeData:data1];//发送文件头&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;//将图片字节流数据分成groumpcount分，每个像素点去掉透明体，3字节RGB处理成2字节，读入字节流缓冲区&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;NSMutableData&nbsp;*<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">datas</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;[NSMutableData&nbsp;data];&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;UInt16&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">temp</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">0</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;for(int&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">i</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">0</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;i</span><span class="tag" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">groumpcount</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;i++)&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[datas&nbsp;appendBytes:(void&nbsp;*)(&amp;i)&nbsp;length:1];//段首编号部分&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[datas&nbsp;appendBytes:(void&nbsp;*)(&amp;groumpcount)&nbsp;length:1];//段首编号分段总数部分&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(int&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">j</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">eachgroupnum</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">*i*2;j</span><span class="tag" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">eachgroupnum</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">*(i+1)*2;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">j</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">j</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">+4)&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">temp</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">pixelByteData</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">[j+2];&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp+=pixelByteData[j+1]*32;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;temp+=pixelByteData[j]*2048;&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">tmp1</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;(uint8_t)(temp&nbsp;&amp;&nbsp;0x0000FF00);&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">tmp2</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;=&nbsp;(uint8_t)(temp&nbsp;&amp;&nbsp;0x000000FF);&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[datas&nbsp;appendBytes:(void&nbsp;*)(&amp;tmp1)&nbsp;length:1];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[datas&nbsp;appendBytes:(void&nbsp;*)(&amp;tmp2)&nbsp;length:1];&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">i</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">==0)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[EADSessionController&nbsp;sharedController]&nbsp;writeData:datas];//第一段数据直接发送&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else{&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">readdatabuf</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">==0xff0000){//readdatabuf为硬件响应发回的数据，当以一段数据成功接受后，给应用发回0xff0000，且readdatabuf值存储最后&nbsp;一次硬件响应&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[EADSessionController&nbsp;sharedController]&nbsp;writeData:datas];//发送下一段数据&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">readdatabuf</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">0</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;//清空上一次接受的数据&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[datas&nbsp;setData:nil];//清空上一次发送的数据&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;//结束本次循环&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[self&nbsp;performSelector:@selector(laterwritedata:)&nbsp;withObject:datas&nbsp;afterDelay:1];&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">temp</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">==NO)&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;//1s之内没有收到硬件的响应，跳出循环，终止发送&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">readdatabuf</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">0</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;//清空上一次接受的数据&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[datas&nbsp;setData:nil];//清空上一次发送的数据&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">-(void)&nbsp;laterwritedata:(NSMutableData&nbsp;*)data&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">{&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;if(<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">readdatabuf</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">==0xff0000){&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">temps</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">YES</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;//temp位YES，表示已得到响应，可以进行下一段的发送&nbsp;&nbsp;</span></span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[[EADSessionController&nbsp;sharedController]&nbsp;writeData:data];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">temps</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">NO</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li style="margin:0px!important;padding:0px 3px 0px 10px!important;border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;">
<span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">} &nbsp;</span></li>
</ol>
</div>
</div></body></html>