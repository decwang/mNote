<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2015-09-10T08:21:51Z"/><meta name="updated" content="2016-10-08T09:09:08Z"/><title>使用Autolayout实现UITableView的Cell动态布局和高度动态改变    2014-12-16 08:12:32|  分类： ios |  标签：autolayout  cell  </title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="multicntwrap" style="color:#737373;font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:12px;line-height:normal;"><div class="multicnt"><h3 class="title pre fs1" style="overflow:hidden;word-wrap:break-word;word-break:break-all;font-size:16px;margin:34px 0px 10px;padding:0px;"><span class="tcnt" style="font-size:26px;font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑, Arial, Helvetica, simsun, 宋体;line-height:38px;">使用Autolayout实现UITableView的Cell动态布局和高度动态改变</span>&nbsp;&nbsp;</h3>
<p class="tdep clearfix nbw-act fc06" style="zoom:1;margin-top:0px;margin-bottom:25px;padding:0px;color:#7f7f7f;line-height:20px;"><span class="pleft" style="float:left;"><span class="blogsep" style="margin:0px 2px;">2014-12-16 08:12:32</span><span class="blogsep" style="margin:0px 2px;">|&nbsp;&nbsp;分类：</span>&nbsp;<a class="fc03 m2a" href="http://blog.163.com/china_uv/blog/#m=0&amp;t=1&amp;c=fks_084064087085088074087080083095085087086066087081084069083" title="ios" style="color:#0071bc;cursor:pointer;text-decoration:none;">ios</a>&nbsp;<span class="blogsep" id="$_blogTagTitle" style="margin:0px 2px;">|&nbsp;&nbsp;标签：</span><span class="fc03" id="$_blogTagInfo" style="color:#0071bc;"><a href="http://blog.163.com/china_uv/blog/#m=0&amp;t=3&amp;c=autolayout" class="fc03 m2a" style="color:#0071bc;cursor:pointer;text-decoration:none;">autolayout</a>&nbsp;&nbsp;<a href="http://blog.163.com/china_uv/blog/#m=0&amp;t=3&amp;c=cell" class="fc03 m2a" style="color:#0071bc;cursor:pointer;text-decoration:none;">cell</a>&nbsp;&nbsp;<a href="http://blog.163.com/china_uv/blog/#m=0&amp;t=3&amp;c=%E9%AB%98%E5%BA%A6" class="fc03 m2a" style="color:#0071bc;cursor:pointer;text-decoration:none;">高度</a>&nbsp;&nbsp;</span></span><span class="pright fc07 ztag" style="float:right;"><span class="blogsep" style="margin:0px 2px;">|</span><span id="$_spanReport" class="fc03 m2a" style="cursor:pointer;color:#0071bc;">举报</span></span><span class="pright fc07 ztag" style="float:right;"><span class="blogsep" style="margin:0px 2px;">|</span><span class="zihao fc03" id="$_fontswitch" style="color:#0071bc;position:relative;cursor:default;">字号</span></span><span class="pright pnt fc03" id="$_blog_subscribe" style="cursor:pointer;float:right;color:#0071bc;"><span class="iblock icn0 icn0-919" style="display:inline-block;zoom:1;width:20px;height:20px;background-image:url(http://b2.bst.126.net/newpage/images/icon.png?v=20120531);background-position:-360px -380px;background-repeat:no-repeat no-repeat;">&nbsp;</span><a class="m2a" style="cursor:pointer;">订阅</a></span></p>
</div>
<div class="m-shareAndDownLoad" style="height:24px;line-height:24px;margin-top:-8px;"><div class="share-wrap pleft" style="float:left;"><span id="$_shareBtn_lofter2" title="分享到LOFTER" class="shareitm lofter f-bkicons" style="background-image:url(http://blog.163.com/newpage/images/redesign2014/bkicons24.png);float:left;width:24px;height:24px;padding:0px 0px 0px 6px;cursor:pointer;background-position:0px -144px;background-repeat:no-repeat no-repeat;">&nbsp;</span><span id="$_shareBtn_sinaweibo2" title="分享到新浪微博" class="shareitm sinawb f-bkicons" style="background-image:url(http://blog.163.com/newpage/images/redesign2014/bkicons24.png);float:left;width:24px;height:24px;padding:0px 0px 0px 6px;cursor:pointer;background-position:0px -192px;background-repeat:no-repeat no-repeat;">&nbsp;</span><span id="$_shareBtn_qq2" title="分享到QQ空间" class="shareitm qqzone f-bkicons" style="background-image:url(http://blog.163.com/newpage/images/redesign2014/bkicons24.png);float:left;width:24px;height:24px;padding:0px 0px 0px 6px;cursor:pointer;background-position:0px -240px;background-repeat:no-repeat no-repeat;">&nbsp;</span><span id="$_shareBtn_qqweibo2" title="分享到腾讯微博" class="shareitm qqweibo f-bkicons" style="background-image:url(http://blog.163.com/newpage/images/redesign2014/bkicons24.png);float:left;width:24px;height:24px;padding:0px 0px 0px 6px;cursor:pointer;background-position:0px -288px;background-repeat:no-repeat no-repeat;">&nbsp;</span><div id="$_shareBtn_weixin2" title="分享到微信" class="shareitm weixin f-bkicons" style="background-image:url(http://blog.163.com/newpage/images/redesign2014/bkicons24.png);float:left;width:24px;height:24px;padding:0px 0px 0px 6px;cursor:pointer;position:relative;zoom:1;background-position:0px -336px;background-repeat:no-repeat no-repeat;"><div class="code2dimlayer fc06" style="color:#7f7f7f;visibility:hidden;position:absolute;left:-22px;bottom:28px;width:242px;height:113px;cursor:default;background-image:url(http://blog.163.com/newpage/images/redesign2014/code2dbg24.png);background-position:0px 0px;background-repeat:no-repeat no-repeat;"><img src="http://blog.163.com/bitMaxImageGen.do?url=http://blog.163.com/china_uv/blog/static/1171372672014111681232340&amp;w=100&amp;h=100&amp;act=qbbkfxtj_20150420_05" style="float:left;width:84px;height:84px;margin:11px -108px 0px 11px;" /><div class="tips" style="margin:30px 0px 0px 108px;color:#777777;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
</div>
<a class="close" style="color:#737373;"></a></div>
</div>
<div id="$_shareBtn_yixin2" title="分享到易信" class="shareitm yixin f-bkicons" style="background-image:url(http://blog.163.com/newpage/images/redesign2014/bkicons24.png);float:left;width:24px;height:24px;padding:0px 0px 0px 6px;cursor:pointer;position:relative;zoom:1;background-position:0px -384px;background-repeat:no-repeat no-repeat;"><div class="code2dimlayer fc06" style="color:#7f7f7f;visibility:hidden;position:absolute;left:-22px;bottom:28px;width:242px;height:113px;cursor:default;background-image:url(http://blog.163.com/newpage/images/redesign2014/code2dbg24.png);background-position:0px 0px;background-repeat:no-repeat no-repeat;"><img src="http://blog.163.com/bitMaxImageGen.do?url=http://blog.163.com/china_uv/blog/static/1171372672014111681232340&amp;w=100&amp;h=100&amp;act=qbbkfxtj_20150420_06" style="float:left;width:84px;height:84px;margin:11px -108px 0px 11px;" /><div class="tips" style="margin:30px 0px 0px 108px;color:#777777;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
</div>
<a class="close" style="color:#737373;"></a></div>
</div>
</div>
<a class="pright fc03 noul" target="_blank" href="http://www.lofter.com/app?act=qbbkrzydb_20150408_01" style="color:#0071bc;text-decoration:none;float:right;">下载LOFTER客户端</a></div>
</div>
<div style="color:#737373;font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:12px;line-height:normal;"></div>
<div class="nbw-blog-start" style="color:#737373;font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;font-size:12px;line-height:normal;"></div>
<div class="bct fc05 fc11 nbw-blog ztag" style="line-height:28px;font-size:16px;word-wrap:break-word;color:#737373;margin:15px 0px;padding:5px 0px;overflow:hidden;font-family:'Hiragino Sans GB W3', 'Hiragino Sans GB', Arial, Helvetica, simsun, u5b8bu4f53;">摘自：http://codingobjc.com/blog/2014/10/15/shi-yong-autolayoutshi-xian-uitableviewde-celldong-tai-bu-ju-he-ke-bian-xing-gao/index.html<div><br />
</div>
<div>附：真心感激衔接国际技术的同行们。</div>
<div><br />
</div>
<div><p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">本文翻译自：<a rel="nofollow" href="http://stackoverflow.com/questions/18746929/using-auto-layout-in-uitableview-for-dynamic-cell-layouts-variable-row-heights" style="color:#258fb8;line-height:24.5px;text-decoration:none;margin:0px;padding:0px;outline-width:0px;">stackoverflow</a></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">有人在<a rel="nofollow" href="http://stackoverflow.com/" style="color:#258fb8;line-height:24.5px;text-decoration:none;margin:0px;padding:0px;outline-width:0px;">stackoverflow</a>上问了一个问题：</p>
<blockquote style="font-size:14px;margin:10px 0px 0px;padding:15px 20px;border-left-width:5px;border-left-style:solid;border-left-color:#cccccc;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-align:justify;background-color:#dddddd;"><p style="line-height:24.5px;margin-top:0px;margin-bottom:0px;padding:0px;">如何在UITableViewCell中使用Autolayout来实现Cell的内容和子视图自动计算行高，并且能够保持平滑滚动的？</p>
</blockquote>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">这个问题得到了300+的支持和450+的收藏，答案得到了730+的支持，很详细的说明了如何在iOS7和iOS8上实现UITableView的动态行高功能，并且这个答案对实现UICollectionView的动态行高也具有参考意义。所以在这里将这个答案翻译了一下，希望对大家有所帮助。以下是答案的全文翻译：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">答案略长，如果你不喜欢细读，可以直接看这两个示例的代码：</p>
<ul style="margin:10px 0px 0px 20px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;"><li style="line-height:24.5px;margin:0px;padding:0px;"><a rel="nofollow" href="https://github.com/smileyborg/TableViewCellWithAutoLayoutiOS8" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;outline-width:0px;">iOS8的示例代码</a>&nbsp;- iOS8以上才支持</li>
<li style="line-height:24.5px;margin:0px;padding:0px;"><a rel="nofollow" href="https://github.com/smileyborg/TableViewCellWithAutoLayout" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;outline-width:0px;">iOS7的示例代码</a>&nbsp;- iOS7+</li>
</ul>
<h3 id="section" style="line-height:36.39999771118164px;margin:10px 0px 0px;padding:0px;font-size:1.3em;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-align:justify;background-color:#eeeeee;">核心概念</h3>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">不管你是在哪个iOS版本上做开发，以下步骤中的前两个步骤都是必须的：</p>
<h4 id="section-1" style="margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">1、设置好布局约束条件</h4>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">在<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">UITableViewCell</code>子类中，添加布局约束，使得cell子视图的边缘固定(pin)到cell的<strong style="line-height:24.5px;margin:0px;padding:0px;">contentView</strong>的边缘（最重要的是要有顶部和底部的边距约束条件）。<strong style="line-height:24.5px;margin:0px;padding:0px;">注意：不要将子视图的边距约束固定到cell本身上了，只能固定到cell的contentView上！</strong>&nbsp;确保每个子视图垂直方向上的内容压缩阻力(compression resistance)和吸附性约束(hugging constraints)没有被你添加的更高优先级的约束条件覆盖，让这些子视图的固有内容尺寸(intrinsic content size)来驱动contentView的高度。（<a rel="nofollow" href="http://stackoverflow.com/questions/22599069/what-is-the-content-compression-resistance-and-content-hugging-of-a-uiview" style="color:#258fb8;line-height:24.5px;text-decoration:none;margin:0px;padding:0px;outline-width:0px;">没看懂？点这里。</a>）</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">记住，要点是让cell的子视图与contentView之间产生垂直的连结，让它们能够对contentView“施加压力”，使contentView扩展以适合它们的尺寸。下面用一个cell和一些子视图作为示例，展示了你的<strong style="line-height:24.5px;margin:0px;padding:0px;">一些</strong>(不是全部！)布局约束应该看起来是什么样的：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;"><img src="http://i.stack.imgur.com/CTUPi.png" alt="" style="line-height:24.5px;border:0px;height:auto;margin:0px;padding:0px;" /></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">可以设想，随着更多的文本被添加到上例中“Multi-line body”那个label上，它需要垂直地增高以适合文本，这将有效地迫使cell的高度增加。（当然，你需要正确地设置约束条件，以使其正常的工作！）</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">如何设置正确的约束条件，绝对是使用Autolayout实现动态行高时<strong style="line-height:24.5px;margin:0px;padding:0px;">最难最重要</strong>的部分。如果弄错了，它就可能无法正常工作——所以，不要着急，慢慢来！我建议你用代码来设置布局约束，这样你就完全知道每个布局约束被加到了什么地方，出问题时也更容易调试。特别如果使用一些优秀开源库，可以让用代码设置约束和用Interface Builder设置约束一样简单直观，并且功能还更强大。这里也有一个由我设计和维护的专用库：<a rel="nofollow" href="https://github.com/smileyborg/PureLayout" style="color:#258fb8;line-height:24.5px;text-decoration:none;margin:0px;padding:0px;outline-width:0px;">https://github.com/smileyborg/PureLayout</a></p>
<ul style="margin:10px 0px 0px 20px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;"><li style="line-height:24.5px;margin:0px;padding:0px;">如果你用代码来设置布局约束，你应该在UITableViewCell子类的<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">updateConstraints</code>方法里面一次性完成。注意，<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">updateConstraints</code>可能不止被调用一次，因此要避免重复添加相同的布局约束。在<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">updateConstraints</code>中，可以将添加布局约束的代码包在一个if条件语句中(比如用一个叫<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">didSetupConstraints</code>的布尔属性，运行一次添加布局约束的代码后就将其设置为YES)，以确保不重复添加相同的布局约束。另外，更新已有布局约束的代码（比如调整布局约束的<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">constant</code>属性），也应该将它们放置在<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">updateConstraints&nbsp;</code>中，但是要在<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">didSetupConstraints</code>条件语句的外面，这样才可以确保每次调用的时候都会被执行。</li>
</ul>
<h4 id="cell" style="margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">2. Cell使用具有唯一性的重用标示符</h4>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">在cell里面，为每一组特定的约束条件，使用一个特定的cell重用标示符。换句话说，如果cell有多种不同的布局，每一种布局应当有其对应的重用标示符。（当cell有多种不同数量的子视图的时候，或者子视图以一种独特的方式布局的时候，这些情况下你就需要使用一个新的重用标示符。）</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">例如，要在一个cell中显示一条email消息，可能会有4种独特的布局：第一种，只有主题的消息；第二种，带主题和正文的消息；第三种，带主题和图片附件的消息；第四种，带主题、正文和图片附件的消息。每一种布局都需要完全不同的布局约束才能实现。因此，一旦cell被初始化并且布局约束被加到其中任意一种类型的cell上后，cell应当得到一个唯一的重用标示符来指定该cell类型。这就意味着，当你dequeue重用一个cell的时候，该类型cell的布局约束已经添加好了，可以直接使用。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">注意，由于固有内容尺寸的不同，具有相同布局约束的cell仍然可能具有不同的高度！不要混淆了布局（不同的约束）和由不同内容尺寸而计算出（通过相同的布局约束来计算）的不同视图frame这两个概念，它们根本是完全不同的两个东西。</p>
<ul style="margin:10px 0px 0px 20px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;"><li style="line-height:24.5px;margin:0px;padding:0px;">不要将拥有不同布局约束条件的cell丢到同一个重用池当中（也就是使用相同的重用标示符），然后又在每次dequeue过后将旧的约束移除，又从头开始重新添加约束。自动布局引擎内部并没有被设计来可以处理大规模的约束更改，你会看到大量的性能问题。</li>
</ul>
<h4 id="ios8---self-sizing-cells" style="margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">iOS8 - Self-Sizing Cells</h4>
<h5 id="section-2" style="line-height:23.239999771118164px;margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-align:justify;background-color:#eeeeee;">3. 启用估算行高</h5>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">在iOS8上，苹果将许多在iOS8之前比较难实现的东西都内置实现了。为了让cell实现self-sizing的机制，必须先将tableView的<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">rowHeight</code>属性设置为常量<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">UITableViewAutomaticDimension</code>。然后，只需将tableView的<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">estimatedRowHeight</code>属性设置为非零值即可开启行高估算功能，例如：</p>
<div style="margin:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;"><notextile style="line-height:24.5px;margin:0px;padding:0px;"><figure style="margin:10px 0px 0px;padding:5px 15px;border:1px solid #cccccc;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;"><figcaption style="line-height:22.049999237060547px;margin:0px;padding:0px;font-size:0.9em;position:inherit;"><div style="margin:0px;padding:0px;overflow-x:auto;"><table style="line-height:22.049999237060547px;margin:0px;padding:0px;border:none;border-spacing:0px;background-position:initial initial;background-repeat:initial initial;"><tbody style="margin:0px;padding:0px;"><tr style="margin:0px;padding:0px;"><td style="line-height:22.049999237060547px;margin:0px;padding:0px;"><pre style="line-height:1.5;white-space:pre-wrap;margin-top:0px;margin-bottom:0px;padding:0px 15px 0px 0px;border-right-width:1px;border-style:none solid none none;border-right-color:#cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;overflow-x:auto;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;text-align:right;background-image:none;background-position:initial initial;background-repeat:initial initial;"><span style="line-height:22.049999237060547px;margin:0px;padding:0px;">1</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">2</span> </pre></td>
<td style="line-height:22.049999237060547px;margin:0px;padding:0px 0px 0px 15px;width:728px;overflow-x:auto;"><pre style="line-height:1.5;white-space:pre-wrap;margin-top:0px;margin-bottom:0px;padding:0px;border:none;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;overflow-x:auto;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-image:none;background-position:initial initial;background-repeat:initial initial;"><code style="line-height:19.844999313354492px;margin:0px;padding:0px;border:none;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-image:none;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#268bd2 !important;">self</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">tableView</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">rowHeight</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">UITableViewAutomaticDimension</span><span style="margin:0px;padding:0px;color:#586e75 !important;">;</span> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#268bd2 !important;">self</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">tableView</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">estimatedRowHeight</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#2aa198 !important;">44.0</span><span style="margin:0px;padding:0px;color:#586e75 !important;">;</span> <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 设置为一个接近“平均”行高的值</span> </span></code></pre></td>
</tr>
</tbody>
</table>
</div>
</figcaption></figure></notextile></div>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">这样做就为tableView上还没有显示在屏幕上的cell提供了一个临时的估算的行高。然后，当cell即将滚入屏幕范围内的时候，会计算出实际的高度。为了确定每一行的实际高度，tableView会自动让每个cell基于其contentView的已知固定宽度（tableView的宽度，减去其他额外的，像section index或accessoryView这些宽度）和被加到contentView及其子视图上的自动布局约束规则来计算<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">contentView</code>的高度。一旦真正的行高被计算出来后，旧的估算的行高会被更新为这个真实的行高（并且其他任何需要对tableView的contentSize或contentOffset的更改都自动替你完成了）。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">一般来说，行高估算值不需要太精确——它只是被用来修正tableView中滚动条的大小的，当你在屏幕上滑动cell的时候，即便估算值不准确，tableView还是能很好地调节滚动条。将tableView的<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">estimatedRowHeight</code>属性设置成（在<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">viewDidLoad</code>或类似的方法中）一个接近于“平均”行高的常量值即可。<em style="line-height:24.5px;margin:0px;padding:0px;">只有行高变化很极端的时候（比如相差一个数量级），才会在滚动时产生滚动条“跳跃”的现象。这个时候，你才应当实现<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">tableView:estimatedHeightForRowAtIndexPath:</code>方法，为每一行返回一个更精确的估算值。</em></p>
<h4 id="ios7cell" style="margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">iOS7支持（需要自己实现cell尺寸自适应功能）</h4>
<h5 id="cell-1" style="line-height:23.239999771118164px;margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-align:justify;background-color:#eeeeee;">3. 完成一个完整的布局过程 &amp; 计算cell的高度</h5>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">首先，为每一个cell都初始化一个离屏(offscreen)实例，为每个重用标示符实例化一个与之对应的cell实例，这些cell完全用于高度计算。（离屏表示cell的引用被存储在view controller的一个属性或实例变量之中，并且这个cell绝对不会被用作<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">tableView:cellForRowAtIndexPath:</code>方法的返回值以实际呈现在屏幕上。）接着，这个cell的内容（例如，文本、图片等等）还必须和会被显示在table view中的内容完全一致。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">然后，强制cell立即更新子视图的布局，再用cell的<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">contentView</code>调用<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">systemLayoutSizeFittingSize:</code>方法计算出cell所需的高度是多少。使用<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">UILayoutFittingCompressedSize</code>参数可以得到适合cell中所有内容所需的最小尺寸。然后其高度就可以作为<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">tableView:heightForRowAtIndexPath:</code>方法的返回值。</p>
<h5 id="section-3" style="line-height:23.239999771118164px;margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-align:justify;background-color:#eeeeee;">4. 使用估算的行高</h5>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">如果你的table view超过了几十行，你会发现自动布局约束的解决方式在第一次加载table view的时候会迅速地卡住主线程。因为，在第一次加载过程中，每一行都会调用<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">tableView:heightForRowAtIndexPath:</code>方法（为了计算滚动条的尺寸）。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">iOS7中，你可以（也绝对应该）使用table view的<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">estimatedRowHeight</code>属性。这样会为还不在屏幕范围内的cell提供一个临时估算的行高值。然后，当这些cell即将要滚入屏幕范围内的时候，真实的行高值会被计算出来（通过<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">tableView:heightForRowAtIndexPath:</code>方法），估算的行高就会被替换掉。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">一般来说，行高估算值不需要太精确——它只是被用来修正tableView中滚动条的大小的，当你在屏幕上滑动cell的时候，即便估算值不准确，tableView还是能很好地调节滚动条。将tableView的<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">estimatedRowHeight</code>属性设置成（在<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">viewDidLoad</code>或类似的方法中）一个接近于“平均”行高的常量值即可。<em style="line-height:24.5px;margin:0px;padding:0px;">只有行高变化很极端的时候（比如相差一个数量级），才会在滚动时产生滚动条“跳跃”的现象。这个时候，你才应当实现<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">tableView:estimatedHeightForRowAtIndexPath:</code>方法，为每一行返回一个更精确的估算值。</em></p>
<h5 id="section-4" style="line-height:23.239999771118164px;margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-align:justify;background-color:#eeeeee;">5. 缓存行高（如果需要）</h5>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;">如果上面提到的你都做了，但是<code style="line-height:22.049999237060547px;margin:0px 3px;padding:1px 3px;border:1px solid #cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;background-position:initial initial;background-repeat:initial initial;">tableView:heightForRowAtIndexPath:</code>的性能仍然慢的不可接受。非常不幸，你需要给行高做一些缓存（这是苹果的工程师们给出的改进建议）。大体的思路是，第一次计算时让自动布局引擎解析约束条件，然后将计算出的行高缓存起来，以后所有对该cell的高度的请求都返回缓存值。当然，关键还要确保任何会导致cell高度变化的情况发生时你都清除了缓存的行高——这通常发生在cell的内容变化时或其他重大事件发生时（比如用户调节了动态类型文本大小(Dynamic Type text size)的滑动条）。</p>
<h5 id="ios7" style="line-height:23.239999771118164px;margin:10px 0px 0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-align:justify;background-color:#eeeeee;">iOS7示例代码（包含详细的注释）</h5>
<div style="margin:0px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;"><notextile style="line-height:24.5px;margin:0px;padding:0px;"><figure style="margin:10px 0px 0px;padding:5px 15px;border:1px solid #cccccc;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;background-color:#dddddd;"><figcaption style="line-height:22.049999237060547px;margin:0px;padding:0px;font-size:0.9em;position:inherit;"><div style="margin:0px;padding:0px;overflow-x:auto;"><table style="line-height:22.049999237060547px;margin:0px;padding:0px;border:none;border-spacing:0px;background-position:initial initial;background-repeat:initial initial;"><tbody style="margin:0px;padding:0px;"><tr style="margin:0px;padding:0px;"><td style="line-height:22.049999237060547px;margin:0px;padding:0px;"><pre style="line-height:1.5;white-space:pre-wrap;margin-top:0px;margin-bottom:0px;padding:0px 15px 0px 0px;border-right-width:1px;border-style:none solid none none;border-right-color:#cccccc;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;overflow-x:auto;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;text-align:right;background-image:none;background-position:initial initial;background-repeat:initial initial;"><span style="line-height:22.049999237060547px;margin:0px;padding:0px;">1</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">2</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">3</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">4</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">5</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">6</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">7</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">8</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">9</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">10</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">11</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">12</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">13</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">14</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">15</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">16</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">17</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">18</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">19</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">20</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">21</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">22</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">23</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">24</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">25</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">26</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">27</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">28</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">29</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">30</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">31</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">32</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">33</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">34</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">35</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">36</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">37</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">38</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">39</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">40</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">41</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">42</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">43</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">44</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">45</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">46</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">47</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">48</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">49</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">50</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">51</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">52</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">53</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">54</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">55</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">56</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">57</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">58</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">59</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">60</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">61</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">62</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">63</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">64</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">65</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">66</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">67</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">68</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">69</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">70</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">71</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">72</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">73</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">74</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">75</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">76</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">77</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">78</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">79</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">80</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">81</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">82</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">83</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">84</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">85</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">86</span> <span style="line-height:22.049999237060547px;margin:0px;padding:0px;">87</span> </pre></td>
<td style="line-height:22.049999237060547px;margin:0px;padding:0px 0px 0px 15px;width:1164px;overflow-x:auto;"><pre style="line-height:1.5;white-space:pre-wrap;margin-top:0px;margin-bottom:0px;padding:0px;border:none;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;overflow-x:auto;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-image:none;background-position:initial initial;background-repeat:initial initial;"><code style="line-height:19.844999313354492px;margin:0px;padding:0px;border:none;font-family:Menlo, Monaco, 'Andale Mono', 'lucida console', 'Courier New', monospace;font-size:0.9em;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-image:none;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#cb4b16 !important;">-</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">UITableViewCell</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;font-weight:bold !important;">tableView:</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">UITableView</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">tableView</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;font-weight:bold !important;">cellForRowAtIndexPath:</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">NSIndexPath</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">indexPath</span> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#586e75 !important;">{</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 判断indexPath对应cell的重用标示符，</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 取决于特定的布局需求（可能只有一个，也或者有多个）</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#268bd2 !important;">NSString</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">reuseIdentifier</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">...;</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 取出重用标示符对应的cell。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 注意，如果重用池(reuse pool)里面没有可用的cell，这个方法会初始化并返回一个全新的cell，</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 因此不管怎样，此行代码过后，你会可以得到一个布局约束已经完全准备好，可以直接使用的cell。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#268bd2 !important;">UITableViewCell</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">tableView</span> <span style="margin:0px;padding:0px;color:#859900 !important;">dequeueReusableCellWithIdentifier:</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">reuseIdentifier</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 用indexPath对应的数据内容来配置cell，例如：</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// cell.textLabel.text = someTextForThisCell;</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// ...</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 确保cell的布局约束被设置好了，因为它可能刚刚才被创建好。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 使用下面两行代码，前提是假设你已经在cell的updateConstraints方法中设置好了约束：</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">setNeedsUpdateConstraints</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">updateConstraintsIfNeeded</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 如果你使用的是多行的UILabel，不要忘了，preferredMaxLayoutWidth需要设置正确。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 如果你没有在cell的-[layoutSubviews]方法中设置，就在这里设置。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 例如：</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// cell.multiLineLabel.preferredMaxLayoutWidth = CGRectGetWidth(tableView.bounds);</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#cb4b16 !important;">return</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span><span style="margin:0px;padding:0px;color:#586e75 !important;">;</span> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#586e75 !important;">}</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#cb4b16 !important;">-</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">CGFloat</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;font-weight:bold !important;">tableView:</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">UITableView</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">tableView</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;font-weight:bold !important;">heightForRowAtIndexPath:</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">NSIndexPath</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">indexPath</span> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#586e75 !important;">{</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 判断indexPath对应cell的重用标示符，</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#268bd2 !important;">NSString</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">reuseIdentifier</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">...;</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 从cell字典中取出重用标示符对应的cell。如果没有，就创建一个新的然后存储在字典里面。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 警告：不要调用table view的dequeueReusableCellWithIdentifier:方法，因为这会导致cell被创建了但是又未曾被tableView:cellForRowAtIndexPath:方法返回，会造成内存泄露！</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#268bd2 !important;">UITableViewCell</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">self</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">offscreenCells</span> <span style="margin:0px;padding:0px;color:#859900 !important;">objectForKey:</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">reuseIdentifier</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#cb4b16 !important;">if</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">!</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">{</span> </span><span style="margin:0px;padding:0px;">        <span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">[[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">YourTableViewCellClass</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">alloc</span><span style="margin:0px;padding:0px;color:#586e75 !important;">]</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">init</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;">        <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">self</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">offscreenCells</span> <span style="margin:0px;padding:0px;color:#859900 !important;">setObject:</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#859900 !important;">forKey:</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">reuseIdentifier</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">}</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 用indexPath对应的数据内容来配置cell，例如：</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// cell.textLabel.text = someTextForThisCell;</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// ...</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 确保cell的布局约束被设置好了，因为它可能刚刚才被创建好。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 使用下面两行代码，前提是假设你已经在cell的updateConstraints方法中设置好了约束：</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">setNeedsUpdateConstraints</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">updateConstraintsIfNeeded</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 将cell的宽度设置为和tableView的宽度一样宽。 </span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 这点很重要。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 如果cell的高度取决于table view的宽度（例如，多行的UILabel通过单词换行等方式），</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 那么这使得对于不同宽度的table view，我们都可以基于其宽度而得到cell的正确高度。 </span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 但是，我们不需要在-[tableView:cellForRowAtIndexPath]方法中做相同的处理，</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 因为，cell被用到table view中时，这是自动完成的。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 也要注意，一些情况下，cell的最终宽度可能不等于table view的宽度。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 例如当table view的右边显示了section index的时候，必须要减去这个宽度。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">bounds</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">CGRectMake</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#2aa198 !important;">0.0f</span><span style="margin:0px;padding:0px;color:#586e75 !important;">,</span> <span style="margin:0px;padding:0px;color:#2aa198 !important;">0.0f</span><span style="margin:0px;padding:0px;color:#586e75 !important;">,</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">CGRectGetWidth</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">tableView</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">bounds</span><span style="margin:0px;padding:0px;color:#586e75 !important;">),</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">CGRectGetHeight</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">bounds</span><span style="margin:0px;padding:0px;color:#586e75 !important;">));</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 触发cell的布局过程，会基于布局约束计算所有视图的frame。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// （注意，你必须要在cell的-[layoutSubviews]方法中给多行的UILabel设置好preferredMaxLayoutWidth值；</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 或者在下面2行代码前手动设置！）</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">setNeedsLayout</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">layoutIfNeeded</span><span style="margin:0px;padding:0px;color:#586e75 !important;">];</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 得到cell的contentView需要的真实高度</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#268bd2 !important;">CGFloat</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">height</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">=</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">[</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">cell</span><span style="margin:0px;padding:0px;color:#586e75 !important;">.</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">contentView</span> <span style="margin:0px;padding:0px;color:#859900 !important;">systemLayoutSizeFittingSize:</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">UILayoutFittingCompressedSize</span><span style="margin:0px;padding:0px;color:#586e75 !important;">].</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">height</span><span style="margin:0px;padding:0px;color:#586e75 !important;">;</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 要为cell的分割线加上额外的1pt高度。因为分隔线是被加在cell底边和contentView底边之间的。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#268bd2 !important;">height</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">+=</span> <span style="margin:0px;padding:0px;color:#2aa198 !important;">1.0f</span><span style="margin:0px;padding:0px;color:#586e75 !important;">;</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#cb4b16 !important;">return</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;">height</span><span style="margin:0px;padding:0px;color:#586e75 !important;">;</span> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#586e75 !important;">}</span> </span><span style="margin:0px;padding:0px;"> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 注意：除非行高极端变化并且你已经明显的觉察到了滚动时滚动条的“跳跃”现象，你才需要实现此方法；否则，直接用tableView的estimatedRowHeight属性即可。</span> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#cb4b16 !important;">-</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">CGFloat</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;font-weight:bold !important;">tableView:</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">UITableView</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">tableView</span> <span style="margin:0px;padding:0px;color:#268bd2 !important;font-weight:bold !important;">estimatedHeightForRowAtIndexPath:</span><span style="margin:0px;padding:0px;color:#586e75 !important;">(</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">NSIndexPath</span> <span style="margin:0px;padding:0px;color:#586e75 !important;font-weight:bold !important;">*</span><span style="margin:0px;padding:0px;color:#586e75 !important;">)</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">indexPath</span> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#586e75 !important;">{</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 以必需的最小计算量，返回一个实际高度数量级之内的估算行高。</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// 例如：</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#93a1a1 !important;font-style:italic !important;">// </span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#cb4b16 !important;">if</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">([</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">self</span> <span style="margin:0px;padding:0px;color:#859900 !important;">isTallCellAtIndexPath:</span><span style="margin:0px;padding:0px;color:#268bd2 !important;">indexPath</span><span style="margin:0px;padding:0px;color:#586e75 !important;">])</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">{</span> </span><span style="margin:0px;padding:0px;">        <span style="margin:0px;padding:0px;color:#cb4b16 !important;">return</span> <span style="margin:0px;padding:0px;color:#2aa198 !important;">350.0f</span><span style="margin:0px;padding:0px;color:#586e75 !important;">;</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">}</span> <span style="margin:0px;padding:0px;color:#cb4b16 !important;">else</span> <span style="margin:0px;padding:0px;color:#586e75 !important;">{</span> </span><span style="margin:0px;padding:0px;">        <span style="margin:0px;padding:0px;color:#cb4b16 !important;">return</span> <span style="margin:0px;padding:0px;color:#2aa198 !important;">40.0f</span><span style="margin:0px;padding:0px;color:#586e75 !important;">;</span> </span><span style="margin:0px;padding:0px;">    <span style="margin:0px;padding:0px;color:#586e75 !important;">}</span> </span><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#586e75 !important;">}</span> </span></code></pre></td>
</tr>
</tbody>
</table>
</div>
</figcaption></figure></notextile></div>
<h3 id="section-5" style="line-height:36.39999771118164px;margin:10px 0px 0px;padding:0px;font-size:1.3em;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;text-align:justify;background-color:#eeeeee;">示例项目</h3>
<ul style="margin:10px 0px 0px 20px;padding:0px;color:#666666;font-family:HelveticaNeue-Light, 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;text-align:justify;background-color:#eeeeee;"><li style="line-height:24.5px;margin:0px;padding:0px;"><a rel="nofollow" href="https://github.com/smileyborg/TableViewCellWithAutoLayoutiOS8" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;outline-width:0px;">iOS8的示例代码</a>&nbsp;- iOS8以上才支持</li>
<li style="line-height:24.5px;margin:0px;padding:0px;"><a rel="nofollow" href="https://github.com/smileyborg/TableViewCellWithAutoLayout" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;outline-width:0px;">iOS7的示例代码</a>&nbsp;- iOS7+</li>
</ul>
</div>
</div></body></html>