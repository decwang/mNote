<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2015-09-22T01:25:32Z"/><meta name="updated" content="2016-10-08T09:09:07Z"/><title> iOS Create an CGImageSource     分类： iOS2014-01-30 00:10 1741人阅读 评论(0) 收藏 举报  iosuiimageImage IO  I</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="article_title" style="margin:5px 0px;font-size:20px;line-height:30px;font-family:'Microsoft YaHei';">&nbsp;<h1 style="margin:0px;padding:0px;display:inline;font-weight:normal;font-size:20px;vertical-align:middle;"><span class="link_title"><a href="http://blog.csdn.net/langya393645864/article/details/18864313" style="color:#333333;text-decoration:none;">iOS Create an CGImageSource&nbsp;</a></span></h1>
</div>
<div class="article_manage" style="padding:5px 0px;color:#999999;font-size:12px;line-height:24px;font-family:Arial;text-align:right;"><span class="link_categories" style="margin:0px 5px;float:left;">分类：&nbsp;<a href="http://blog.csdn.net/langya393645864/article/category/1879105" style="color:#ff9900;text-decoration:none;">iOS</a></span><span class="link_postdate" style="margin:0px 5px 0px 0px;">2014-01-30 00:10</span>&nbsp;<span class="link_view" title="阅读次数" style="margin:0px 5px;padding:0px 0px 0px 14px;background-image:url(http://static.blog.csdn.net/images/ico_view.png);background-position:0% 50%;background-repeat:no-repeat no-repeat;">1741人阅读</span>&nbsp;<span class="link_comments" title="评论次数" style="margin:0px 5px;padding:0px 0px 0px 14px;background-image:url(http://static.blog.csdn.net/images/ico_comm.png);background-position:0% 50%;background-repeat:no-repeat no-repeat;"><a href="http://blog.csdn.net/langya393645864/article/details/18864313#comments" style="color:#ff9900;text-decoration:none;">评论</a>(0)</span>&nbsp;<span class="link_collect" style="margin:0px 5px;"><a title="收藏" style="color:#ff9900;">收藏</a></span>&nbsp;<span class="link_report" style="margin:0px 5px;"><a href="http://blog.csdn.net/langya393645864/article/details/18864313#report" title="举报" style="color:#ff9900;text-decoration:none;">举报</a></span></div>
<div class="tag2box" style="margin:10px 0px;font-family:Arial, Console, Verdana, 'Courier New';font-size:12px;line-height:normal;"><a href="http://www.csdn.net/tag/ios" target="_blank" style="color:#ff9900;text-decoration:none;display:inline-block;padding:4px 10px;line-height:12px;margin-right:10px;border:1px solid #eeeeee;background-color:#eeeeee;border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;">ios</a><a href="http://www.csdn.net/tag/uiimage" target="_blank" style="color:#ff9900;text-decoration:none;display:inline-block;padding:4px 10px;line-height:12px;margin-right:10px;border:1px solid #eeeeee;background-color:#eeeeee;border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;">uiimage</a><a href="http://www.csdn.net/tag/Image%20IO" target="_blank" style="color:#ff9900;text-decoration:none;display:inline-block;padding:4px 10px;line-height:12px;margin-right:10px;border:1px solid #eeeeee;background-color:#eeeeee;border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;">Image IO</a></div>
<div id="article_content" class="article_content" style="margin:20px 0px 0px;line-height:26px;font-family:Arial;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;">Image I/O 是 iOS SDK 提供的一个图片编解码器，支持&nbsp;<span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">JPEG, JPEG2000, RAW, TIFF, BMP, GIF, and PNG ，支持 metadata 读取，提供颜色管理。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">CGImageSource ：数据读取的接口，支持 URL, CFData, or data consumer 。提供读取 CGImage, Thumbnail CGImage, image properties 等等。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">CGImageDestination：数据写入的接口，支持 URL, CFData, or data consumer 。可写入单个或多个 CGImage, 包括 Thumbnail CGImage, image properties</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">一、Image I/O 读取 ALAssets Library 图片数据&nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">&nbsp;ALAssets Library&nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">ALAssetsLibrary : 提供访问 Photos App 下的图片与视频的功能。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">ALAssetsGroup ：表示一个有序的 ALAsset 的集合分组。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">ALAsset ：表示 Photos 中的一项图片与视频。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">ALAssetRepresentation ：表示 ALAsset 中的一种展示。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:13px;">1. 实例一个 ALAssetsLibrary :</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:12px;">ALAssetsLibrary _assetsLibrary = [[ALAssetsLibrary alloc] init];</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:12px;">2. 遍历 ALAssetsGroup ：<br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;font-size:12px;">[_assetsLibrary enumerateGroupsWithTypes:ALAssetsGroupAll usingBlock:^(ALAssetsGroup *group, BOOL *stop) {}&nbsp;</span><span style="font-family:'Lucida Grande', 'Lucida Sans Unicode', Helvetica, Arial, Verdana, sans-serif;">failureBlock:^(NSError *error){} ];</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">3. 遍历 ALAsset ：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">[group enumerateAssetsUsingBlock:^(ALAsset *result, NSUInteger index, BOOL *stop) {}];</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">4. 读取 NSData :</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">ALAssetRepresentation *representation = result.defaultRepresentation;</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">CGImageRef cImage = [representation fullScreenImage];</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">uint8_t *buffer = (uint8_t *)malloc(representation.size);</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">NSError *error;</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">NSUInteger length = [representation getBytes:buffer fromOffset:0 length:representation.size error:&amp;error];</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">NSData *data = [NSData dataWithBytes:buffer length:length];</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">5. 构造 CGImageSource :&nbsp;</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">CGImageSourceRef cImageSource = CGImageSourceCreateWithData((__bridge CFDataRef)data, NULL);</p>
<br />
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">二、Image I/O 从 NSBundle 读取图片数据&nbsp;</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">1.URL 直接生成 CGImageSource</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">NSString *imagePath =[[NSBundle mainBundle] pathForResource:@"image" ofType:@"jpg"];</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">CGImageSourceRef &nbsp;cImageSource = CGImageSourceCreateWithURL((__bridge CFURLRef)[NSURL fileURLWithPath:imagePath], NULL);</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">三、 Image I/O 从 UIImage 读取图片数据</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">1. UIImageJPEGRepresentation/UIImagePNGRepresentation/CGImageGetDataProvider</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">NSData *UIImageJPEGRepresentation(UIImage *image, CGFloat compressionQuality);</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">NSData *UIImagePNGRepresentation(UIImage *image);</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">CGImageSourceRef cImageSource = CGImageSourceCreateWithData(data);</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">CGDataProvider cDataProvider = CGImageGetDataProvider(cImage);</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">CGImageSourceRef cImageSource = CGImageSourceCreateWithDataProvider(cDataProvider);</p>
</div></body></html>