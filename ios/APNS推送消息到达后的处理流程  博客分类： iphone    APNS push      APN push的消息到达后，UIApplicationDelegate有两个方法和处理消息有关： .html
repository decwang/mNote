<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2015-04-02T06:43:21Z"/><meta name="updated" content="2015-04-02T06:43:22Z"/><title>APNS推送消息到达后的处理流程  博客分类： iphone    APNS push      APN push的消息到达后，UIApplicationDelegate有两个方法和处理消息有关： </title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="blog_title" style="margin-bottom:15px;font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:12px;line-height:18px;"><h3 style="font-size:16px;line-height:1.5em;margin:0px 0px 0.5em;padding:10px 0px 0px;"><a href="http://gypgyp.iteye.com/blog/1871006" style="color:#108ac6;">APNS推送消息到达后的处理流程</a></h3>
<ul class="blog_categories" style="margin:0px;padding:0px;list-style-type:none;"><strong>博客分类：</strong>&nbsp;<li style="margin:0px 5px 0px 0px;padding:0px;list-style-type:none;display:inline;"><a href="http://gypgyp.iteye.com/category/183678" style="color:#108ac6;">iphone</a></li>
</ul>
<div class="news_tag" style="clear:both;margin:10px 0px 5px;line-height:20px;"><a href="http://www.iteye.com/blogs/tag/APNS%20push" style="color:#ffffff;text-decoration:none;display:inline-block;margin:0px 5px 5px 0px;padding:0px 10px;background-color:#aab5c3;border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;">APNS push</a>&nbsp;</div>
</div>
<div id="blog_content" class="blog_content" style="line-height:1.8em;font-family:Helvetica, Tahoma, Arial, sans-serif;"><div class="iteye-blog-content-contain"><p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;">&nbsp;<span style="letter-spacing:0px;">APN push的消息到达后，UIApplicationDelegate有两个方法和处理消息有关：</span></span></p>
<ol style="font-size:1em;line-height:1.4em;margin:0px 0px 1.5em;padding:0px;"><li style="font-size:9px;margin:0px;padding:0px;text-align:justify;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">application:didReceiveRemoteNotification:</span></li>
<li style="font-size:9px;margin:0px;padding:0px;text-align:justify;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">application:didFinishLaunchingWithOptions:</span></li>
</ol>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;text-align:justify;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">下面的流程图显示了app在处理推送消息的一个流程。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;text-align:justify;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;text-align:justify;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">测试推送的流程时，有两个难题：</span></p>
<ol style="font-size:1em;line-height:1.4em;margin:0px 0px 1.5em;padding:0px;"><li style="font-size:9px;margin:0px;padding:0px;text-align:justify;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">推送需要服务端配合，搭建整个远程推送的环境很困难。</span></li>
<li style="font-size:9px;margin:0px;padding:0px;text-align:justify;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">在测试程序没有运行时，没有有效的办法检测程序的处理流程。</span></li>
</ol>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">针对上面的问题，在测试过程中分别找到了对应的处理方式。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';color:#103ffb;"><span style="font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;"><span style="letter-spacing:0px;">第一个问题的解决办法是用本地推送来代替远程推送。经查阅apple的官方文档：<br />
</span><span style="letter-spacing:0px;">http://developer.apple.com/library/mac/#documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/WhatAreRemoteNotif.html#//apple_ref/doc/uid/TP40008194-CH102-SW1</span></span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">远程推送和本地推送在处理流程上是一致的，不同的地方是delegate的方法和参数不同。所以只是测试推送在应用端的处理流程的话，是可以用本地推送模拟远程推送的。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">第二个问题的解决方案是输出的重定向：参靠下面的网址：</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:12px;line-height:normal;font-family:'Lucida Grande';color:#103ffb;"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;"><a href="http://stackoverflow.com/questions/2103141/iphone-once-i-have-redirected-nslog-to-a-file-how-do-i-revert-it-to-the-consol" style="color:#108ac6;">http://stackoverflow.com/questions/2103141/iphone-once-i-have-redirected-nslog-to-a-file-how-do-i-revert-it-to-the-consol</a></span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:12px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">具体代码如下：</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; NSString *documentsDirectory = [paths objectAtIndex:0];</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; NSString *logPath = [documentsDirectory stringByAppendingPathComponent:@"console.log"];</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; freopen([logPath cStringUsingEncoding:NSASCIIStringEncoding],"a+",stderr);</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp;&nbsp; &nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp; &nbsp; NSLog(@"application didFinishLaunchingWithOptions");</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">将stderr重定向到一个文件后，所有NSLog的输出就由console转到了指定的文件。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="font-family:SimSun, 宋体, tahoma, arial, helvetica, sans-serif;font-size:14px;">&nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';"><span style="letter-spacing:0px;"><br />
<img alt="" src="http://dl2.iteye.com/upload/attachment/0084/6306/945f30ae-2f3d-3187-ac79-b6eec20a3862.png" style="border:0px;" /><br />
&nbsp;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';">&nbsp;</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;font-size:9px;line-height:normal;font-family:'Lucida Grande';">&nbsp;</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">&nbsp;</p>
</div>
</div>
<div class="attachments" style="border-top-width:1px;border-top-style:solid;border-top-color:#999999;margin-top:10px;font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:12px;line-height:18px;"><ul style="margin:5px;padding:5px;list-style:none;border:1px solid #cccccc;"><li style="margin:0px 0px 0.25em 30px;padding:0px;"><a href="http://dl.iteye.com/topics/download/4520e618-c62f-3cad-8b98-cd9fd1238502" style="color:#108ac6;">tabnav4.zip</a>&nbsp;(84.9 KB)</li>
<li style="margin:0px 0px 0.25em 30px;padding:0px;">下载次数: 6</li>
</ul>
<ul style="margin:5px;padding:5px;list-style:none;border:1px solid #cccccc;"><li style="margin:0px 0px 0.25em 30px;padding:0px;"><a href="http://dl.iteye.com/topics/download/8d8d7cc6-f0c0-3c87-a28b-89c55155021c" style="color:#108ac6;">APN的客户端处理流程.docx.zip</a>&nbsp;(58.6 KB)</li>
<li style="margin:0px 0px 0.25em 30px;padding:0px;">下载次数: 14</li>
</ul>
<ul style="margin:5px;padding:5px;list-style:none;border:1px solid #cccccc;"><li style="margin:0px 0px 0.25em 30px;padding:0px;"><a href="http://dl.iteye.com/topics/download/aa883328-7ec7-3bef-8913-8139b57c16aa" style="color:#108ac6;">apns客户端处理流程.vsd.zip</a>&nbsp;(41.4 KB)</li>
<li style="margin:0px 0px 0.25em 30px;padding:0px;">下载次数: 6</li>
</ul>
<ul style="margin:5px;padding:5px;list-style:none;border:1px solid #cccccc;"><li style="margin:0px 0px 0.25em 30px;padding:0px;"><a href="http://gypgyp.iteye.com/blog/1871006#" style="color:#108ac6;">查看图片附件</a></li>
</ul>
</div></body></html>