<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2016-07-19T09:17:47Z"/><meta name="updated" content="2016-07-19T09:17:51Z"/><title> NSProxy实现AOP方便为ios应用实现异常处理策略    2012-12-23 22:07 10163人阅读 评论(7) 收藏 举报     分类：   【iOS开发】（12）     版权</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="article_title" style="margin-bottom:21px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;">&nbsp;<h1 style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;font-size:18px;"><span class="link_title"><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535" style="text-decoration:none;color:#000000;">NSProxy实现AOP方便为ios应用实现异常处理策略</a></span></h1>
</div>
<div class="article_manage clearfix" style="color:#999999;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:22px;font-family:Arial;text-align:right;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ededed;margin:0px -20px 10px;padding:0px 20px 5px;overflow:hidden;widows:1;"><div class="article_r"><span class="link_postdate" style="margin:0px 16px 0px 0px;">2012-12-23 22:07</span>&nbsp;<span class="link_view" title="阅读次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 24px;display:inline-block;background:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon.png) 0px -25px no-repeat;">10163人阅读</span>&nbsp;<span class="link_comments" title="评论次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 17px;display:inline-block;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-attachment:initial;background-color:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:0px -43px;background-repeat:no-repeat;"><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#comments" style="text-decoration:none;color:#c88326;">评论</a>(7)</span>&nbsp;<span class="link_collect tracking-ad" data-mod="popu_171" style="margin:0px 16px 0px 5px;display:inline-block;padding-left:17px;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-position:0px -62px;background-repeat:no-repeat;"><a title="收藏" target="_blank" style="color:#c88326;">收藏</a></span>&nbsp;<span class="link_report" style="margin:0px 16px 0px 5px;display:inline-block;padding-left:17px;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-position:0px -81px;background-repeat:no-repeat;"><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#report" title="举报" style="text-decoration:none;color:#c88326;">举报</a></span></div>
</div>
<div class="category clearfix" style="margin:0px -20px;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ededed;padding:0px 20px;height:46px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;"><div class="category_l" style="display:inline-block;font-size:14px;color:#333333;"><img src="http://static.blog.csdn.net/images/category_icon.jpg" style="border:none;vertical-align:middle;" />&nbsp;<span style="display:inline-block;vertical-align:middle;">分类：</span></div>
&nbsp;<div class="category_r" style="display:inline-block;font-size:14px;color:#df3434;"><label style="display:inline-block;margin-left:15px;cursor:pointer;line-height:46px;position:relative;">【iOS开发】（12）&nbsp;<img class="arrow-down" src="http://static.blog.csdn.net/images/arrow_triangle%20_down.jpg" style="border:none;display:inline;" /></label></div>
</div>
<div class="bog_copyright" style="padding:20px 0px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;"><p class="copyright_p" style="margin-top:0px;margin-bottom:0px;padding:0px 0px 0px 10px;height:14px;line-height:14px;border-left-style:solid;border-left-width:3px;border-left-color:#e41c1e;color:#666666;font-size:14px;">版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
</div>
<div id="article_content" class="article_content" style="margin:35px 0px;font-size:15px;color:#555555;line-height:35px;font-family:'microsoft yahei';font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;">前段时间关注过objc实现的<a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming" style="text-decoration:none;color:#0c89cf;">AOP</a>。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">在GitHub找到了其中的两个库：<a href="https://github.com/moszi/AOP-in-Objective-C" style="text-decoration:none;color:#0c89cf;">AOP-in-Objective-C</a>&nbsp;和&nbsp;<a href="https://github.com/ndcube/AOP-for-Objective-C" style="text-decoration:none;color:#0c89cf;">AOP-for-Objective-C</a></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">第一个是基于NSProxy来实现的；第二个是基于GCD以及block实现的；</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">两者都使用了Cocoa的运行时编程技术，将拦截器注入给代理对象，使其干涉真是对象的执行顺序从而达到给代码增加“切面”的目的，这里的模式就是通常的代理模式。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">因为时间关系，暂时只看了第一个库的代码，下面简短地分析一下。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">NSProxy：如其名，它出现的目的就是为了来“代理”一个真实对象的。这是Foundation库的内置实现。大部门人都知道NSObject是通常Cocoa中的根类，没错，但其实根类并不止一个，NSProxy也是跟NSObject的根类，只是它是个抽象类并且不是用于通常意义上的编程目的，所以不是那么广为人知（事实上我也是今天才知道）。并且NSObject看到它你以为它是个类。但今天看NSProxy定义的时候，我发现它的头文件里是这样定义的：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_plain" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:938.516px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;background-color:#e7e5dc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;border-left-width:3px;border-left-style:solid;border-left-color:#999999;background-color:#f8f8f8;"><b>[plain]</b>&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="ViewSource" title="view plain" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="CopyToClipboard" title="copy" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">copy</a><div style="position:absolute;left:479px;top:1045px;width:29px;height:15px;z-index:99;"><embed id="ZeroClipboardMovie_1" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="29" height="15" name="ZeroClipboardMovie_1" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=29&amp;height=15" wmode="transparent" /></div>
</span><span data-mod="popu_169">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="PrintSource" title="print" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">print</a></span><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="About" title="?" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">?</a></div>
</div>
<ol start="1" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;color:#5c5c5c;background-color:#ffffff;margin:0px 0px 1px 45px !important;"><li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">@interface&nbsp;NSProxy&nbsp;&lt;NSObject&gt;&nbsp;&nbsp;</span></span></li>
</ol>
</div>
<br />
开始我很莫名其妙，如果是继承自NSObject的话，应该是个冒号。这种写法明显就是实现协议的写法啊。于是，查看了一下资料，果然还有个NSObject的协议，并且NSObject类自身也实现了NSObject协议。具体资料请看<a href="http://mobile.51cto.com/iphone-274229.htm" style="text-decoration:none;color:#0c89cf;">这篇文章</a>。<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">NSProxy与NSObject一虚一实，并且它们都实现了NSObject协议。这让NSProxy的实现类能够很好地“代理”NSObject子类，并且把NSObject协议抽象出来，也让他们能够共享某些行为。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">来看看它是如何工作的（测试代码见AOPLibTest.m文件）：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">在你需要使用AOP的地方，你首先需要实例化一个对象，比如你需要实例化一个NSMutableArray，你需要使用AOPProxy来实例化它：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:938.516px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;background-color:#e7e5dc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;border-left-width:3px;border-left-style:solid;border-left-color:#999999;background-color:#f8f8f8;"><b>[cpp]</b>&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="ViewSource" title="view plain" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="CopyToClipboard" title="copy" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">copy</a><div style="position:absolute;left:470px;top:1374px;width:29px;height:15px;z-index:99;"><embed id="ZeroClipboardMovie_2" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="29" height="15" name="ZeroClipboardMovie_2" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=2&amp;width=29&amp;height=15" wmode="transparent" /></div>
</span><span data-mod="popu_169">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="PrintSource" title="print" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">print</a></span><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="About" title="?" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">?</a></div>
</div>
<ol start="1" class="dp-cpp" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;color:#5c5c5c;background-color:#ffffff;margin:0px 0px 1px 45px !important;"><li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">NSMutableArray*&nbsp;testArray&nbsp;=&nbsp;(NSMutableArray*)[[AOPProxy&nbsp;alloc]&nbsp;initWithNewInstanceOfClass:[NSMutableArray&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">]];&nbsp;&nbsp;</span></span></li>
</ol>
</div>
<br />
这里，其实是间接实例化。它提供了一个接口，你把你的类名传给它，由它给你实例化。事实上，这是一种注入方式，而看完这个方法的定义你就会看到其实它返回给你的并不是NSMutableArray的一个实例（其实是AOPProxy，而<span style="color:#ff0000;">它们之所以能互相强制转换是因为他们都实现了NSObject协议</span>）：<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:938.516px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;background-color:#e7e5dc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;border-left-width:3px;border-left-style:solid;border-left-color:#999999;background-color:#f8f8f8;"><b>[cpp]</b>&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="ViewSource" title="view plain" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="CopyToClipboard" title="copy" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">copy</a><div style="position:absolute;left:470px;top:1598px;width:29px;height:15px;z-index:99;"><embed id="ZeroClipboardMovie_3" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="29" height="15" name="ZeroClipboardMovie_3" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=3&amp;width=29&amp;height=15" wmode="transparent" /></div>
</span><span data-mod="popu_169">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="PrintSource" title="print" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">print</a></span><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="About" title="?" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">?</a></div>
</div>
<ol start="1" class="dp-cpp" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;color:#5c5c5c;background-color:#ffffff;margin:0px 0px 1px 45px !important;"><li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">-&nbsp;(id)&nbsp;initWithNewInstanceOfClass:(Class)&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;create&nbsp;a&nbsp;new&nbsp;instance&nbsp;of&nbsp;the&nbsp;specified&nbsp;class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;newInstance&nbsp;=&nbsp;[[<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;alloc]&nbsp;init];&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;invoke&nbsp;my&nbsp;designated&nbsp;initializer</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;[self&nbsp;initWithInstance:newInstance];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;release&nbsp;the&nbsp;new&nbsp;instance</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;[newInstance&nbsp;release];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;finally&nbsp;return&nbsp;the&nbsp;configured&nbsp;self</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">return</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;self;&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">}&nbsp;&nbsp;</span></li>
</ol>
</div>
<br />
上面的self指代的就是AOPProxy，其中的initWithInstance方法：<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:938.516px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;background-color:#e7e5dc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;border-left-width:3px;border-left-style:solid;border-left-color:#999999;background-color:#f8f8f8;"><b>[cpp]</b>&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="ViewSource" title="view plain" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="CopyToClipboard" title="copy" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">copy</a><div style="position:absolute;left:470px;top:1986px;width:29px;height:15px;z-index:99;"><embed id="ZeroClipboardMovie_4" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="29" height="15" name="ZeroClipboardMovie_4" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=4&amp;width=29&amp;height=15" wmode="transparent" /></div>
</span><span data-mod="popu_169">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="PrintSource" title="print" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">print</a></span><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="About" title="?" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">?</a></div>
</div>
<ol start="1" class="dp-cpp" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;color:#5c5c5c;background-color:#ffffff;margin:0px 0px 1px 45px !important;"><li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">-&nbsp;(id)&nbsp;initWithInstance:(id)anObject&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;parentObject&nbsp;=&nbsp;[anObject&nbsp;retain];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;methodStartInterceptors&nbsp;=&nbsp;[[NSMutableArray&nbsp;alloc]&nbsp;init];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;methodEndInterceptors&nbsp;=&nbsp;[[NSMutableArray&nbsp;alloc]&nbsp;init];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">return</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;self;&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">}&nbsp;&nbsp;</span></li>
</ol>
</div>
<br />
可以看到，它在内部hold住了真实对象，并且实例化了两个数组，用来存储方法执行前后的拦截器集合。<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">下面，我们可以为NSMutableArray增加拦截器了：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:938.516px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;background-color:#e7e5dc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;border-left-width:3px;border-left-style:solid;border-left-color:#999999;background-color:#f8f8f8;"><b>[cpp]</b>&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="ViewSource" title="view plain" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="CopyToClipboard" title="copy" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">copy</a><div style="position:absolute;left:470px;top:2319px;width:29px;height:15px;z-index:99;"><embed id="ZeroClipboardMovie_5" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="29" height="15" name="ZeroClipboardMovie_5" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=5&amp;width=29&amp;height=15" wmode="transparent" /></div>
</span><span data-mod="popu_169">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="PrintSource" title="print" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">print</a></span><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="About" title="?" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">?</a></div>
</div>
<ol start="1" class="dp-cpp" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;color:#5c5c5c;background-color:#ffffff;margin:0px 0px 1px 45px !important;"><li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">[(AOPProxy*)testArray&nbsp;interceptMethodStartForSelector:@selector(addObject:)&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withInterceptorTarget:self&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interceptorSelector:@selector(&nbsp;addInterceptor:&nbsp;)];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;[(AOPProxy*)testArray&nbsp;interceptMethodEndForSelector:@selector(removeObjectAtIndex:)&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;withInterceptorTarget:self&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interceptorSelector:@selector(&nbsp;removeInterceptor:&nbsp;)];&nbsp;&nbsp;</span></li>
</ol>
</div>
<br />
因为这两个方法是AOPProxy的实例方法，所以在编写的时候还是需要在强制转回来（其实你在XCode里跟踪的时候，这里的testArray一直都是APOProxy类型的对象，因为一开始他就是被AOPPorxy allo出来的）。这两个方法的实现很简单，只是将拦截器假如相应的数组中去，待后面取出来执行。<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:938.516px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;background-color:#e7e5dc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;border-left-width:3px;border-left-style:solid;border-left-color:#999999;background-color:#f8f8f8;"><b>[cpp]</b>&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="ViewSource" title="view plain" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="CopyToClipboard" title="copy" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">copy</a><div style="position:absolute;left:470px;top:2651px;width:29px;height:15px;z-index:99;"><embed id="ZeroClipboardMovie_6" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="29" height="15" name="ZeroClipboardMovie_6" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=6&amp;width=29&amp;height=15" wmode="transparent" /></div>
</span><span data-mod="popu_169">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="PrintSource" title="print" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">print</a></span><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="About" title="?" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">?</a></div>
</div>
<ol start="1" class="dp-cpp" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;color:#5c5c5c;background-color:#ffffff;margin:0px 0px 1px 45px !important;"><li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">[testArray&nbsp;addObject:[NSNumber&nbsp;numberWithInt:1]];&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;[testArray&nbsp;removeObjectAtIndex:0];&nbsp;&nbsp;</span></li>
</ol>
</div>
<br />
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">好了，看起来这里开始调用某个对象本身的行为了。为什么说看起来呢？难道不是吗。当然不是，我在上面已经说过了，这里只是取名为testArray事实上它并不是NSMutableArray的实例，而是AOPProxy的实例。但为什么它还是可以调用addObject这个方法呢，因为它被强制转换为NSMutableArray类型了，编辑器能够接受这样的类型转换，也就是这是合法的。所以编辑器认为它就是NSMutableArray类型的对象了，所以是可以这么调用的，但后面你会看到。在运行时其实编译器知道了它不是真实的NSMutableArray类型（也就是说它无法响应addObject以及removeObjectAtIndex这两个方法），所以把它交给了另一个专门的方法来处理这些无法响应的消息：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="o" style="margin:0px;padding:0px;border:0px;font-weight:bold;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">-</span><span style="color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;"> </span><span class="p" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">(</span><span class="kt" style="margin:0px;padding:0px;border:0px;color:#445588;font-weight:bold;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">void</span><span class="p" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">)</span><span class="nl" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">forwardInvocation:</span><span class="p" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">(</span><span class="n" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">NSInvocation</span><span style="color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;"> </span><span class="o" style="margin:0px;padding:0px;border:0px;font-weight:bold;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">*</span><span class="p" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">)</span><span class="n" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">anInvocation;</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="n" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">这个方法其实是继承自NSPorxy，NSProxy对它的实现其实就是抛出个异常，子类需要重新实现它，把它消息传递给真实的对象。详细信息参考<a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/Reference/Reference.html#//apple_ref/occ/cl/NSObject" style="text-decoration:none;color:#0c89cf;">官方文档</a>！</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="n" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">来看看它的实现：</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:938.516px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;background-color:#e7e5dc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;border-left-width:3px;border-left-style:solid;border-left-color:#999999;background-color:#f8f8f8;"><b>[cpp]</b>&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="ViewSource" title="view plain" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="CopyToClipboard" title="copy" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">copy</a><div style="position:absolute;left:470px;top:3029px;width:29px;height:15px;z-index:99;"><embed id="ZeroClipboardMovie_7" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="29" height="15" name="ZeroClipboardMovie_7" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=7&amp;width=29&amp;height=15" wmode="transparent" /></div>
</span><span data-mod="popu_169">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="PrintSource" title="print" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">print</a></span><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="About" title="?" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">?</a></div>
</div>
<ol start="1" class="dp-cpp" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;color:#5c5c5c;background-color:#ffffff;margin:0px 0px 1px 45px !important;"><li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">-&nbsp;(</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">void</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">)forwardInvocation:(NSInvocation&nbsp;*)anInvocation;&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">{&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;SEL&nbsp;aSelector&nbsp;=&nbsp;[anInvocation&nbsp;selector];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;check&nbsp;if&nbsp;the&nbsp;parent&nbsp;object&nbsp;responds&nbsp;to&nbsp;the&nbsp;selector&nbsp;...</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">if</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;(&nbsp;[parentObject&nbsp;respondsToSelector:aSelector]&nbsp;)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[anInvocation&nbsp;setTarget:parentObject];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;Intercept&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;method.</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSAutoreleasePool&nbsp;*pool&nbsp;=&nbsp;[[NSAutoreleasePool&nbsp;alloc]&nbsp;init];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">for</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;(&nbsp;</span><span class="datatypes" style="margin:0px;padding:0px;border:none;color:#2e8b57;font-weight:bold;background-color:inherit;">int</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;[methodStartInterceptors&nbsp;count];&nbsp;i++&nbsp;)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;first&nbsp;search&nbsp;for&nbsp;this&nbsp;selector&nbsp;...</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AOPInterceptorInfo&nbsp;*oneInfo&nbsp;=&nbsp;[methodStartInterceptors&nbsp;objectAtIndex:i];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">if</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;(&nbsp;[oneInfo&nbsp;interceptedSelector]&nbsp;==&nbsp;aSelector&nbsp;)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;extract&nbsp;the&nbsp;interceptor&nbsp;info</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;target&nbsp;=&nbsp;[oneInfo&nbsp;interceptorTarget];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEL&nbsp;selector&nbsp;=&nbsp;[oneInfo&nbsp;interceptorSelector];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;finally&nbsp;invoke&nbsp;the&nbsp;interceptor</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(NSObject&nbsp;*)&nbsp;target&nbsp;performSelector:selector&nbsp;withObject:anInvocation];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[pool&nbsp;release];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;Invoke&nbsp;the&nbsp;original&nbsp;method&nbsp;...</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[self&nbsp;invokeOriginalMethod:anInvocation];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;Intercept&nbsp;the&nbsp;ending&nbsp;of&nbsp;the&nbsp;method.</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSAutoreleasePool&nbsp;*pool2&nbsp;=&nbsp;[[NSAutoreleasePool&nbsp;alloc]&nbsp;init];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">for</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;(&nbsp;</span><span class="datatypes" style="margin:0px;padding:0px;border:none;color:#2e8b57;font-weight:bold;background-color:inherit;">int</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;[methodEndInterceptors&nbsp;count];&nbsp;i++&nbsp;)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;first&nbsp;search&nbsp;for&nbsp;this&nbsp;selector&nbsp;...</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AOPInterceptorInfo&nbsp;*oneInfo&nbsp;=&nbsp;[methodEndInterceptors&nbsp;objectAtIndex:i];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">if</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;(&nbsp;[oneInfo&nbsp;interceptedSelector]&nbsp;==&nbsp;aSelector&nbsp;)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;extract&nbsp;the&nbsp;interceptor&nbsp;info</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;target&nbsp;=&nbsp;[oneInfo&nbsp;interceptorTarget];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SEL&nbsp;selector&nbsp;=&nbsp;[oneInfo&nbsp;interceptorSelector];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;finally&nbsp;invoke&nbsp;the&nbsp;interceptor</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(NSObject&nbsp;*)&nbsp;target&nbsp;performSelector:selector&nbsp;withObject:anInvocation];&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[pool2&nbsp;release];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[super&nbsp;forwardInvocation:invocation];</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">}&nbsp;&nbsp;</span></li>
</ol>
</div>
<br />
可以砍到这里让真实的对象调用了方法，并且干涉了对象的行为，在其前后加入了拦截器的执行操作。从而“优雅”地实现了AOP。<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="n" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">该库中，还提供了两个Aspect：</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="n" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">AOPMethodLoger-用于简单记录方法的日志；</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span class="n" style="margin:0px;padding:0px;border:0px;color:#333333;font-family:Consolas, 'Liberation Mono', Courier, monospace;line-height:16px;white-space:pre;">AOPThreadInvoker-用于在一个单独的线程上执行方法；</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:Consolas, 'Liberation Mono', Courier, monospace;color:#333333;"><span style="line-height:16px;white-space:pre;">之前在Java以及.net中已经很广泛地应用了AOP的实例了，常见的应用有做Log啊，异常捕获啊之类的。最近在做iOS的应用，其中也会牵扯到异常捕获的问题，特别是牵扯到数据库操作以及业务逻辑上的异常，总是写代码捕获块儿，费事还占面积。所以，我在里面又加了一个Aspect：AOPExcettionCatcher。很简单，就是在这里统一实现了异常捕获。</span></span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:Consolas, 'Liberation Mono', Courier, monospace;color:#333333;"><span style="line-height:16px;white-space:pre;">重新实现了invokeOriginalMethod方法：</span></span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_cpp" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;width:938.516px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;background-color:#e7e5dc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;border-left-width:3px;border-left-style:solid;border-left-color:#999999;background-color:#f8f8f8;"><b>[cpp]</b>&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="ViewSource" title="view plain" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="CopyToClipboard" title="copy" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">copy</a><div style="position:absolute;left:470px;top:4469px;width:29px;height:15px;z-index:99;"><embed id="ZeroClipboardMovie_8" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="29" height="15" name="ZeroClipboardMovie_8" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=8&amp;width=29&amp;height=15" wmode="transparent" /></div>
</span><span data-mod="popu_169">&nbsp;<a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="PrintSource" title="print" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">print</a></span><a href="http://blog.csdn.net/yanghua_kobe/article/details/8395535#" class="About" title="?" style="text-decoration:none;border:none;padding:0px;margin:0px 10px 0px 0px;color:#0c89cf;background-image:none;background-color:inherit;background-position:initial initial;background-repeat:initial initial;">?</a></div>
</div>
<ol start="1" class="dp-cpp" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;color:#5c5c5c;background-color:#ffffff;margin:0px 0px 1px 45px !important;"><li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">-&nbsp;(</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">void</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">)invokeOriginalMethod:(NSInvocation&nbsp;*)anInvocation{&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@<span class="string" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">"%@"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">,@</span><span class="string" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">"entry&nbsp;into&nbsp;try&nbsp;block"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;@<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">try</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[super&nbsp;invokeOriginalMethod:anInvocation];&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;@<span class="keyword" style="margin:0px;padding:0px;border:none;color:blue;font-weight:bold;background-color:inherit;">catch</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;(NSException&nbsp;*exception)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@<span class="string" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">"%@"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">,@</span><span class="string" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">"entry&nbsp;into&nbsp;catch&nbsp;block"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@<span class="string" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">"%@"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">,[exception&nbsp;reason]);&nbsp;&nbsp;</span></span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;@finally&nbsp;{&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NSLog(@<span class="string" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">"%@"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">,@</span><span class="string" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">"entry&nbsp;into&nbsp;finally&nbsp;block"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:#555555;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="margin:0px !important;padding:0px 3px 0px 10px !important;border-style:none none none solid;border-left-width:3px;border-left-color:#999999;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;background-color:#f5fae2;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">}&nbsp;&nbsp;</span></li>
</ol>
</div>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-family:Consolas, 'Liberation Mono', Courier, monospace;color:#333333;"><span style="line-height:16px;white-space:pre;">当然了这只是应用之一，你还可以用它做更多的事情。</span></span></p>
</div></body></html>