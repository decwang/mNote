<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2016-09-30T12:04:02Z"/><meta name="updated" content="2016-10-08T09:04:30Z"/><title> [置顶] 如何设计一个 iOS 控件?(iOS 控件完全解析)    标签： ios设计控件  2015-05-25 11:35 22364人阅读 评论(26) 收藏 举报     分类：  iO</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="article_title" style="margin-bottom:21px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;">&nbsp;<h1 style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;font-size:18px;"><span class="link_title"><a href="http://blog.csdn.net/zhangao0086/article/details/45622875" style="text-decoration:none;color:#000000;"><span style="color:red;">[置顶]</span>&nbsp;如何设计一个 iOS 控件?(iOS 控件完全解析)</a></span></h1>
</div>
<div class="article_manage clearfix" style="color:#999999;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:22px;font-family:Arial;text-align:right;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ededed;margin:0px -20px 10px;padding:0px 20px 5px;overflow:hidden;widows:1;"><div class="article_l" style="width:948px;float:left;"><span class="link_categories" style="margin:0px 0px 0px 5px;float:left;">标签：&nbsp;<a href="http://www.csdn.net/tag/ios" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">ios</a><a href="http://www.csdn.net/tag/%e8%ae%be%e8%ae%a1" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">设计</a><a href="http://www.csdn.net/tag/%e6%8e%a7%e4%bb%b6" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">控件</a></span></div>
<div class="article_r"><span class="link_postdate" style="margin:0px 16px 0px 0px;">2015-05-25 11:35</span>&nbsp;<span class="link_view" title="阅读次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 24px;display:inline-block;background:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon.png) 0px -25px no-repeat;">22364人阅读</span>&nbsp;<span class="link_comments" title="评论次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 17px;display:inline-block;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-attachment:initial;background-color:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:0px -43px;background-repeat:no-repeat;"><a href="http://blog.csdn.net/zhangao0086/article/details/45622875#comments" style="text-decoration:none;color:#c88326;">评论</a>(26)</span>&nbsp;<span class="link_collect tracking-ad" data-mod="popu_171" style="margin:0px 16px 0px 5px;display:inline-block;padding-left:17px;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-position:0px -62px;background-repeat:no-repeat;"><a title="收藏" target="_blank" style="color:#c88326;">收藏</a></span>&nbsp;<span class="link_report" style="margin:0px 16px 0px 5px;display:inline-block;padding-left:17px;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-position:0px -81px;background-repeat:no-repeat;"><a href="http://blog.csdn.net/zhangao0086/article/details/45622875#report" title="举报" style="text-decoration:none;color:#c88326;">举报</a></span></div>
</div>
<div class="category clearfix" style="margin:0px -20px;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ededed;padding:5px 20px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;"><div class="category_l" style="display:inline-block;font-size:14px;color:#333333;width:70px;float:left;line-height:28px;"><img src="http://static.blog.csdn.net/images/category_icon.jpg" style="border:none;vertical-align:middle;" />&nbsp;<span style="display:inline-block;vertical-align:middle;">分类：</span></div>
<div class="category_r" style="display:inline-block;font-size:14px;color:#df3434;float:left;width:853.188px;"><label style="display:inline-block;margin-left:15px;cursor:pointer;line-height:28px;position:relative;">iOS开发（71）&nbsp;<img class="arrow-down" src="http://static.blog.csdn.net/images/arrow_triangle%20_down.jpg" style="border:none;display:inline;" /></label>&nbsp;<label style="display:inline-block;margin-left:15px;cursor:pointer;line-height:28px;position:relative;">Swift开发（33）&nbsp;<img class="arrow-down" src="http://static.blog.csdn.net/images/arrow_triangle%20_down.jpg" style="border:none;display:inline;" /></label></div>
</div>
<div class="bog_copyright" style="padding:20px 0px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;"><p class="copyright_p" style="margin-top:0px;margin-bottom:0px;padding:0px 0px 0px 10px;height:14px;line-height:14px;border-left-style:solid;border-left-width:3px;border-left-color:#e41c1e;color:#666666;font-size:14px;">版权声明：如需转载，请注明出处，谢谢！</p>
</div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;clear:both;"></div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;border:1px solid #cccccc;float:left;min-width:200px;padding:4px 10px;background-color:#eeeeee;background-position:initial initial;background-repeat:initial initial;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;text-align:right;"><span style="float:left;">目录<a href="http://blog.csdn.net/zhangao0086/article/details/45622875#" title="系统根据文章中H1到H6标签自动生成文章目录" style="text-decoration:none;">(?)</a></span><a href="http://blog.csdn.net/zhangao0086/article/details/45622875#" title="展开" style="text-decoration:none;">[+]</a></p>
</div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;clear:both;"></div>
<div id="article_content" class="article_content" style="margin:35px 0px;font-size:15px;color:#555555;line-height:35px;font-family:'microsoft yahei';font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><div class="markdown_views" style="font-size:14px;"><blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">代码的等级：可编译、可运行、可测试、可读、可维护、可复用</p>
</blockquote>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h1 id="前言" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t0" style="box-sizing:border-box;color:#0c89cf;"></a>前言</h1>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">一个控件从外在特征来说，主要是封装这几点：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><ul style="box-sizing:border-box;"><li style="box-sizing:border-box;">交互方式</li>
<li style="box-sizing:border-box;">显示样式</li>
<li style="box-sizing:border-box;">数据使用</li>
</ul>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">对外在特征的封装，能让我们在多种环境下达到 PM 对产品的要求，并且提到代码复用率，使维护工作保持在一个相对较小的范围内；而一个好的控件除了有对外一致的体验之外，还有其内在特征：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><ul style="box-sizing:border-box;"><li style="box-sizing:border-box;">灵活性</li>
<li style="box-sizing:border-box;">低耦合</li>
<li style="box-sizing:border-box;">易拓展</li>
<li style="box-sizing:border-box;">易维护</li>
</ul>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">通常特征之间需要做一些取舍，比如灵活性与耦合度，有时候接口越多越能适应各种环境，但是接口越少对外产生的依赖就越少，维护起来也更容易。通常一些前期看起来还不错的代码，往往也会随着时间加深慢慢“成长”，功能的增加也会带来新的接口，很不自觉地就加深了耦合度，在开发中时不时地进行一些重构工作很有必要。总之，尽量减少接口的数量，但有足够的定制空间，可以在一开始把接口全部隐藏起来，再根据实际需要慢慢放开。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">自定义控件在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">iOS</code>&nbsp;项目里很常见，通常页面之间入口很多，而且使用场景极有可能大不相同，比如一个&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;既可以以代码初始化，也可以以&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">xib</code>的形式初始化，而我们是需要保证这两种操作都能产生同样的行为。本文将会讨论到以下几点：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><ul style="box-sizing:border-box;"><li style="box-sizing:border-box;">选择正确的初始化方式</li>
<li style="box-sizing:border-box;">调整布局的时机</li>
<li style="box-sizing:border-box;">正确的处理 touches 方法</li>
<li style="box-sizing:border-box;">drawRectCALayer 与动画</li>
<li style="box-sizing:border-box;">UIControl 与 UIButton</li>
<li style="box-sizing:border-box;">更友好的支持 xib</li>
<li style="box-sizing:border-box;">不规则图形和事件触发范围（事件链的简单介绍以及处理）</li>
<li style="box-sizing:border-box;">合理使用 KVO</li>
</ul>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果这些问题你一看就懂的话就不用继续往下看了。</p>
<h1 id="设计方针" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t1" style="box-sizing:border-box;color:#0c89cf;"></a>设计方针</h1>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="选择正确的初始化方式" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t2" style="box-sizing:border-box;color:#0c89cf;"></a>选择正确的初始化方式</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;的首要问题就是既能从代码中初始化，也能从&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">xib</code>&nbsp;中初始化，两者有何不同? UIView 是支持&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">NSCoding</code>&nbsp;协议的，当在 xib 或 storyboard 里存在一个 UIView 的时候，其实是将 UIView 序列化到文件里（xib 和 storyboard 都是以 XML 格式来保存的），加载的时候反序列化出来，所以：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><ul style="box-sizing:border-box;"><li style="box-sizing:border-box;">当从代码实例化 UIView 的时候，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithFrame</code>&nbsp;会执行；</li>
<li style="box-sizing:border-box;">当从文件加载 UIView 的时候，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>&nbsp;会执行。</li>
</ul>
</blockquote>
<h3 id="从代码中加载" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t3" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">从代码中加载</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">虽然 initWithFrame 是 UIView 的<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">Designated Initializer</code>，理论上来讲你继承自 UIView 的任何子类，该方法最终都会被调用，但是有一些类在初始化的时候没有遵守这个约定，如&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIImageView</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithImage</code>&nbsp;和&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UITableViewCell</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithStyle:reuseIdentifier</code>: 的构造器等，所以我们在写自定义控件的时候，最好只假设父视图的 Designated Initializer 被调用。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果控件在初始化或者在使用之前必须有一些参数要设置，那我们可以写自己的 Designated Initializer 构造器，如：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs erlang has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-pp" style="box-sizing:border-box;">- <span class="hljs-params" style="color:#660066;box-sizing:border-box;">(instancetype)</span>initWithName:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">NSString</span> *)</span>name;</span></code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">在实现中一定要调用父类的 Designated Initializer，而且如果你有多个自定义的 Designated Initializer，最终都应该指向一个全能的初始化构造器：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (instancetype)initWithName:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">NSString</span> *)name {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> initWithName:name frame:CGRectZero];
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}

- (instancetype)initWithName:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">NSString</span> *)name frame:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGRect</span>)frame {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> initWithFrame:frame];
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>) {
        <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.name</span> = name;
    }
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">并且你要考虑到，因为你的控件是继承自 UIView 或 UIControl 的，那么用户完全可以不使用你提供的构造器，而直接调用基类的构造器，所以最好重写父类的 Designated Initializer，使它调用你提供的 Designated Initializer ，比如父类是个 UIView：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (instancetype)initWithFrame:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGRect</span>)frame {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> initWithName:<span class="hljs-literal" style="color:#006666;box-sizing:border-box;">nil</span> frame:frame];
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">这样当用户从代码里初始化你的控件的时候，就总是逃脱不了你需要执行的初始化代码了，哪怕用户直接调用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">init</code>&nbsp;方法，最终还是会回到父类的 Designated Initializer 上。</p>
<h3 id="从-xib-或-storyboard-中加载" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t4" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">从 xib 或 storyboard 中加载</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">当控件从 xib 或 storyboard 中加载的时候，情况就变得复杂了，首先我们知道有 initWithCoder 方法，该方法会在对象被反序列化的时候调用，比如从文件加载一个 UIView 的时候：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs haskell has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIView</span> *view = [[<span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIView</span> alloc] init];<span class="hljs-type" style="box-sizing:border-box;color:#660066;">NSData</span> *<span class="hljs-typedef" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">data</span> = [<span class="hljs-type" style="box-sizing:border-box;color:#660066;">NSKeyedArchiver</span> archivedDataWithRootObject:view];</span> [[<span class="hljs-type" style="box-sizing:border-box;color:#660066;">NSUserDefaults</span> standardUserDefaults] setObject:<span class="hljs-typedef" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">data</span> forKey:@"<span class="hljs-type" style="box-sizing:border-box;color:#660066;">KeyView</span>"];</span> [[<span class="hljs-type" style="box-sizing:border-box;color:#660066;">NSUserDefaults</span> standardUserDefaults] synchronize];<span class="hljs-typedef" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">data</span> = [[<span class="hljs-type" style="box-sizing:border-box;color:#660066;">NSUserDefaults</span> standardUserDefaults] objectForKey:@"<span class="hljs-type" style="box-sizing:border-box;color:#660066;">KeyView</span>"];</span> <span class="hljs-title" style="box-sizing:border-box;">view</span> = [<span class="hljs-type" style="box-sizing:border-box;color:#660066;">NSKeyedUnarchiver</span> unarchiveObjectWithData:<span class="hljs-typedef" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">data</span>];</span> <span class="hljs-type" style="box-sizing:border-box;color:#660066;">NSLog</span>(@<span class="hljs-string" style="color:#008800;box-sizing:border-box;">"%@"</span>, view);</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">执行&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">unarchiveObjectWithData</code>&nbsp;的时候，&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>&nbsp;会被调用，那么你有可能会在这个方法里做一些初始化工作，比如恢复到保存之前的状态，当然前提是需要在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">encodeWithCoder</code>&nbsp;中预先保存下来。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">不过我们很少会自己直接把一个 View 保存到文件中，一般是在 xib 或 storyboard 中写一个 View，然后让系统来完成反序列化的工作，此时在<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>&nbsp;调用之后，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">awakeFromNib</code>&nbsp;方法也会被执行，既然在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">awakeFromNib</code>&nbsp;方法里也能做初始化操作，那我们如何抉择?</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">一般来说要尽量在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>&nbsp;中做初始化操作，毕竟这是最合理的地方，只要你的控件支持序列化，那么它就能在任何被反序列化的时候执行初始化操作，这里适合做全局数据、状态的初始化工作，也适合手动添加子视图。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">awakeFromNib</code>&nbsp;相较于&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>&nbsp;的优势是：当&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">awakeFromNib</code>&nbsp;执行的时候，各种&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBOutlet</code>&nbsp;也都连接好了；而&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>&nbsp;调用的时候，虽然子视图已经被添加到视图层级中，但是还没有引用。如果你是基于 xib 或 storyboard 创建的控件，那么你可能需要对 IBOutlet 连接的子控件进行初始化工作，这种情况下，你只能在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">awakeFromNib</code>&nbsp;里进行处理。同时 xib 或 storyboard 对灵活性是有打折的，因为它们创建的代码无法被继承，所以当你选择用 xib 或 storyboard 来实现一个控件的时候，你已经不需要对灵活性有很高的要求了，唯一要做的是要保证用户一定是通过 xib 创建的此控件，否则可能是一个空的视图，可以在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithFrame</code>&nbsp;里放置一个&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">断言</code>&nbsp;或者异常来通知控件的用户。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">最后还要注意视图层级的问题，比如你要给 View 放置一个背景，你可能会在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>&nbsp;或&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">awakeFromNib</code>&nbsp;中这样写：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs ruby has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">[<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> <span class="hljs-symbol" style="color:#006666;box-sizing:border-box;">addSubview:</span><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>.backgroundView]; <span class="hljs-regexp" style="color:#008800;box-sizing:border-box;">//</span> 通过懒加载一个背景 <span class="hljs-constant" style="box-sizing:border-box;">View</span>，然后添加到视图层级上</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">你的本意是在控件的最下面放置一个背景，却有可能将这个背景覆盖到控件的最上方，原因是用户可能会在 xib 里写入这个控件，然后往它上面添加一些子视图，这样一来，用户添加的这些子视图会在你添加背景之前先进入视图层级，你的背景被添加后就挡住了用户的子视图。如果你想支持用户的这种操作，可以把&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">addSubview</code>&nbsp;替换成&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">insertSubview:atIndex:</code>。</p>
<h3 id="同时支持从代码和文件中加载" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t5" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">同时支持从代码和文件中加载</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果你要同时支持&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithFrame</code>&nbsp;和&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>&nbsp;，那么你可以提供一个&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">commonInit</code>&nbsp;方法来做统一的初始化：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">id</span>)initWithCoder:(NSCoder *)aDecoder {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> initWithCoder:aDecoder];
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>) {
        [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> commonInit];
    }
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">id</span>)initWithFrame:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGRect</span>)frame {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> initWithFrame:frame];
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>) {
        [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> commonInit];
    }

    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)commonInit {
    <span class="hljs-comment" style="color:#880000;box-sizing:border-box;">// do something ...</span> }</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
<li style="box-sizing:border-box;padding:0px 5px;">18</li>
<li style="box-sizing:border-box;padding:0px 5px;">19</li>
<li style="box-sizing:border-box;padding:0px 5px;">20</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
<li style="box-sizing:border-box;padding:0px 5px;">18</li>
<li style="box-sizing:border-box;padding:0px 5px;">19</li>
<li style="box-sizing:border-box;padding:0px 5px;">20</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">awakeFromNib</code>&nbsp;方法里就不要再去调用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">commonInit</code>&nbsp;了。</p>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="调整布局的时机" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t6" style="box-sizing:border-box;color:#0c89cf;"></a>调整布局的时机</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">当一个控件被初始化以及开始使用之后，它的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">frame</code>&nbsp;仍然可能发生变化，我们也需要接受这些变化，因为你提供的是&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;的接口，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;有很多种初始化方式：<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithFrame</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithCoder</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">init</code>&nbsp;和类方法&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">new</code>，用户完全可以在初始化之后再设置&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">frame</code>&nbsp;属性，而且用户就算使用<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">initWithFrame</code>&nbsp;来初始化也避免不了&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">frame</code>&nbsp;的改变，比如在横竖屏切换的时候。为了确保当它的 Size 发生变化后其子视图也能同步更新，我们不能一开始就把布局写死（使用约束除外）。</p>
<h3 id="基于-frame" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t7" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">基于 frame</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果你是直接基于 frame 来布局的，你应该确保在初始化的时候只添加视图，而不去设置它们的frame，把设置子视图 frame 的过程全部放到<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">layoutSubviews</code>&nbsp;方法里：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (instancetype)initWithCoder:(NSCoder *)aDecoder {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> initWithCoder:aDecoder];
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>) {
        [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> commonInit];
    }
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}

- (instancetype)initWithFrame:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGRect</span>)frame {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> initWithFrame:frame];
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>) {
        [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> commonInit];
    }
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)layoutSubviews {
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> layoutSubviews];

    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.label</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.frame</span> = CGRectInset(<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.bounds</span>, <span class="hljs-number" style="color:#006666;box-sizing:border-box;">20</span>, <span class="hljs-number" style="color:#006666;box-sizing:border-box;">0</span>);
}

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)commonInit {
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> addSubview:<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.label</span>];
}

- (<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UILabel</span> *)label {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (_label == <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">nil</span>) {
        _label = [<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UILabel</span> new];
        _label<span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.textColor</span> = [<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIColor</span> grayColor];
    }
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> _label;
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
<li style="box-sizing:border-box;padding:0px 5px;">18</li>
<li style="box-sizing:border-box;padding:0px 5px;">19</li>
<li style="box-sizing:border-box;padding:0px 5px;">20</li>
<li style="box-sizing:border-box;padding:0px 5px;">21</li>
<li style="box-sizing:border-box;padding:0px 5px;">22</li>
<li style="box-sizing:border-box;padding:0px 5px;">23</li>
<li style="box-sizing:border-box;padding:0px 5px;">24</li>
<li style="box-sizing:border-box;padding:0px 5px;">25</li>
<li style="box-sizing:border-box;padding:0px 5px;">26</li>
<li style="box-sizing:border-box;padding:0px 5px;">27</li>
<li style="box-sizing:border-box;padding:0px 5px;">28</li>
<li style="box-sizing:border-box;padding:0px 5px;">29</li>
<li style="box-sizing:border-box;padding:0px 5px;">30</li>
<li style="box-sizing:border-box;padding:0px 5px;">31</li>
<li style="box-sizing:border-box;padding:0px 5px;">32</li>
<li style="box-sizing:border-box;padding:0px 5px;">33</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
<li style="box-sizing:border-box;padding:0px 5px;">18</li>
<li style="box-sizing:border-box;padding:0px 5px;">19</li>
<li style="box-sizing:border-box;padding:0px 5px;">20</li>
<li style="box-sizing:border-box;padding:0px 5px;">21</li>
<li style="box-sizing:border-box;padding:0px 5px;">22</li>
<li style="box-sizing:border-box;padding:0px 5px;">23</li>
<li style="box-sizing:border-box;padding:0px 5px;">24</li>
<li style="box-sizing:border-box;padding:0px 5px;">25</li>
<li style="box-sizing:border-box;padding:0px 5px;">26</li>
<li style="box-sizing:border-box;padding:0px 5px;">27</li>
<li style="box-sizing:border-box;padding:0px 5px;">28</li>
<li style="box-sizing:border-box;padding:0px 5px;">29</li>
<li style="box-sizing:border-box;padding:0px 5px;">30</li>
<li style="box-sizing:border-box;padding:0px 5px;">31</li>
<li style="box-sizing:border-box;padding:0px 5px;">32</li>
<li style="box-sizing:border-box;padding:0px 5px;">33</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">这么做就能保证 label 总是出现在正确的位置上。&nbsp;<br style="box-sizing:border-box;" />
使用 layoutSubviews 方法有几点需要注意：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><ol style="box-sizing:border-box;"><li style="box-sizing:border-box;">不要依赖前一次的计算结果，应该总是根据当前最新值来计算</li>
<li style="box-sizing:border-box;">由于&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">layoutSubviews</code>&nbsp;方法是在自身的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">bounds</code>&nbsp;发生改变的时候调用， 因此&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIScrollView</code>&nbsp;会在滚动时不停地调用，当你只关心 Size 有没有变化的时候，可以把前一次的 Size 保存起来，通过与最新的 Size 比较来判断是否需要更新，在大多数情况下都能改善性能</li>
</ol>
</blockquote>
<h3 id="基于-auto-layout-约束" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t8" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">基于 Auto Layout 约束</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果你是基于 Auto Layout 约束来进行布局，那么可以在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">commonInit</code>&nbsp;调用的时候就把约束添加上去，不要重写 layoutSubviews 方法，因为这种情况下它的默认实现就是根据约束来计算 frame。最重要的一点，把&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">translatesAutoresizingMaskIntoConstraints</code>&nbsp;属性设为 NO，以免产生<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">NSAutoresizingMaskLayoutConstraint</code>&nbsp;约束，如果你使用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">Masonry</code>&nbsp;框架的话，则不用担心这个问题，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">mas_makeConstraints</code>&nbsp;方法会首先设置这个属性为&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">NO</code>:</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="language-objectivec hljs has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)commonInit {
    ...
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> setupConstraintsForSubviews];
}

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)setupConstraintsForSubviews {
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.label</span> mas_makeConstraints:^(MASConstraintMaker *make) {
        ...
    }];
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
</ul>
</pre><h3 id="支持-sizetofit" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t9" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">支持 sizeToFit</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果你的控件对尺寸有严格的限定，比如有一个统一的宽高比或者是固定尺寸，那么最好能实现系统给出的约定成俗的接口。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">sizeToFit 用在基于 frame 布局的情况下，由你的控件去实现 sizeThatFits: 方法：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGSize</span>)sizeThatFits:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGSize</span>)size {
    <span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGSize</span> fitSize = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> sizeThatFits:size];
    fitSize<span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.height</span> += <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.label</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.frame</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.size</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.height</span>;
    <span class="hljs-comment" style="color:#880000;box-sizing:border-box;">// 如果是固定尺寸，就像 UISwtich 那样返回一个固定 Size 就 OK 了</span>     <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> fitSize;
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">然后在外部调用该控件的 sizeToFit 方法，这个方法内部会自动调用 sizeThatFits 并更新自身的 Size：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="language-objectivec hljs has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">[<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.customView</span> sizeToFit];</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
</pre><h3 id="在-viewcontroller-里调整视图布局" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t10" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">在 ViewController 里调整视图布局</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">当执行&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">viewDidLoad</code>&nbsp;方法时，不要依赖&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">self.view</code>&nbsp;的 Size。很多人会这样写：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="language-objectivec hljs has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)viewDidLoad {
    ...
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.label</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.width</span> = <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.view</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.width</span>;
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">这样是不对的，哪怕看上去没问题也只是碰巧没问题而已。当 viewDidLoad 方法被调用的时候，self.view 才刚刚被初始化，此时它的容器还没有对它的 frame 进行设置，如果 view 是从 xib 加载的，那么它的 Size 就是 xib 中设置的值；如果它是从代码加载的，那么它的 Size 和屏幕大小有关系，除了 Size 以外，Origin 也不会准确。整个过程看起来像这样：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">当访问 ViewController 的 view 的时候，ViewController 会先执行 loadViewIfRequired 方法，如果 view 还没有加载，则调用 loadView，然后是 viewDidLoad 这个钩子方法，最后是返回 view，容器拿到 view 后，根据自身的属性（如 edgesForExtendedLayout、判断是否存在 tabBar、判断 navigationBar 是否透明等）添加约束或者设置 frame。</p>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">你至少应该设置&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">autoresizingMask</code>&nbsp;属性：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="language-objectivec hljs has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)viewDidLoad {
    ...
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.label</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.width</span> = <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.view</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.width</span>;
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.label</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.autoresizingMask</span> = UIViewAutoresizingFlexibleWidth;
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">或者在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">viewDidLayoutSubviews</code>&nbsp;里处理：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)viewDidLayoutSubviews {
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> viewDidLayoutSubviews];

    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.label</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.width</span> = <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.view</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.width</span>;
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果是基于 Auto Layout 来布局，则在 viewDidLoad 里添加约束即可。</p>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="正确的处理-touches-方法" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t11" style="box-sizing:border-box;color:#0c89cf;"></a>正确的处理 touches 方法</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果你需要重写&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">touches</code>&nbsp;方法，那么应该完整的重写这四个方法：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs erlang has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-pp" style="box-sizing:border-box;">- <span class="hljs-params" style="color:#660066;box-sizing:border-box;">(void)</span>touchesBegan:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">NSSet</span> *)</span>touches withEvent:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">UIEvent</span> *)</span>event;
- <span class="hljs-params" style="color:#660066;box-sizing:border-box;">(void)</span>touchesMoved:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">NSSet</span> *)</span>touches withEvent:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">UIEvent</span> *)</span>event;
- <span class="hljs-params" style="color:#660066;box-sizing:border-box;">(void)</span>touchesEnded:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">NSSet</span> *)</span>touches withEvent:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">UIEvent</span> *)</span>event;
- <span class="hljs-params" style="color:#660066;box-sizing:border-box;">(void)</span>touchesCancelled:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">NSSet</span> *)</span>touches withEvent:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">UIEvent</span> *)</span>event;</span></code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">当你的视图在这四个方法执行的时候，如果已经对事件进行了处理，就不要再调用 super 的 touches 方法，super 的 touches 方法默认实现是在响应链里继续转发事件（UIView 的默认实现）。如果你的基类是&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIScrollView</code>&nbsp;或者&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIButton</code>&nbsp;这些已经重写了事件处理的类，那么当你不想处理事件的时候可以调用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">self.nextResponder</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">touches</code>&nbsp;方法来转发事件，其他的情况就调用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">super</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">touches</code>&nbsp;方法来转发，比如&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIScrollView</code>&nbsp;可以这样来转发&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">触摸</code>&nbsp;事件：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="language-objectivec hljs has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (!<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.dragging</span>) {
        [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.nextResponder</span> touchesBegan: touches withEvent:event]; 
    }       

    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> touchesBegan: touches withEvent: event];
}

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)touchesMoved...

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)touchesEnded...

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)touchesCancelled...</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">这么实现以后，当你仅仅只是“碰”一个 UIScrollView 的时候，该事件就有可能被&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">nextResponder</code>&nbsp;处理。&nbsp;<br style="box-sizing:border-box;" />
如果你没有实现自己的事件处理，也没有调用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">nextResponder</code>&nbsp;和&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">super</code>，那么响应链就会断掉。另外，尽量用手势识别器去处理自定义事件，它的好处是你不需要关心响应链，逻辑处理起来也更加清晰，事实上，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIScrollView</code>&nbsp;也是通过手势识别器实现的：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">@property(nonatomic, readonly) UIPanGestureRecognizer *panGestureRecognizer NS_AVAILABLE_IOS(5_0);&nbsp;<br style="box-sizing:border-box;" />
@property(nonatomic, readonly) UIPinchGestureRecognizer *pinchGestureRecognizer NS_AVAILABLE_IOS(5_0);</p>
</blockquote>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="drawrectcalayer-与动画" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t12" style="box-sizing:border-box;color:#0c89cf;"></a>drawRect、CALayer 与动画</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">drawRect</code>&nbsp;方法很适合做自定义的控件，当你需要更新 UI 的时候，只要用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">setNeedsDisplay</code>&nbsp;标记一下就行了，这么做又简单又方便；控件也常常用于封装动画，但是动画却有可能被移除掉。&nbsp;<br style="box-sizing:border-box;" />
需要注意的地方：</p>
<ol style="box-sizing:border-box;"><li style="box-sizing:border-box;"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">drawRect</code>&nbsp;里尽量用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">CGContext</code>&nbsp;绘制 UI。如果你用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">addSubview</code>&nbsp;插入了其他的视图，那么当系统在每次进入绘制的时候，会先把当前的上下文清除掉（此处不考虑&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">clearsContextBeforeDrawing</code>&nbsp;的影响），然后你也要清除掉已有的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">subviews</code>，以免重复添加视图；用户可能会往你的控件上添加他自己的子视图，然后在某个情况下清除所有的子视图（我就喜欢这么做）：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="language-objectivec hljs has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">[subviews makeObjectsPerformSelector:<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@selector</span>(removeFromSuperview)];</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
</pre></li>
<li style="box-sizing:border-box;"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">CALayer</code>&nbsp;代替&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>。<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">CALayer</code>&nbsp;节省内存，而且更适合去做一个“图层”，因为它不会接收事件、也不会成为响应链中的一员，但是它能够响应父视图（或&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">layer</code>）的尺寸变化，这种特性很适合做单纯的数据展示：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="language-objectivec hljs has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">CALayer *imageLayer = [CALayer layer];
imageLayer<span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.frame</span> = rect;
imageLayer<span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.contents</span> = (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">id</span>)image;
[<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.view</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.layer</span> addSublayer:imageLayer];</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
</pre></li>
<li style="box-sizing:border-box;"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果有可能的话使用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">setNeedsDisplayInRect</code>&nbsp;代替&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">setNeedsDisplay</code>&nbsp;以优化性能，但是遇到性能问题的时候应该先检查自己的绘图算法和绘图时机，我个人其实从来没有使用过&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">setNeedsDisplayInRect</code>。</p>
</li>
<li style="box-sizing:border-box;"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">当你想做一个无限循环播放的动画的时候，可能会创建几个封装了动画的 CALayer，然后把它们添加到视图层级上，就像我在<a href="http://blog.csdn.net/zhangao0086/article/details/38170359" target="_blank" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">iOS 实现脉冲雷达以及动态增减元素 By Swift</code></a>&nbsp;中这么做的：&nbsp;<br style="box-sizing:border-box;" />
<img width="33%" src="http://img.blog.csdn.net/20140727131305736" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" />&nbsp;<br style="box-sizing:border-box;" />
效果还不错，实现又简单，但是当你按下 Home 键并再次返回到 app 的时候，原本好看的动画就变成了一滩死水：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">这是因为在按下 Home 键的时候，所有的动画被移除了，具体的，每个 layer 都调用了 removeAllAnimations 方法。</p>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果你想重新播放动画，可以监听&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIApplicationDidBecomeActiveNotification</code>&nbsp;通知，就像我在&nbsp;<a href="http://blog.csdn.net/zhangao0086/article/details/38170359" target="_blank" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">上述博客</code></a>&nbsp;中做的那样。</p>
</li>
<li style="box-sizing:border-box;"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIImageView</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">drawRect</code>&nbsp;永远不会被调用：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;line-height:1.25;">Special Considerations</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">The UIImageView class is optimized to draw its images to the display. UIImageView will not call drawRect: in a subclass. If your subclass needs custom drawing code, it is recommended you use UIView as the base class.</p>
</blockquote>
</li>
<li style="box-sizing:border-box;"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">drawRect</code>&nbsp;也不一定会调用，我在 12 年的博客：<a href="http://blog.csdn.net/zhangao0086/article/details/7568998" target="_blank" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">定制UINavigationBar</code></a>&nbsp;中曾经提到过 UIKit 框架的实现机制：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;line-height:1.25;">众所周知一个视图如何显示是取决于它的 drawRect 方法，因为调这个方法之前 UIKit 也不知道如何显示它，但其实 drawRect 方法的目的也是画图（显示内容），而且我们如果以其他的方式给出了内容（图）的话， drawRect 方法就不会被调用了。</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:5px;border-bottom-right-radius:5px;border-bottom-left-radius:0px;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">注：实际上 UIView 是 CALayer 的delegate，如果 CALayer 没有内容的话，会回调给 UIView 的 displayLayer: 或者 drawLayer:inContext: 方法，UIView 在其中调用 drawRect ，draw 完后的图会缓存起来，除非使用 setNeedsDisplay 或是一些必要情况，否则都是使用缓存的图。</p>
</blockquote>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;和&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">CALayer</code>&nbsp;都是模型对象，如果我们以这种方式给出内容的话，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">drawRect</code>&nbsp;也就不会被调用了：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.customView</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.layer</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.contents</span> = (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">id</span>)[<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIImage</span> imageNamed:@<span class="hljs-string" style="color:#008800;box-sizing:border-box;">"AppIcon"</span>];<span class="hljs-comment" style="color:#880000;box-sizing:border-box;">// 哪怕是给它一个 nil，这两句等价</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.customView</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.layer</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.contents</span> = <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">nil</span>;</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">我猜测是在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">CALayer</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">setContents</code>&nbsp;方法里有个标记，无论传入的对象是什么都会将该标记打开，但是调用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">setNeedsDisplay</code>&nbsp;的时候会将该标记去除。</p>
</li>
</ol>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="uicontrol-与-uibutton" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t13" style="box-sizing:border-box;color:#0c89cf;"></a>UIControl 与 UIButton</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果要做一个可交互的控件，那么把&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIControl</code>&nbsp;作为基类就是首选，这个完美的基类支持各种状态：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><ul style="box-sizing:border-box;"><li style="box-sizing:border-box;">enabled</li>
<li style="box-sizing:border-box;">selected</li>
<li style="box-sizing:border-box;">highlighted</li>
<li style="box-sizing:border-box;">tracking</li>
<li style="box-sizing:border-box;">……</li>
</ul>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">还支持多状态下的观察者模式：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="language-objectivec hljs has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@property</span>(<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">nonatomic</span>,<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">readonly</span>) UIControlState state;

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)addTarget:(<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">id</span>)target action:(SEL)action forControlEvents:(UIControlEvents)controlEvents;
- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)removeTarget:(<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">id</span>)target action:(SEL)action forControlEvents:(UIControlEvents)controlEvents;</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">这个基类可以很方便地为视图添加各种点击状态，最常见的用法就是将&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIViewController</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">view</code>&nbsp;改成&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIControl</code>，然后就能快速实现<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">resignFirstResponder</code>。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIButton</code>&nbsp;自带图文接口，支持更强大的状态切换，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">titleEdgeInsets</code>&nbsp;和&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">imageEdgeInsets</code>&nbsp;也比较好用，配合两个基类的属性更好，先设置对齐规则，再设置 insets：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs css has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-at_rule" style="box-sizing:border-box;">@<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">property(nonatomic)</span> UIControlContentVerticalAlignment contentVerticalAlignment</span>;    <span class="hljs-at_rule" style="box-sizing:border-box;">@<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">property(nonatomic)</span> UIControlContentHorizontalAlignment contentHorizontalAlignment</span>;</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIControl</code>&nbsp;和&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIButton</code>&nbsp;都能很好的支持 xib，可以设置各种状态下的显示和 Selector，但是对 UIButton 来说这些并不够，因为&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">Normal</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">Highlighted</code>&nbsp;和&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">Normal | Highlighted</code>&nbsp;是三种不同的状态，如果你需要实现根据当前状态显示不同高亮的图片，可以参考我下面的代码：&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20150518230921139" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /><img src="http://img.blog.csdn.net/20150518233220099" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)updateStates {
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> setTitle:[<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> titleForState:UIControlStateNormal] forState:UIControlStateNormal | UIControlStateHighlighted];
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> setImage:[<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> imageForState:UIControlStateNormal] forState:UIControlStateNormal | UIControlStateHighlighted];

    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> setTitle:[<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> titleForState:UIControlStateSelected] forState:UIControlStateSelected | UIControlStateHighlighted];
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> setImage:[<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> imageForState:UIControlStateSelected] forState:UIControlStateSelected | UIControlStateHighlighted];
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">或者使用初始化设置：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)commonInit {
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> setImage:[<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIImage</span> imageNamed:@<span class="hljs-string" style="color:#008800;box-sizing:border-box;">"Normal"</span>] forState:UIControlStateNormal];
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> setImage:[<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIImage</span> imageNamed:@<span class="hljs-string" style="color:#008800;box-sizing:border-box;">"Selected"</span>] forState:UIControlStateSelected];
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> setImage:[<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIImage</span> imageNamed:@<span class="hljs-string" style="color:#008800;box-sizing:border-box;">"Highlighted"</span>] forState:UIControlStateHighlighted];
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> setImage:[<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIImage</span> imageNamed:@<span class="hljs-string" style="color:#008800;box-sizing:border-box;">"Selected_Highlighted"</span>] forState:UIControlStateSelected | UIControlStateHighlighted];
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
</ul>
</pre><blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">总之尽量使用原生类的接口，或者模仿原生类的接口。</p>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">大多数情况下根据你所需要的特性来选择现有的基类就够了，或者用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView + 手势识别器</code>&nbsp;的组合也是一个好方案，尽量不要用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">touches</code>&nbsp;方法（<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">userInteractionEnabled</code>&nbsp;属性对&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">touches</code>&nbsp;和<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">手势识别器</code>的作用一样），这是我在&nbsp;<a href="https://github.com/zhangao0086/DKCarouselView/tree/1.4.0" target="_blank" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">DKCarouselView</code>&nbsp;</a>中内置的一个可点击的 ImageView，也可以继承 UIButton，不过 UIButton 更侧重于状态，ImageView 侧重于图片本身：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">typedef</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>(^DKCarouselViewTapBlock)();<span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">DKClickableImageView</span> : <span class="hljs-title" style="box-sizing:border-box;color:#660066;">UIImageView</span></span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@property</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">nonatomic</span>, <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">assign</span>) <span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">BOOL</span> enable;<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@property</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">nonatomic</span>, copy) DKCarouselViewTapBlock tapBlock;<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@end</span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@implementation</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">DKClickableImageView</span></span> - (instancetype)initWithFrame:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGRect</span>)frame {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> ((<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> initWithFrame:frame])) {
        [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> commonInit];
    }
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}

- (instancetype)initWithCoder:(NSCoder *)aDecoder {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> ((<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> initWithCoder:aDecoder])) {
        [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> commonInit];
    }
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)commonInit {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.userInteractionEnabled</span> = <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">YES</span>;
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.enable</span> = <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">YES</span>;

    UITapGestureRecognizer *tapGesture = [[UITapGestureRecognizer alloc] initWithTarget:<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> action:<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@selector</span>(onTap:)];
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> addGestureRecognizer:tapGesture];
}

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">IBAction</span>)onTap:(<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">id</span>)sender {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (!<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.enable</span>) <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span>;

    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.tapBlock</span>) {
        <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.tapBlock</span>();
    }
}<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@end</span></code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
<li style="box-sizing:border-box;padding:0px 5px;">18</li>
<li style="box-sizing:border-box;padding:0px 5px;">19</li>
<li style="box-sizing:border-box;padding:0px 5px;">20</li>
<li style="box-sizing:border-box;padding:0px 5px;">21</li>
<li style="box-sizing:border-box;padding:0px 5px;">22</li>
<li style="box-sizing:border-box;padding:0px 5px;">23</li>
<li style="box-sizing:border-box;padding:0px 5px;">24</li>
<li style="box-sizing:border-box;padding:0px 5px;">25</li>
<li style="box-sizing:border-box;padding:0px 5px;">26</li>
<li style="box-sizing:border-box;padding:0px 5px;">27</li>
<li style="box-sizing:border-box;padding:0px 5px;">28</li>
<li style="box-sizing:border-box;padding:0px 5px;">29</li>
<li style="box-sizing:border-box;padding:0px 5px;">30</li>
<li style="box-sizing:border-box;padding:0px 5px;">31</li>
<li style="box-sizing:border-box;padding:0px 5px;">32</li>
<li style="box-sizing:border-box;padding:0px 5px;">33</li>
<li style="box-sizing:border-box;padding:0px 5px;">34</li>
<li style="box-sizing:border-box;padding:0px 5px;">35</li>
<li style="box-sizing:border-box;padding:0px 5px;">36</li>
<li style="box-sizing:border-box;padding:0px 5px;">37</li>
<li style="box-sizing:border-box;padding:0px 5px;">38</li>
<li style="box-sizing:border-box;padding:0px 5px;">39</li>
<li style="box-sizing:border-box;padding:0px 5px;">40</li>
<li style="box-sizing:border-box;padding:0px 5px;">41</li>
<li style="box-sizing:border-box;padding:0px 5px;">42</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
<li style="box-sizing:border-box;padding:0px 5px;">18</li>
<li style="box-sizing:border-box;padding:0px 5px;">19</li>
<li style="box-sizing:border-box;padding:0px 5px;">20</li>
<li style="box-sizing:border-box;padding:0px 5px;">21</li>
<li style="box-sizing:border-box;padding:0px 5px;">22</li>
<li style="box-sizing:border-box;padding:0px 5px;">23</li>
<li style="box-sizing:border-box;padding:0px 5px;">24</li>
<li style="box-sizing:border-box;padding:0px 5px;">25</li>
<li style="box-sizing:border-box;padding:0px 5px;">26</li>
<li style="box-sizing:border-box;padding:0px 5px;">27</li>
<li style="box-sizing:border-box;padding:0px 5px;">28</li>
<li style="box-sizing:border-box;padding:0px 5px;">29</li>
<li style="box-sizing:border-box;padding:0px 5px;">30</li>
<li style="box-sizing:border-box;padding:0px 5px;">31</li>
<li style="box-sizing:border-box;padding:0px 5px;">32</li>
<li style="box-sizing:border-box;padding:0px 5px;">33</li>
<li style="box-sizing:border-box;padding:0px 5px;">34</li>
<li style="box-sizing:border-box;padding:0px 5px;">35</li>
<li style="box-sizing:border-box;padding:0px 5px;">36</li>
<li style="box-sizing:border-box;padding:0px 5px;">37</li>
<li style="box-sizing:border-box;padding:0px 5px;">38</li>
<li style="box-sizing:border-box;padding:0px 5px;">39</li>
<li style="box-sizing:border-box;padding:0px 5px;">40</li>
<li style="box-sizing:border-box;padding:0px 5px;">41</li>
<li style="box-sizing:border-box;padding:0px 5px;">42</li>
</ul>
</pre><hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="更友好的支持-xib" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t14" style="box-sizing:border-box;color:#0c89cf;"></a>更友好的支持 xib</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">你的控件现在应该可以正确的从文件、代码中初始化了，但是从 xib 中初始化以后可能还需要通过代码来进行一些设置，你或许觉得像上面那样设置 Button 的状态很恶心而且不够直观，但是也没办法，这是由于 xib 虽然对原生控件，如&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIImageView</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIScrollView</code>&nbsp;等支持较好（想设置圆角、边框等属性也没办法，只能通过 layer 来设置），但是对自定义控件却没有什么办法，当你拖一个 UIView 到 xib 中，然后把它的 Class 改成你自己的子类后，xib 如同一个瞎子一样，不会有任何变化。————好在这些都成了过去。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">Xcode 6 引入了两个新的宏：<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBInspectable</code>&nbsp;和&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBDesignable</code>。</p>
<h3 id="ibinspectable" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t15" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">IBInspectable</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">该宏会让 xib 识别属性，它支持这些数据类型：布尔、字符串、数字（NSNumber）、 CGPoint、CGSize、CGRect、UIColor 、 NSRange 和 UIImage。&nbsp;<br style="box-sizing:border-box;" />
比如我们要让自定义的 Button 能在 xib 中设置&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIControlStateSelected | UIControlStateHighlighted</code>&nbsp;状态的图片，就可以这么做：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-comment" style="color:#880000;box-sizing:border-box;">// CustomButton</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@property</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">nonatomic</span>, <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">strong</span>) IBInspectable <span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIImage</span> *highlightSelectedImage;

- (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)setHighlightSelectedImage:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIImage</span> *)highlightSelectedImage {
    _highlightSelectedImage = highlightSelectedImage;

    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> setImage:highlightSelectedImage forState:UIControlStateHighlighted | UIControlStateSelected];
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">只需要在属性上加个&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBInspectable</code>&nbsp;宏即可，然后 xib 中就能显示这个自定义的属性：&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20150524003030863" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">xib 会把属性名以大驼峰样式显示，如果有多个属性，xib 也会自动按属性名的第一个单词分组显示，如：&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20150524003429394" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">通过使用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBInspectable</code>&nbsp;宏，你可以把原本只能通过代码来设置的属性，也放到 xib 里来，代码就显得更加简洁了。</p>
<h3 id="ibdesignable" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t16" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">IBDesignable</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">xib 配合&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBInspectable</code>&nbsp;宏虽然可以让属性设置变得简单化，但是只有在运行期间你才能看到控件的真正效果，而使用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBDesignable</code>&nbsp;可以让<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">Interface Builder</code>&nbsp;实时渲染控件，这一切只需要在类名加上&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBDesignable</code>&nbsp;宏即可：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">IB_DESIGNABLE<span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">CustomButton</span> : <span class="hljs-title" style="box-sizing:border-box;color:#660066;">UIButton</span></span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@property</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">nonatomic</span>, <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">strong</span>) IBInspectable <span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIImage</span> *highlightSelectedImage;<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@end</span></code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">这样一来，当你在 xib 中调整属性的时候，画布也会实时更新。</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">关于对 IBInspectable / IBDesignable 的详细介绍可以看这里：<a href="http://nshipster.cn/ibinspectable-ibdesignable/" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;">http://nshipster.cn/ibinspectable-ibdesignable/</a>&nbsp;<br style="box-sizing:border-box;" />
这是 Twitter 上其他开发者做出的效果：&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20150524010715678" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" />&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20150524010739826" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">相信通过使用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">IBInspectable / IBDesignable</code>&nbsp;，会让控件使用起来更加方便、也更加有趣。</p>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="不规则图形和事件触发范围" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t17" style="box-sizing:border-box;color:#0c89cf;"></a>不规则图形和事件触发范围</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">不规则图形在 iOS 上并不多见，想来设计师也怕麻烦。不过 iOS 上的控件说到底都是各式各样的矩形，就算你修改&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">cornerRadius</code>，让它看起来像这样：&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20150519170534843" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">也只是看起来像这样罢了，它的实际事件触发范围还是一个矩形。</p>
<h3 id="问题描述" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t18" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">问题描述</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">想象一个复杂的可交互的控件，它并不是单独工作的，可能需要和另一个控件交互，而且它们的事件触发范围可能会重叠，像这个选择联系人的列表：</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><img src="http://img.blog.csdn.net/20150519152655463" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">在设计的时候让上面二级菜单在最大的范围内可以被点击，下面的一级菜单也能在自己的范围内很好的工作，正常情况下它们的触发范围是这样的：</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><img src="http://img.blog.csdn.net/20150519172134529" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">我们想要的是这样的：</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><img src="http://img.blog.csdn.net/20150522223048661" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">想要实现这样的效果需要对事件分发有一定的了解。首先我们来想想，当触摸屏幕的时候发生了什么?</p>
<h3 id="当触摸屏幕的时候发生了什么" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t19" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">当触摸屏幕的时候发生了什么?</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">当屏幕接收到一个 touch 的时候，iOS 需要找到一个合适的对象来处理事件（ touch 或者手势），要寻找这个对象，需要用到这个方法：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs erlang has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-pp" style="box-sizing:border-box;">- <span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">UIView</span> *)</span>hitTest:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">CGPoint</span>)</span>point withEvent:<span class="hljs-params" style="color:#660066;box-sizing:border-box;">(<span class="hljs-variable" style="box-sizing:border-box;">UIEvent</span> *)</span>event;</span></code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">该方法会首先在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">application</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">keyWindow</code>&nbsp;上调用（<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIWindow</code>&nbsp;也是&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;的子类），并且该方法的返回值将被用来处理事件。如果这个<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">view</code>（无论是&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">window</code>&nbsp;还是普通的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>） 的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">userInteractionEnabled</code>&nbsp;属性被设置为&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">NO</code>，则它的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">hitTest:</code>&nbsp;永远返回&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">nil</code>，这意味着它和它的子视图没有机会去接收和处理事件。如果&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">userInteractionEnabled</code>&nbsp;属性为&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">YES</code>，则会先判断产生触摸的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">point</code>&nbsp;是否发生在自己的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">bounds</code>&nbsp;内，如果没有也将返回&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">nil</code>；如果&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">point</code>&nbsp;在自己的范围内，则会为自己的每个子视图调用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">hitTest:</code>&nbsp;方法，只要有一个子视图通过这个方法返回一个<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;对象，那么整个方法就一层一层地往上返回；如果没有子视图返回&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;对象，则父视图将会把自己返回。</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">所以，在事件分发中，有这么几个关键点：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><ol style="box-sizing:border-box;"><li style="box-sizing:border-box;">如果父视图不能响应事件（userInteractionEnabled 为 NO），则其子视图也将无法响应事件。</li>
<li style="box-sizing:border-box;">如果子视图的 frame 有一半在外面，就像这样：&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20150522230700824" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;" />&nbsp;<br style="box-sizing:border-box;" />
则在外面的部分是无法响应事件的，因为它超出了父视图的范围。</li>
<li style="box-sizing:border-box;">整个事件链只会返回一个 Hit-Test View 来处理事件。</li>
<li style="box-sizing:border-box;">子视图的顺序会影响到 Hit-Test View 的选择：最先通过 hitTest: 方法返回的 UIView 才会被返回，假如有两个子视图平级，并且它们的 frame 一样，但是谁是后添加的谁就优先返回。</li>
</ol>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">了解了事件分发的这些特点后，还需要知道最后一件事：<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIView</code>&nbsp;如何判断产生事件的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">point</code>&nbsp;是否在自己的范围内? 答案是通过&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">pointInside</code>&nbsp;方法，这个方法的默认实现类似于这样：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-comment" style="color:#880000;box-sizing:border-box;">// point 被转化为对应视图的坐标系统</span> - (<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">BOOL</span>)pointInside:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGPoint</span>)point withEvent:(UIEvent *)event {
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> CGRectContainsPoint(<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.bounds</span>, point);
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">所以，当我们想改变一个&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">View</code>&nbsp;的事件触发范围的时候，重写&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">pointInside</code>&nbsp;方法就可以了。</p>
<h3 id="回到问题" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t20" style="box-sizing:border-box;color:#0c89cf;"></a><b style="box-sizing:border-box;">回到问题</b></h3>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">针对这种视图一定要处理它们的事件触发范围，也就是&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">pointInside</code>&nbsp;方法，一般来说，我们先判断 point 是不是在自己的范围内（通过调用&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">super</code>&nbsp;来判断），然后再判断该 point 符不符合我们的处理要求：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">这个例子我用&nbsp;<a href="http://lib.csdn.net/base/1" class="replace_word" title="undefined" target="_blank" style="text-decoration:none;box-sizing:border-box;color:#df3434;font-weight:bold;">Swift</a>&nbsp;来写</p>
</blockquote>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs coffeescript has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">override func pointInside<span class="hljs-function" style="box-sizing:border-box;"><span class="hljs-params" style="color:#660066;box-sizing:border-box;">(point: CGPoint, withEvent event: UIEvent?)</span> -&gt;</span> Bool {
    <span class="hljs-reserved" style="box-sizing:border-box;">let</span> inside = <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span>.pointInside(point, <span class="hljs-attribute" style="box-sizing:border-box;color:#008800;">withEvent</span>: event)

    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> inside {
        <span class="hljs-reserved" style="box-sizing:border-box;">let</span> radius = self.layer.cornerRadius
        <span class="hljs-reserved" style="box-sizing:border-box;">let</span> dx = point.x - self.bounds.size.width / <span class="hljs-number" style="color:#006666;box-sizing:border-box;">2</span>         <span class="hljs-reserved" style="box-sizing:border-box;">let</span> dy = point.y - radius

        <span class="hljs-reserved" style="box-sizing:border-box;">let</span> distace = sqrt(dx * dx + dy * dy)
        <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> distace &lt; radius
    }

    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> inside
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">如果你要实现非矩形的控件，那么请在开发时处理好这类问题。&nbsp;<br style="box-sizing:border-box;" />
这里附上一个很容易测试的小 Demo：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs haskell has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">class</span> <span class="hljs-type" style="box-sizing:border-box;color:#660066;">CustomView</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIControl</span> {

    override init<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">frame</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">CGRect</span>)</span> {
        super.init<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">frame</span>: <span class="hljs-title" style="box-sizing:border-box;color:#660066;">frame</span>)</span>         self.backgroundColor = <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIColor</span>.redColor<span class="hljs-container" style="box-sizing:border-box;">()</span>     }

    required init<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">coder</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">aDecoder</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">NSCoder</span>)</span> {
        super.init<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">coder</span>: <span class="hljs-title" style="box-sizing:border-box;color:#660066;">aDecoder</span>)</span>         self.backgroundColor = <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIColor</span>.redColor<span class="hljs-container" style="box-sizing:border-box;">()</span>     }

    override func layoutSubviews<span class="hljs-container" style="box-sizing:border-box;">()</span> {
        super.layoutSubviews<span class="hljs-container" style="box-sizing:border-box;">()</span>         self.layer.cornerRadius = self.bounds.size.width / 2
    }

    override func beginTrackingWithTouch<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">touch</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UITouch</span>, <span class="hljs-title" style="box-sizing:border-box;color:#660066;">withEvent</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">event</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIEvent</span>)</span> -&gt; <span class="hljs-type" style="box-sizing:border-box;color:#660066;">Bool</span> {
        self.backgroundColor = <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIColor</span>.grayColor<span class="hljs-container" style="box-sizing:border-box;">()</span>         return super.beginTrackingWithTouch<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">touch</span>, <span class="hljs-title" style="box-sizing:border-box;color:#660066;">withEvent</span>: <span class="hljs-title" style="box-sizing:border-box;color:#660066;">event</span>)</span>     }

    override func endTrackingWithTouch<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">touch</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UITouch</span>, <span class="hljs-title" style="box-sizing:border-box;color:#660066;">withEvent</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">event</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIEvent</span>)</span> {
        super.endTrackingWithTouch<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">touch</span>, <span class="hljs-title" style="box-sizing:border-box;color:#660066;">withEvent</span>: <span class="hljs-title" style="box-sizing:border-box;color:#660066;">event</span>)</span>         self.backgroundColor = <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIColor</span>.redColor<span class="hljs-container" style="box-sizing:border-box;">()</span>     }

    override func pointInside<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">point</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">CGPoint</span>, <span class="hljs-title" style="box-sizing:border-box;color:#660066;">withEvent</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">event</span>: <span class="hljs-type" style="box-sizing:border-box;color:#660066;">UIEvent</span>?)</span> -&gt; <span class="hljs-type" style="box-sizing:border-box;color:#660066;">Bool</span> {
        let inside = super.pointInside<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">point</span>, <span class="hljs-title" style="box-sizing:border-box;color:#660066;">withEvent</span>: <span class="hljs-title" style="box-sizing:border-box;color:#660066;">event</span>)</span>         if inside {
            let radius = self.layer.cornerRadius
            let dx = point.x - self.bounds.size.width / 2
            let dy = point.y - radius

            let distace = sqrt<span class="hljs-container" style="box-sizing:border-box;">(<span class="hljs-title" style="box-sizing:border-box;color:#660066;">dx</span> * <span class="hljs-title" style="box-sizing:border-box;color:#660066;">dx</span> + <span class="hljs-title" style="box-sizing:border-box;color:#660066;">dy</span> * <span class="hljs-title" style="box-sizing:border-box;color:#660066;">dy</span>)</span>             return distace &lt; radius
        }

        return inside
    }

}</span></code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
<li style="box-sizing:border-box;padding:0px 5px;">18</li>
<li style="box-sizing:border-box;padding:0px 5px;">19</li>
<li style="box-sizing:border-box;padding:0px 5px;">20</li>
<li style="box-sizing:border-box;padding:0px 5px;">21</li>
<li style="box-sizing:border-box;padding:0px 5px;">22</li>
<li style="box-sizing:border-box;padding:0px 5px;">23</li>
<li style="box-sizing:border-box;padding:0px 5px;">24</li>
<li style="box-sizing:border-box;padding:0px 5px;">25</li>
<li style="box-sizing:border-box;padding:0px 5px;">26</li>
<li style="box-sizing:border-box;padding:0px 5px;">27</li>
<li style="box-sizing:border-box;padding:0px 5px;">28</li>
<li style="box-sizing:border-box;padding:0px 5px;">29</li>
<li style="box-sizing:border-box;padding:0px 5px;">30</li>
<li style="box-sizing:border-box;padding:0px 5px;">31</li>
<li style="box-sizing:border-box;padding:0px 5px;">32</li>
<li style="box-sizing:border-box;padding:0px 5px;">33</li>
<li style="box-sizing:border-box;padding:0px 5px;">34</li>
<li style="box-sizing:border-box;padding:0px 5px;">35</li>
<li style="box-sizing:border-box;padding:0px 5px;">36</li>
<li style="box-sizing:border-box;padding:0px 5px;">37</li>
<li style="box-sizing:border-box;padding:0px 5px;">38</li>
<li style="box-sizing:border-box;padding:0px 5px;">39</li>
<li style="box-sizing:border-box;padding:0px 5px;">40</li>
<li style="box-sizing:border-box;padding:0px 5px;">41</li>
<li style="box-sizing:border-box;padding:0px 5px;">42</li>
<li style="box-sizing:border-box;padding:0px 5px;">43</li>
<li style="box-sizing:border-box;padding:0px 5px;">44</li>
<li style="box-sizing:border-box;padding:0px 5px;">45</li>
<li style="box-sizing:border-box;padding:0px 5px;">46</li>
<li style="box-sizing:border-box;padding:0px 5px;">47</li>
<li style="box-sizing:border-box;padding:0px 5px;">48</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
<li style="box-sizing:border-box;padding:0px 5px;">18</li>
<li style="box-sizing:border-box;padding:0px 5px;">19</li>
<li style="box-sizing:border-box;padding:0px 5px;">20</li>
<li style="box-sizing:border-box;padding:0px 5px;">21</li>
<li style="box-sizing:border-box;padding:0px 5px;">22</li>
<li style="box-sizing:border-box;padding:0px 5px;">23</li>
<li style="box-sizing:border-box;padding:0px 5px;">24</li>
<li style="box-sizing:border-box;padding:0px 5px;">25</li>
<li style="box-sizing:border-box;padding:0px 5px;">26</li>
<li style="box-sizing:border-box;padding:0px 5px;">27</li>
<li style="box-sizing:border-box;padding:0px 5px;">28</li>
<li style="box-sizing:border-box;padding:0px 5px;">29</li>
<li style="box-sizing:border-box;padding:0px 5px;">30</li>
<li style="box-sizing:border-box;padding:0px 5px;">31</li>
<li style="box-sizing:border-box;padding:0px 5px;">32</li>
<li style="box-sizing:border-box;padding:0px 5px;">33</li>
<li style="box-sizing:border-box;padding:0px 5px;">34</li>
<li style="box-sizing:border-box;padding:0px 5px;">35</li>
<li style="box-sizing:border-box;padding:0px 5px;">36</li>
<li style="box-sizing:border-box;padding:0px 5px;">37</li>
<li style="box-sizing:border-box;padding:0px 5px;">38</li>
<li style="box-sizing:border-box;padding:0px 5px;">39</li>
<li style="box-sizing:border-box;padding:0px 5px;">40</li>
<li style="box-sizing:border-box;padding:0px 5px;">41</li>
<li style="box-sizing:border-box;padding:0px 5px;">42</li>
<li style="box-sizing:border-box;padding:0px 5px;">43</li>
<li style="box-sizing:border-box;padding:0px 5px;">44</li>
<li style="box-sizing:border-box;padding:0px 5px;">45</li>
<li style="box-sizing:border-box;padding:0px 5px;">46</li>
<li style="box-sizing:border-box;padding:0px 5px;">47</li>
<li style="box-sizing:border-box;padding:0px 5px;">48</li>
</ul>
</pre><hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="合理使用-kvo" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t21" style="box-sizing:border-box;color:#0c89cf;"></a>合理使用 KVO</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">某些视图的接口比较宝贵，被你用掉后外部的使用者就无法使用了，比如&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UITextField</code>&nbsp;的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">delegate</code>，好在&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UITextField</code>&nbsp;还提供了通知和<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UITextInput</code>&nbsp;方法可以使用；像&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIScrollView</code>&nbsp;或者基于 UIScrollView 的控件，你既不能设置它的 delegate，又没有其他的替代方法可以使用，对于像以下这种需要根据某些属性实时更新的控件来说，<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">KVO</code>&nbsp;真是极好的：</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">这是一个动态高度 Header 的例子（<a href="https://github.com/zhangao0086/DKStickyHeaderView" target="_blank" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;">DKStickyHeaderView</a>）：&nbsp;<br style="box-sizing:border-box;" />
<img width="40%" src="http://img.blog.csdn.net/20150520224913484" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">这个是一个固定在 Bottom 的例子（<a href="https://github.com/zhangao0086/DKStickyFooterView" target="_blank" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;">DKStickyFooterView</a>）：&nbsp;<br style="box-sizing:border-box;" />
<img width="40%" src="http://img.blog.csdn.net/20150520222427519" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">两者都是基于 UIScrollView、基于 KVO ，不依赖外部参数：</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs avrasm has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;">override func observeValueForKeyPath(keyPath: String, ofObject object: AnyObject, change: [NSObject : AnyObject], context: UnsafeMutablePointer&lt;Void&gt;) {
    if keyPath == KEY_PATH_CONTENTOFFSET {
        let scrollView = self<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.superview</span> as! UIScrollView

        var delta: CGFloat = <span class="hljs-number" style="color:#006666;box-sizing:border-box;">0.0</span>         if scrollView<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.contentOffset</span><span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.y</span> &lt; <span class="hljs-number" style="color:#006666;box-sizing:border-box;">0.0</span> {
            delta = fabs(min(<span class="hljs-number" style="color:#006666;box-sizing:border-box;">0.0</span>, scrollView<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.contentOffset</span><span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.y</span>))
        }

        var newFrame = self<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.frame</span>         newFrame<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.origin</span><span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.y</span> = -delta
        newFrame<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.size</span><span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.height</span> = self<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.minHeight</span> + delta
        self<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.frame</span> = newFrame
    } else {
        super<span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">.observeValueForKeyPath</span>(keyPath, ofObject: object, change: change, context: context)
    }
}</code><ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
</ul>
<ul class="pre-numbering" style="box-sizing:border-box;position:absolute;width:50px;top:0px;left:0px;margin:0px;padding:6px 0px 40px;border-right-width:1px;border-right-style:solid;border-right-color:#dddddd;list-style:none;text-align:right;background-color:#eeeeee;"><li style="box-sizing:border-box;padding:0px 5px;">1</li>
<li style="box-sizing:border-box;padding:0px 5px;">2</li>
<li style="box-sizing:border-box;padding:0px 5px;">3</li>
<li style="box-sizing:border-box;padding:0px 5px;">4</li>
<li style="box-sizing:border-box;padding:0px 5px;">5</li>
<li style="box-sizing:border-box;padding:0px 5px;">6</li>
<li style="box-sizing:border-box;padding:0px 5px;">7</li>
<li style="box-sizing:border-box;padding:0px 5px;">8</li>
<li style="box-sizing:border-box;padding:0px 5px;">9</li>
<li style="box-sizing:border-box;padding:0px 5px;">10</li>
<li style="box-sizing:border-box;padding:0px 5px;">11</li>
<li style="box-sizing:border-box;padding:0px 5px;">12</li>
<li style="box-sizing:border-box;padding:0px 5px;">13</li>
<li style="box-sizing:border-box;padding:0px 5px;">14</li>
<li style="box-sizing:border-box;padding:0px 5px;">15</li>
<li style="box-sizing:border-box;padding:0px 5px;">16</li>
<li style="box-sizing:border-box;padding:0px 5px;">17</li>
</ul>
</pre><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">对容器类的&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">ViewController</code>&nbsp;来说也一样有用。在 iOS8 之前没有&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">UIContentContainer</code>&nbsp;这个正式协议，如果你要实现一个很长的、非列表、可滚动的 ViewController，那么你可能会将其中的功能分散到几个&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">ChildViewController</code>&nbsp;里，然后把它们组合起来，这样一来，这些&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">ChildViewController</code>既能被单独作为一个 ViewController 展示，也可以被组合到一起。作为组合到一起的前提，就是需要一个至少有以下两个方法的协议：</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><ol style="box-sizing:border-box;"><li style="box-sizing:border-box;">提供一个统一的输入源，大多是一个 Model 或者像 userId 这样的</li>
<li style="box-sizing:border-box;">能够返回你所需要的高度，比如设置 preferredContentSize 属性</li>
</ol>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">ChildViewController</code>&nbsp;动态地设置&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">contentSize</code>，容器监听&nbsp;<code style="box-sizing:border-box;font-family:'Source Code Pro', monospace;padding:2px 4px;font-size:12.6px;color:#3f3f3f;white-space:nowrap;border-radius:0px;background-color:rgba(128, 128, 128, 0.0745098);">contentSize</code>&nbsp;的变化动态地设置约束或者 frame。</p>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">欢迎补充和讨论</p>
</div>
</div></body></html>