<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2013-08-29T09:36:01Z"/><meta name="updated" content="2013-09-05T03:26:14Z"/><title>protobuf 编译成ios版本      2013-05-20 12:14:00|  分类： cocos2d  |字号 订阅              什么地方用protobuf和为什么要用pr</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="multicntwrap">
	      <div class="multicnt">
	      	<div>
		      <h3 class="title pre fs1"><span class="tcnt">protobuf 编译成ios版本</span>&nbsp;&nbsp;</h3>
		      <p class="tdep clearfix nbw-act fc06" style="line-height:20px;">
		        <span class="pleft"> 		          
		          <span class="blogsep">2013-05-20 12:14:00</span><span class="blogsep">|&nbsp;&nbsp;分类：</span> 		          <a class="fc03 m2a" href="http://blog.163.com/sylar_lin/blog/#m=0&amp;t=1&amp;c=fks_084069084086085065086087083095085095083064087084086074087" title="cocos2d">cocos2d</a> 		          
		        </span> 		        <span class="pright fc07 ztag"><span class="blogsep">|</span><span class="zihao fc03" id="$_fontswitch">字号</span></span><span class="pright pnt fc03" id="$_blog_subscribe"><span class="iblock icn0 icn0-919">&nbsp;</span><a class="m2a">订阅</a></span> 		      </p>
		    </div>
	      </div>
        </div>
        <div>
        
        </div>
        <div class="nbw-blog-start"></div>
        <div class="bct fc05 fc11 nbw-blog ztag js-fs2"><div>什么地方用protobuf和为什么要用protobuf我就不做重复解说了，google大把了</div>
<div><br />
</div>
下载protobuf<div>https://code.google.com/p/protobuf/downloads/list</div>
<div><br />
</div>
<div>先安装</div>
<div>比较简单,cd到解压后的目录</div>
<div>su root 取得root权限</div>
<div>./configure</div>
<div>make&nbsp;</div>
<div>make check</div>
<div>make install</div>
<div><br />
</div>
<div>编译成功后</div>
<div>把<a target="_blank" rel="nofollow" href="https://github.com/dinote/protobuf-mobile-build/blob/master/ios-config.sh">这个sh</a>保存到当前目录下(注意修改这里为你的sdk号&nbsp;export SDKVER="6.1"&nbsp;<span style="line-height:22px;">)</span></div>
<div>./ios-config.sh&nbsp;<span style="line-height:22px;">执行这个脚本&nbsp;</span></div>
<div><span style="line-height:22px;"><br />
</span></div>
<div><span style="line-height:22px;">编译成功后就会在当前目录下的</span>ios-build文件夹子中：</div>
<div>libprotobuf-lite.a &nbsp;<span style="line-height:22px;">(版本信息：armv7 (cputype (12) cpusubtype (11)) i386&nbsp;)</span></div>
<div><span style="line-height:22px;"><br />
</span></div>
<div><span style="line-height:22px;background-color:#ffff00;">注意，这个作者提供的sh版本生成出来的是一个lite版本来的，不能用protobuf的一些额外的功能，例如反射功能:</span></div>
<div><span style="font-family:Arial, 'Liberation Sans', 'DejaVu Sans', sans-serif;font-size:13.600000381469727px;line-height:17.600000381469727px;">The "lite" version is not able to serialize to or from&nbsp;</span><code style="margin:0px;padding:1px 5px;border:0px;font-size:13.600000381469727px;vertical-align:baseline;background-color:#eeeeee;font-family:Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif;line-height:17.600000381469727px;">iostream</code><span style="font-family:Arial, 'Liberation Sans', 'DejaVu Sans', sans-serif;font-size:13.600000381469727px;line-height:17.600000381469727px;">, or "</span><code style="margin:0px;padding:1px 5px;border:0px;font-size:13.600000381469727px;vertical-align:baseline;background-color:#eeeeee;font-family:Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif;line-height:17.600000381469727px;">FileDescriptor</code><span style="font-family:Arial, 'Liberation Sans', 'DejaVu Sans', sans-serif;font-size:13.600000381469727px;line-height:17.600000381469727px;">", and it cannot use the</span><code style="margin:0px;padding:1px 5px;border:0px;font-size:13.600000381469727px;vertical-align:baseline;background-color:#eeeeee;font-family:Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif;line-height:17.600000381469727px;">Reflection</code><span style="font-family:Arial, 'Liberation Sans', 'DejaVu Sans', sans-serif;font-size:13.600000381469727px;line-height:17.600000381469727px;">&nbsp;feature, and... a scattering of other features.</span></div>
<div><span style="font-family:'Arial, Liberation Sans, DejaVu Sans, sans-serif';"><span style="line-height:17.59375px;">如果用到这些功能的话，编译的时候则会出现undefined symbol等连接错误</span></span></div>
<br />
<div>如果需要用完整版本，请使用如下sh代码：</div>
<div>ios-build目录下面则多了三个文件，其中<span style="line-height:25px;background-color:#ccced0;color:#880000;font-family:monospace;white-space:pre;">libprotobuf.a</span><span style="line-height:22px;">就是我们要用到的完整版本</span></div>
<pre class="prettyprint"><p><span class="pln">configure_for_platform</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> PLATFORM</span><span class="pun">=</span><span class="pln">$1</span> <span class="pln">	</span><span class="com">#export PLATFORM=iPhoneOS </span> <span class="pln">	echo </span><span class="str">"Platform is ${PLATFORM}"</span> <span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span class="str">"$PLATFORM"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"iPhoneSimulator"</span><span class="pln"> </span><span class="pun">];</span><span class="pln"> </span><span class="kwd">then</span> <span class="pln">		</span><span class="kwd">export</span><span class="pln"> ARCHITECTURE</span><span class="pun">=</span><span class="pln">i386</span> <span class="pln">		</span><span class="kwd">export</span><span class="pln"> ARCH</span><span class="pun">=</span><span class="pln">i686</span><span class="pun">-</span><span class="pln">apple</span><span class="pun">-</span><span class="pln">darwin10</span> <span class="pln">	</span><span class="kwd">fi</span> <span class="pln">	</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span class="str">"$PLATFORM"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"iPhoneOS"</span><span class="pln"> </span><span class="pun">];</span><span class="pln"> </span><span class="kwd">then</span> <span class="pln">		</span><span class="kwd">export</span><span class="pln"> ARCHITECTURE</span><span class="pun">=</span><span class="pln">$2</span> <span class="pln">		</span><span class="kwd">export</span><span class="pln"> ARCH</span><span class="pun">=</span><span class="pln">arm</span><span class="pun">-</span><span class="pln">apple</span><span class="pun">-</span><span class="pln">darwin10 </span> <span class="pln">	</span><span class="kwd">fi</span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> ARCH_PREFIX</span><span class="pun">=</span><span class="pln">$ARCH</span><span class="pun">-</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> SDKVER</span><span class="pun">=</span><span class="str">"6.1"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> DEVROOT</span><span class="pun">=</span><span class="str">/Applications/</span><span class="typ">Xcode</span><span class="pun">.</span><span class="pln">app</span><span class="pun">/</span><span class="typ">Contents</span><span class="pun">/</span><span class="typ">Developer</span><span class="pun">/</span><span class="typ">Platforms</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">PLATFORM</span><span class="pun">}.</span><span class="pln">platform</span><span class="pun">/</span><span class="typ">Developer</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> SDKROOT</span><span class="pun">=</span><span class="str">"$DEVROOT/SDKs/${PLATFORM}$SDKVER.sdk"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> PKG_CONFIG_PATH</span><span class="pun">=</span><span class="str">"$SDKROOT/usr/lib/pkgconfig:$DEVROOT/usr/lib/pkgconfig"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> AS</span><span class="pun">=</span><span class="str">"$DEVROOT/usr/bin/as"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> ASCPP</span><span class="pun">=</span><span class="str">"$DEVROOT/usr/bin/as"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> AR</span><span class="pun">=</span><span class="str">"$DEVROOT/usr/bin/ar"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> RANLIB</span><span class="pun">=</span><span class="str">"$DEVROOT/usr/bin/ranlib"</span><span class="pln"> </span> <span class="pln">	</span><span class="com">#export CPP="$DEVROOT/usr/bin/c++" </span> <span class="pln">	</span><span class="com">#export CXXCPP="$DEVROOT/usr/bin/c++" </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> CC</span><span class="pun">=</span><span class="str">"$DEVROOT/usr/bin/gcc"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> CXX</span><span class="pun">=</span><span class="str">"$DEVROOT/usr/bin/g++"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> LD</span><span class="pun">=</span><span class="str">"$DEVROOT/usr/bin/ld"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> STRIP</span><span class="pun">=</span><span class="str">"$DEVROOT/usr/bin/strip"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> LIBRARY_PATH</span><span class="pun">=</span><span class="str">"$SDKROOT/usr/lib"</span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> CPPFLAGS</span><span class="pun">=</span><span class="str">""</span><span class="pln"> </span> <span class="pln">	</span><span class="com">#export CFLAGS="-arch armv7 -fmessage-length=0 -pipe -fpascal-strings -miphoneos-version-min=4.0 -isysroot=$SDKROOT -I$SDKROOT/usr/include -I$SDKROOT/usr/include/c++/4.2.1/" </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> CFLAGS</span><span class="pun">=</span><span class="str">"-arch ${ARCHITECTURE} -fmessage-length=0 -pipe -fpascal-strings -miphoneos-version-min=4.0 -isysroot=$SDKROOT -I$SDKROOT/usr/include -I$SDKROOT/usr/include/c++/4.2.1/"</span><span class="pln"> </span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> CXXFLAGS</span><span class="pun">=</span><span class="str">"$CFLAGS"</span><span class="pln"> </span> <span class="pln">	</span><span class="com">#export LDFLAGS="-isysroot='$SDKROOT' -L$SDKROOT/usr/lib/system -L$SDKROOT/usr/lib/"</span> <span class="pln">	</span><span class="kwd">export</span><span class="pln"> LDFLAGS</span><span class="pun">=</span><span class="str">"-arch ${ARCHITECTURE} -isysroot='$SDKROOT' -L$SDKROOT/usr/lib/system -L$SDKROOT/usr/lib/"</span> <span class="pln">	</span><span class="pun">./</span><span class="pln">configure </span><span class="pun">--</span><span class="pln">host</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">ARCH</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="kwd">with</span><span class="pun">-</span><span class="pln">protoc</span><span class="pun">=</span><span class="pln">protoc </span><span class="pun">--</span><span class="pln">enable</span><span class="pun">-</span><span class="kwd">static</span><span class="pln"> </span><span class="pun">--</span><span class="pln">disable</span><span class="pun">-</span><span class="pln">shared </span> <span class="pun">}</span> <span class="pln">mkdir ios</span><span class="pun">-</span><span class="pln">build</span> <span class="com">#build for iPhoneSimulator</span> <span class="pln">configure_for_platform iPhoneSimulator</span> <span class="pln">make clean</span> <span class="pln">make</span> <span class="pln">cp src</span><span class="pun">/.</span><span class="pln">libs</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">.</span><span class="pln">a ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">-</span><span class="pln">i386</span><span class="pun">.</span><span class="pln">a</span> <span class="com">#提取完整版本(i386)</span> <span class="pln">cp src</span><span class="pun">/.</span><span class="pln">libs</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">.</span><span class="pln">a ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">i386</span><span class="pun">.</span><span class="pln">a</span> <span class="com">#build for iPhoneOS armv7</span> <span class="pln">configure_for_platform iPhoneOS armv7</span> <span class="pln">make clean</span> <span class="pln">make</span> <span class="pln">cp src</span><span class="pun">/.</span><span class="pln">libs</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">.</span><span class="pln">a ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">-</span><span class="pln">armv7</span><span class="pun">.</span><span class="pln">a</span> <span class="com">#提取完整版本(armv7)</span> <span class="pln">cp src</span><span class="pun">/.</span><span class="pln">libs</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">.</span><span class="pln">a ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">armv7</span><span class="pun">.</span><span class="pln">a</span> <span class="com">#build for iPhoneOS armv7s</span> <span class="pln">configure_for_platform iPhoneOS armv7s</span> <span class="pln">make clean</span> <span class="pln">make</span> <span class="pln">cp src</span><span class="pun">/.</span><span class="pln">libs</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">.</span><span class="pln">a ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">-</span><span class="pln">armv7s</span><span class="pun">.</span><span class="pln">a</span> <span class="com">#提取完整版本(armv7s)</span> <span class="pln">cp src</span><span class="pun">/.</span><span class="pln">libs</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">.</span><span class="pln">a ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">armv7s</span><span class="pun">.</span><span class="pln">a</span> <span class="pln">make clean</span> <span class="com">#cerate a fat library containing all achitectures in libprotobuf-lite.a</span> <span class="pln">xcrun </span><span class="pun">-</span><span class="pln">sdk iphoneos lipo </span><span class="pun">-</span><span class="pln">arch armv7 ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">-</span><span class="pln">armv7</span><span class="pun">.</span><span class="pln">a </span><span class="pun">-</span><span class="pln">arch armv7s ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">-</span><span class="pln">armv7s</span><span class="pun">.</span><span class="pln">a </span><span class="pun">-</span><span class="pln">arch i386 ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">-</span><span class="pln">i386</span><span class="pun">.</span><span class="pln">a </span><span class="pun">-</span><span class="pln">create </span><span class="pun">-</span><span class="pln">output ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">lite</span><span class="pun">.</span><span class="pln">a</span> <span class="com">#合并三个完整版本（libprotobuf.a）</span> <span class="pln">xcrun </span><span class="pun">-</span><span class="pln">sdk iphoneos lipo </span><span class="pun">-</span><span class="pln">arch armv7 ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">armv7</span><span class="pun">.</span><span class="pln">a </span><span class="pun">-</span><span class="pln">arch armv7s ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">armv7s</span><span class="pun">.</span><span class="pln">a </span><span class="pun">-</span><span class="pln">arch i386 ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">-</span><span class="pln">i386</span><span class="pun">.</span><span class="pln">a </span><span class="pun">-</span><span class="pln">create </span><span class="pun">-</span><span class="pln">output ios</span><span class="pun">-</span><span class="pln">build</span><span class="pun">/</span><span class="pln">libprotobuf</span><span class="pun">.</span><span class="pln">a</span> </p>
</pre></div></body></html>