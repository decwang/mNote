<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2014-12-18T06:14:26Z"/><meta name="updated" content="2016-10-08T09:09:11Z"/><title>UIWindow & UIWindowLevel笔记  一、UIWindow是一种特殊的UIView，通常在一个程序中只会有一个UIWindow，但可以手动创建多个UIWindow，同时加到程序里面</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;text-align:center;"><span style="line-height:36px;font-size:18pt;">UIWindow &amp; UIWindowLevel笔记</span></p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">一、UIWindow是一种特殊的UIView，通常在一个程序中只会有一个UIWindow，但可以手动创建多个UIWindow，同时加到程序里面。UIWindow在程序中主要起到三个作用：</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　1、作为容器，包含app所要显示的所有视图</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　2、传递触摸消息到程序中view和其他对象</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　3、与UIViewController协同工作，方便完成设备方向旋转的支持</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">二、通常我们可以采取两种方法将view添加到UIWindow中：</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　1、addSubview</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　直接将view通过addSubview方式添加到window中，程序负责维护view的生命周期以及刷新，但是并不会为去理会view对应的ViewController，因此采用这种方法将view添加到window以后，我们还要保持view对应的ViewController的有效性，不能过早释放。</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　2、rootViewController</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　rootViewController时UIWindow的一个遍历方法，通过设置该属性为要添加view对应的ViewController，UIWindow将会自动将其view添加到当前window中，同时负责ViewController和view的生命周期的维护，防止其过早释放</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">三、WindowLevel</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　UIWindow在显示的时候会根据UIWindowLevel进行排序的，即Level高的将排在所有Level比他低的层级的前面。下面我们来看UIWindowLevel的定义：</p>
<div class="cnblogs_code" style="background-color:#f5f5f5;border:1px solid #cccccc;padding:5px;overflow:auto;margin:5px 0px;line-height:20.799999237060547px;font-family:'Courier New' !important;font-size:12px !important;"><pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New' !important;"><span style="line-height:1.5 !important;"><span style="color:#0000ff;line-height:1.5 !important;">　　　　const</span> UIWindowLevel UIWindowLevelNormal;</span> <span style="line-height:1.5 !important;"><span style="color:#0000ff;line-height:1.5 !important;">　　　　const</span> UIWindowLevel UIWindowLevelAlert;</span> <span style="line-height:1.5 !important;"><span style="color:#0000ff;line-height:1.5 !important;">　　　　const</span> UIWindowLevel UIWindowLevelStatusBar;</span> <span style="line-height:1.5 !important;">　　　　typedef CGFloat UIWindowLevel;</span></pre></div>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　IOS系统中定义了三个window层级，其中每一个层级又可以分好多子层级(从UIWindow的头文件中可以看到成员变量<span style="line-height:21px;font-size:14px;"><span class="s1">CGFloat&nbsp;</span>_windowSublevel;)，不过系统并没有把则个属性开出来。UIWindow的默认级别是UIWindowLevelNormal，我们打印输出这三个level的值分别如下：</span></p>
<div class="cnblogs_Highlighter" style="font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;"><div id="highlighter_730142" class="syntaxhighlighter nogutter objc" style="width:100% !important;margin:1em 0px !important;position:relative !important;overflow:auto !important;font-size:1em !important;"><table border="0" cellpadding="0" cellspacing="0" style="border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:100% !important;box-sizing:content-box !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;font-size:12px !important;min-height:inherit !important;"><tbody style="border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:inherit !important;"><tr style="border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:inherit !important;"><td class="code" style="border-collapse:collapse;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;min-height:inherit !important;"><div class="container" style="border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px !important;position:relative !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:inherit !important;"><div class="line number1 index0 alt2" style="border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;background-color:#f4f4f4 !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.8em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px 1em 0px 0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:inherit !important;"><code class="objc plain" style="white-space:pre-wrap;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.8em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;min-height:inherit !important;">2012-03-27 22:46:08.752 UIViewSample[395:f803] Normal window level: 0.000000</code></div>
<div class="line number2 index1 alt1" style="border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.8em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px 1em 0px 0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:inherit !important;"><code class="objc plain" style="white-space:pre-wrap;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.8em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;min-height:inherit !important;">2012-03-27 22:46:08.754 UIViewSample[395:f803] Alert window level: 2000.000000</code></div>
<div class="line number3 index2 alt2" style="border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;background-color:#f4f4f4 !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.8em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px 1em 0px 0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:inherit !important;"><code class="objc plain" style="white-space:pre-wrap;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.8em !important;margin:0px !important;outline:0px !important;overflow:visible !important;padding:0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;min-height:inherit !important;">2012-03-27 22:46:08.755 UIViewSample[395:f803] Status window level: 1000.000000</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　这样印证了他们级别的高低顺序从小到大为Normal &lt; StatusBar &lt; Alert，下面请看小的测试代码：</p>
<div class="cnblogs_code" style="background-color:#f5f5f5;border:1px solid #cccccc;padding:5px;overflow:auto;margin:5px 0px;line-height:20.799999237060547px;font-family:'Courier New' !important;font-size:12px !important;"><div class="cnblogs_code_toolbar" style="margin-top:5px;"><span class="cnblogs_code_copy" style="padding-right:5px;line-height:1.5 !important;"><a title="复制代码" style="color:#075db3;text-decoration:underline;border:none !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none !important;" /></a></span></div>
<pre style="margin-top:0px;margin-bottom:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New' !important;">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *<span style="line-height:1.5 !important;">)launchOptions
{
    self.window </span>=<span style="line-height:1.5 !important;"> [[[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]] autorelease];
    self.window.backgroundColor </span>=<span style="line-height:1.5 !important;"> [UIColor yellowColor];
    [self.window makeKeyAndVisible];
    
    UIWindow </span>*normalWindow =<span style="line-height:1.5 !important;"> [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
    normalWindow.backgroundColor </span>=<span style="line-height:1.5 !important;"> [UIColor blueColor];
    normalWindow.windowLevel </span>=<span style="line-height:1.5 !important;"> UIWindowLevelNormal;
    [normalWindow makeKeyAndVisible];
    
    CGRect windowRect </span>= CGRectMake(<span style="color:#800080;line-height:1.5 !important;">50</span><span style="line-height:1.5 !important;">,
                                   </span><span style="color:#800080;line-height:1.5 !important;">50</span><span style="line-height:1.5 !important;">,
                                   [[UIScreen mainScreen] bounds].size.width </span>- <span style="color:#800080;line-height:1.5 !important;">100</span><span style="line-height:1.5 !important;">,
                                   [[UIScreen mainScreen] bounds].size.height </span>- <span style="color:#800080;line-height:1.5 !important;">100</span><span style="line-height:1.5 !important;">);
    UIWindow </span>*alertLevelWindow =<span style="line-height:1.5 !important;"> [[UIWindow alloc] initWithFrame:windowRect];
    alertLevelWindow.windowLevel </span>=<span style="line-height:1.5 !important;"> UIWindowLevelAlert;
    alertLevelWindow.backgroundColor </span>=<span style="line-height:1.5 !important;"> [UIColor redColor];
    [alertLevelWindow makeKeyAndVisible];
    
    UIWindow </span>*statusLevelWindow = [[UIWindow alloc] initWithFrame:CGRectMake(<span style="color:#800080;line-height:1.5 !important;">0</span>, <span style="color:#800080;line-height:1.5 !important;">50</span>, <span style="color:#800080;line-height:1.5 !important;">320</span>, <span style="color:#800080;line-height:1.5 !important;">20</span><span style="line-height:1.5 !important;">)];
    statusLevelWindow.windowLevel </span>=<span style="line-height:1.5 !important;"> UIWindowLevelStatusBar;
    statusLevelWindow.backgroundColor </span>=<span style="line-height:1.5 !important;"> [UIColor blackColor];
    [statusLevelWindow makeKeyAndVisible];
    
    NSLog(</span><span style="color:#800000;line-height:1.5 !important;">@"</span><span style="color:#800000;line-height:1.5 !important;">Normal window level: %f</span><span style="color:#800000;line-height:1.5 !important;">"</span><span style="line-height:1.5 !important;">, UIWindowLevelNormal);
    NSLog(</span><span style="color:#800000;line-height:1.5 !important;">@"</span><span style="color:#800000;line-height:1.5 !important;">Alert window level: %f</span><span style="color:#800000;line-height:1.5 !important;">"</span><span style="line-height:1.5 !important;">, UIWindowLevelAlert);
    NSLog(</span><span style="color:#800000;line-height:1.5 !important;">@"</span><span style="color:#800000;line-height:1.5 !important;">Status window level: %f</span><span style="color:#800000;line-height:1.5 !important;">"</span><span style="line-height:1.5 !important;">, UIWindowLevelStatusBar);
    
    </span><span style="color:#0000ff;line-height:1.5 !important;">return</span><span style="line-height:1.5 !important;"> YES;
}</span></pre><div class="cnblogs_code_toolbar" style="margin-top:5px;"><span class="cnblogs_code_copy" style="padding-right:5px;line-height:1.5 !important;"><a title="复制代码" style="color:#075db3;text-decoration:underline;border:none !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="border:none !important;" /></a></span></div>
</div>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">&nbsp;</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　运行结果如下图：</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;"><img src="http://pic002.cnblogs.com/images/2012/302680/2012032722535669.jpg" alt="" style="border:0px;display:block;margin-left:auto;margin-right:auto;" /></p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　我们可以注意到两点：</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　1）我们生成的normalWindow虽然是在第一个默认的window之后调用makeKeyAndVisible，但是仍然没有显示出来。这说明当Level层级相同的时候，只有第一个设置为KeyWindow的显示出来，后面同级的再设置KeyWindow也不会显示。</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　2）statusLevelWindow在alertLevelWindow之后调用makeKeyAndVisible，仍然只是显示在alertLevelWindow的下方。这说明UIWindow在显示的时候是不管KeyWindow是谁，都是Level优先的，即Level最高的始终显示在最前面。</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　那么如何才能将后加的同一层级的window显示出来呢？</p>
<p style="margin:10px auto;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;font-size:13px;line-height:20.799999237060547px;">　　<span style="line-height:24px;font-size:16px;">思考中......</span></p></body></html>