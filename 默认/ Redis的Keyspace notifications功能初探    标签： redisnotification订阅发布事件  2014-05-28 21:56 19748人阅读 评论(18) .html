<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-07-20T04:05:55Z"/><meta name="updated" content="2017-07-20T04:05:57Z"/><title> Redis的Keyspace notifications功能初探    标签： redisnotification订阅发布事件  2014-05-28 21:56 19748人阅读 评论(18) </title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="article_title" style="margin-bottom:21px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;orphans:2;widows:2;">&nbsp;<h1 style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;font-size:18px;"><span class="link_title"><a href="http://blog.csdn.net/chaijunkun/article/details/27361453" style="text-decoration:none;color:#000000;">Redis的Keyspace notifications功能初探</a></span></h1>
</div>
<div class="article_manage clearfix" style="border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#ededed;color:#999999;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:12px;line-height:22px;font-family:Arial;text-align:right;margin:0px -20px 10px;padding:0px 20px 5px;overflow:hidden;orphans:2;widows:2;"><div class="article_l" style="width:934px;float:left;"><span class="link_categories" style="margin:0px 0px 0px 5px;float:left;">标签：&nbsp;<a href="http://www.csdn.net/tag/redis" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">redis</a><a href="http://www.csdn.net/tag/notification" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">notification</a><a href="http://www.csdn.net/tag/%e8%ae%a2%e9%98%85%e5%8f%91%e5%b8%83" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">订阅发布</a><a href="http://www.csdn.net/tag/%e4%ba%8b%e4%bb%b6" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">事件</a></span></div>
<div class="article_r"><span class="link_postdate" style="margin:0px 16px 0px 0px;">2014-05-28 21:56</span>&nbsp;<span class="link_view" title="阅读次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 24px;background:url(&quot;../images/skin-type-icon.png&quot;) 0px -25px no-repeat;display:inline-block;">19748人阅读</span>&nbsp;<span class="link_comments" title="评论次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 17px;background-image:url(&quot;../images/skin-type-icon-yellow.png&quot;) !important;background-position:0px -43px;background-size:initial;background-repeat:no-repeat;background-attachment:initial;background-origin:initial;background-clip:initial;background-color:initial;display:inline-block;"><a href="http://blog.csdn.net/chaijunkun/article/details/27361453#comments" style="text-decoration:none;color:#c88326;">评论</a>(18)</span>&nbsp;<span class="link_collect tracking-ad" data-mod="popu_171" style="margin:0px 16px 0px 5px;display:inline-block;background-image:url(&quot;../images/skin-type-icon-yellow.png&quot;) !important;background-repeat:no-repeat;background-position:0px -62px;padding-left:17px;"><a title="收藏" target="_blank" style="color:#c88326;">收藏</a></span>&nbsp;<span class="link_report" style="margin:0px 16px 0px 5px;display:inline-block;background-image:url(&quot;../images/skin-type-icon-yellow.png&quot;) !important;background-repeat:no-repeat;background-position:0px -81px;padding-left:17px;"><a href="http://blog.csdn.net/chaijunkun/article/details/27361453#report" title="举报" style="text-decoration:none;color:#c88326;">举报</a></span></div>
</div>
<div class="category clearfix" style="border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#ededed;margin:0px -20px;padding:5px 20px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;orphans:2;widows:2;"><div class="category_l" style="font-size:14px;float:left;display:inline-block;color:#333333;width:70px;line-height:28px;"><img src="http://static.blog.csdn.net/images/category_icon.jpg" style="border:none;vertical-align:middle;" />&nbsp;<span style="vertical-align:middle;display:inline-block;">分类：</span></div>
<div class="category_r" style="font-size:14px;float:left;display:inline-block;color:#df3434;width:840.594px;"><label style="display:inline-block;margin-left:15px;cursor:pointer;line-height:28px;position:relative;">研究成果（42）&nbsp;<img class="arrow-down" src="http://static.blog.csdn.net/images/arrow_triangle%20_down.jpg" style="border:none;display:inline;" /></label>&nbsp;<label style="display:inline-block;margin-left:15px;cursor:pointer;line-height:28px;position:relative;">redis相关技术</label></div>
</div>
<div class="bog_copyright" style="padding:20px 0px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;orphans:2;widows:2;"><p class="copyright_p" style="margin-top:0px;margin-bottom:0px;padding:0px 0px 0px 10px;height:14px;line-height:14px;border-left-width:3px;border-left-style:solid;border-left-color:#e41c1e;color:#666666;font-size:14px;">版权声明：本文为博主原创文章，更多博文请访问：http://blog.csdn.net/chaijunkun，未经博主允许不得转载。</p>
</div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;orphans:2;widows:2;clear:both;"></div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;orphans:2;widows:2;border:1px solid #cccccc;background-color:#eeeeee;float:left;min-width:200px;padding:4px 10px;background-position:initial initial;background-repeat:initial initial;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;text-align:right;"><span style="float:left;">目录<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" title="系统根据文章中H1到H6标签自动生成文章目录" style="text-decoration:none;">(?)</a></span><a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" title="展开" style="text-decoration:none;">[+]</a></p>
</div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;orphans:2;widows:2;clear:both;"></div>
<div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post" style="margin:35px 0px;font-size:15px;color:#555555;line-height:35px;font-family:'microsoft yahei';font-variant-ligatures:normal;orphans:2;widows:2;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">本文出处：http://blog.csdn.net/chaijunkun/article/details/27361453，转载请注明。由于本人不定期会整理相关博文，会对相应内容作出完善。因此强烈建议在原始出处查看此文。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;"><br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">最近在做一套系统，其中要求若干个Worker服务器将心跳信息都上报给中央服务器。当一定时间中央服务器没有得到心跳信息时则认为该Worker失效了，发出告警。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;"><br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">满足这种需求的解决方法多种多样，我开始想到了memcache，上报一次心跳信息就刷新一次缓存，当缓存内心跳信息对象超时被删除，即认为对应的Worker失效。然而由于memcache的工作原理，删除都是被动的，我们无法及时判断数据是否过期，即便知道了数据过期，也没有一种机制来回调方法来执行自定义的处理动作。难道缓存架构就真的不行了吗？</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;"><br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">答案是否定的。在Redis 2.8.0版本起，加入了“Keyspace notifications”（即“键空间通知”）的功能。如何理解该功能呢？我们来看下官方是怎么说的：</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">键空间通知，允许Redis客户端从“发布/订阅”通道中建立订阅关系，以便客户端能够在Redis中的数据因某种方式受到影响时收到相应事件。<br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">可能接收到的事件举例如下：<br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">影响一个给出的键的所有命令（会告诉你哪个键被执行了一个命令，这个命令是什么）；<br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">接收到了一个LPUSH操作的所有键（LPUSH命令：key v1 [v2 v3..]将指定的所有值从左到右进行压栈操作，形成一个栈，并将该栈命名为指定的key）；<br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">在数据库0中失效的所有键（不一定非得是数据库0，这里这样表述其实想表达可以知道影响的哪个数据库）。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;"><br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">看到这里我联想到，如果一条缓存数据失效了，通过订阅关系，客户端会收到消息，通过分析消息可以得知何种消息，分析消息内容可以知道是哪个key失效了。这样就可以间接实现开头所描述的功能。</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;"><br />
</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">接下来我们来看下实验的步骤：</span></p>
<h1 style="margin:0px;padding:0px;"><a name="t0" target="_blank" style="color:#0c89cf;"></a><span style="font-size:18px;">1.准备redis服务器</span></h1>
<div><span style="font-size:18px;">作为开源软件，redis下载后得到的是源代码，使用tar -xzvf redis-2.8.9.tar.gz解压后对其进行编译，过程也很简单，make就可以了。编译完成之后可以使用自带的runtest进行测试，看是否编译成功。然后就是安装了，执行make PREFIX=/usr/local/redis-2.8.9 install，PREFIX参数指定的就是安装路径。现在安装的只有可执行文件，还没有配置文件。其实在源码目录中有一个模板redis.conf，我们对它进行改动就可以了。</span></div>
<div><span style="font-size:18px;">其他配置我们不关心，但是官方文档中说Keyspace notifications功能默认是关闭的（默认地，Keyspace 时间通知功能是禁用的，因为它或多或少会使用一些CPU的资源），我们需要打开它。打开的方法也很简单，配置属性：notify-keyspace-events</span></div>
<div><span style="font-size:18px;"><br />
</span></div>
<div><span style="font-size:18px;">默认配置是这样的：notify-keyspace-events ""</span></div>
<div><span style="font-size:18px;">根据文档中的说明：</span></div>
<div><div class="dp-highlighter bg_plain" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[plain]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:742px;top:1799px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_1" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_1" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">K&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Keyspace&nbsp;events,&nbsp;published&nbsp;with&nbsp;__keyspace@&lt;db&gt;__&nbsp;prefix.&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">E&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Keyevent&nbsp;events,&nbsp;published&nbsp;with&nbsp;__keyevent@&lt;db&gt;__&nbsp;prefix.&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">g&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Generic&nbsp;commands&nbsp;(non-type&nbsp;specific)&nbsp;like&nbsp;DEL,&nbsp;EXPIRE,&nbsp;RENAME,&nbsp;...&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;commands&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&nbsp;commands&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;commands&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hash&nbsp;commands&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sorted&nbsp;set&nbsp;commands&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Expired&nbsp;events&nbsp;(events&nbsp;generated&nbsp;every&nbsp;time&nbsp;a&nbsp;key&nbsp;expires)&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">e&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Evicted&nbsp;events&nbsp;(events&nbsp;generated&nbsp;when&nbsp;a&nbsp;key&nbsp;is&nbsp;evicted&nbsp;for&nbsp;maxmemory)&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Alias&nbsp;for&nbsp;g$lshzxe,&nbsp;so&nbsp;that&nbsp;the&nbsp;"AKE"&nbsp;string&nbsp;means&nbsp;all&nbsp;the&nbsp;events.&nbsp;&nbsp;</span></li>
</ol>
</div>
我们配置为：<span style="font-size:18px;">notify-keyspace-events Ex，含义为：发布key事件，使用过期事件（当每一个key失效时，都会生成该事件）。</span></div>
<h1 style="margin:0px;padding:0px;"><a name="t1" target="_blank" style="color:#0c89cf;"></a><span style="font-size:18px;">2.准备客户端和连接配置<br />
</span></h1>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><span style="font-size:18px;">本文中使用的客户端是Jedis，版本为2.4.2，为了代码的通用性，我使用Spring来管理连接：</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_html" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[html]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:739px;top:2207px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_2" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_2" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=2&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" class="dp-xml" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">bean</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">id</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"pool"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"redis.clients.jedis.JedisPool"</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">constructor-arg</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">bean</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">id</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"config"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"redis.clients.jedis.JedisPoolConfig"</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">property</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">name</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"maxIdle"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">value</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"0"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">/&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">property</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">name</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"maxTotal"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">value</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"20"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">/&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">property</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">name</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"maxWaitMillis"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">value</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"1000"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">/&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">property</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">name</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"testOnBorrow"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="attribute" style="margin:0px;padding:0px;border:none;color:red;background-color:inherit;">value</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">=</span><span class="attribute-value" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"true"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">/&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;/</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">bean</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;/</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">constructor-arg</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">constructor-arg</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">value</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">192.168.1.100</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;/</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">value</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;/</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">constructor-arg</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">constructor-arg</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">value</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">6379</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;/</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">value</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;/</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">constructor-arg</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&lt;/</span><span class="tag-name" style="margin:0px;padding:0px;border:none;color:#993300;background-color:inherit;font-weight:bold;">bean</span><span class="tag" style="color:#993300;margin:0px;padding:0px;border:none;background-color:inherit;font-weight:bold;">&gt;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
</ol>
</div>
然后使用Spring Test和Junit来测试代码<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[java]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:737px;top:2599px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_3" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_3" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=3&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" class="dp-j" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="annotation" style="margin:0px;padding:0px;border:none;color:#646464;background-color:inherit;">@RunWith</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">(SpringJUnit4ClassRunner.</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">)&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="annotation" style="margin:0px;padding:0px;border:none;color:#646464;background-color:inherit;">@ContextConfiguration</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">(</span><span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"/applicationContext*.xml"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">)&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">public</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;RedisSubscribeDemo&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">private</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">static</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">final</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;Log&nbsp;Log=&nbsp;LogFactory.getLog(RedisSubscribeDemo.</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="margin:0px;padding:0px;border:none;color:#646464;background-color:inherit;">@Resource</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">private</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;JedisPool&nbsp;pool;&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="margin:0px;padding:0px;border:none;color:#646464;background-color:inherit;">@Test</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">public</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">void</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;doTest()&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">throws</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;InterruptedException&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">for</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;(</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">int</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;i&nbsp;=&nbsp;</span><span class="number" style="margin:0px;padding:0px;border:none;color:#c00000;background-color:inherit;">0</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;&nbsp;i&nbsp;&lt;&nbsp;</span><span class="number" style="margin:0px;padding:0px;border:none;color:#c00000;background-color:inherit;">1</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">;&nbsp;i++)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TestThread&nbsp;thread=&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">new</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;TestThread(pool);&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread.start();&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.sleep(50000L);&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.info(<span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"Test&nbsp;finish..."</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">}&nbsp;&nbsp;</span></li>
</ol>
</div>
<br />
由于要使用一定的延迟，我们把主要测试代码放到了TestThread中。当测试线程启动后，主线程停滞50秒，让我们有足够的时间来操作。<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[java]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:737px;top:3080px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_4" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_4" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=4&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" class="dp-j" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">public</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;TestThread&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">extends</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;Thread&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">private</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;Log&nbsp;log=&nbsp;LogFactory.getLog(TestThread.</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">private</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;JedisPool&nbsp;pool;&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">public</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;TestThread(JedisPool&nbsp;pool){&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"loading&nbsp;test&nbsp;thread"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">this</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">.pool=&nbsp;pool;&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation" style="margin:0px;padding:0px;border:none;color:#646464;background-color:inherit;">@Override</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">public</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">void</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;run()&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jedis&nbsp;jedis=&nbsp;pool.getResource();&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jedis.psubscribe(<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">new</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;MySubscribe(),&nbsp;</span><span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"*"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">try</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.sleep(10000L);&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">catch</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;(InterruptedException&nbsp;e)&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"延时失败"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">,&nbsp;e);&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jedis.close();&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(<span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"Test&nbsp;run&nbsp;finished"</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">}&nbsp;&nbsp;</span></li>
</ol>
</div>
在测试线程中，我们将自定义的MySubscribe加入到了Jedis的模板订阅（即psubscribe，因为模板订阅的channel是支持星号'*'通配的，这样可以收集到多个通配通道的消息，而与之相反的还有一个subscribe，此订阅只能指定严格匹配的通道）中，同样为了测试过程能够将结果显示出来，在绑定了订阅后，对该线程进行了延时10秒。<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<div class="dp-highlighter bg_java" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[java]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:737px;top:3686px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_5" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_5" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=5&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" class="dp-j" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">public</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;MySubscribe&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">extends</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;JedisPubSub&nbsp;{&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">private</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">static</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">final</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;Log&nbsp;log=&nbsp;LogFactory.getLog(MySubscribe.</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">class</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">);&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;初始化按表达式的方式订阅时候的处理&nbsp;&nbsp;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">public</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">void</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;onPSubscribe(String&nbsp;pattern,&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">int</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;subscribedChannels)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(pattern&nbsp;+&nbsp;<span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"="</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;+&nbsp;subscribedChannels);&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="margin:0px;padding:0px;border:none;color:#008200;background-color:inherit;">//&nbsp;取得按表达式的方式订阅的消息后的处理&nbsp;&nbsp;</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">public</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;</span><span class="keyword" style="margin:0px;padding:0px;border:none;color:#006699;background-color:inherit;font-weight:bold;">void</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;onPMessage(String&nbsp;pattern,&nbsp;String&nbsp;channel,&nbsp;String&nbsp;message)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.info(pattern&nbsp;+&nbsp;<span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"="</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;+&nbsp;channel&nbsp;+&nbsp;</span><span class="string" style="margin:0px;padding:0px;border:none;color:blue;background-color:inherit;">"="</span><span style="margin:0px;padding:0px;border:none;background-color:inherit;">&nbsp;+&nbsp;message);&nbsp;&nbsp;</span></span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;&nbsp;&nbsp;...其他未用到的重写方法忽略&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">}&nbsp;&nbsp;</span></li>
</ol>
</div>
作为Jedis自定义订阅，必须继承redis.clients.jedis.JedisPubSub类，在<span style="font-size:18px;">psubscribe模式下，重点重写onPMessage方法，该方法为接收到模板订阅后处理事件的重要代码。pattern为在绑定订阅时使用的通配模板，channel为通配后符合条件的实际通道名称，message就不用多说了，就是事件消息内容。</span><br />
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<h1 style="margin:0px;padding:0px;"><a name="t2" target="_blank" style="color:#0c89cf;"></a><span style="font-size:18px;">3.实战</span></h1>
<div><span style="font-size:18px;">通过Redis自带的redis-cli命令，我们可以在服务端通过命令行的方式直接操作。我们运行上面的示例代码，然后迅速切换到redis-cli命令中，建立一个生命周期很短暂的数据：</span></div>
<div><div class="dp-highlighter bg_plain" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[plain]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:742px;top:4254px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_6" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_6" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=6&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">127.0.0.1:6379&gt;&nbsp;set&nbsp;chaijunkun&nbsp;123&nbsp;PX&nbsp;100&nbsp;&nbsp;</span></span></li>
</ol>
</div>
PX参数指定生命周期单位为毫秒，100即声明周期，即100毫秒。key为chaijunkun的数据，其值为123。</div>
<div><span style="font-size:18px;">当执行语句后，回显：</span></div>
<div><div class="dp-highlighter bg_plain" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[plain]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:742px;top:4411px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_7" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_7" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=7&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">OK&nbsp;&nbsp;</span></span></li>
</ol>
</div>
<br />
这时我们看实例程序的输出：</div>
<div><div class="dp-highlighter bg_plain" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[plain]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:742px;top:4568px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_8" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_8" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=8&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">*=__keyevent@0__:expired=chaijunkun&nbsp;&nbsp;</span></span></li>
</ol>
</div>
从输出可以看出，之前指定的通配符为*，通配任何通道；之后是实际的通道名称：__keyevent@0__:expired，这里我们可以看到订阅收到了一个keyevent位于数据库0，事件类型为：expired，是一个过期事件；最后是chaijunkun，这个是过期数据的key。</div>
<div><span style="font-size:18px;">在官方文档中，keyevent通道的格式永远是这样的：</span></div>
<div><span style="font-size:18px;">__keyevent@&lt;db&gt;__:prefix<br />
</span></div>
<div><span style="font-size:18px;">对于数据过期事件，我们在绑定订阅时通配模板也可以精确地写成：</span></div>
<div><span style="font-size:18px;">__keyevent@*__:expired<br />
</span></div>
<div><span style="font-size:18px;">通过示例代码，我们可以看到确实印证了之前的构想，实现了数据过期的事件触发（event）或者说回调（callback）。</span></div>
<div><span style="font-size:18px;"><br />
</span></div>
<h1 style="margin:0px;padding:0px;"><a name="t3" target="_blank" style="color:#0c89cf;"></a><span style="font-size:18px;">4.其他应用</span></h1>
<div><span style="font-size:18px;">之前的代码中，对于事件的发布都是由Redis自己生成的。实际上在命令中主动发布自定义消息也是可以的，在publish命令的帮助中我们看到：</span></div>
<div><div class="dp-highlighter bg_plain" style="font-family:Consolas, 'Courier New', Courier, mono, serif;font-size:12px;background-color:#e7e5dc;width:924.656px;overflow:hidden;padding-top:1px;position:relative;border-color:#cccccc;margin:18px 0px !important;"><div class="bar" style="padding-left:45px;"><div class="tools" style="padding:3px 8px 10px 10px;font-variant-ligatures:normal;font-variant-east-asian:normal;font-variant-position:normal;font-stretch:normal;font-size:9px;line-height:normal;font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;color:silver;background-color:#f8f8f8;border-left-width:3px;border-left-style:solid;border-left-color:#6ce26c;"><b>[plain]</b>&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="ViewSource" title="view plain" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_plain.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">view plain</a><span data-mod="popu_168">&nbsp;<a href="http://blog.csdn.net/chaijunkun/article/details/27361453#" class="CopyToClipboard" title="copy" target="_blank" style="text-decoration:none;background-image:url(file:///Applications/mNote.app/Contents/Resources/images/default/ico_copy.gif);background-color:inherit;border:none;padding:1px;margin:0px 10px 0px 0px;color:#0c89cf;display:inline-block;width:16px;height:16px;text-indent:-2000px;background-position:left top;background-repeat:no-repeat no-repeat;">copy</a><div style="position:absolute;left:742px;top:5075px;width:18px;height:18px;z-index:99;"><embed id="ZeroClipboardMovie_9" src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_9" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=9&amp;width=18&amp;height=18" wmode="transparent" /></div>
</span></div>
</div>
<ol start="1" style="padding:0px;border:none;list-style-position:initial;list-style-image:initial;background-color:#ffffff;color:#5c5c5c;margin:0px 0px 1px 45px !important;"><li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;"><span style="margin:0px;padding:0px;border:none;background-color:inherit;">127.0.0.1:6379&gt;&nbsp;help&nbsp;publish&nbsp;&nbsp;</span></span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;PUBLISH&nbsp;channel&nbsp;message&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;summary:&nbsp;Post&nbsp;a&nbsp;message&nbsp;to&nbsp;a&nbsp;channel&nbsp;&nbsp;</span></li>
<li class="alt" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;color:inherit;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;since:&nbsp;2.0.0&nbsp;&nbsp;</span></li>
<li class="" style="border-style:none none none solid;border-left-width:3px;border-left-color:#6ce26c;list-style:decimal-leading-zero outside;background-color:#f8f8f8;line-height:18px;margin:0px !important;padding:0px 3px 0px 10px !important;"><span style="margin:0px;padding:0px;border:none;color:black;background-color:inherit;">&nbsp;&nbsp;group:&nbsp;pubsub&nbsp;&nbsp;</span></li>
</ol>
</div>
<div><br />
</div>
</div>
<div><span style="font-size:18px;">通过参数，可以自定义通道名称和通道消息。而在Jedis中，发布API甚至做到了字节数据的级别：</span></div>
<div><span style="font-size:18px;">jedis.publish(byte[] channel, byte[] message)<br />
</span></div>
<div><span style="font-size:18px;">因此我们可以构想，自定一套通讯协议，channel为命令字，message为消息体，我们可以通过redis这种简单的发布/订阅机制实现消息的分发。</span></div>
</div></body></html>