<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-02-14T09:22:21Z"/><meta name="updated" content="2017-02-14T09:22:24Z"/><title>iOS原生地图MKMapView添加半透明遮盖物和轨迹起点、终点等自定义annotation   作者 柠檬跑步 关注2016.09.13 16:33 字数 547 阅读 587评论 10喜欢 8 </title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><h1 class="title" style="box-sizing:border-box;font-size:34px;margin:20px 0px 0px;font-family:-apple-system, 'SF UI Display', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;line-height:1.3;color:#333333;word-break:break-word;font-variant-ligatures:normal;orphans:2;widows:2;">iOS原生地图MKMapView添加半透明遮盖物和轨迹起点、终点等自定义annotation</h1>
<div class="author" style="box-sizing:border-box;margin:30px 0px 40px;color:#333333;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:17px;font-variant-ligatures:normal;orphans:2;widows:2;"><a class="avatar" href="http://www.jianshu.com/u/03cb18a3c411" style="box-sizing:border-box;background-color:transparent;color:#333333;text-decoration:none;cursor:pointer;width:48px;height:48px;display:inline-block;vertical-align:middle;"><img src="http://upload.jianshu.io/users/upload_avatars/2928749/903d200dc8f7.png?imageMogr2/auto-orient/strip|imageView2/1/w/144/h/144" alt="144" style="box-sizing:border-box;border:1px solid #dddddd;vertical-align:middle;width:48px;height:48px;border-radius:50%;" /></a>&nbsp;<div class="info" style="box-sizing:border-box;vertical-align:middle;display:inline-block;margin-left:8px;"><span class="tag" style="box-sizing:border-box;padding:1px 2px;font-size:12px;color:#ea6f5a;border:1px solid #ea6f5a;border-radius:3px;">作者</span>&nbsp;<span class="name" style="box-sizing:border-box;margin-left:3px;margin-right:3px;font-size:16px;vertical-align:middle;"><a href="http://www.jianshu.com/u/03cb18a3c411" style="box-sizing:border-box;background-color:transparent;color:#333333;text-decoration:none;cursor:pointer;">柠檬跑步</a></span>&nbsp;<a class="btn btn-success follow" style="box-sizing:border-box;background-color:#42c02e;color:#ffffff;cursor:pointer;display:inline-block;margin-bottom:0px;text-align:center;vertical-align:middle;background-image:none;border:1px solid #42c02e;white-space:nowrap;padding:0px 7px 0px 5px;font-size:12px;line-height:normal;border-top-left-radius:40px;border-top-right-radius:40px;border-bottom-right-radius:40px;border-bottom-left-radius:40px;"><span style="box-sizing:border-box;margin-left:2px;">关注</span></a><div class="meta" style="box-sizing:border-box;margin-top:5px;font-size:12px;color:#969696;"><span class="publish-time" style="box-sizing:border-box;padding-right:5px;">2016.09.13 16:33</span>&nbsp;<span class="wordage" style="box-sizing:border-box;padding-right:5px;">字数 547</span>&nbsp;<span class="views-count" style="box-sizing:border-box;padding-right:5px;">阅读 587</span><span class="comments-count" style="box-sizing:border-box;padding-right:5px;">评论 10</span><span class="likes-count" style="box-sizing:border-box;padding-right:5px;">喜欢 8</span></div>
</div>
</div>
<div class="show-content" style="box-sizing:border-box;color:#2f2f2f;word-break:break-word;font-size:16px;line-height:1.7;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-variant-ligatures:normal;orphans:2;widows:2;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">先看效果：</p>
<div class="image-package" style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;"><img src="http://upload-images.jianshu.io/upload_images/2928749-b4e32a162b0561c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2928749-b4e32a162b0561c6.png?imageMogr2/auto-orient/strip%7CimageView2/2" style="box-sizing:border-box;border:0px;vertical-align:middle;height:auto;cursor:zoom-in;transition:all 0.25s ease-in-out;-webkit-transition:all 0.25s ease-in-out;" /><br style="box-sizing:border-box;" />
<div class="image-caption" style="box-sizing:border-box;min-width:20%;max-width:80%;min-height:22px;display:inline-block;padding:10px;margin:0px auto;border-bottom:1px solid #d9d9d9;font-size:14px;color:#969696;line-height:1.7;">WechatIMG1.png</div>
</div>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">（一）先说透明遮盖物：因为多数跑步后的轨迹是黄色或者绿色，这与地图上公路的颜色很接近，为了使轨迹更明显，需要在地图上添加一层半透明遮盖物，这里我们直接用MapKit的MKCircle</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:15px;margin-top:0px;margin-bottom:20px;line-height:1.42857;word-break:break-word;word-wrap:normal;color:#657b83;background-color:#f6f6f6;border:1px solid #cccccc;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-position:initial initial;background-repeat:initial initial;"><code class="objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:12px;background-color:transparent;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;padding:0px;border:none;"><span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">strong</span>, <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">nonatomic</span>) <span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">MKCircle</span> *transparentCircle;<span class="hljs-meta" style="box-sizing:border-box;">#pragma mark - 添加半透明覆盖层</span> - (<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">void</span>)addTransparentOverlay{
    <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">self</span>.transparentCircle = [<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">MKCircle</span> circleWithCenterCoordinate:<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">CLLocationCoordinate2DMake</span>(<span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">39.905</span>, <span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">116.398</span>) radius:<span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">100000000</span>];
    [<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">self</span>.mapView addOverlay:<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">self</span>.transparentCircle level:<span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">1</span>];
}</code></pre><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">这里要注意下透明遮盖物和轨迹等id &lt;MKOverlay&gt;的level都要为1，另外这个MKCircle的半径要足够大，咕咚就有个很尴尬的问题,缩小到一定比例尺后，边缘就暴露了(但他们用的应该也不是MKCircle)：<br style="box-sizing:border-box;" />
</p>
<div class="image-package" style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;"><img src="http://upload-images.jianshu.io/upload_images/2928749-f209d750bbc79563.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" data-original-src="http://upload-images.jianshu.io/upload_images/2928749-f209d750bbc79563.png?imageMogr2/auto-orient/strip%7CimageView2/2" style="box-sizing:border-box;border:0px;vertical-align:middle;height:auto;cursor:zoom-in;transition:all 0.25s ease-in-out;-webkit-transition:all 0.25s ease-in-out;" /><br style="box-sizing:border-box;" />
<div class="image-caption" style="box-sizing:border-box;min-width:20%;max-width:80%;min-height:22px;display:inline-block;padding:10px;margin:0px auto;border-bottom:1px solid #d9d9d9;font-size:14px;color:#969696;line-height:1.7;">WechatIMG2.png</div>
</div>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;"><br style="box-sizing:border-box;" />
最后在MKMapViewDelegate中实现相应的渲染器即可：</p>
<pre class="hljs groovy" style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:15px;margin-top:0px;margin-bottom:20px;line-height:1.42857;word-break:break-word;word-wrap:normal;color:#657b83;background-color:#f6f6f6;border:1px solid #cccccc;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-position:initial initial;background-repeat:initial initial;"><code class="groovy" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:12px;background-color:transparent;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;padding:0px;border:none;">- (MKOverlayRenderer *)<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">mapView:</span>(MKMapView *)mapView <span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">rendererForOverlay:</span>(id &lt;MKOverlay&gt;)overlay{
    <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">if</span> ([overlay <span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">isKindOfClass:</span>[MKCircle <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">class</span>]]){</span>         <span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">//半透明蒙层</span>         MKCircleRenderer *circleRenderer = [[MKCircleRenderer alloc] <span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">initWithCircle:</span>overlay];
        circleRenderer.fillColor = [UIColor <span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">colorWithRed:</span><span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">0</span> <span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">green:</span><span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">0</span> <span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">blue:</span><span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">0</span> <span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">alpha:</span><span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">.2</span>];
        <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">return</span> circleRenderer;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">return</span> nil;
}</code></pre><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">（二）再说起点终点：运动轨迹要添加起点终点，这样才会方便用户查看，看这个起点终点就类似于大头针，所以自然想到了&lt;MKAnnotation&gt;协议，我的方法是自定义PointAnnotation。<br style="box-sizing:border-box;" />
PointAnnotation.h实现：</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:15px;margin-top:0px;margin-bottom:20px;line-height:1.42857;word-break:break-word;word-wrap:normal;color:#657b83;background-color:#f6f6f6;border:1px solid #cccccc;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-position:initial initial;background-repeat:initial initial;"><code class="objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:12px;background-color:transparent;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;padding:0px;border:none;"><span class="hljs-meta" style="box-sizing:border-box;">#import <span class="hljs-meta-string" style="box-sizing:border-box;">&lt;Foundation/Foundation.h&gt;</span></span> <span class="hljs-meta" style="box-sizing:border-box;">#import <span class="hljs-meta-string" style="box-sizing:border-box;">&lt;MapKit/MapKit.h&gt;</span></span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#b58900;">PointAnnotation</span> : <span class="hljs-title" style="box-sizing:border-box;color:#b58900;">NSObject</span>&lt;<span class="hljs-title" style="box-sizing:border-box;color:#b58900;">MKAnnotation</span>&gt;</span> <span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">/**
 *  大头针的位置
 */</span> <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">nonatomic</span>, <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">assign</span>) <span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">CLLocationCoordinate2D</span> coordinate;<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">/**
 *  大头针标题
 */</span> <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">nonatomic</span>, <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">copy</span>) <span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">NSString</span> *title;<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">/**
 *  大头针的子标题
 */</span> <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">nonatomic</span>, <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">copy</span>) <span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">NSString</span> *subtitle;<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">@end</span></code></pre><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">PointAnnotation.m什么都没有~</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:15px;margin-top:0px;margin-bottom:20px;line-height:1.42857;word-break:break-word;word-wrap:normal;color:#657b83;background-color:#f6f6f6;border:1px solid #cccccc;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-position:initial initial;background-repeat:initial initial;"><code class="objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:12px;background-color:transparent;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;padding:0px;border:none;"><span class="hljs-meta" style="box-sizing:border-box;">#import <span class="hljs-meta-string" style="box-sizing:border-box;">"PointAnnotation.h"</span></span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">@implementation</span> <span class="hljs-title" style="box-sizing:border-box;color:#b58900;">PointAnnotation</span></span> <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">@end</span></code></pre><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">创建了自定义的大头针之后，就要在mapView上addAnnotation了,这里面需要区分起始点图片（我用title区分），以及相应的坐标，self.runningData.locationArray是我项目中存储轨迹的数据结构，按需替换即可：</p>
<pre class="hljs mipsasm" style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:15px;margin-top:0px;margin-bottom:20px;line-height:1.42857;word-break:break-word;word-wrap:normal;color:#657b83;background-color:#f6f6f6;border:1px solid #cccccc;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-position:initial initial;background-repeat:initial initial;"><code class="mipsasm" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:12px;background-color:transparent;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;padding:0px;border:none;"><span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">#pragma mark - 添加起始点标记</span> - (void)<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">addStartAndEndPoint{</span>     PointAnnotation *pointAnnotation1 = [[PointAnnotation alloc] init]<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     pointAnnotation1.title = @<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">"start"</span><span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     NSDictionary *<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">dic1 </span>= [self.runningData.locationArray firstObject]<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     CLLocationDegrees latitude1  = [<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">dic1[@"latitude"] </span>doubleValue]<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     CLLocationDegrees longitude1 = [<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">dic1[@"longitude"] </span>doubleValue]<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     pointAnnotation1.coordinate = CLLocationCoordinate2DMake(latitude1, longitude1)<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     [self.mapView <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">addAnnotation:pointAnnotation1];</span>     PointAnnotation *pointAnnotation2 = [[PointAnnotation alloc] init]<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     pointAnnotation2.title = @<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">"end"</span><span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     NSDictionary *<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">dic2 </span>= [self.runningData.locationArray lastObject]<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     CLLocationDegrees latitude2  = [<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">dic2[@"latitude"] </span>doubleValue]<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     CLLocationDegrees longitude2 = [<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">dic2[@"longitude"] </span>doubleValue]<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     pointAnnotation2.coordinate = CLLocationCoordinate2DMake(latitude2, longitude2)<span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">;</span>     [self.mapView <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">addAnnotation:pointAnnotation2];</span>}</code></pre><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">添加后会调用MKMapViewDelegate的代理方法(里面除了起点、终点外，还有每公里标记的annotation)：</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:15px;margin-top:0px;margin-bottom:20px;line-height:1.42857;word-break:break-word;word-wrap:normal;color:#657b83;background-color:#f6f6f6;border:1px solid #cccccc;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-position:initial initial;background-repeat:initial initial;"><code class="objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:12px;background-color:transparent;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;padding:0px;border:none;">- (<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">MKAnnotationView</span> *)mapView:(<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">MKMapView</span> *)mapView viewForAnnotation:(<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">id</span>&lt;<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">MKAnnotation</span>&gt;)annotation{

    <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">static</span> <span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">NSString</span> *placemarkIdentifier = <span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">@"PointAnnotation"</span>;
    <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">if</span> ([annotation isKindOfClass:[PointAnnotation <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">class</span>]]){

        <span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">MKAnnotationView</span> *annotationView = [[<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">MKAnnotationView</span> alloc] initWithAnnotation:annotation reuseIdentifier:placemarkIdentifier];
        <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">if</span>([annotation.title isEqualToString:<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">@"start"</span>]){
            <span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">//起点</span>             annotationView.image = [<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">@"StartPoint.png"</span>];
        }<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">else</span> <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">if</span>([annotation.title isEqualToString:<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">@"end"</span>]){
            <span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">//终点</span>             annotationView.image = [<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">@"EndPoint.png"</span>];
        }<span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">else</span> <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">if</span>([annotation.title isEqualToString:<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">@"km"</span>]){
            <span class="hljs-comment" style="box-sizing:border-box;color:#93a1a1;">//公里</span>             annotationView.image = [<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">@"KmBG.png"</span>];
            <span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">UILabel</span> *kmLabel = [[<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">UILabel</span> alloc] initWithFrame:<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">CGRectMake</span>(<span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">2</span>, <span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">1</span>, annotationView.width<span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">-4</span>, annotationView.height<span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">-2</span>)];
            kmLabel.text = annotation.subtitle;
            kmLabel.textAlignment = <span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">NSTextAlignmentCenter</span>;
            kmLabel.textColor = [<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">UIColor</span> blackColor];
            kmLabel.font = [<span class="hljs-built_in" style="box-sizing:border-box;color:#268bd2;">UIFont</span> fontWithName:<span class="hljs-string" style="box-sizing:border-box;color:#2aa198;">@"Helvetica-Bold"</span> size:<span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">12</span>];
            kmLabel.numberOfLines = <span class="hljs-number" style="box-sizing:border-box;color:#2aa198;">0</span>;
            kmLabel.adjustsFontSizeToFitWidth = <span class="hljs-literal" style="box-sizing:border-box;">YES</span>;
            [annotationView addSubview:kmLabel];
        }
        <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">return</span> annotationView;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;color:#859900;">return</span> <span class="hljs-literal" style="box-sizing:border-box;">nil</span>;

}</code></pre><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">到此，iphone自带地图上添加半透明遮盖物和自定义annotation的工作就完事了，另外需要说一点就是：我在构造MKAnnotationView的时候没有使用类似UITableView构造Cell的复用机制（暂时没问题，但是annotation很多的时候也许会影响性能），原因是复用后在移动地图时annotationView的顺序会错乱，暂时没找到原因，谁有解决办法请留言说明，谢谢~</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;">最后，附上我项目的下载地址，如果有帮到你，求好评，谢谢！；如果有其他问题，也欢迎一起讨论<br style="box-sizing:border-box;" />
<a href="https://itunes.apple.com/cn/app/ning-meng-pao-bu/id1108388147?mt=8" target="_blank" style="box-sizing:border-box;background-color:transparent;color:#3194d0;text-decoration:none;cursor:pointer;">https://itunes.apple.com/cn/app/ning-meng-pao-bu/id1108388147?mt=8</a></p>
<div><br />
</div>
</div></body></html>