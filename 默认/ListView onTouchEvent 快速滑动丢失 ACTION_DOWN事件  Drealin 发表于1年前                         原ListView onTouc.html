<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2016-11-17T06:25:38Z"/><meta name="updated" content="2016-11-17T06:25:39Z"/><title>ListView onTouchEvent 快速滑动丢失 ACTION_DOWN事件  Drealin 发表于1年前                         原ListView onTouc</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="float-heading block" style="box-sizing:inherit;position:fixed;top:40px;left:0px;width:1233px;padding:8px 0px 12px;box-shadow:rgba(0, 0, 0, 0.0980392) 0px 1px 3px;z-index:99;opacity:1;transition:all 0.2s;-webkit-transition:all 0.2s;background-position:initial initial;background-repeat:initial initial;"><div class="blog-wrapper" style="box-sizing:inherit;width:800px;position:relative;margin:auto;"><div class="layout-flex" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;display:flex;-webkit-box-align:center;align-items:center;"><div class="flex-grow" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;-webkit-box-flex:1;flex-grow:1;"><div class="heading" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;font-size:20px;line-height:2;max-width:550px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">ListView onTouchEvent 快速滑动丢失 ACTION_DOWN事件</div>
<div class="data-info" style="box-sizing:inherit;padding:0px;color:#666666;"><a href="https://my.oschina.net/zhibuji/home" class="link-blue" target="_blank" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;border:none;outline:0px;transition:color 0.3s;text-decoration:none;color:#4466bb;">Drealin</a>&nbsp;发表于1年前</div>
</div>
<div class="" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><div class="opr-btn" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><div class="opr-btn-blog btn-reward-blog " style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;position:relative;display:inline-block;margin-left:30px;"><a data-popupbox-model="reward" style="box-sizing:inherit;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;border:none;outline:0px;transition:color 0.3s;-webkit-transition:color 0.3s;color:#333333;"></a></div>
&nbsp;<div class="opr-btn-blog btn-like-blog " style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;position:relative;display:inline-block;margin-left:30px;"><a class="" style="box-sizing:inherit;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;border:none;outline:0px;transition:color 0.3s;-webkit-transition:color 0.3s;color:#333333;"></a></div>
&nbsp;<div class="opr-btn-blog btn-favor-blog hover" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;position:relative;display:inline-block;margin-left:30px;"><a class=" " data-blogid="525488" data-blogtype="3" data-userid="" data-thispage="https://my.oschina.net/zhibuji/blog/525488" style="box-sizing:inherit;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;border:none;outline:0px;transition:color 0.3s;-webkit-transition:color 0.3s;color:#333333;"></a></div>
&nbsp;<div class="opr-btn-blog btn-share-blog hover" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;position:relative;display:inline-block;margin-left:30px;"><a class="" style="box-sizing:inherit;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;border:none;outline:0px;transition:color 0.3s;-webkit-transition:color 0.3s;color:#333333;"></a></div>
</div>
</div>
</div>
</div>
</div>
<div class="blog-content" style="box-sizing:inherit;width:800px;position:relative;margin:auto;"><div class="blog-heading" style="box-sizing:inherit;"><div class="title" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;font-size:28px;word-break:break-all;"><span class="status-tag original" title="原创博客" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;display:inline-block;margin-right:5px;border:2px solid #51bae3;border-radius:50%;width:29px;height:29px;vertical-align:middle;text-align:center;font-size:16px;line-height:26px;float:left;color:#51bae3;margin-bottom:4px;">原</span>ListView onTouchEvent 快速滑动丢失 ACTION_DOWN事件</div>
<div class="info-opr layout" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;width:800px;font-size:16px;color:#666666;margin-top:8px;padding-bottom:20px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#cccccc;"><div class="layout-right" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;float:right;"><div class="opr-btn-blog btn-favor-blog favor hover" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;position:relative;"><a class="btn btn-black-blog " data-blogid="525488" data-blogtype="3" data-userid="" data-thispage="https://my.oschina.net/zhibuji/blog/525488" style="box-sizing:inherit;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;border:1px solid #5b5c5f;outline:0px;transition:color 0.3s;-webkit-transition:color 0.3s;color:#5b5c5f;display:inline-block;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;padding:0.4rem 0.8rem;margin:0px;font-size:1.4rem;cursor:pointer;width:88px;text-align:center;background-position:initial initial;background-repeat:initial initial;">&nbsp;<span id="" class="operate_title" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">收藏</span></a></div>
</div>
<div class="layout-column" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;width:1200px;display:table-cell;"><div class="user-info" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;display:inline-block;"><div class="name" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#000000;display:inline-block;margin:10px 3px;"><a href="https://my.oschina.net/zhibuji/home" target="_blank" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;border:none;outline:0px;transition:color 0.3s;text-decoration:none;color:#4466bb;">Drealin</a></div>
</div>
&nbsp;<div class="data-info text-gary" style="box-sizing:inherit;padding:10px 0px;display:inline-block;"><ul style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;list-style-type:none;margin:0px;padding:0px;"><li class="time" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;margin:0px 8px;padding:0px;display:inline-block;">发表于&nbsp;<span id="" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">1年前</span></li>
&nbsp;<li class="read" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;margin:0px 8px;padding:0px;display:inline-block;">阅读&nbsp;<span id="read" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">1253</span></li>
&nbsp;<li class="favor" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;margin:0px 8px;padding:0px;display:inline-block;">收藏&nbsp;<span id="" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">5</span></li>
&nbsp;<li class="vote" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;margin:0px 8px;padding:0px;display:inline-block;">点赞&nbsp;<span id="" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">0</span></li>
&nbsp;<li class="comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;margin:0px 8px;padding:0px;display:inline-block;"><a href="https://my.oschina.net/zhibuji/blog/525488#comment-list" data-href="#comment-list" class="link-blue" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;border:none;outline:0px;transition:color 0.3s;text-decoration:none;color:#4466bb;">评论&nbsp;<span id="comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">0</span></a></li>
</ul>
</div>
</div>
</div>
</div>
<div class="blog-abstract" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;margin:23px 0px 45px;line-height:28px;word-break:break-all;color:#666666;font-size:18px;font-style:italic;font-family:Baskerville, Georgia, 'Liberation Serif', 'Kaiti SC', STKaiti, 'AR PL UKai CN', 'AR PL UKai HK', 'AR PL UKai TW', 'AR PL UKai TW MBE', 'AR PL KaitiM GB', KaiTi, KaiTi_GB2312, TW-Kai, serif;">摘要: 自定义ListView</div>
<div class="blog-body" id="blogBody" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;word-wrap:break-word;font-size:1.6rem;font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;color:#3d464d;line-height:28px;margin-top:30px;position:relative;"><val data-name="blog_content_type" data-value="richtext" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"></val><div class="BlogContent" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">最近在工作中，遇到需要自定义Listview Item的左右滑动效果，ListView Item本身有点击事件，滑动过程中item需要显示不同于其他的背景颜色，滑开之后，背景颜色保持并且又有item内的点击事件这样：</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;"><img src="http://static.oschina.net/uploads/space/2015/1104/102633_7izO_591636.png" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;border:none;margin:auto;max-width:80%;height:auto;" /></p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">说明这个问题呢，需要先说明一下这个效果的实现逻辑：</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">1、根据<span style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;line-height:22.5px;">ACTION_DOWN事件的</span>按下位置，获取ListView被按下位置的item，并设置按下背景颜色</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">2、根据<span style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;line-height:22.5px;">ACTION_MOVE时间判断滑动距离，</span>如果滑动达到左右滑动阈值，那么根据左右滑动距离，将View进行左右位置偏移，如果未达到阈值则不处理该事件。</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">3、用户可点击整个item，触发跳转事件</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">4、View位置移动后，用户点击Delete按钮，删除该条item</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">5、如果View已经被用户移开，那么如果再次触发<span style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;line-height:22.5px;">ACTION_DOWN，被移开的View自动恢复到原来位置。</span></p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">主要逻辑如上，效果实现不难，重写ListView的onTouch事件就好了啊，但是在自测过程中，发现一个大问题，就是在快速滑动ListView的时候，onTouch方法有事会丢失ACTION_DOWN事件。但是后面的Move事件和up事件从来没有丢失过。如果都丢失还好，但是MOVE和UP没有丢失，就导致关键判断丢失，又加上ListView item的复用机制，导致整个ListView状态出错，搞地整个人都不好了。</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">以为是我自己写的方法哪里返回值有错，就将所有自己的写的东西注释掉，然后在onTouchEvent里面打印DOWN的状态，发现就是没有我代码，DOWN事件一样在快速滑动的时候接收不到。不是自己代码的问题就好。然后Google了好几下，发现问这个问题的不少，但是能解决我的问题方案没有。就在我以为这是一个不可解决的问题的时候，我惊恐的发现，QQ的item就不存在这个问题，每次划开，再快的速度滑动，都可以正常关闭，我擦擦，不能输啊。</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">于是开始看源码，细节就不多说，结论如下：</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">该DOWN事件在ListView 的dispatchTouchEvent的时候是可以接收到的，但是在onTouchEvent方法里面就接收不到了。所以我们就去看看ListView的dispatchTouchEvent方法，ListView的dispatchTouchEvent是在ViewGroup里面，只看经过我分析关键的部分：</p>
<pre class="brush:java;toolbar: true; auto-links: false; hljs" style="box-sizing:inherit;overflow-x:auto;padding:2px;color:#dcdcdc;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;line-height:1.4;word-wrap:normal;font-size:13px;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;background-color:#3f3f3f;background-position:initial initial;background-repeat:initial initial;"><code class="hljs java" style="box-sizing:inherit;display:block;overflow-x:auto;padding:10px;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;line-height:1.4;word-wrap:normal;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;background-position:initial initial;background-repeat:initial initial;"><span class="hljs-meta" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">@Override</span> &nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;"><span class="hljs-function" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><span class="hljs-keyword" style="box-sizing:inherit;">public</span></span></span><span class="hljs-function" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">&nbsp;</span><span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;"><span class="hljs-function" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><span class="hljs-keyword" style="box-sizing:inherit;">boolean</span></span></span><span class="hljs-function" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">&nbsp;</span><span class="hljs-title" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#efef8f;"><span class="hljs-function" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><span class="hljs-title" style="box-sizing:inherit;">dispatchTouchEvent</span></span></span><span class="hljs-params" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><span class="hljs-function" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;"><span class="hljs-params" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">(MotionEvent&nbsp;ev)</span></span></span><span class="hljs-function" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;">&nbsp;</span></span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">if</span>&nbsp;(mInputEventConsistencyVerifier&nbsp;!=&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">null</span>)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mInputEventConsistencyVerifier.onTouchEvent(ev,&nbsp;<span class="hljs-number" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#8cd0d3;">1</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">boolean</span>&nbsp;handled&nbsp;=&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">if</span>&nbsp;(onFilterTouchEventForSecurity(ev))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">final</span>&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">int</span>&nbsp;action&nbsp;=&nbsp;ev.getAction();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">final</span>&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">int</span>&nbsp;actionMasked&nbsp;=&nbsp;action&nbsp;&amp;&nbsp;MotionEvent.ACTION_MASK;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;Handle&nbsp;an&nbsp;initial&nbsp;down.</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">if</span>&nbsp;(actionMasked&nbsp;==&nbsp;MotionEvent.ACTION_DOWN)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;Throw&nbsp;away&nbsp;all&nbsp;previous&nbsp;state&nbsp;when&nbsp;starting&nbsp;a&nbsp;new&nbsp;touch&nbsp;gesture.</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;The&nbsp;framework&nbsp;may&nbsp;have&nbsp;dropped&nbsp;the&nbsp;up&nbsp;or&nbsp;cancel&nbsp;event&nbsp;for&nbsp;the&nbsp;previous&nbsp;gesture</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;due&nbsp;to&nbsp;an&nbsp;app&nbsp;switch,&nbsp;ANR,&nbsp;or&nbsp;some&nbsp;other&nbsp;state&nbsp;change.</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cancelAndClearTouchTargets(ev);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resetTouchState();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;Check&nbsp;for&nbsp;interception.</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">final</span>&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">boolean</span>&nbsp;intercepted;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">if</span>&nbsp;(actionMasked&nbsp;==&nbsp;MotionEvent.ACTION_DOWN
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;mFirstTouchTarget&nbsp;!=&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">null</span>)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">final</span>&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">boolean</span>&nbsp;disallowIntercept&nbsp;=&nbsp;(mGroupFlags&nbsp;&amp;&nbsp;FLAG_DISALLOW_INTERCEPT)&nbsp;!=&nbsp;<span class="hljs-number" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#8cd0d3;">0</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">if</span>&nbsp;(!disallowIntercept)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intercepted&nbsp;=&nbsp;onInterceptTouchEvent(ev);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev.setAction(action);&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;restore&nbsp;action&nbsp;in&nbsp;case&nbsp;it&nbsp;was&nbsp;changed</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">else</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intercepted&nbsp;=&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">else</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;There&nbsp;are&nbsp;no&nbsp;touch&nbsp;targets&nbsp;and&nbsp;this&nbsp;action&nbsp;is&nbsp;not&nbsp;an&nbsp;initial&nbsp;down</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;so&nbsp;this&nbsp;view&nbsp;group&nbsp;continues&nbsp;to&nbsp;intercept&nbsp;touches.</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intercepted&nbsp;=&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">true</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
&nbsp;&nbsp;&nbsp;&nbsp;}</code></pre><pre class="brush:java;toolbar: true; auto-links: false; hljs" style="box-sizing:inherit;overflow-x:auto;padding:2px;color:#dcdcdc;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;line-height:1.4;word-wrap:normal;font-size:13px;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;background-color:#3f3f3f;background-position:initial initial;background-repeat:initial initial;"><code class="hljs java" style="box-sizing:inherit;display:block;overflow-x:auto;padding:10px;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;line-height:1.4;word-wrap:normal;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;background-position:initial initial;background-repeat:initial initial;"><span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">if</span>&nbsp;(actionMasked&nbsp;==&nbsp;MotionEvent.ACTION_DOWN
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;mFirstTouchTarget&nbsp;!=&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">null</span>)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">final</span>&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">boolean</span>&nbsp;disallowIntercept&nbsp;=&nbsp;(mGroupFlags&nbsp;&amp;&nbsp;FLAG_DISALLOW_INTERCEPT)&nbsp;!=&nbsp;<span class="hljs-number" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#8cd0d3;">0</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">if</span>&nbsp;(!disallowIntercept)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intercepted&nbsp;=&nbsp;onInterceptTouchEvent(ev);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev.setAction(action);&nbsp;<span class="hljs-comment" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#7f9f7f;">//&nbsp;restore&nbsp;action&nbsp;in&nbsp;case&nbsp;it&nbsp;was&nbsp;changed</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">else</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intercepted&nbsp;=&nbsp;<span class="hljs-keyword" style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;color:#e3ceab;">false</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</code></pre><p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">关键就在这里，我们可以看到有一句：// restore action in case it was changed，因为快速滑动，当DOWN事件传递到onInterceptTouchEvent方法去判断是不是该拦截的时候，MOVE事件来了，然后被restore了。</p>
<p style="box-sizing:inherit;margin-bottom:16px;font-size:16px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:28px;widows:1;background-color:#f8f8f8;">于是在onInterceptTouchEvent方法里面打印了一下是否有丢失DOWN事件，发现是：木有丢失！！！好哒，问题就在这里了。了解问题在这里，这个问题就容易解决了<span style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;font-size:14px;color:#c00000;">。重写onInterceptTouchEvent,判断DOWN事件的位置是不是需要拦截，返回正确的TRUE or FALSE值就OK了喽。</span></p>
<div><span style="box-sizing:inherit;-webkit-tap-highlight-color:transparent;font-size:14px;color:#c00000;"><br />
</span></div>
</div>
</div>
</div></body></html>