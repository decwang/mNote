<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-06-20T02:37:09Z"/><meta name="updated" content="2017-06-20T02:37:25Z"/><title>MapReduce理解</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><p style="font-variant-ligatures:normal;orphans:2;widows:2;margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;line-height:1.6em;color:#444444;">前面的几篇博客主要介绍了<a target="_blank" href="http://blog.xiaoxiaomo.com/tags/Hadoop/" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">Hadoop</a>的存储<a target="_blank" href="http://blog.xiaoxiaomo.com/2016/04/11/Hadoop-HDFS%E6%9E%B6%E6%9E%84%E5%92%8CShell/" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">HDFS</a>，接下来几篇博客主要介绍<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">Hadoop的计算框架MapReduce</span>。本片博客主要讲解MapReduce框架的具体执行流程，以及shuffle过程，当然这方面的技术博客已经特别多而且都写得很优秀，我写本篇博客之前也有过相关阅读，受益匪浅。对一些博客和资料的参考都会才博客下方参考资料中列出。</p>
<h1 id="MapReduce理解" style="margin:1.1em 0px;padding:0px;font-variant-ligatures:normal;orphans:2;widows:2;border:0px;outline:0px;font-family:'Droid Serif', Georgia, serif;vertical-align:baseline;color:#444444;line-height:1.1em;"><a name="t0" target="_blank" style="color:#336699;"></a><a target="_blank" href="http://blog.xiaoxiaomo.com/2016/07/03/Hadoop-MapReduce%E8%AF%A6%E8%A7%A3/#MapReduce理解" class="headerlink" title="MapReduce理解" style="color:#444444;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;"></a>MapReduce理解</h1>
<ul style="list-style:none;font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">MapRedeuce</span>，我们可以把它分开来理解：</li>
</ul>
<ol style="font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;list-style-position:initial;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">映射（Mapping）</span>&nbsp;：<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">对集合里的每个目标应用同一个操作</span>。即，<span style="margin:0px;padding:0px;border:0px;outline:0px;font-family:inherit;vertical-align:baseline;">如果你想把表单里每个单元格乘以二，那么把这个函数单独地应用在每个单元格上的操作就属于mapping</span>（这里体现了<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">移动计算</span>而不是移动数据）；</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">化简（Reducing）</span>：<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">遍历集合中的元素来返回一个综合的结果</span>。即，输出表单里一列数字的和这个任务属于reducing。</li>
</ol>
<a target="_blank" id="more" style="color:#258fb8;font-variant-ligatures:normal;orphans:2;widows:2;margin:0px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;"></a><ul style="list-style:none;font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">计算框架</span><br />
<a target="_blank" href="http://img.xiaoxiaomo.com/blog%2Fimg%2F20160412199999.png" title="一个简单的MapReduce执行流程" class="fancybox" rel="article0" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><img src="http://img.xiaoxiaomo.com/blog%2Fimg%2F20160412199999.png" alt="一个简单的MapReduce执行流程" style="border:none;margin:0px;padding:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:auto;display:block;" /></a><span class="caption" style="margin:0.5em 0px 0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:0.9em;vertical-align:baseline;color:#999999;display:block;position:relative;text-align:center;">一个简单的MapReduce执行流程</span><br />
简单理解，<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">MapReduce计算框架</span>：</p>
<blockquote style="margin:1.6em 0px;padding:0px 0.8em;border-width:0px 0px 0px 4px;border-left-style:solid;border-left-color:#dddddd;outline:0px;font-style:inherit;font-family:'Droid Serif', Georgia, serif;vertical-align:baseline;color:#777777;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">把需要计算的东西放入到MapReduce中进行计算，然后返回一个我们期望的结果</span>。所以<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">首先</span>我们需要一个来源（需要计算的东西）即输入（input），<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">然后</span>MapReduce操作这个输入（input），通过定义好的计算模型，<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">最后</span>得到一个（期望的结果）输出（output）。</p>
</blockquote>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">计算模型</span><br />
<a target="_blank" href="http://img.xiaoxiaomo.com/blog%2Fimg%2F20160703142402.png" title="Map和Reduce" class="fancybox" rel="article0" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><img src="http://img.xiaoxiaomo.com/blog%2Fimg%2F20160703142402.png" alt="Map和Reduce" style="border:none;margin:0px;padding:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:auto;display:block;" /></a><span class="caption" style="margin:0.5em 0px 0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:0.9em;vertical-align:baseline;color:#999999;display:block;position:relative;text-align:center;">Map和Reduce</span><br />
在这里我们主要讨论的是<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">MapReduce计算模型</span>：</p>
<blockquote style="margin:1.6em 0px;padding:0px 0.8em;border-width:0px 0px 0px 4px;border-left-style:solid;border-left-color:#dddddd;outline:0px;font-style:inherit;font-family:'Droid Serif', Georgia, serif;vertical-align:baseline;color:#777777;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;">在运行一个mapreduce计算任务时候，任务过程被分为两个阶段：map阶段和reduce阶段，每个阶段都是用键值对（key/value）作为输入（input）和输出（output）。而程序员要做的就是定义好这两个阶段的函数：map函数和reduce函数。</p>
</blockquote>
</li>
</ul>
<h1 id="实例代码" style="margin:1.1em 0px;padding:0px;font-variant-ligatures:normal;orphans:2;widows:2;border:0px;outline:0px;font-family:'Droid Serif', Georgia, serif;vertical-align:baseline;color:#444444;line-height:1.1em;"><a name="t1" target="_blank" style="color:#336699;"></a><a target="_blank" href="http://blog.xiaoxiaomo.com/2016/07/03/Hadoop-MapReduce%E8%AF%A6%E8%A7%A3/#实例代码" class="headerlink" title="实例代码" style="color:#444444;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;"></a>实例代码</h1>
<ul style="list-style:none;font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">以MapReduce统计单词次数为例（伪代码），主要<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">四个模块</span>来讲解，如上图计算框架：</li>
</ul>
<ol style="font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;list-style-position:initial;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">Input，数据读入</span></p>
<table style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;border-spacing:0px;line-height:1.6em;width:auto;"><tbody style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><tr style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><td class="gutter" style="margin:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;"><pre style="white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;padding:0px 20px 0px 0px;border:none;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;font-size:0.85em;vertical-align:baseline;overflow:auto;color:#666666;line-height:22.4px;text-align:right;"><span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">1</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">2</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">3</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">4</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">5</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">6</span> </pre></td>
<td class="code" style="margin:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;"><pre style="white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;vertical-align:baseline;overflow:auto;color:#272822;line-height:22.4px;"><span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">// 设置数据输入来源</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">FileInputFormat.setInputPaths(job, args[<span class="number" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ae81ff;">0</span>]);</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">FileInputFormat.setInputDirRecursive(job, <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">true</span>); <span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//递归</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">job.setInputFormatClass(TextInputFormat.class);	<span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//设置输入格式</span></span>  <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//TextInputFormat，一种默认的文本输入格式，Mapper一次读取文本中的一行数据。</span></span> </pre></td>
</tr>
</tbody>
</table>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">使用Mapper计算</span></p>
<table style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;border-spacing:0px;line-height:1.6em;width:auto;"><tbody style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><tr style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><td class="gutter" style="margin:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;"><pre style="white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;padding:0px 20px 0px 0px;border:none;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;font-size:0.85em;vertical-align:baseline;overflow:auto;color:#666666;line-height:22.4px;text-align:right;"><span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">1</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">2</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">3</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">4</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">5</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">6</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">7</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">8</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">9</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">10</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">11</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">12</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">13</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">14</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">15</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">16</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">17</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">18</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">19</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">20</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">21</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">22</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">23</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">24</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">25</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">26</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">27</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">28</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">29</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">30</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">31</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">32</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">33</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">34</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">35</span> </pre></td>
<td class="code" style="margin:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;"><pre style="white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;vertical-align:baseline;overflow:auto;color:#272822;line-height:22.4px;"><span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//设置Job的Mapper计算类和K2、V2类型</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">job.setMapperClass(WordCountMapper.class);	<span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//1.设置Mapper类</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">job.setMapOutputKeyClass(Text.class);	<span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//设置Mapper输出Key的类型</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">job.setMapOutputValueClass(LongWritable.class);<span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//设置Mapper输出Value的类型</span></span>  <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//WordCountMapper类</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">/**</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * 自定义的Map 需要继承Mapper</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * K1 : 行序号</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * V1 : 行信息</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * K2 : 单词</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * V2 : 次数</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> */</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">public</span> <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">static</span> <span class="class" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#a6e22e;"><span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">class</span> <span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">WordCountMapper</span> <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">extends</span> <span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">Mapper</span>&lt;<span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">LongWritable</span>,<span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">Text</span>,<span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">Text</span>,<span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">LongWritable</span>&gt; </span>{</span>  <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    Text k2 = <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">new</span> Text() ;</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    LongWritable v2 = <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">new</span> LongWritable();</span>  <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    <span class="meta" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">@Override</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    <span class="function" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;"><span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">protected</span> <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">void</span> <span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">map</span><span class="params" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#fd971f;">(LongWritable key, Text value, Context context)</span> </span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">            <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">throws</span> IOException, InterruptedException </span>{</span>  <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        <span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//1. 获取行信息</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        String line = value.toString();</span>  <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        <span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//2. 获取行的所用单词</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        String[] words = line.split(<span class="string" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#e6db74;">"\t"</span>);<span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//这里假设一行文本单词分隔符为"\t"</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">for</span> (String word : words) {</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">            k2.set(word.getBytes()) ; <span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//设置键</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">            v2.set(<span class="number" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ae81ff;">1</span>);                <span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//设置值</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">            context.write(k2,v2);</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        }</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        </span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    }</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">}</span> </pre></td>
</tr>
</tbody>
</table>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">使用Reducer合并计算</span></p>
<table style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;border-spacing:0px;line-height:1.6em;width:auto;"><tbody style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><tr style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><td class="gutter" style="margin:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;"><pre style="white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;padding:0px 20px 0px 0px;border:none;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;font-size:0.85em;vertical-align:baseline;overflow:auto;color:#666666;line-height:22.4px;text-align:right;"><span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">1</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">2</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">3</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">4</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">5</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">6</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">7</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">8</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">9</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">10</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">11</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">12</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">13</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">14</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">15</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">16</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">17</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">18</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">19</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">20</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">21</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">22</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">23</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">24</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">25</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">26</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">27</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">28</span> </pre></td>
<td class="code" style="margin:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;"><pre style="white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;vertical-align:baseline;overflow:auto;color:#272822;line-height:22.4px;"><span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//设置Job的Reducer计算类和K3、V3类型</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">job.setReducerClass(WordCountReducer.class);	<span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//自定义的Reducer类</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">job.setOutputKeyClass(Text.class);		<span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//输出Key类型</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">job.setOutputValueClass(LongWritable.class);	<span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//输出Value类型</span></span>  <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">//WordCountReducer 类</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="comment" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#75715e;">/**</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * 自定义的Reduce 需要继承Reducer</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * K2 : 字符串</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * V3 : 次数（分组）</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * K3 : 字符串</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> * V3 : 次数（统计总的）</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"> */</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;"><span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">public</span> <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">static</span> <span class="class" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#a6e22e;"><span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">class</span> <span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">WordCountReducer</span> <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">extends</span> <span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">Reducer</span>&lt;<span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">Text</span>,<span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">LongWritable</span>,<span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">Text</span>,<span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">LongWritable</span>&gt;</span>{</span>  <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    LongWritable v3 = <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">new</span> LongWritable() ;</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">int</span> sum  = <span class="number" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ae81ff;">0</span> ;</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    <span class="meta" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">@Override</span></span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    <span class="function" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;"><span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">protected</span> <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">void</span> <span class="title" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#f92672;">reduce</span><span class="params" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#fd971f;">(Text key, Iterable&lt;LongWritable&gt; values, Context context)</span> </span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">            <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">throws</span> IOException, InterruptedException </span>{</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        sum = <span class="number" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ae81ff;">0</span> ;</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">for</span> (LongWritable value : values) {</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">            sum +=value.get() ;</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        }</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        v3.set(sum);</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">        context.write( key , v3 );</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">    }</span> <span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">}</span> </pre></td>
</tr>
</tbody>
</table>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">Output，数据写出</span></p>
<table style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;border-spacing:0px;line-height:1.6em;width:auto;"><tbody style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><tr style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><td class="gutter" style="margin:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;"><pre style="white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;padding:0px 20px 0px 0px;border:none;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;font-size:0.85em;vertical-align:baseline;overflow:auto;color:#666666;line-height:22.4px;text-align:right;"><span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">1</span> </pre></td>
<td class="code" style="margin:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:inherit;font-size:14px;vertical-align:middle;"><pre style="white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;padding:0px;border:none;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;vertical-align:baseline;overflow:auto;color:#272822;line-height:22.4px;"><span class="line" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:22.4px;">FileOutputFormat.setOutputPath(job, <span class="keyword" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#66d9ef;">new</span> Path(args[<span class="number" style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;color:#ae81ff;">1</span>]));</span> </pre></td>
</tr>
</tbody>
</table>
</li>
</ol>
<h1 id="运行机制" style="margin:1.1em 0px;padding:0px;font-variant-ligatures:normal;orphans:2;widows:2;border:0px;outline:0px;font-family:'Droid Serif', Georgia, serif;vertical-align:baseline;color:#444444;line-height:1.1em;"><a name="t2" target="_blank" style="color:#336699;"></a><a target="_blank" href="http://blog.xiaoxiaomo.com/2016/07/03/Hadoop-MapReduce%E8%AF%A6%E8%A7%A3/#运行机制" class="headerlink" title="运行机制" style="color:#444444;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;"></a>运行机制</h1>
<ul style="list-style:none;font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">下面从<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">两个角度</span>来讲解MapReduce的运行机制：</li>
</ul>
<ol style="font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;list-style-position:initial;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">各个角色实体</span>;</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">运行的时间先后顺序</span>。<br />
<a target="_blank" href="http://img.xiaoxiaomo.com/blog%2Fimg%2F20160419199999.jpg" title="MapReduce计算模型的运行机制" class="fancybox" rel="article0" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><img src="http://img.xiaoxiaomo.com/blog%2Fimg%2F20160419199999.jpg" alt="MapReduce计算模型的运行机制" style="border:none;margin:0px;padding:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;height:auto;display:block;" /></a><span class="caption" style="margin:0.5em 0px 0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:0.9em;vertical-align:baseline;color:#999999;display:block;position:relative;text-align:center;">MapReduce计算模型的运行机制</span></li>
</ol>
<h2 id="各个角色实体" style="margin:1.1em 0px;padding:0px;font-variant-ligatures:normal;orphans:2;widows:2;border:0px;outline:0px;font-family:'Droid Serif', Georgia, serif;vertical-align:baseline;color:#444444;line-height:1.1em;"><a name="t3" target="_blank" style="color:#336699;"></a><a target="_blank" href="http://blog.xiaoxiaomo.com/2016/07/03/Hadoop-MapReduce%E8%AF%A6%E8%A7%A3/#各个角色实体" class="headerlink" title="各个角色实体" style="color:#444444;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;"></a>各个角色实体</h2>
<ol style="font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;list-style-position:initial;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">程序运行时过程设计到的一个角色实体</span><br />
1.1.&nbsp;<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">Client</span>：编写mapreduce程序，配置作业，提交作业的客户端 ；<br />
1.2.&nbsp;<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">ResourceManager</span>：集群中的资源分配管理 ；<br />
1.3.&nbsp;<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">NodeManager</span>：启动和监管各自节点上的计算资源 ；<br />
1.4.&nbsp;<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">ApplicationMaster</span>：每个程序对应一个AM，负责程序的任务调度，本身也是运行在NM的Container中 ；<br />
1.5.&nbsp;<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">HDFS</span>：分布式文件系统，保存作业的数据、配置信息等等。</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">客户端提交Job</span><br />
2.1. 客户端编写好Job后，调用Job实例的Submit()或者waitForCompletion()方法提交作业；<br />
2.2. 客户端向ResourceManager请求分配一个Application ID，客户端会对程序的输出、输入路径进行检查，如果没有问题，进行作业输入分片的计算。</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">Job提交到ResourceManager</span><br />
3.1. 将作业运行所需要的资源拷贝到HDFS中（jar包、配置文件和计算出来的输入分片信息等）；<br />
3.2. 调用ResourceManager的submitApplication方法将作业提交到ResourceManager。</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">给作业分配ApplicationMaster</span><br />
4.1. ResourceManager收到submitApplication方法的调用之后会命令一个NodeManager启动一个Container ；<br />
4.2. 在该NodeManager的Container上启动管理该作业的ApplicationMaster进程。</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">ApplicationMaster初始化作业</span><br />
5.1. ApplicationMaster对作业进行初始化操作；<br />
5.2. ApplicationMaster从HDFS中获得输入分片信息(map、reduce任务数)</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">任务分配</span><br />
6.1. ApplicationMaster为其每个map和reduce任务向RM请求计算资源；<br />
6.2. map任务优先于reduce任，map数据优先考虑本地化的数据。</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">任务执行</span>，在 Container 上启动任务（通过YarnChild进程来运行），执行map/reduce任务。</p>
</li>
</ol>
<h2 id="时间先后顺序" style="margin:1.1em 0px;padding:0px;font-variant-ligatures:normal;orphans:2;widows:2;border:0px;outline:0px;font-family:'Droid Serif', Georgia, serif;vertical-align:baseline;color:#444444;line-height:1.1em;"><a name="t4" target="_blank" style="color:#336699;"></a><a target="_blank" href="http://blog.xiaoxiaomo.com/2016/07/03/Hadoop-MapReduce%E8%AF%A6%E8%A7%A3/#时间先后顺序" class="headerlink" title="时间先后顺序" style="color:#444444;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;"></a>时间先后顺序</h2>
<ol style="font-variant-ligatures:normal;orphans:2;widows:2;margin:1.6em 20px;padding:0px;border:0px;outline:0px;font-family:'Microsoft Yahei', 'Helvetica Neue', Helvetica, Arial, sans-serif;vertical-align:baseline;list-style-position:initial;line-height:1.6em;color:#444444;"><li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">输入分片（input split）</span><br />
每个输入分片会让一个map任务来处理，默认情况下，以HDFS的一个块的大小（默认为128M，可以设置）为一个分片。map输出的结果会暂且放在一个环形内存缓冲区中（<code style="margin:0px;padding:0px 0.4em;border:0px;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;font-size:1em;vertical-align:baseline;background-color:#f9f2f4;color:#c7254e;background-position:initial initial;background-repeat:initial initial;">默认mapreduce.task.io.sort.mb=100M</code>）,当该缓冲区快要溢出时（<code style="margin:0px;padding:0px 0.4em;border:0px;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;font-size:1em;vertical-align:baseline;background-color:#f9f2f4;color:#c7254e;background-position:initial initial;background-repeat:initial initial;">默认mapreduce.map.sort.spill.percent=0.8</code>）,会在本地文件系统中创建一个溢出文件，将该缓冲区中的数据写入这个文件；</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">map阶段</span>：由我们自己编写，最后调用 context.write(…)；</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">partition分区阶段</span><br />
3.1. 在map中调用 context.write(k2,v2)方法输出，该方法会立刻调用 Partitioner类对数据进行分区，一个分区对应一个 reduce task。<br />
3.2. 默认的分区实现类是&nbsp;<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">HashPartitioner</span>&nbsp;，根据<code style="margin:0px;padding:0px 0.4em;border:0px;outline:0px;font-style:inherit;font-family:'Source Code Pro', Consolas, Monaco, Menlo, Consolas, monospace;font-size:1em;vertical-align:baseline;background-color:#f9f2f4;color:#c7254e;background-position:initial initial;background-repeat:initial initial;">k2的哈希值 % numReduceTasks</code>，可能出现“数据倾斜”现象。<br />
3.3. 可以自定义 partition ，调用 job.setPartitioner(…)自己定义分区函数。</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">combiner合并阶段</span>：将属于同一个reduce处理的输出结果进行合并操作<br />
4.1. 是可选的；<br />
4.2. 目的有三个：1.减少Key-Value对；2.减少网络传输；3.减少Reduce的处理。</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">shuffle阶段</span>：即Map和Reduce中间的这个过程<br />
5.1. 首先&nbsp;<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">map</span>&nbsp;在做输出时候会在内存里开启一个环形内存缓冲区，专门用来做输出，同时map还会启动一个守护线程；<br />
5.2. 如缓冲区的内存达到了阈值的80%，守护线程就会把内容写到磁盘上，这个过程叫<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">spill</span>，另外的20%内存可以继续写入要写进磁盘的数据；<br />
5.3. 写入磁盘和写入内存操作是互不干扰的，如果缓存区被撑满了，那么map就会阻塞写入内存的操作，让写入磁盘操作完成后再继续执行写入内存操作;<br />
5.4. 写入磁盘时会有个排序操作，如果定义了combiner函数，那么排序前还会执行combiner操作；<br />
5.5. 每次spill操作也就是写入磁盘操作时候就会写一个溢出文件，也就是说在做map输出有几次spill就会产生多少个溢出文件，等map输出全部做完后，map会合并这些输出文件，这个过程里还会有一个Partitioner操作（如上）<br />
5.6. 最后&nbsp;<span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">reduce</span>&nbsp;就是合并map输出文件，Partitioner会找到对应的map输出文件，然后进行复制操作，复制操作时reduce会开启几个复制线程，这些线程默认个数是5个（可修改），这个复制过程和map写入磁盘过程类似，也有阈值和内存大小，阈值一样可以在配置文件里配置，而内存大小是直接使用reduce的tasktracker的内存大小，复制时候reduce还会进行排序操作和合并文件操作，这些操作完了就会进行reduce计算了。</p>
</li>
<li style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;"><p style="margin-top:1.6em;margin-bottom:1.6em;padding-top:0px;padding-bottom:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;line-height:1.6em;"><span style="margin:0px;padding:0px;border:0px;outline:0px;font-style:inherit;font-family:inherit;vertical-align:baseline;">reduce阶段</span>：由我们自己编写，最终结果存储在hdfs上的。</p>
</li>
</ol>
<div style="color:#333333;font-family:Arial;font-variant-ligatures:normal;orphans:2;widows:2;"><span style="font-family:&quot;Microsoft Yahei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:#444444;">参考</span></div>
<div style="color:#333333;font-family:Arial;font-variant-ligatures:normal;orphans:2;widows:2;"><span style="font-family:&quot;Microsoft Yahei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:#444444;"><a target="_blank" href="https://github.com/kite-sdk/kite/wiki/Hadoop-MapReduce-Tutorial" rel="external" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;vertical-align:baseline;">https://github.com/kite-sdk/kite/wiki/Hadoop-MapReduce-Tutorial</a><br />
<a target="_blank" href="http://www.cnblogs.com/sharpxiajun/p/3151395.html" rel="external" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;vertical-align:baseline;">http://www.cnblogs.com/sharpxiajun/p/3151395.html</a><br />
<a target="_blank" href="http://blog.csdn.net/qq1010885678/article/details/51337323" rel="external" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;vertical-align:baseline;">http://blog.csdn.net/qq1010885678/article/details/51337323</a><br />
<a target="_blank" href="http://blog.csdn.net/u014313009/article/details/38072269" rel="external" style="color:#258fb8;text-decoration:none;margin:0px;padding:0px;border:0px;outline:0px;vertical-align:baseline;">http://blog.csdn.net/u014313009/article/details/38072269 （Shuffle阶段讲的很好）</a></span></div></body></html>