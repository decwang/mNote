<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2016-11-17T06:25:59Z"/><meta name="updated" content="2016-11-17T06:26:01Z"/><title> android下拉刷新和listview冲突    标签： Androidandroid事件处理  2016-06-07 19:48 683人阅读 评论(0) 收藏 举报     分类：  And</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="article_title" style="margin-bottom:21px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;">&nbsp;<h1 style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;font-size:18px;"><span class="link_title"><a href="http://blog.csdn.net/u012246458/article/details/51606056" style="text-decoration:none;color:#000000;">android下拉刷新和listview冲突</a></span></h1>
</div>
<div class="article_manage clearfix" style="color:#999999;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:22px;font-family:Arial;text-align:right;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ededed;margin:0px -20px 10px;padding:0px 20px 5px;overflow:hidden;widows:1;"><div class="article_l" style="width:948px;float:left;"><span class="link_categories" style="margin:0px 0px 0px 5px;float:left;">标签：&nbsp;<a href="http://www.csdn.net/tag/Android" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">Android</a><a href="http://www.csdn.net/tag/android%e4%ba%8b%e4%bb%b6%e5%a4%84%e7%90%86" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">android事件处理</a></span></div>
<div class="article_r"><span class="link_postdate" style="margin:0px 16px 0px 0px;">2016-06-07 19:48</span>&nbsp;<span class="link_view" title="阅读次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 24px;display:inline-block;background:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon.png) 0px -25px no-repeat;">683人阅读</span>&nbsp;<span class="link_comments" title="评论次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 17px;display:inline-block;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-attachment:initial;background-color:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:0px -43px;background-repeat:no-repeat;"><a href="http://blog.csdn.net/u012246458/article/details/51606056#comments" style="text-decoration:none;color:#c88326;">评论</a>(0)</span>&nbsp;<span class="link_collect tracking-ad" data-mod="popu_171" style="margin:0px 16px 0px 5px;display:inline-block;padding-left:17px;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-position:0px -62px;background-repeat:no-repeat;"><a title="收藏" target="_blank" style="color:#c88326;">收藏</a></span>&nbsp;<span class="link_report" style="margin:0px 16px 0px 5px;display:inline-block;padding-left:17px;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-position:0px -81px;background-repeat:no-repeat;"><a href="http://blog.csdn.net/u012246458/article/details/51606056#report" title="举报" style="text-decoration:none;color:#c88326;">举报</a></span></div>
</div>
<div class="category clearfix" style="margin:0px -20px;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ededed;padding:5px 20px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;"><div class="category_l" style="display:inline-block;font-size:14px;color:#333333;width:70px;float:left;line-height:28px;"><img src="http://static.blog.csdn.net/images/category_icon.jpg" style="border:none;vertical-align:middle;" />&nbsp;<span style="display:inline-block;vertical-align:middle;">分类：</span></div>
<div class="category_r" style="display:inline-block;font-size:14px;color:#df3434;float:left;width:853.188px;"><label style="display:inline-block;margin-left:15px;cursor:pointer;line-height:28px;position:relative;">Android（125）&nbsp;<img class="arrow-down" src="http://static.blog.csdn.net/images/arrow_triangle%20_down.jpg" style="border:none;display:inline;" /></label></div>
</div>
<div class="bog_copyright" style="padding:20px 0px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;"><p class="copyright_p" style="margin-top:0px;margin-bottom:0px;padding:0px 0px 0px 10px;height:14px;line-height:14px;border-left-style:solid;border-left-width:3px;border-left-color:#e41c1e;color:#666666;font-size:14px;">版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
</div>
<div id="article_content" class="article_content" style="margin:35px 0px;font-size:15px;color:#555555;line-height:35px;font-family:'microsoft yahei';font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;">在写自定义下拉刷新的时候，碰到ListView和下拉刷新冲突：listView下拉一直出现下拉刷新动画，没有出现listView前面的内容。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">后来了解了一下<a href="http://lib.csdn.net/base/15" class="replace_word" title="undefined" target="_blank" style="text-decoration:none;color:#df3434;font-weight:bold;">Android</a>布局嵌套后事件拦击机制而解决了问题。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">参考了两个博客：<a target="_blank" href="http://blog.csdn.net/awangyunke/article/details/22047987" style="text-decoration:none;color:#0c89cf;">Android 触摸事件传递机制</a><br />
<a target="_blank" href="http://blog.csdn.net/chunqiuwei/article/details/41084921" style="text-decoration:none;color:#0c89cf;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; android事件拦截处理机制详解</a><br />
<br />
总体上了解了事件拦截机制的路数，但是实际开发中确实遇到各种问题，其中一个就是LIstView和下拉冲突，总是显示下拉刷新，没有显示listView的顶部内容。</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">解决办法：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<pre style="white-space:pre-wrap;word-wrap:break-word;color:#a9b7c6;font-family:宋体;font-size:10.5pt;background-color:#2b2b2b;">getParent().requestDisallowInterceptTouchEvent(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;</span><span style="color:#808080;">//listview的滑动和下拉刷新的滑动冲突，到这步拦截，一直运行onTouchEvent，直到onTouchEvent把时间给外层布局，才运行外层的拦截(onInterceptTouchEvent)-消费(onTouchEvent)</span></pre><p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">个人代码；</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">两层层布局嵌套：（外部是下拉刷新，内部是一个listView）</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<pre style="white-space:pre-wrap;word-wrap:break-word;color:#a9b7c6;font-family:宋体;font-size:10.5pt;background-color:#2b2b2b;"><span style="color:#e8bf6a;">&lt;com.baofoo.mobile.wallet.common.view.pullable.PullToRefreshLayoutView</span><span style="color:#e8bf6a;">        </span><span style="color:#9876aa;">android</span><span style="color:#bababa;">:id=</span><span style="color:#6a8759;">"@+id/rv_pull"</span><span style="color:#6a8759;">        </span><span style="color:#9876aa;">android</span><span style="color:#bababa;">:layout_width=</span><span style="color:#6a8759;">"match_parent"</span><span style="color:#6a8759;">        </span><span style="color:#9876aa;">android</span><span style="color:#bababa;">:layout_height=</span><span style="color:#6a8759;">"wrap_content"</span><span style="color:#e8bf6a;">&gt;</span><span style="color:#808080;"> </span><span style="color:#808080;">        </span><span style="color:#e8bf6a;">&lt;com.baofoo.pulltorefresh.activity.PullableListView</span><span style="color:#e8bf6a;">                </span><span style="color:#9876aa;">android</span><span style="color:#bababa;">:id=</span><span style="color:#6a8759;">"@+id/content_view"</span><span style="color:#6a8759;">                </span><span style="color:#9876aa;">android</span><span style="color:#bababa;">:layout_width=</span><span style="color:#6a8759;">"match_parent"</span><span style="color:#6a8759;">                </span><span style="color:#9876aa;">android</span><span style="color:#bababa;">:layout_height=</span><span style="color:#6a8759;">"match_parent"</span><span style="color:#6a8759;">                </span><span style="color:#9876aa;">android</span><span style="color:#bababa;">:background=</span><span style="color:#6a8759;">"@color/white"</span><span style="color:#6a8759;">                </span><span style="color:#9876aa;">android</span><span style="color:#bababa;">:divider=</span><span style="color:#6a8759;">"@color/finance_divider"</span><span style="color:#e8bf6a;">/&gt;</span><span style="color:#e8bf6a;"> </span><span style="color:#e8bf6a;"> </span><span style="color:#e8bf6a;">&lt;/com.baofoo.mobile.wallet.common.view.pullable.PullToRefreshLayoutView&gt;</span></pre><br />
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">PullToRefreshLayoutView.java拦截代码：（onInterceptTouchEvent是拦截方法，onTouchEvent是执行方法）</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<pre style="white-space:pre-wrap;word-wrap:break-word;color:#a9b7c6;font-family:宋体;font-size:10.5pt;background-color:#2b2b2b;"><span style="color:#bbb529;">@Override</span><span style="color:#cc7832;">public boolean </span><span style="color:#ffc66d;">onInterceptTouchEvent</span>(<span style="color:#bbb529;">@NonNull </span>MotionEvent ev) {

    LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"顺序拦截：002"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;"> </span><span style="color:#cc7832;">    if </span>(!isEnabled() || canChildScrollUp() || <span style="color:#9876aa;">mRefreshing</span>) {
        <span style="color:#cc7832;">return false;</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">final int </span>action = MotionEventCompat.<span style="font-style:italic;">getActionMasked</span>(ev)<span style="color:#cc7832;">;</span><span style="color:#cc7832;"> </span><span style="color:#cc7832;">    switch </span>(action) {
        <span style="color:#cc7832;">case </span>MotionEvent.<span style="color:#9876aa;font-style:italic;">ACTION_DOWN</span>:
            <span style="color:#808080;">//mAnimateToStartPosition</span><span style="color:#808080;"> </span><span style="color:#808080;">            </span>LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;01"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span>setTargetOffsetTop(<span style="color:#6897bb;">0</span><span style="color:#cc7832;">, true</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">mActivePointerId </span>= MotionEventCompat.<span style="font-style:italic;">getPointerId</span>(ev<span style="color:#cc7832;">, </span><span style="color:#6897bb;">0</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">mIsBeingDragged </span>= <span style="color:#cc7832;">false;</span><span style="color:#cc7832;">            final float </span>initialMotionY = getMotionEventY(ev<span style="color:#cc7832;">, </span><span style="color:#9876aa;">mActivePointerId</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            if </span>(initialMotionY == -<span style="color:#6897bb;">1</span>) {
                <span style="color:#cc7832;">return false;</span><span style="color:#cc7832;">            </span>}
            <span style="color:#9876aa;">mInitialMotionY </span>= initialMotionY<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            break;</span><span style="color:#cc7832;">        case </span>MotionEvent.<span style="color:#9876aa;font-style:italic;">ACTION_MOVE</span>:
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;02"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">mActivePointerId </span>== <span style="color:#9876aa;font-style:italic;">INVALID_POINTER</span>) {
                <span style="color:#cc7832;">return false;</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">final float </span>y = getMotionEventY(ev<span style="color:#cc7832;">, </span><span style="color:#9876aa;">mActivePointerId</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            if </span>(y == -<span style="color:#6897bb;">1</span>) {
                <span style="color:#cc7832;">return false;</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">final float </span>yDiff = y - <span style="color:#9876aa;">mInitialMotionY</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            if </span>(yDiff &gt; <span style="color:#9876aa;">mTouchSlop </span>&amp;&amp; !<span style="color:#9876aa;">mIsBeingDragged</span>) {
                LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"触发下拉刷新："</span>+yDiff +<span style="color:#6a8759;">"..." </span>+ <span style="color:#9876aa;">mTouchSlop </span>+<span style="color:#6a8759;">".." </span>+ y + <span style="color:#6a8759;">"..." </span>+ <span style="color:#9876aa;">mInitialMotionY</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">                </span><span style="color:#9876aa;">mIsBeingDragged </span>= <span style="color:#cc7832;">true;</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">break;</span><span style="color:#cc7832;">        case </span>MotionEvent.<span style="color:#9876aa;font-style:italic;">ACTION_UP</span>:
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;03"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">        case </span>MotionEvent.<span style="color:#9876aa;font-style:italic;">ACTION_CANCEL</span>:
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;04"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">mIsBeingDragged </span>= <span style="color:#cc7832;">false;</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">mActivePointerId </span>= <span style="color:#9876aa;font-style:italic;">INVALID_POINTER</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            break;</span><span style="color:#cc7832;">        case </span>MotionEventCompat.<span style="color:#9876aa;font-style:italic;">ACTION_POINTER_UP</span>:
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;05"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span>onSecondaryPointerUp(ev)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            break;</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">return </span><span style="color:#9876aa;">mIsBeingDragged</span><span style="color:#cc7832;">;</span>}<span style="color:#bbb529;">@Override</span><span style="color:#cc7832;">public boolean </span><span style="color:#ffc66d;">onTouchEvent</span>(<span style="color:#bbb529;">@NonNull </span>MotionEvent ev) {
    LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"顺序处理：002"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;"> </span><span style="color:#cc7832;">    if </span>(!<span style="color:#9876aa;">mIsBeingDragged</span>) {
        <span style="color:#cc7832;">return super</span>.onTouchEvent(ev)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">    </span>}

    <span style="color:#cc7832;">final int </span>action = MotionEventCompat.<span style="font-style:italic;">getActionMasked</span>(ev)<span style="color:#cc7832;">;</span><span style="color:#cc7832;"> </span><span style="color:#cc7832;">    switch </span>(action) {
        <span style="color:#cc7832;">case </span>MotionEvent.<span style="color:#9876aa;font-style:italic;">ACTION_MOVE</span>: {
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;06"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            final int </span>pointerIndex = MotionEventCompat.<span style="font-style:italic;">findPointerIndex</span>(ev<span style="color:#cc7832;">, </span><span style="color:#9876aa;">mActivePointerId</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            if </span>(pointerIndex &lt; <span style="color:#6897bb;">0</span>) {
                <span style="color:#cc7832;">return false;</span><span style="color:#cc7832;">            </span>}

            <span style="color:#cc7832;">final float </span>y = MotionEventCompat.<span style="font-style:italic;">getY</span>(ev<span style="color:#cc7832;">, </span>pointerIndex)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            final float </span>yDiff = y - <span style="color:#9876aa;">mInitialMotionY</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            final float </span>scrollTop = yDiff * <span style="color:#9876aa;font-style:italic;">DRAG_RATE</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">mCurrentDragPercent </span>= scrollTop / <span style="color:#9876aa;">mTotalDragDistance</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">mCurrentDragPercent </span>&lt; <span style="color:#6897bb;">0</span>) {
                <span style="color:#cc7832;">return false;</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">float </span>boundedDragPercent = Math.<span style="font-style:italic;">min</span>(<span style="color:#6897bb;">1f</span><span style="color:#cc7832;">, </span>Math.<span style="font-style:italic;">abs</span>(<span style="color:#9876aa;">mCurrentDragPercent</span>))<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            float </span>extraOS = Math.<span style="font-style:italic;">abs</span>(scrollTop) - <span style="color:#9876aa;">mTotalDragDistance</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            float </span>slingshotDist = <span style="color:#9876aa;">mTotalDragDistance</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            float </span>tensionSlingshotPercent = Math.<span style="font-style:italic;">max</span>(<span style="color:#6897bb;">0</span><span style="color:#cc7832;">,</span><span style="color:#cc7832;">                    </span>Math.<span style="font-style:italic;">min</span>(extraOS<span style="color:#cc7832;">, </span>slingshotDist * <span style="color:#6897bb;">2</span>) / slingshotDist)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            float </span>tensionPercent = (<span style="color:#cc7832;">float</span>) ((tensionSlingshotPercent / <span style="color:#6897bb;">4</span>) - Math.<span style="font-style:italic;">pow</span>(
                    (tensionSlingshotPercent / <span style="color:#6897bb;">4</span>)<span style="color:#cc7832;">, </span><span style="color:#6897bb;">2</span>)) * <span style="color:#6897bb;">2f</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            float </span>extraMove = (slingshotDist) * tensionPercent / <span style="color:#6897bb;">2</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            int </span>targetY = (<span style="color:#cc7832;">int</span>) ((slingshotDist * boundedDragPercent) + extraMove)<span style="color:#cc7832;">;</span><span style="color:#cc7832;"> </span><span style="color:#cc7832;">            if</span>(<span style="color:#9876aa;">mCurrentDragPercent </span>&gt; <span style="color:#6897bb;">1.0</span>) {
                <span style="color:#cc7832;">return false;</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else </span>{
                setTargetOffsetTop(targetY - <span style="color:#9876aa;">mCurrentOffsetTop</span><span style="color:#cc7832;">, true</span>)<span style="color:#cc7832;">;</span><span style="color:#808080;">//设置本布局高度</span><span style="color:#808080;">                </span><span style="color:#9876aa;">pullToRefreshCatView</span>.setCurrentProgress(<span style="color:#9876aa;">mCurrentDragPercent</span><span style="color:#cc7832;">, </span><span style="color:#9876aa;">mCurrentOffsetTop</span>)<span style="color:#cc7832;">;</span><span style="color:#808080;">//传递给猫进度数据</span><span style="color:#808080;">            </span>}

            <span style="color:#cc7832;">break;</span><span style="color:#cc7832;">        </span>}
        <span style="color:#cc7832;">case </span>MotionEventCompat.<span style="color:#9876aa;font-style:italic;">ACTION_POINTER_DOWN</span>:
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;07"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            final int </span>index = MotionEventCompat.<span style="font-style:italic;">getActionIndex</span>(ev)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">mActivePointerId </span>= MotionEventCompat.<span style="font-style:italic;">getPointerId</span>(ev<span style="color:#cc7832;">, </span>index)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            break;</span><span style="color:#cc7832;">        case </span>MotionEventCompat.<span style="color:#9876aa;font-style:italic;">ACTION_POINTER_UP</span>:
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;08"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span>onSecondaryPointerUp(ev)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            break;</span><span style="color:#cc7832;">        case </span>MotionEvent.<span style="color:#9876aa;font-style:italic;">ACTION_UP</span>:
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;09"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">        case </span>MotionEvent.<span style="color:#9876aa;font-style:italic;">ACTION_CANCEL</span>: {
            LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"PullToRefresh---&gt;010"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            if </span>(<span style="color:#9876aa;">mActivePointerId </span>== <span style="color:#9876aa;font-style:italic;">INVALID_POINTER</span>) {
                <span style="color:#cc7832;">return false;</span><span style="color:#cc7832;">            </span>}
            <span style="color:#cc7832;">final int </span>pointerIndex = MotionEventCompat.<span style="font-style:italic;">findPointerIndex</span>(ev<span style="color:#cc7832;">, </span><span style="color:#9876aa;">mActivePointerId</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            final float </span>y = MotionEventCompat.<span style="font-style:italic;">getY</span>(ev<span style="color:#cc7832;">, </span>pointerIndex)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            final float </span>overScrollTop = (y - <span style="color:#9876aa;">mInitialMotionY</span>) * <span style="color:#9876aa;font-style:italic;">DRAG_RATE</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span><span style="color:#9876aa;">mIsBeingDragged </span>= <span style="color:#cc7832;">false;</span><span style="color:#cc7832;"> </span><span style="color:#cc7832;">            </span>LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"嘿嘿：" </span>+  overScrollTop + <span style="color:#6a8759;">"....." </span>+ <span style="color:#9876aa;">mTotalDragDistance</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            if </span>(overScrollTop &gt; <span style="color:#9876aa;">mTotalDragDistance</span>) {<span style="color:#808080;">//开始刷新</span><span style="color:#808080;">                </span>setRefreshing(<span style="color:#cc7832;">true, true</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span>} <span style="color:#cc7832;">else </span>{
                <span style="color:#9876aa;">mRefreshing </span>= <span style="color:#cc7832;">false;</span><span style="color:#cc7832;">                </span>animateOffsetToPosition(<span style="color:#9876aa;">mAnimateToStartPosition</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">            </span>}
            <span style="color:#9876aa;">mActivePointerId </span>= <span style="color:#9876aa;font-style:italic;">INVALID_POINTER</span><span style="color:#cc7832;">;</span><span style="color:#cc7832;">            return false;</span><span style="color:#cc7832;">        </span>}
    }

    <span style="color:#cc7832;">return true;</span>}</pre><p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">PullableListView.java拦截代码：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<pre style="white-space:pre-wrap;word-wrap:break-word;color:#a9b7c6;font-family:宋体;font-size:10.5pt;background-color:#2b2b2b;">    <span style="color:#bbb529;">@Override</span><span style="color:#bbb529;">    </span><span style="color:#cc7832;">public boolean </span><span style="color:#ffc66d;">onInterceptTouchEvent</span>(MotionEvent ev) {<span style="color:#808080;"> </span><span style="color:#808080;"> </span><span style="color:#808080;">        </span>getParent().requestDisallowInterceptTouchEvent(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;</span><span style="color:#808080;">//listview的滑动和下拉刷新的滑动冲突，到这步拦截，一直运行onTouchEvent，直到onTouchEvent把时间给外层布局，才运行外层的拦截(onInterceptTouchEvent)-消费(onTouchEvent)</span><span style="color:#808080;"> </span><span style="color:#808080;">        </span>LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"顺序拦截：001"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">        return super</span>.onInterceptTouchEvent(ev)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">    </span>}

    <span style="color:#bbb529;">@Override</span><span style="color:#bbb529;">    </span><span style="color:#cc7832;">public boolean </span><span style="color:#ffc66d;">onTouchEvent</span>(MotionEvent ev) {
        <span style="color:#cc7832;">if </span>(getChildAt(<span style="color:#6897bb;">0</span>) == <span style="color:#cc7832;">null</span>) {<span style="color:#808080;">// 获取view的position防止为null</span><span style="color:#808080;">            </span>getParent().requestDisallowInterceptTouchEvent(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">        </span>}
        <span style="color:#cc7832;">if </span>(getCount() == <span style="color:#6897bb;">0</span>) {
            <span style="color:#808080;">// 没有item的时候也可以下拉刷新</span><span style="color:#808080;">            </span>getParent().requestDisallowInterceptTouchEvent(<span style="color:#cc7832;">false</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">        </span>} <span style="color:#cc7832;">else if </span>(getFirstVisiblePosition() == <span style="color:#6897bb;">0</span><span style="color:#6897bb;">                </span>&amp;&amp; getChildAt(<span style="color:#6897bb;">0</span>).getTop() &gt;= <span style="color:#6897bb;">0</span>) {
            <span style="color:#808080;">// 滑到ListView的顶部了</span><span style="color:#808080;">            </span>getParent().requestDisallowInterceptTouchEvent(<span style="color:#cc7832;">false</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">        </span>} <span style="color:#cc7832;">else </span>{
            getParent().requestDisallowInterceptTouchEvent(<span style="color:#cc7832;">true</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">        </span>}

        LogUtils.<span style="font-style:italic;">d</span>(<span style="color:#6a8759;">"顺序处理：001"</span>)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">        return super</span>.onTouchEvent(ev)<span style="color:#cc7832;">;</span><span style="color:#cc7832;">    </span>}</pre><p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">解析：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">运行的结果是：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">顺序拦截：002 --&gt; 顺序拦截：001 --&gt; 顺序处理：001 -- &gt; 顺序处理：002&nbsp;</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">但是listVIew必须是向上拉倒第一个item的时候才能执行下拉刷新（顺序处理002），所以要用到代码getParent().requestDisallowInterceptTouchEvent(true);</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">当为true时候，代表listview拦截成功，必须listView中的onTouchEvent执行完毕后设为false放行，下拉刷新才能执行（顺序处理：002）</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">所以关键代码还是：getParent().requestDisallowInterceptTouchEvent(true);</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">一下是运行图：</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;">第一个是没有使用getParent().requestDisallowInterceptTouchEvent(true);&nbsp; | 第二个是使用后的</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><img src="http://img.blog.csdn.net/20160607194319412?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" height="585" width="376" style="border:none;max-width:602px;max-height:100%;height:auto;" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="http://img.blog.csdn.net/20160607194725786?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" height="582" width="374" style="border:none;max-width:602px;max-height:100%;height:auto;" /></p>
</div></body></html>