<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-02-14T09:48:53Z"/><meta name="updated" content="2017-02-14T09:57:49Z"/><title>让MKMapView变得丰富多彩</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="post-topheader custom-" style="box-sizing:border-box;padding:20px 0px;background-color:#f6f6f6;color:#333333;font-family:'Helvetica Neue', Helvetica, Arial, 'PingFang SC', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', 'Microsoft Yahei', sans-serif;"><div class="container" style="box-sizing:border-box;margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px;width:1140px;"><div class="row" style="box-sizing:border-box;margin-left:-15px;margin-right:-15px;"><div class="col-md-9 col-sm-8 col-xs-12" style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;float:left;width:855px;"><div class="post-topheader__info" data-username="jeluomsy" data-userslug="jeluomsy" data-useravatar="https://sfault-avatar.b0.upaiyun.com/171/544/1715445486-56834f83dda28_big64" style="box-sizing:border-box;color:#999999;margin-left:40px;margin-bottom:-5px;"><h1 class="h3 post-topheader__info--title" id="articleTitle" data-id="1190000004679243" style="box-sizing:border-box;font-size:24px;margin:0px 0px 15px;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;"><a href="https://segmentfault.com/a/1190000004679243" style="box-sizing:border-box;background-color:transparent;color:#333333;text-decoration:none;outline:0px;background-position:initial initial;background-repeat:initial initial;">让MKMapView变得丰富多彩</a></h1>
<ul class="taglist--inline inline-block article__title--tag mr10" style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;display:inline-block;margin-right:10px !important;list-style:none;padding:0px;font-size:0px;"><li class="tagPopup mb5" style="box-sizing:border-box;margin-bottom:5px !important;padding:0px;font-size:13px;display:inline-block;margin-right:0px;"><a class="tag" href="https://segmentfault.com/t/iOS/blogs" data-toggle="popover" data-img="https://sfault-avatar.b0.upaiyun.com/294/188/2941880015-1040000000089442_huge256" data-placement="top" data-original-title="iOS" data-id="1040000000089442" style="box-sizing:border-box;background-color:rgba(1, 126, 102, 0.0784314);color:#017e66;text-decoration:none;outline:0px;display:inline-block;padding:0px 8px;height:24px;line-height:24px;text-align:center;">iOS</a></li>
</ul>
&nbsp;<div class="article__author" style="box-sizing:border-box;display:inline-block;"><a href="https://segmentfault.com/u/jeluomsy" class="mr5 " style="box-sizing:border-box;background-color:transparent;color:#009a61;text-decoration:none;outline:0px;margin-right:5px !important;background-position:initial initial;background-repeat:initial initial;"><strong style="box-sizing:border-box;">jeluomsy</strong></a>&nbsp;2016年03月24日发布</div>
</div>
</div>
<div class="col-md-3 col-sm-4 hidden-xs" style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;float:left;width:285px;"><ul class="post-topheader__side list-unstyled" style="box-sizing:border-box;margin:0px;padding-left:0px;list-style:none;color:#999999;"><li style="box-sizing:border-box;margin-top:0px;"><button type="button" class="btn btn-success btn-sm" data-id="1190000004679243" id="sideLike" style="color:#ffffff;font-family:inherit;font-size:12px;font-style:inherit;font-variant-caps:inherit;line-height:1.5;margin:0px 15px 0px 0px;overflow:visible;cursor:pointer;vertical-align:middle;background-image:none;border:1px solid #4cae4c;white-space:nowrap;padding:5px 10px;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;-webkit-user-select:none;background-color:#5cb85c;-webkit-box-shadow:rgba(0, 0, 0, 0.0980392) 0px 1px 2px;box-shadow:rgba(0, 0, 0, 0.0980392) 0px 1px 2px;min-width:58px;">推荐</button>&nbsp;<strong id="sideLiked" style="box-sizing:border-box;color:#333333;">1</strong>&nbsp;推荐</li>
<li style="box-sizing:border-box;margin-top:10px;"><button type="button" id="sideBookmark" class="btn btn-default btn-sm" data-id="1190000004679243" data-type="article" style="color:#333333;font-family:inherit;font-size:12px;font-style:inherit;font-variant-caps:inherit;line-height:1.5;margin:0px 15px 0px 0px;overflow:visible;cursor:pointer;vertical-align:middle;background-image:none;border:1px solid #cccccc;white-space:nowrap;padding:5px 10px;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;-webkit-user-select:none;background-color:#ffffff;-webkit-box-shadow:rgba(0, 0, 0, 0.0980392) 0px 1px 2px;box-shadow:rgba(0, 0, 0, 0.0980392) 0px 1px 2px;min-width:58px;">收藏</button>&nbsp;<strong id="sideBookmarked" style="box-sizing:border-box;color:#333333;">6</strong>&nbsp;收藏，<span class="no-stress" style="box-sizing:border-box;color:#333333;">2.1k</span>&nbsp;浏览</li>
</ul>
</div>
</div>
</div>
</div>
<div class="container mt30" style="box-sizing:border-box;margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px;width:1140px;color:#333333;font-family:'Helvetica Neue', Helvetica, Arial, 'PingFang SC', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', 'Microsoft Yahei', sans-serif;margin-top:30px !important;"><div class="row" style="box-sizing:border-box;margin-left:-15px;margin-right:-15px;"><div class="col-xs-12 col-md-9 main " style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;float:left;width:855px;"><div class="article fmt article__content" data-id="1190000004679243" data-license="cc" style="box-sizing:border-box;line-height:1.6;word-wrap:break-word;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:1.5em;">在MKMapView上添加标注可以方便用户更好地获取信息，与地图进行交互。标注分为两种，一种是<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">Annotations</code>，一种是<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">Overlays</code>。</p>
<ul style="box-sizing:border-box;margin:1.5em 0px 1.5em 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">Annotations。标注由经纬度所确定的一个点，比如用户当前位置，一个被指定的地址，或者一个被收藏的地点。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">Overlays。标注由多点连成的线，一个或者多个相邻或不相邻的区域。比如路线、交通状况、或者某个地点的边界。</p>
</li>
</ul>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">和MKMapView中的subView不同，Annotations和Overlays会随着地图的移动而移动。</p>
<h2 id="articleHeader0" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.75em;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#eeeeee;padding-bottom:10px;">添加Annotations</h2>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">Annotations可以是地图上一个点醒目地标注出来，并且可以提供这个地点一些简单的信息。你可以用Annotations来标注当前位置、指定的位置、或者被收藏的位置等等。可以在地图上用一组图片来分别标记这些位置，还可以通过calloutView显示基本信息和可操作的空间，比如链接到更详细的介绍页面。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">下面这张图，使用了<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">大头针</code>来标注一个指定的地点，并且通过<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">calloutView</code>显示一些基本信息，以及一个<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">点击后可以提供驾车导航的按钮</code>和<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">点击后可以跳转获取更多信息的按钮</code>。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;"><img data-src="https://segmentfault.com/image?src=http://7xpk3y.com1.z0.glb.clouddn.com/2016-03-16-1-1.png&amp;objectId=1190000004679243&amp;token=ad8c0e201aef459fd7e709a9e890bc26" src="https://segmentfault.com/image?src=http://7xpk3y.com1.z0.glb.clouddn.com/2016-03-16-1-1.png&amp;objectId=1190000004679243&amp;token=ad8c0e201aef459fd7e709a9e890bc26" style="box-sizing:border-box;border:1px solid #dddddd;vertical-align:middle;padding:3px;cursor:pointer;display:inline;position:static !important;" /></p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">如果要定义一个Annotation，要通过下面两个类：</p>
<ul style="box-sizing:border-box;margin:1.5em 0px 1.5em 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;"><em style="box-sizing:border-box;">Annotation object</em>&nbsp;，遵循<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotation</code>协议，管理Annotation相关的属性。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;"><em style="box-sizing:border-box;">Annotation View</em>&nbsp;，<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotationView</code>类型，来绘制Annotation的样式。</p>
</li>
</ul>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">MapKit已经提供一些标准样式的Annotations，比如上图所示的大头针。也可以自定义annotationView。无论是使用标准的还是自定义的annotationView，你都不能使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">addSubView:</code>的方法将他们添加到mapView上。而应该使用mapView的代理方法<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:viewForAnnotation:</code></p>
<h3 id="articleHeader1" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">添加Annotations的步骤</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">按照以下步骤来实现和使用Annotations。假定已经添加了mapView。</p>
<ol style="box-sizing:border-box;margin:1.5em 0px 1.5em 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">用下面任意一种方法定义_Annotation object_。</p>
<ul style="box-sizing:border-box;margin:0px 0px 0px 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPointAnnotation</code>类实现一个简单的Annotation。用这个方法定义的Annotation object包含calloutView的title和subtitle属性。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">自定义一个遵循<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotation</code>协议的类。这个类可以包含任何你想包含的属性。</p>
</li>
</ul>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">定义一个_Annotation View_。根据你的需要选择合适的方法。</p>
<ul style="box-sizing:border-box;margin:0px 0px 0px 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">如果使用系统提供的大头针作为标注，只需要创建一个<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPinAnnotationView</code>的实例即可。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">如果使用一张静态图片，创建一个<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotationView</code>的实例，给它的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">image</code>属性赋值即可。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">如果上面两种方法已经无法满足你，那么就新建一个继承自<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotation</code>类的子类，实现绘制代码。</p>
</li>
</ul>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">实现mapView的代理方法<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:viewForAnnotation:</code>。</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">在实现这个方法的时候，如果存在可以复用的annotationView，就直接使用。如果不存在，新建一个annotationView。如果需要显示多种类型的annotationView，根据<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">annotaion</code>类型不同，显示相应类型的annotationView。</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">这个方法让我想起<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">tableView:cellForRowAtIndexPath:</code>。它们两个的实现方式很相似。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">addAnnotation</code>或者<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">addAnnotations:</code>方法，添加annotationView到mapView上。</p>
</li>
</ol>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">无论被标注的位置是否在可见区域内，annotationView都会被添加到mapView上。如果希望选择性地隐藏annotationView，你必须手动移除它们。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">无论mapView的缩放比例是多少，AnnotationView都会以相同的大小显示。因此，当用户将地图比例缩小时，很可能会是AnnotationView会相互遮挡。为了解决这样的问题，可以根据缩放比例，添加或者移除annotationView。比如在一个天气应用中，当缩放比例小的时候，只显示省会城市的天气；当缩放比例变大的时候，可以逐渐显示出地级市、区县、乡镇的天气信息。</p>
<h3 id="articleHeader2" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">MKAnnotation、MKAnnotationView、CalloutView</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">首先，让我们来理解一下这两个类的作用以及它们的关系。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">MKAnnotation类中定义了<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotation</code>协议，这个协议定义了coordinate（必须实现的属性）、title和subtitle。coordinate属性的作用就是定义在哪个点处显示MKAnnotationView。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">所以，一个MKAnnotationView都会对应一个MKAnnotation对象，即它的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">annotation</code>属性。而MKAnnotation对象可以适用于多个MKAnnotationView。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">MKAnnotationView是用来定义标注的样式。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">CalloutView是当MKAnnotationView被选中后，弹出的View，用于呈现更多关于当前标注的位置的信息。默认情况下，它的title和subtitle由MKAnnotationView对象的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">annotation</code>属性定义。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">接下来，分别介绍它们的用法。</p>
<h3 id="articleHeader3" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">定义Annotation对象</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">如果仅仅需要关联一个位置的title，你只要用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPointAnnotation</code>类作为Annotation对象就行了。如果想添加另外的信息，你需要自定义一个Annotation对象。所有的Annotation对象必须遵循<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotation</code>协议。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">一个自定义的Annotation对象必须包含<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">coordinate</code>和其他你想要的属性。给出最简单的Annotation对象的定义。</p>
<pre style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;max-height:35em;position:relative;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);-webkit-background-size:30px, 30px;background-size:30px, 30px;margin-top:0px !important;"><code class="Objective-C" style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;"><span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#445588;font-weight:bold;">myCustomAnnotation</span> : <span class="hljs-title" style="box-sizing:border-box;color:#445588;font-weight:bold;">NSObject</span> &lt;<span class="hljs-title" style="box-sizing:border-box;color:#445588;font-weight:bold;">MKAnnotation</span>&gt; </span>{
    CLLocationCoordinate2D coordinate;
}<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">readonly</span>, <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>) CLLocationCoordinate2D coordinate;

- (instancetype)initWithLocation:(CLLocationCoordinate2D)coord;<span class="hljs-comment" style="box-sizing:border-box;color:#999988;">// 其他方法或者属性</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@end</span></code></pre><p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">自定义的类必须实现<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">coordinate</code>属性和一个给它赋值的初始化方法。（建议使用@synthesize，可以保证mapkit可以根据这个属性值的改变自动更新地图。）</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);background-size:30px, 30px;max-height:35em;position:relative;-webkit-background-size:30px, 30px;margin-top:0px !important;"><code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;"><span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@implementation</span> <span class="hljs-title" style="box-sizing:border-box;color:#445588;font-weight:bold;">myCustomAnnotation</span></span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@synthesize</span> coordinate;

- (instancetype)initWithLocation:(CLLocationCoordinate2D)coord {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> = [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">super</span> init];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> != <span class="hljs-literal" style="box-sizing:border-box;">nil</span>) {
        coordinate = coord;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span>;
}<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@end</span></code></pre><p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;"><strong style="box-sizing:border-box;">如果AnnotationView添加到mapView上之后，你手动地修改类中coordinate、title、subtitle属性的值，请务必发送一个通知。MapKit使用KVO检测这三个属性值的变化以在需要的时候更新地图。如果不发送，可能会导致位置的标注没有被正确显示。</strong></p>
<h3 id="articleHeader4" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">使用系统提供的AnnotationView</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">使用系统提供的annotationView可以很轻松地标注地图。<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotationView</code>定义了所有annotationView的基本行为。它的子类<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPinAnnotationView</code>用一张大头针的图片来标注一个位置。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">也可以不通过继承，直接设置它的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">image</code>属性，来显示一张图片作为annotationView。这张图片是以被标注的位置为中心呈现的。如果不想显示在中心点，你可以使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">centerOffset</code>属性移动中心点。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">举个栗子。创建一个自定义图片的MKAnnotationView，并且图片显示在经纬度的右下方。</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);background-size:30px, 30px;max-height:35em;position:relative;-webkit-background-size:30px, 30px;margin-top:0px !important;"><code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;">MKAnnotationView* aView = [[MKAnnotationView alloc] initWithAnnotation:annotation
                                  reuseIdentifier:<span class="hljs-string" style="box-sizing:border-box;color:#dd1144;">@"MyCustomAnnotation"</span>];
aView<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.image</span> = [<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#dd1144;">@"myimage.png"</span>];
aView<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.centerOffset</span> = CGPointMake(<span class="hljs-number" style="box-sizing:border-box;color:#009999;">10</span>, -<span class="hljs-number" style="box-sizing:border-box;color:#009999;">20</span>);</code></pre><p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">可以在代理方法<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:viewForAnnotation:</code>中创建标准的AnnotationView。</p>
<h3 id="articleHeader5" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">自定义AnnotationView</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">如果静态图片不能满足你的需求，你就可以通过继承<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotationView</code>来自定义annotationView。</p>
<ul style="box-sizing:border-box;margin:1.5em 0px 1.5em 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">重写<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">drawRect:</code>方法，重新定义样式。</p>
</li>
</ul>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">当重写<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">drawRect:</code>方法时，务必保证annotationView的frame非零，以确保在地图上是可见的。因为默认的初始化方法会用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">image</code>属性的图片的frame作为annotationView的frame。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">给一个简单的例子，重写了<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">- (instancetype)initWithAnnotation:(id&lt;MKAnnotation&gt;)annotation reuseIdentifier:(NSString *)reuseIdentifier;</code>方法。</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);background-size:30px, 30px;max-height:35em;position:relative;-webkit-background-size:30px, 30px;margin-top:0px !important;"><code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;">- (instancetype)initWithAnnotation:(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">id</span>&lt;MKAnnotation&gt;)annotation reuseIdentifier:(<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">NSString</span> *)reuseIdentifier {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> = [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">super</span> initWithAnnotation:annotation reuseIdentifier:reuseIdentifier];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span>) {
        <span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">CGRect</span> myFrame = <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.frame</span>;
        myFrame<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.size</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.width</span> = <span class="hljs-number" style="box-sizing:border-box;color:#009999;">40</span>;
        myFrame<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.size</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.height</span> = <span class="hljs-number" style="box-sizing:border-box;color:#009999;">40</span>;
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.frame</span> = myFrame;
        
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.backgroundColor</span> = [<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIColor</span> blueColor];
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.opaque</span> = <span class="hljs-literal" style="box-sizing:border-box;">NO</span>;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span>;
}</code></pre><h3 id="articleHeader6" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">在代理方法中创建annotationView</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">当需要添加annotationView时，调用代理方法<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:viewForAnnotation:</code>。如果<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">没有实现</code>这个方法或者<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">总返回nil</code>的话，系统就会使用默认的annotationView。如果不想使用系统默认的，那就重写这个方法，然后返回<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKAnnotationView</code>对象。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">在每次创建新的annotationView时，总要检查是否存在可复用的View。mapView的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">dequeueReusableAnnotationViewWithIdentifier:&nbsp;</code>方法可以获取到可以复用的View。如果返回了<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">nil</code>，那么创建一个新的annotationView。如果<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">没有返回nil</code>，那么将它的属性值换掉，然后赋给annotationView。__无论是哪种情况，都要把方法中<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">annotation</code>参数赋给<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">annotationView.annotation</code>。__</p>
<pre class="hljs ruby" style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);background-size:30px, 30px;max-height:35em;position:relative;-webkit-background-size:30px, 30px;margin-top:0px !important;"><code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;">- (<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKAnnotationView</span> *)<span class="hljs-symbol" style="box-sizing:border-box;color:#990073;">mapView:</span>(<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKMapView</span> *)mapView
                      <span class="hljs-symbol" style="box-sizing:border-box;color:#990073;">viewForAnnotation:</span>(id &lt;<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKAnnotation</span>&gt;)annotation
{
    <span class="hljs-regexp" style="box-sizing:border-box;color:#009926;">//</span> 如果标注的是用户当前位置，则直接返回<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nil</span>。
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([annotation <span class="hljs-symbol" style="box-sizing:border-box;color:#990073;">isKindOfClass:</span>[<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKUserLocation</span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">class</span>]])</span>         <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nil</span>;
 
    <span class="hljs-regexp" style="box-sizing:border-box;color:#009926;">//</span> 处理自定义的annotation。
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([annotation <span class="hljs-symbol" style="box-sizing:border-box;color:#990073;">isKindOfClass:</span>[<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MyCustomAnnotation</span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">class</span>]])</span>     {
        <span class="hljs-regexp" style="box-sizing:border-box;color:#009926;">//</span> 首先尝试复用已存在的<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKPinAnnotationView</span>。
        <span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKPinAnnotationView</span> *pinView = (<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKPinAnnotationView</span>*)[mapView <span class="hljs-symbol" style="box-sizing:border-box;color:#990073;">dequeueReusableAnnotationViewWithIdentifier:</span>@<span class="hljs-string" style="box-sizing:border-box;color:#dd1144;">"CustomPinAnnotationView"</span>];
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (!pinView)
        {
            <span class="hljs-regexp" style="box-sizing:border-box;color:#009926;">//</span> 没有可以复用的<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">View</span>，新建一个。
            pinView = [[<span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKPinAnnotationView</span> alloc] <span class="hljs-symbol" style="box-sizing:border-box;color:#990073;">initWithAnnotation:</span>annotation <span class="hljs-symbol" style="box-sizing:border-box;color:#990073;">reuseIdentifier:</span>@<span class="hljs-string" style="box-sizing:border-box;color:#dd1144;">"CustomPinAnnotationView"</span>];
            pinView.pinColor = <span class="hljs-constant" style="box-sizing:border-box;color:#009999;">MKPinAnnotationColorRed</span>;
            pinView.animatesDrop = <span class="hljs-constant" style="box-sizing:border-box;color:#009999;">YES</span>;
            pinView.canShowCallout = <span class="hljs-constant" style="box-sizing:border-box;color:#009999;">YES</span>;
 
            <span class="hljs-regexp" style="box-sizing:border-box;color:#009926;">//</span> 如果有的话，可以通过设置accessoryView定义callout。
        }
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">else</span>             pinView.annotation = annotation;
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> pinView;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nil</span>;
}</code></pre><h3 id="articleHeader7" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">创建Callout</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">Callout是在annotationView被选中时弹出。这时，AnnotationView的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">selected</code>属性为YES。你可以通过<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">setSelected:</code>方法设置selected属性，手动控制CalloutView的显示和消失。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">同样地，它既可以是系统提供的标准View，也可以是自定义View。一个标准的callout会显示标注的title，此外，它还可以显示subtitle、image和一个UIControl对象。如果想自定义callout，给annotationView添加自定义的subView，然后重写<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event;</code>方法响应用户事件。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">使用标准的callout是显示自定义内容最容易的方法。如下图所示，在callout中添加了图片和详情按钮。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;"><img data-src="https://segmentfault.com/image?src=http://7xpk3y.com1.z0.glb.clouddn.com/2016-03-16-1-2.png&amp;objectId=1190000004679243&amp;token=92cfdbd8256edd90be6a68c00eb30225" src="https://segmentfault.com/image?src=http://7xpk3y.com1.z0.glb.clouddn.com/2016-03-16-1-2.png&amp;objectId=1190000004679243&amp;token=92cfdbd8256edd90be6a68c00eb30225" style="box-sizing:border-box;border:1px solid #dddddd;vertical-align:middle;padding:3px;cursor:pointer;display:inline;position:static !important;" /></p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">接下来给出代码，如何实现修改callout样式。</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);background-size:30px, 30px;max-height:35em;position:relative;-webkit-background-size:30px, 30px;margin-top:0px !important;"><code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;"><span class="hljs-comment" style="box-sizing:border-box;color:#999988;">// 假设这个annotationView已经添加到mapView上了。</span> - (MKAnnotationView *)mapView:(<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">MKMapView</span> *)theMapView viewForAnnotation:(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">id</span> &lt;MKAnnotation&gt;)annotation
{
    <span class="hljs-comment" style="box-sizing:border-box;color:#999988;">// 首先尝试重用pin view。(代码没有贴出来，请参照上一段代码)。</span>     
    <span class="hljs-comment" style="box-sizing:border-box;color:#999988;">// 如果没有可以重用的View，则新建一个对象。</span>     MKPinAnnotationView *customPinView = [[MKPinAnnotationView alloc] initWithAnnotation:annotation reuseIdentifier:BridgeAnnotationIdentifier];
    customPinView<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.pinColor</span> = MKPinAnnotationColorPurple;
    customPinView<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.animatesDrop</span> = <span class="hljs-literal" style="box-sizing:border-box;">YES</span>;
    customPinView<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.canShowCallout</span> = <span class="hljs-literal" style="box-sizing:border-box;">YES</span>;
    
    <span class="hljs-comment" style="box-sizing:border-box;color:#999988;">// 添加右边的详情按钮。</span>     <span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIButton</span> *rightButton = [<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIButton</span> buttonWithType:UIButtonTypeDetailDisclosure];
    <span class="hljs-comment" style="box-sizing:border-box;color:#999988;">// 因为没有页面跳转，所以Target和action参数设为nil。</span>     [rightButton addTarget:<span class="hljs-literal" style="box-sizing:border-box;">nil</span> action:<span class="hljs-literal" style="box-sizing:border-box;">nil</span> forControlEvents:UIControlEventTouchUpInside];
    customPinView<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.rightCalloutAccessoryView</span> = rightButton;
    
    <span class="hljs-comment" style="box-sizing:border-box;color:#999988;">// 在callout左边添加自定义图片。</span>     <span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIImageView</span> *myCustomImage = [[<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIImageView</span> alloc] initWithImage:[<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#dd1144;">@"MyCustomImage.png"</span>]];
    customPinView<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.leftCalloutAccessoryView</span> = myCustomImage;
    
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> customPinView;
}</code></pre><p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">在iOS开发中，实现<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:annotationView:calloutAccessoryControlTapped:</code>代理方法来响应callout的control（必须是继承自<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">UIControl</code>）的点击事件。在实现这个方法的时候，通过AnnotationView的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">identifier</code>来分别那个AnnotationView的callout的control被点击了。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">当自定义callout时，需要多做一些工作，保证callout能够正常显示和消失。</p>
<ol style="box-sizing:border-box;margin:1.5em 0px 1.5em 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">创建一个<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">UIView</code>的子类。需要重写<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">drawRect:</code>方法。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">创建一个ViewController，初始化callout，执行按钮的点击事件。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">在AnnotationView中，实现<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event;</code>方法响应在callout边界内的点击事情。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">在AnnotationView中，实现<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">setSelected:animated:</code>方法。将自定义的callout作为annotationView的subView。当用户点击annotationView时，显示callout。如果callout已经显示，那么在<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">setSelected:animated:</code>中应该让callout消失，并从<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">subViews</code>中移除。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">在annotationView的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">initWithAnnotation:</code>方法中，将<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">canShowCallout</code>设为<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">NO</code>，防止用户点击annotationView弹出系统的callout。</p>
</li>
</ol>
<h3 id="articleHeader8" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">显示多个annotationView</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">上文提及了显示多个annotationView会造成的不良后果。在缩放程度过小的时候，多个annotationView会因为离得太近而乱成一堆，用户无法清晰地分辨。而解决的方案就是通过缩放比例，改变显示的annotationView的个数。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">调用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:regionWillChangeAnimated:</code>和<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:regionDidChangeAnimated:</code>方法检测缩放程度。当它变化时，根据需要添加或移除一部分annotationView。也许，还需要考虑其他因素（比如用户当前位置）决定它们的去留。</p>
<h2 id="articleHeader9" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.75em;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#eeeeee;padding-bottom:10px;">添加Overlays</h2>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">Overlays可以让我们在地图上标记处任意的区域。和Annotations不同，Overlays是根据多个坐标定义的。根据这些坐标，可以将它们连成线、矩形、圆或者其他不规则的图形，同时可以给这些图形填充颜色。利用Overlays，我们可以显示路况信息、地点的边界、路线等等。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">和显示Annotation一样，显示Overlays同样要定义两个对象：</p>
<ul style="box-sizing:border-box;margin:1.5em 0px 1.5em 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">overlay object。遵循MKOverlay协议，管理overlay相关的坐标点。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">overlayRender。MKOverlayRender类的对象，用来定义显示在地图上的overlay。</p>
</li>
</ul>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">__在iOS 7.0之后，使用MKOverlayRender代替MKOverlayView。前者提供了和MKOverlayView相同的功能，但更加轻量、高效。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">MKOverlay和MKOverlayRender类的作用，请对比MKAnnotation和MKAnnotationView。</p>
<h3 id="articleHeader10" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">添加Overlays的步骤</h3>
<ol style="box-sizing:border-box;margin:1.5em 0px 1.5em 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">定义一个MKOverlay对象。</p>
<ul style="box-sizing:border-box;margin:0px 0px 0px 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">直接使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKCircle</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPolygon</code>或者<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPolyline</code>类。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">继承<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKShape</code>或者<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKMultiPoint</code>类。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">使用任何遵循<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKOverlay</code>协议的类。</p>
</li>
</ul>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">定义Overlay Render。</p>
<ul style="box-sizing:border-box;margin:0px 0px 0px 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">对一些标准的形状，比如圆形、多边形等，使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKCircleRender</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPolygonRender</code>或者<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPolylineRender</code>。通过设置这些类的属性可以得到不同的样式。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">对于继承<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKShape</code>的自定义形状，定义一个<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKOverlayPathRender</code>的子类呈现它们。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">对于其他自定义的overlay，定义<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKOverlayRenderer</code>类的子类，实现自己的绘制方法。</p>
</li>
</ul>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">实现<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView</code>的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:rendererForOverlay:</code>代理方法。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">addOverlay:</code>方法，将其添加到mapView上。</p>
</li>
</ol>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">和annotation不同的是，overlay会随着地图的缩放而缩放。因为overlay表示地图上的边界、路线等信息。</p>
<h3 id="articleHeader11" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.5em;">使用标准的Overlays对象和View</h3>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">如果想标注显示地图上的某个区域，使用标准的Overlay类是最简单的方法。标准的Overlay类包括<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKCircle</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPolypon</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPolyline</code>，配合<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKCircleRender</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPolygonRender</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKPolylineRender</code>类将它们显示到mapView上。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">定义一个MKPolyline对象。MKPolyline有两个初始化方法，分别是使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">CLLocationCoordinate</code>类型的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">数组</code>和<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKMapPoint</code>类型的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">数组</code>，<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">count</code>参数表示数组中所包含的元素个数。</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);background-size:30px, 30px;max-height:35em;position:relative;-webkit-background-size:30px, 30px;margin-top:0px !important;"><code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;">CLLocationCoordinate2D points[<span class="hljs-number" style="box-sizing:border-box;color:#009999;">2</span>];
points[<span class="hljs-number" style="box-sizing:border-box;color:#009999;">0</span>] = CLLocationCoordinate2DMake(<span class="hljs-number" style="box-sizing:border-box;color:#009999;">30.000000</span>, <span class="hljs-number" style="box-sizing:border-box;color:#009999;">120.000000</span>);
points[<span class="hljs-number" style="box-sizing:border-box;color:#009999;">1</span>] = CLLocationCoordinate2DMake(<span class="hljs-number" style="box-sizing:border-box;color:#009999;">40.000000</span>, <span class="hljs-number" style="box-sizing:border-box;color:#009999;">130.000000</span>);
MKPolyline *polyline = [MKPolyline polylineWithCoordinates:points count:<span class="hljs-number" style="box-sizing:border-box;color:#009999;">2</span>];
[<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.mapView</span> addOverlay:polyline];</code></pre><p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">要把overlay显示到mapView上，必须实现mapView的<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">mapView:rendererForOverlay:</code>代理方法，返回<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKOverlayRender</code>类的对象。</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);background-size:30px, 30px;max-height:35em;position:relative;-webkit-background-size:30px, 30px;margin-top:0px !important;"><code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;">- (MKOverlayRenderer *)mapView:(<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">MKMapView</span> *)mapView rendererForOverlay:(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">id</span>&lt;MKOverlay&gt;)overlay {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([overlay isKindOfClass:[MKPolyline class]]) {
        MKPolylineRenderer *polylineRender = [[MKPolylineRenderer alloc] initWithPolyline:(MKPolyline *)overlay];
        [polylineRender setNeedsDisplay];
        polylineRender<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.fillColor</span> = [<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIColor</span> redColor];
        polylineRender<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.strokeColor</span> = [<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UIColor</span> redColor];
        polylineRender<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.lineWidth</span> = <span class="hljs-number" style="box-sizing:border-box;color:#009999;">1.0</span>f;
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> polylineRender;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> <span class="hljs-literal" style="box-sizing:border-box;">nil</span>;
}</code></pre><p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;"><strong style="box-sizing:border-box;">注意：如果是用MKPolylineRender的话，使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">strokeColor</code>属性设置其颜色，而不是<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">fillColor</code>属性。</strong></p>
<h2 id="articleHeader12" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.75em;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#eeeeee;padding-bottom:10px;">关于搜索</h2>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">通过<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKLocalSearch</code>、<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKLocalSearchRequest</code>，我们可以实现对地图的搜索。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">先来一段代码。结合UISearchBar和MKMapKit，将搜索的内容在地图上标注出来。在每次重新搜索的时候移除已经添加的MKAnnotation。搜索的结果以<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">MKMapItem</code>类型的数组给出，可以取出位置相关的信息，比如名称，经纬度，url等等。</p>
<pre class="hljs objectivec" style="box-sizing:border-box;overflow:auto;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:1em;margin-bottom:1.5em;line-height:1.3;word-break:break-all;word-wrap:break-word;background-color:#f6f6f6;border:none;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;background-image:url(https://sf-static.b0.upaiyun.com/v-58a17839/global/img/blueprint.png);background-size:30px, 30px;max-height:35em;position:relative;-webkit-background-size:30px, 30px;margin-top:0px !important;"><code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:1em;padding:0px;color:inherit;border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;white-space:inherit;background-image:none;overflow-wrap:normal;background-position:initial initial;background-repeat:initial initial;">- (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)searchBarSearchButtonClicked:(<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">UISearchBar</span> *)searchBar {
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.mapView</span> removeAnnotations:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.annotationArray</span>];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.searchRequest</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.naturalLanguageQuery</span> = <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.searchBar</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.text</span>;
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.localSearch</span> = [[MKLocalSearch alloc] initWithRequest:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.searchRequest</span>];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.localSearch</span> startWithCompletionHandler:^(MKLocalSearchResponse * _Nullable response, <span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">NSError</span> * _Nullable error) {
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.resultArray</span> = [<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">NSMutableArray</span> arrayWithArray:response<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.mapItems</span>];
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.annotationArray</span> = [<span class="hljs-built_in" style="box-sizing:border-box;color:#0086b3;">NSMutableArray</span> array];
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">for</span> (MKMapItem *mapItem <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">in</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.resultArray</span>) {
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.placeAnnotation</span> = [[PlaceAnnotation alloc] init];
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.placeAnnotation</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.coordinate</span> = mapItem<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.placemark</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.location</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.coordinate</span>;
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.placeAnnotation</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.title</span> = mapItem<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.name</span>;
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.placeAnnotation</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.url</span> = mapItem<span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.url</span>;
            [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.annotationArray</span> addObject:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.placeAnnotation</span>];
            [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.mapView</span> addAnnotation:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.placeAnnotation</span>];
        }
    }];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.searchBar</span> resignFirstResponder];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;color:#008080;">.resultArray</span> removeAllObjects];
}</code></pre><h2 id="articleHeader13" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin:1.5em 0px 0px;font-size:1.75em;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:#eeeeee;padding-bottom:10px;">结语</h2>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">结合之前的两篇文章，我自己算是把MapKit和CoreLocation的基本用法理了一遍。从看官方文档到从Stackoverflow查找问题解决方法，花了挺长时间的。</p>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">最后总结一下使用MapKit和CoreLocation时需要注意的点：</p>
<ul style="box-sizing:border-box;margin:1.5em 0px 1.5em 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">如果App中需要用到定位服务，</p>
<ul style="box-sizing:border-box;margin:0px 0px 0px 3em;padding-left:0px;"><li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">首先要添加MapKit和CoreLocation这两个系统框架</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">其次根据需要在info.plist中加入<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">NSLocationWhenInUseUsageDescription</code>和<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">NSLocationAlwaysUsageDescription</code>两个字段</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">最后就是相应地调用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">requestWhenInUseAuthorization</code>或者<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">requestAlwaysAuthorization</code>方法请求用户授权。</p>
</li>
</ul>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">为了保险起见，在每一次调用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">startUpdatingLocation</code>方法前，检查App是否已经获取到定位服务的权限。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">使用定位服务是很耗电的，所以每次在退出有mapView的页面之前，调用一次<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">stopUpdatingLocation</code>，可能对节省电量有帮助。</p>
</li>
<li style="box-sizing:border-box;margin:0.3em 0px;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;">在使用MKPolylineRender时，使用<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">strokeColor</code>属性给其设置颜色。而不是<code style="box-sizing:border-box;font-family:'Source Code Pro', Consolas, Menlo, Monaco, 'Courier New', monospace;font-size:0.93em;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-top-left-radius:3px;border-top-right-radius:3px;border-bottom-right-radius:3px;border-bottom-left-radius:3px;">fillColor</code>。</p>
</li>
</ul>
<p style="box-sizing:border-box;margin-top:1.5em;margin-bottom:1.5em;">目前就写这么多，欢迎大家提意见和建议。</p>
</div>
</div>
</div>
</div></body></html>