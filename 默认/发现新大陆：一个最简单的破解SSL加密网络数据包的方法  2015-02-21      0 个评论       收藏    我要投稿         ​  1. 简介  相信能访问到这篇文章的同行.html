<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-03-10T07:01:29Z"/><meta name="updated" content="2017-03-10T07:01:31Z"/><title>发现新大陆：一个最简单的破解SSL加密网络数据包的方法  2015-02-21      0 个评论       收藏    我要投稿         ​  1. 简介  相信能访问到这篇文章的同行</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><dl class="box_t" style="border-width:0px;padding:15px 0px 0px;margin:0px;list-style:none;float:left;width:670px;height:35px;text-align:center;font-size:21px;font-weight:bold;font-family:宋体;font-variant-ligatures:normal;orphans:2;widows:2;"><dd style="border-width:0px;padding:0px;margin:0px;list-style:none;">发现新大陆：一个最简单的破解SSL加密网络数据包的方法</dd></dl><dl class="box_INFO" style="border-width:0px;padding:10px 20px 5px;margin:0px;list-style:none;float:left;width:630px;font-size:12px;color:#999999;font-family:宋体;font-variant-ligatures:normal;orphans:2;widows:2;"><dd class="frinfo line_blue" style="border-width:0px;padding:0px;margin:0px;list-style:none;background:url(&quot;../images/xxbule.jpg&quot;) left 22px repeat-x;height:30px;overflow:hidden;float:left;width:500px;">2015-02-21 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="num" id="changyan_count_unit" style="color:#1f3a87;font-weight:bold;padding:5px 0px 5px 20px;background-image:url(http://www.2cto.com/statics/images/icon/user_comment.png);background-position:0% 50%;background-repeat:no-repeat no-repeat;">0</a><a href="http://www.2cto.com/article/201502/377678.html#SOHUCS" style="color:#1f3a87;text-decoration:none;">&nbsp;个评论</a>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</dd><dd class="frsize line_blue" style="border-width:0px;padding:0px;margin:0px;list-style:none;background:url(&quot;../images/xxbule.jpg&quot;) left 22px repeat-x;height:30px;overflow:hidden;float:left;width:130px;text-align:right;"><span id="favorite"><a class="t6" style="color:#1f3a87;">收藏</a>&nbsp;</span>&nbsp;&nbsp;&nbsp;<a target="_blank" href="http://www.2cto.com/index.php?m=member&amp;c=content&amp;a=publish&amp;modid=1&amp;siteid=1" style="color:#1f3a87;text-decoration:none;"><img src="http://statics.2cto.com/images/dl.jpg" style="border-width:0px;padding:0px;margin:0px;list-style:none;" />我要投稿</a></dd></dl><div class="cont_ibox" style="border-width:0px;padding:0px 0px 10px;margin:0px auto;list-style:none;width:650px;clear:both;text-align:center;font-family:宋体;font-size:12px;font-variant-ligatures:normal;orphans:2;widows:2;"><div id="_bs5z0dalcx41zlg3ybc0x80k9" style="border-width:0px;padding:0px;margin:0px;list-style:none;"></div>
<div id="BAIDU_SSP__wrapper_u2597680_0" style="border-width:0px;padding:0px;margin:0px;list-style:none;"><iframe id="iframeu2597680_0" src="http://pos.baidu.com/mcrm?sz=650x180&amp;rdid=2597680&amp;dc=3&amp;di=u2597680&amp;dri=0&amp;dis=0&amp;dai=4&amp;ps=329x456&amp;coa=at%3D3%26rsi0%3D650%26rsi1%3D180%26pat%3D1%26tn%3DbaiduCustNativeAD%26rss1%3D%2523F9F9F9%26conBW%3D0%26adp%3D1%26ptt%3D0%26titFF%3D%2525E5%2525BE%2525AE%2525E8%2525BD%2525AF%2525E9%25259B%252585%2525E9%2525BB%252591%26titFS%3D14%26rss2%3D%2523000000%26titSU%3D0%26tft%3D0%26tlt%3D1%26ptbg%3D90%26piw%3D140%26pih%3D90%26ptp%3D1&amp;dcb=___adblockplus&amp;dtm=HTML_POST&amp;dvi=0.0&amp;dci=-1&amp;dpt=none&amp;tsr=0&amp;tpr=1489129144318&amp;ti=%E5%8F%91%E7%8E%B0%E6%96%B0%E5%A4%A7%E9%99%86%EF%BC%9A%E4%B8%80%E4%B8%AA%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E7%A0%B4%E8%A7%A3SSL%E5%8A%A0%E5%AF%86%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9A%84%E6%96%B9%E6%B3%95%20-%20%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%20-%20%E7%BA%A2%E9%BB%91%E8%81%94%E7%9B%9F&amp;ari=2&amp;dbv=2&amp;drs=1&amp;pcs=1872x983&amp;pss=1872x340&amp;cfv=0&amp;cpl=5&amp;chi=1&amp;cce=true&amp;cec=GBK&amp;tlm=1489129144&amp;rw=983&amp;ltu=http%3A%2F%2Fwww.2cto.com%2Farticle%2F201502%2F377678.html&amp;ltr=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3DMJ6S2RNND7P-lSpoLi4d8saZ57DRoBqGxF_mPlq1ulhJs05kC4XFCzYO45vFG7EDTig4bNM9T9QiUxY4W3PFuq%26wd%3D%26eqid%3Dad9861710001ef560000000458c24eb3&amp;ecd=1&amp;uc=1873x1057&amp;pis=-1x-1&amp;ccd=24&amp;cja=false&amp;cmi=7&amp;col=zh-CN&amp;cdo=-1&amp;sr=1920x1080&amp;tcn=1489129145&amp;qn=a7f0e5df6f2bdb56&amp;tt=1489129144284.418.418.418" width="650" height="180" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" allowtransparency="true" style="border-width:0px;vertical-align:bottom;margin:0px;width:650px;height:180px;"></iframe></div>
</div>
<dl class="box_body" id="fontzoom" style="border-width:0px;padding:0px 20px 20px;margin:0px;list-style:none;float:left;width:630px;color:#333333;line-height:28px;font-family:宋体;font-variant-ligatures:normal;orphans:2;widows:2;"><dd id="Article" style="border-width:0px;padding:0px;margin:0px;list-style:none;"><h3 style="border-width:0px;padding:0px;margin:0px;list-style:none;">​</h3>
<h2>1. 简介</h2>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">相信能访问到这篇文章的同行基本上都会用过流行的网络抓包工具WireShark，用它来抓取相应的网络数据包来进行问题分析或者其他你懂的之类的事情。</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;"><img alt="\" data-ke-="" src="http://www.2cto.com/uploadfile/Collfiles/20150215/20150215095205314.png" style="border-width:0px;padding:0px;margin:0px auto;list-style:none;display:block;width:630px;height:335.7px;" /></p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">一般来说，我们用WireShark来抓取包进行分析是没有多大问题的。但这里有个问题是，如果你碰到的是用SSL/TLS等<a href="http://www.2cto.com/article/jiami/" target="_blank" class="keylink" style="color:#333333;text-decoration:none;">加密</a>手段加密过的网络数据的时候，往往我们只能束手无策。在过去的话，如果我们拥有的该传输会话的私钥的话我们还是可以将它提供给WireShark来让其对这些加密数据包进行解密的，但这已经是想当年还用RSA进行网络数据加密的年代的事情了。当今大家都已经逐渐拥抱&nbsp;前向加密技术PFS&nbsp;的时代了，所以该方法就不再适用了。因为前向加密技术的目的就是让每个数据交互都使用的是不同的私钥，所以你像以前RSA时代一样想只用一个私钥就能把整个session会话的网络数据包都<a href="http://www.2cto.com/article/jiami/" target="_blank" class="keylink" style="color:#333333;text-decoration:none;">破解</a>出来的话是不可能的了。所以这将是一个挺恼火的事情。</p>
<h2>2. Session Key日记记录来救火！</h2>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">大家先别火起，这里我来告诉你另外一个简单的方法来解决这个问题！其实Firefox和Chrome<a href="http://www.2cto.com/os/liulanqi/" target="_blank" class="keylink" style="color:#333333;text-decoration:none;">浏览器</a>都支持用日记文件的方式记录下用来加密TLS数据包对称会话秘钥的。这样你就可以在WireShark中指定该文件来快速完成你的破解目的了。请继续往下看具体的步骤。</p>
<h2>3. Browsers配置</h2>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">首先你需要配置一个环境变量。</p>
<h2>3.1 在Windows下的配置：</h2>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">怎么去到环境变量配置页面相信不需要我多说了，毕竟国内还是Windows的天下。</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;"><img alt="\" data-ke-="" src="http://www.2cto.com/uploadfile/Collfiles/20150215/20150215095205316.jpg" style="border-width:0px;padding:0px;margin:0px auto;list-style:none;display:block;width:630px;height:503.446px;" /></p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">在上图的位置增加一个新的叫做“SSLKEYLOGFILE”的环境变量并指定其路径到你想要保存你的会话私钥的地方。</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;"><img alt="\" data-ke-="" src="http://www.2cto.com/uploadfile/Collfiles/20150215/20150215095205317.jpg" style="border-width:0px;padding:0px;margin:0px auto;list-style:none;display:block;width:388px;height:215px;" /></p>
<h2>3.2 在<a href="http://www.2cto.com/os/linux/" target="_blank" class="keylink" style="color:#333333;text-decoration:none;font-size:14px;">Linux</a>或者MAC OS X上的配置:</h2>
<pre style="font-family:'Courier New', monospace;font-size:12px;margin-top:0px;width:630px;overflow:auto;padding:10px 0px;">$ export SSLKEYLOGFILE=~/path/to/sslkeylog.log</pre><p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">当然，如果你想在你的<a href="http://www.2cto.com/os/" target="_blank" class="keylink" style="color:#333333;text-decoration:none;">系统</a>每次启动的时候都指定该日记路径的话，你可以在你的Linux下执行下面的动作：</p>
<pre style="font-family:'Courier New', monospace;font-size:12px;margin-top:0px;width:630px;overflow:auto;padding:10px 0px;">1~/.bashrc</pre><p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">或者在你的MAC OS X上执行以下命令：</p>
<pre style="font-family:'Courier New', monospace;font-size:12px;margin-top:0px;width:630px;overflow:auto;padding:10px 0px;">1~/.MacOSX/environment </pre><p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">这样我们下次启动Firefox或者Chrome的开发者模式的时候，TLS秘钥就会自动写入到该指定文件下面了</p>
<pre style="font-family:'Courier New', monospace;font-size:12px;margin-top:0px;width:630px;overflow:auto;padding:10px 0px;">~/.MacOSX/environment</pre><h2>4. Wireshark配置</h2>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">&nbsp;</p>
为了支持这个功能，你当前的WireShark版本必须是1.6或者更新。我们仅仅要做的就是先进入偏好设置页面：<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">&nbsp;</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;"><img alt="\" data-ke-="" src="http://www.2cto.com/uploadfile/Collfiles/20150215/20150215095206318.jpg" style="border-width:0px;padding:0px;margin:0px auto;list-style:none;display:block;width:457px;height:488px;" /></p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">展开协议选项:</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;"><img alt="\" data-ke-="" src="http://www.2cto.com/uploadfile/Collfiles/20150215/20150215095206319.jpg" style="border-width:0px;padding:0px;margin:0px auto;list-style:none;display:block;width:305px;height:326px;" /></p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">找到SSL选项然后如下图所示打开上面设置好的会话秘钥保存文件：</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;"><img alt="\" data-ke-="" src="http://www.2cto.com/uploadfile/Collfiles/20150215/20150215095206320.jpg" style="border-width:0px;padding:0px;margin:0px auto;list-style:none;display:block;width:630px;height:444.6px;" /></p>
<h2>5. 结果</h2>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">下图就是我们通常见到的WireShark抓到TLS数据包后的显示结果：</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;"><img alt="\" data-ke-="" src="http://www.2cto.com/uploadfile/Collfiles/20150215/20150215095206321.png" style="border-width:0px;padding:0px;margin:0px auto;list-style:none;display:block;width:630px;height:335.7px;" /></p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">This is what it looks like when you switch to the “Decrypted SSL Data” tab. &nbsp;Note that we can now see the request information in plain-text! &nbsp;Success!大家可以看到WireShark下面会有一个“已解密的SSL Data”的标签，点击之后你就可以如下图所示的看到已经解密的TLS数据包的相信信息了：</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;"><img alt="\" data-ke-="" src="http://www.2cto.com/uploadfile/Collfiles/20150215/20150215095206322.png" style="border-width:0px;padding:0px;margin:0px auto;list-style:none;display:block;width:630px;height:230.155px;" /></p>
<h2>6. 小结</h2>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">通过本文我真心希望你能从中学到一些东西，该方法让我们能够如此直截了当的去把TLS数据包给破解出来。这种方式的另外一个值得一提的好处是，给会话过程中的两台机器根本不需要安装任何Wireshark工具，因为你会担心安装上去会搞得问题是做多错多都不知道哪里出问题了。你只需要做的是把他们上面的该会话秘钥文件指定到一个网络共享文件夹然后用另外一个已经机器上安装WireShark并如前所示指定该秘钥文件进行抓包就了事了。</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">最后多谢大家查看本文。如想每天都能看到最新的技术等资讯文章，敬请关注本人下面提供的微信公众号:techgogogo。谢谢！</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">-------------完------------------</p>
<p style="border-width:0px;padding:0px;margin-top:0px;margin-bottom:8px;list-style:none;text-indent:2em;">英文原文引用：&nbsp;https://jimshaver.net/2015/02/11/decrypting-tls-browser-traffic-with-wireshark-the-easy-way/</p>
</dd></dl></body></html>