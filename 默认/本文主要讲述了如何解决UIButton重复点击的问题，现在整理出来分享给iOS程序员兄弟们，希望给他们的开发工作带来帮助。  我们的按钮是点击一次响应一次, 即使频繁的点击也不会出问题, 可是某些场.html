<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2016-11-08T10:06:00Z"/><meta name="updated" content="2016-11-08T10:06:02Z"/><title>本文主要讲述了如何解决UIButton重复点击的问题，现在整理出来分享给iOS程序员兄弟们，希望给他们的开发工作带来帮助。  我们的按钮是点击一次响应一次, 即使频繁的点击也不会出问题, 可是某些场</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">本文主要讲述了如何解决UIButton重复点击的问题，现在整理出来分享给iOS程序员兄弟们，希望给他们的开发工作带来帮助。</span></p>
<p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">我们的按钮是点击一次响应一次, 即使频繁的点击也不会出问题, 可是某些场景下还偏偏就是会出问题.</span></p>
<h2 id="通常是如何解决" style="margin:0px;padding:0px;border:0px;font-size:16px;color:#2a3744;line-height:29.6px;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">通常是如何解决</span></h2>
<p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">我们通常会在按钮点击的时候设置这个按钮不可点击. 等待0.xS的延时后,在设置回来; 或者在操作结束的时候设置可以点击.</span></p>
<pre class="brush:java;" style="margin-top:0px;margin-bottom:10px;font-size:13px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;"><code class="hljs" style="width:660px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:17px;font-family:tahoma, arial, sans-serif;color:#4e6384;display:block;margin:5px auto;padding:10px;border-width:1px 1px 1px 3px;border-style:solid;border-color:#8391a7;">- (IBAction)clickBtn1:(UIbutton *)sender
{
    sender.enabled = NO;
    doSomething
    sender.enabled = YES;
}</code></span></pre><p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">如果涉及到按钮不同状态不同样式的时候, 用enabled不见得够用.还得额外加个变量来记录状态.</span></p>
<pre class="brush:java;" style="margin-top:0px;margin-bottom:10px;font-size:13px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;"><code class="hljs" style="width:660px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:17px;font-family:tahoma, arial, sans-serif;color:#4e6384;display:block;margin:5px auto;padding:10px;border-width:1px 1px 1px 3px;border-style:solid;border-color:#8391a7;">- (IBAction)clickBtn1:(UIbutton *)sender
{
    if (doingSomeThing) return;

    doingSomeThing = YES;
    doSomething
    doingSomeThing = NO;
}</code></span></pre><p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">笔者举的例子是直接在响应事件的周期内直接禁止点击的. 如果想做1秒内禁止重复点击的话,则得用<code style="width:660px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:17px;font-family:tahoma, arial, sans-serif;color:#4e6384;display:block;margin:5px auto;padding:10px;border-width:1px 1px 1px 3px;border-style:solid;border-color:#8391a7;">performSelector:withObject:afterDelay:</code></span></p>
<h2 id="漂亮的解决是怎样的" style="margin:0px;padding:0px;border:0px;font-size:16px;color:#2a3744;line-height:29.6px;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">漂亮的解决是怎样的</span></h2>
<p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">有了重复的代码段就是有了一个共性, 就可以抽象出来.</span></p>
<p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">我们可以给按钮添加一个属性<code style="width:660px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:17px;font-family:tahoma, arial, sans-serif;color:#4e6384;display:block;margin:5px auto;padding:10px;border-width:1px 1px 1px 3px;border-style:solid;border-color:#8391a7;">重复点击间隔</code>, 通过设置这个属性来控制再次接受点击事件的时间间隔.</span></p>
<pre class="brush:java;" style="margin-top:0px;margin-bottom:10px;font-size:13px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;"><code class="hljs" style="width:660px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:17px;font-family:tahoma, arial, sans-serif;color:#4e6384;display:block;margin:5px auto;padding:10px;border-width:1px 1px 1px 3px;border-style:solid;border-color:#8391a7;">@interface UIControl (XY)
@property (nonatomic, assign) NSTimeInterval uxy_acceptEventInterval;   // 可以用这个给重复点击加间隔
@end

static const char *UIControl_acceptEventInterval = UIControl_acceptEventInterval;
- (NSTimeInterval)uxy_acceptEventInterval
{
    return [objc_getAssociatedObject(self, UIControl_acceptEventInterval) doubleValue];
}

- (void)setUxy_acceptEventInterval:(NSTimeInterval)uxy_acceptEventInterval
{
    objc_setAssociatedObject(self, UIControl_acceptEventInterval, @(uxy_acceptEventInterval), OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}</code></span></pre><p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">在app启动的时候,我们hook 所有的按钮的 event</span></p>
<pre class="brush:java;" style="margin-top:0px;margin-bottom:10px;font-size:13px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;"><code class="hljs" style="width:660px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:17px;font-family:tahoma, arial, sans-serif;color:#4e6384;display:block;margin:5px auto;padding:10px;border-width:1px 1px 1px 3px;border-style:solid;border-color:#8391a7;">@implementation UIControl (XY)

+ (void)load
{
    Method a = class_getInstanceMethod(self, @selector(sendAction:to:forEvent:));
    Method b = class_getInstanceMethod(self, @selector(__uxy_sendAction:to:forEvent:));
    method_exchangeImplementations(a, b);
}

@end</code></span></pre><p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">在我们的点击事件里呢,对点击事件做下过滤</span></p>
<pre class="brush:java;" style="margin-top:0px;margin-bottom:10px;font-size:13px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;"><code class="hljs" style="width:660px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:17px;font-family:tahoma, arial, sans-serif;color:#4e6384;display:block;margin:5px auto;padding:10px;border-width:1px 1px 1px 3px;border-style:solid;border-color:#8391a7;">- (void)__uxy_sendAction:(SEL)action to:(id)target forEvent:(UIEvent *)event
{
    if (self.uxy_ignoreEvent) return;

    if (self.uxy_acceptEventInterval &gt; 0)
    {
        self.uxy_ignoreEvent = YES;
        [self performSelector:@selector(setUxy_ignoreEvent:) withObject:@(NO) afterDelay:self.uxy_acceptEventInterval];
    }

    [self __uxy_sendAction:action to:target forEvent:event];
}</code></span></pre><p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">实际使用起来就是这个样子</span></p>
<pre class="brush:java;" style="margin-top:0px;margin-bottom:10px;font-size:13px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;"><code class="hljs" style="width:660px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:17px;font-family:tahoma, arial, sans-serif;color:#4e6384;display:block;margin:5px auto;padding:10px;border-width:1px 1px 1px 3px;border-style:solid;border-color:#8391a7;">    UIButton *tempBtn = [UIButton buttonWithType:UIButtonTypeCustom];
    [tempBtn addTarget:self action:@selector(clickWithInterval:) forControlEvents:UIControlEventTouchUpInside];
    tempBtn.uxy_acceptEventInterval = 0.5;</code></span></pre><p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">文章至此就结束了.虽然不推荐大范围用runtime, 但是小范围内使用还是可以解决不少小问题的.</span></p>
<p style="margin-top:0px;margin-bottom:10px;padding:0px;border:0px;font-size:13px;text-indent:2em;font-family:'Microsoft YaHei', 微软雅黑, Arial, 'Lucida Grande', Tahoma, sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:24.05px;widows:1;background-position:initial initial;background-repeat:initial initial;"><span style="margin:0px;padding:0px;border:0px;font-size:medium;background:transparent;">本文到此结束，希望能给在遇到UIButton重复点击问题的iOS程序员兄弟们带来一定参考。</span></p></body></html>