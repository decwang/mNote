<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-06-27T07:19:16Z"/><meta name="updated" content="2017-06-27T07:19:18Z"/><title>接口的安全性主要围绕Token、Timestamp和Sign三个机制展开设计，保证接口的数据不会被篡改和重复调用，下面具体来看：  Token授权机制：用户使用用户名密码登录后服务器给客户端返回一个</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;">接口的安全性主要围绕Token、Timestamp和Sign三个机制展开设计，保证接口的数据不会被篡改和重复调用，下面具体来看：</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;"><span style="box-sizing:border-box;font-weight:700;">Token授权机制</span>：用户使用用户名密码登录后服务器给客户端返回一个Token（<i style="box-sizing:border-box;">通常是UUID</i>），并将Token-UserId以键值对的形式存放在缓存服务器中。服务端接收到请求后进行Token验证，如果Token不存在，说明请求无效。</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;"><span style="box-sizing:border-box;font-weight:700;">时间戳超时机制</span>：用户每次请求都带上当前时间的时间戳timestamp，服务端接收到timestamp后跟当前时间进行比对，如果时间差大于一定时间（<i style="box-sizing:border-box;">比如5分钟</i>），则认为该请求失效，这个时间要保证足够完成本次请求的同时尽量短，可以减少缓存服务器的压力（<i style="box-sizing:border-box;">见签名机制</i>）。</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;"><span style="box-sizing:border-box;font-weight:700;">签名机制</span>：将Token和时间戳加上其他请求参数就行MD5或SHA-1算法（可根据情况加点盐）加密，加密后的数据为本次请求的签名sign，并将该签名存放到缓存服务器中，超时时间设定为跟时间戳的超时时间一致（<i style="box-sizing:border-box;">这就是为什么要尽量短，二者时间一致可以保证无论在timestamp规定时间内还是外本URL都只能访问一次</i>）。服务端接收到请求后以同样的算法得到签名，并跟当前的签名进行比对，如果不一样，说明参数被更改过，直接返回错误标识。同一个签名只能使用一次，如果发现缓存服务器中已经存在了本次签名，则拒绝服务。</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;">整个流程如下：</p>
<blockquote style="box-sizing:border-box;padding:20px;margin:0px 0px 25px;font-size:16px;border-left-width:6px;border-left-style:solid;border-left-color:#b4b4b4;background-color:#f7f7f7;word-break:break-word;line-height:30px;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-variant-ligatures:normal;orphans:2;widows:2;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;line-height:1.7;">1、客户端通过用户名密码登录服务器并获取Token</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;line-height:1.7;">2、客户端生成时间戳timestamp，并将timestamp作为其中一个参数</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;line-height:1.7;">3、客户端将所有的参数，包括Token和timestamp按照自己的算法进行排序加密得到签名sign</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;line-height:1.7;">4、将token、timestamp和sign作为请求时必须携带的参数加在每个请求的URL后边（http://url/request?token=123&amp;timestamp=123&amp;sign=123123123）</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;word-break:break-word;line-height:1.7;">5、服务端写一个过滤器对token、timestamp和sign进行验证，只有三个参数都正确且在规定时间内，本次请求才有效</p>
</blockquote>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;">在以上三中机制的保护下，</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;">如果黑客劫持了请求，并对请求中的参数进行了修改，签名就无法通过；</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;">如果黑客使用已经劫持的URL进行DOS攻击，服务器则会因为缓存服务器中已经存在签名而拒绝服务，所以DOS攻击也是不可能的；</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;">如果黑客隔一段时间进行一次DOS攻击（假如这个时间大于签名在缓存服务器中的缓存时长），则会因为时间戳超时而无法完成请求，这就是为什么签名的缓存时长要跟时间戳的超时时长一样。</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:25px;word-break:break-word;color:#2f2f2f;font-family:-apple-system, 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;font-size:16px;font-variant-ligatures:normal;orphans:2;widows:2;">如果签名算法和用户名密码都暴露了，那齐天大圣来了估计也不好使吧。。。。</p></body></html>