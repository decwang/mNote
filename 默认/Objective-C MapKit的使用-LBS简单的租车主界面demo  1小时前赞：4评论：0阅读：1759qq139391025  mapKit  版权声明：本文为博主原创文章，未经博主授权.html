<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2017-02-16T04:45:12Z"/><meta name="updated" content="2017-02-16T04:45:14Z"/><title>Objective-C MapKit的使用-LBS简单的租车主界面demo  1小时前赞：4评论：0阅读：1759qq139391025  mapKit  版权声明：本文为博主原创文章，未经博主授权</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="title" style="box-sizing:border-box;margin:0px;padding:10px 0px;font-size:24px;color:#333333;font-family:'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑;font-variant-ligatures:normal;orphans:2;widows:2;"><br class="Apple-interchange-newline" />
Objective-C MapKit的使用-LBS简单的租车主界面demo</div>
<div class="labels" style="box-sizing:border-box;margin:0px;padding:0px;font-size:13px;overflow:hidden;color:#333333;font-family:'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑;font-variant-ligatures:normal;orphans:2;widows:2;"><span class="lf" style="box-sizing:border-box;float:left;margin-right:15px;">1小时前</span><span class="rg like" style="box-sizing:border-box;float:right;margin-left:15px;">赞：4</span><span class="rg" style="box-sizing:border-box;float:right;margin-left:15px;">评论：0</span><span class="rg" style="box-sizing:border-box;float:right;margin-left:15px;">阅读：1759</span><a class="rg" href="http://blog.cocoachina.com/article/47027#" style="box-sizing:border-box;background-color:transparent;color:#3a3a3a;text-decoration:none;margin:0px 0px 0px 15px;padding:0px;float:right;">qq139391025</a></div>
<div class="faces" style="box-sizing:border-box;margin:0px;padding:10px 0px;color:#333333;font-family:'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑;font-variant-ligatures:normal;orphans:2;widows:2;"><span style="box-sizing:border-box;display:inline-block;font-size:12px;height:24px;line-height:24px;padding:0px 8px;margin:0px 10px 4px 0px;border-radius:5px;background-color:#7ebbff;color:#ffffff;">mapKit</span></div>
<div class="blogarea" style="box-sizing:border-box;margin:0px;padding:8px 14px 19px;background-color:#fafafa;border:1px solid #dddddd;color:#333333;font-family:'Helvetica Neue', Helvetica, Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 微软雅黑;font-variant-ligatures:normal;orphans:2;widows:2;"><div class="copyright" style="box-sizing:border-box;margin:10px 0px;padding:0px 0px 0px 5px;border-left-width:4px;border-left-style:solid;border-left-color:#eb6100;"><strong style="box-sizing:border-box;">版权声明：</strong>本文为博主原创文章，未经博主授权不得转载。</div>
<div class="content" style="box-sizing:border-box;margin:0px;padding:10px 0px 0px;"><h1 id="st-0" style="box-sizing:border-box;margin:20px 0px 10px;font-size:36px;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;">效果</h1>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;text-indent:28px;line-height:24px;"><img src="http://upload-images.jianshu.io/upload_images/4009159-3d5191fcc8b774f2.gif?imageMogr2/auto-orient/strip" alt="效果.gif" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:94%;" /></p>
<h1 id="st-1" style="box-sizing:border-box;margin:20px 0px 10px;font-size:36px;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;">分析</h1>
<ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;text-indent:28px;line-height:24px;">三个view：地图view、车辆信息view、车辆类型选择view</p>
<blockquote style="box-sizing:border-box;padding:10px 20px;margin:0px 0px 20px;font-size:17.5px;border-left:5px solid #eeeeee;background-color:rgba(0, 0, 0, 0.0588235);"><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;"><li style="box-sizing:border-box;">地图view：大头针的摆放，根据不同的种类显示大头针</li>
<li style="box-sizing:border-box;">车辆信息view：根据当前点击的大头针显示对应的车辆信息</li>
<li style="box-sizing:border-box;">车辆类型选择view：选择车辆类型</li>
</ul>
</blockquote>
</li>
<li style="box-sizing:border-box;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;text-indent:28px;line-height:24px;">交互分析</p>
<blockquote style="box-sizing:border-box;padding:10px 20px;margin:0px 0px 20px;font-size:17.5px;border-left:5px solid #eeeeee;background-color:rgba(0, 0, 0, 0.0588235);"><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;"><li style="box-sizing:border-box;">选择车辆类型，地图上出现不同的大头针</li>
<li style="box-sizing:border-box;">车辆信息view可滑动，滑动完成后地图定位到当前车辆的大头针上</li>
</ul>
</blockquote>
</li>
<li style="box-sizing:border-box;"><p style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;text-indent:28px;line-height:24px;">view的搭建</p>
<blockquote style="box-sizing:border-box;padding:10px 20px;margin:0px 0px 20px;font-size:17.5px;border-left:5px solid #eeeeee;background-color:rgba(0, 0, 0, 0.0588235);"><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;"><li style="box-sizing:border-box;">车辆选择view：自定义slider 分段滑竿（<a href="http://www.jianshu.com/p/baa1b7454ee3" target="_blank" style="box-sizing:border-box;background-color:transparent;color:#eb6100;text-decoration:none;margin:0px;padding:0px;">上一篇文章提到过</a>）</li>
<li style="box-sizing:border-box;">车辆信息View：使用uicollectionView的流水布局，做出分页效果</li>
<li style="box-sizing:border-box;">mapView:自定义大头针，根据类型选择不同的大头针图片</li>
</ul>
</blockquote>
</li>
<li style="box-sizing:border-box;">参数的传递<blockquote style="box-sizing:border-box;padding:10px 20px;margin:0px 0px 20px;font-size:17.5px;border-left:5px solid #eeeeee;background-color:rgba(0, 0, 0, 0.0588235);"><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;"><li style="box-sizing:border-box;">模拟数据通过编写1.plist完成</li>
<li style="box-sizing:border-box;">读取plist数据,通过选择车辆类型,将筛选出来的数据使用模型数组存放,通过set方法传递给mapView和车辆信息view，并刷新界面</li>
<li style="box-sizing:border-box;">选择车辆信息view 通过代理将当前显示的车辆信息页传递给mapview并定位</li>
<li style="box-sizing:border-box;">mapview有两个委托方法,<code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:15.75px;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-radius:4px;">点击空白处</code>和<code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:15.75px;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-radius:4px;">点击大头针</code>两个方法,用来设置车辆选择view和车辆信息view的显隐</li>
</ul>
</blockquote>
</li>
</ul>
<h1 id="st-2" style="box-sizing:border-box;margin:20px 0px 10px;font-size:36px;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;">代码</h1>
<h2 id="st-3" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;margin-top:20px;margin-bottom:10px;font-size:30px;">数据模型</h2>
<ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">数据模型及KVC使用</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-preprocessor" style="box-sizing:border-box;color:#880000;">#import <span class="hljs-title" style="box-sizing:border-box;font-weight:bold;">&lt;Foundation&gt;</span></span> <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//车类型</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">typedef</span> NS_ENUM(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSInteger</span>, CarType) {
    CarTypeNone = -<span class="hljs-number" style="box-sizing:border-box;color:#008800;">1</span>,        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//默认大头针</span>     CarTypeDaily,           <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//日租</span>     CarTypeHourly,          <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//时租</span>     CarTypeLong,            <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//长租</span>     CarTypeTestDrive,       <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//试驾</span> };<span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">CarModel</span> : <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">NSObject</span></span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSDictionary</span> *location;      <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//经纬度</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">assign</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *carType;             <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//车类型</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">copy</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *carName;             <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//车名称</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">copy</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *price;               <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//价格</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">copy</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *distance;            <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//与用户的距离</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">copy</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *locationName;        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//当前位置名</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">copy</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *imageName;           <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//车图片</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">copy</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *order;               <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//订单</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">copy</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *banDay;              <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//限行</span> - (instancetype)initWithCarModelDict:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSDictionary</span>*)dict;
+ (instancetype)carModelWithDict:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSDictionary</span>*)ditc;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@end</span></code></pre><h2 id="st-4" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;margin-top:20px;margin-bottom:10px;font-size:30px;">自定义collectionview</h2>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;text-indent:28px;line-height:24px;">使用xib的约束直接布局cell，cell外部公开carModel,用于赋值</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;text-indent:28px;line-height:24px;"><img src="http://upload-images.jianshu.io/upload_images/4009159-8bce682312030144.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240" alt="item布局" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:94%;" /></p>
<ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">给自定义的collectionview写一个委托，用来告诉controller当前选择cellitem</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-preprocessor" style="box-sizing:border-box;color:#880000;">#import <span class="hljs-title" style="box-sizing:border-box;font-weight:bold;">&lt;UIKit&gt;</span></span> <span class="hljs-preprocessor" style="box-sizing:border-box;color:#880000;">#import <span class="hljs-title" style="box-sizing:border-box;font-weight:bold;">"CarModel.h"</span></span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@protocol</span> <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">CarInfoCollectionViewDelegate</span> &lt;<span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">NSObject</span>&gt;</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)selectItemArray:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSArray</span>*)array WithIndex:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSInteger</span>)index;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@end</span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">CarInfoCollectionView</span> : <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">UICollectionView</span></span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span>&lt;CarModel&gt; *carModelArray;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">id</span>&lt;CarInfoCollectionViewDelegate&gt; delegate2;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@end</span></code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">界面呈现翻页效果 左右两边留上一页和下一页的边缘，需要计算停下的位置，使用<code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:12.6px;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-radius:4px;">UICollectionViewDelegate</code>代理方法</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//停下的位置</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)scrollViewWillEndDragging:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIScrollView</span> *)scrollView withVelocity:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">CGPoint</span>)velocity targetContentOffset:(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">inout</span> <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">CGPoint</span> *)targetContentOffset
{
    UICollectionViewFlowLayout *layout = (UICollectionViewFlowLayout*)<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.collectionViewLayout</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//实际滑动的距离</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">float</span> pageWidth = layout<span class="hljs-variable" style="box-sizing:border-box;">.itemSize</span><span class="hljs-variable" style="box-sizing:border-box;">.width</span> + layout<span class="hljs-variable" style="box-sizing:border-box;">.minimumLineSpacing</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//当前位置</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">float</span> currentOffset = scrollView<span class="hljs-variable" style="box-sizing:border-box;">.contentOffset</span><span class="hljs-variable" style="box-sizing:border-box;">.x</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//目标位置</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">float</span> targetOffset = targetContentOffset-&gt;x;
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">float</span> newTargetOffset = <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>;
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">int</span> count = <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>;
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (targetOffset &gt; currentOffset) {
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//向上取整</span>         count = ceilf(currentOffset / pageWidth);
        newTargetOffset = ceilf(currentOffset / pageWidth) * pageWidth;
    }<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">else</span> {
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//向下取整</span>         count = floorf(currentOffset / pageWidth);
        newTargetOffset = floorf(currentOffset / pageWidth) * pageWidth;

    }
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//处理边界</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (newTargetOffset &lt; <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span> xss=removed&gt; scrollView<span class="hljs-variable" style="box-sizing:border-box;">.contentSize</span><span class="hljs-variable" style="box-sizing:border-box;">.width</span>)
        newTargetOffset = scrollView<span class="hljs-variable" style="box-sizing:border-box;">.contentSize</span><span class="hljs-variable" style="box-sizing:border-box;">.width</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//设置目标位置指针</span>     targetContentOffset-&gt;x = currentOffset; 
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//跳转新位置</span>     [scrollView setContentOffset:CGPointMake(newTargetOffset, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>) animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>];
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">当界面滚动完成时，通过代理通知controller当前的cellitem</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;">- (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)scrollViewDidEndScrollingAnimation:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIScrollView</span> *)scrollView {
    UICollectionViewFlowLayout *layout = (UICollectionViewFlowLayout*)<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.collectionViewLayout</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//实际滑动的距离</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">int</span> pageWidth = layout<span class="hljs-variable" style="box-sizing:border-box;">.itemSize</span><span class="hljs-variable" style="box-sizing:border-box;">.width</span> + layout<span class="hljs-variable" style="box-sizing:border-box;">.minimumLineSpacing</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//当前位置</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">int</span> currentOffset = scrollView<span class="hljs-variable" style="box-sizing:border-box;">.contentOffset</span><span class="hljs-variable" style="box-sizing:border-box;">.x</span>;
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">int</span> count = currentOffset / pageWidth;

    <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSLog</span>(<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"滚完了 %d"</span>,count );
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.delegate2</span> respondsToSelector:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@selector</span>(selectItemArray:WithIndex:)]) {
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.delegate2</span> selectItemArray:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carModelArray</span> WithIndex:count];
    }
}</code></pre><h2 id="st-5" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;margin-top:20px;margin-bottom:10px;font-size:30px;">mapView</h2>
<ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">代理</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-preprocessor" style="box-sizing:border-box;color:#880000;">#import <span class="hljs-title" style="box-sizing:border-box;font-weight:bold;">&lt;UIKit&gt;</span></span> <span class="hljs-preprocessor" style="box-sizing:border-box;color:#880000;">#import <span class="hljs-title" style="box-sizing:border-box;font-weight:bold;">&lt;MapKit&gt;</span></span> <span class="hljs-preprocessor" style="box-sizing:border-box;color:#880000;">#import <span class="hljs-title" style="box-sizing:border-box;font-weight:bold;">"CarModel.h"</span></span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@protocol</span> <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">MapViewDelegate</span> &lt;<span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">NSObject</span>&gt;</span> <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//点击地图没有点到大头针</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)didSelectMapWithoutAnnotation;<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//点到大头针</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)didSelectMapAnnotationViewWithCarArray:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span>&lt;CarModel&gt;*)carArray WithIndex:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSInteger</span>)index;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@end</span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">MapView</span> : <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">UIView</span></span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span>(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">id</span>&lt;MapViewDelegate&gt; delegate;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">MKMapView</span> *map;<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//大头针数组</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span> *annotationArray;<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//car数据模型数组</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span>&lt;CarModel&gt; *carModelArray;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@end</span></code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">使用到的全局变量</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">MapView</span>()&lt;<span class="hljs-title" style="box-sizing:border-box;color:#880000;font-weight:bold;">CLLocationManagerDelegate</span>&gt;</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)CLLocationManager *locationManager;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> *currentLocationBtn;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> *zoomInBtn; <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//放大</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> *zoomOutBtn;<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//缩小</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">strong</span>)MyAnnotation *userLocationAnnotation;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@property</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">nonatomic</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">assign</span>)<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">int</span> scale;<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@end</span></code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">初始化</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//初始化</span> - (instancetype)initWithFrame:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">CGRect</span>)frame
{
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> = [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">super</span> initWithFrame:frame];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span>) {

        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carModelArray</span> = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span> array];
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> loadingMapInfo];
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> addSubview:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span>];
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> addSubview:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.currentLocationBtn</span>];
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> addSubview:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.zoomInBtn</span>];
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> addSubview:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.zoomOutBtn</span>];
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span>;
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">全局变量使用懒加载 需要提到的是当前位置的大头针的位置需要进行火星转码</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//当前位置大头针</span> - (MyAnnotation *)userLocationAnnotation {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (!_userLocationAnnotation) {
        _userLocationAnnotation = [[MyAnnotation alloc] init];
        _userLocationAnnotation<span class="hljs-variable" style="box-sizing:border-box;">.type</span> = CarTypeNone;
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//转火星坐标</span>         CLLocationCoordinate2D currentLocation = [WGS84TOGCJ02 transformFromWGSToGCJ:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.locationManager</span><span class="hljs-variable" style="box-sizing:border-box;">.location</span><span class="hljs-variable" style="box-sizing:border-box;">.coordinate</span>];
        _userLocationAnnotation<span class="hljs-variable" style="box-sizing:border-box;">.coordinate</span> = currentLocation;
        _userLocationAnnotation<span class="hljs-variable" style="box-sizing:border-box;">.title</span> = <span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"我的位置"</span>;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> _userLocationAnnotation;
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">定位当前位置和放大缩小按钮的实现</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//定位</span> - (<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> *)currentLocationBtn {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (!_currentLocationBtn) {
        _currentLocationBtn = [[<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> alloc] initWithFrame:CGRectMake(<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>, CGRectGetHeight(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.frame</span>)*<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.6</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">50</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">50</span>)];
        [_currentLocationBtn setImage:[<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"location_my.png"</span>] forState:UIControlStateNormal];
        [_currentLocationBtn addTarget:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> action:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@selector</span>(clickCurrentBtn) forControlEvents:UIControlEventTouchUpInside];
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> _currentLocationBtn;
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//点击定位</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)clickCurrentBtn {
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> deselectAnnotation:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.userLocationAnnotation</span> animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">NO</span>];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> selectAnnotation:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.userLocationAnnotation</span> animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>];
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//放大</span> - (<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> *)zoomInBtn {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (!_zoomInBtn) {
        _zoomInBtn = [[<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> alloc] initWithFrame:CGRectMake(CGRectGetWidth(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.frame</span>)-<span class="hljs-number" style="box-sizing:border-box;color:#008800;">60</span>, CGRectGetHeight(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.frame</span>)*<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.55</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">50</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">50</span>)];
        [_zoomInBtn setImage:[<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"zoomin.png"</span>] forState:UIControlStateNormal];
        [_zoomInBtn addTarget:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> action:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@selector</span>(mapZoomIn) forControlEvents:UIControlEventTouchUpInside];
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> _zoomInBtn;
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//放大方法</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)mapZoomIn {
    MKCoordinateRegion region = <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span><span class="hljs-variable" style="box-sizing:border-box;">.region</span>;
    region<span class="hljs-variable" style="box-sizing:border-box;">.span</span><span class="hljs-variable" style="box-sizing:border-box;">.latitudeDelta</span> = region<span class="hljs-variable" style="box-sizing:border-box;">.span</span><span class="hljs-variable" style="box-sizing:border-box;">.latitudeDelta</span> * <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.5</span>;
    region<span class="hljs-variable" style="box-sizing:border-box;">.span</span><span class="hljs-variable" style="box-sizing:border-box;">.longitudeDelta</span> = region<span class="hljs-variable" style="box-sizing:border-box;">.span</span><span class="hljs-variable" style="box-sizing:border-box;">.longitudeDelta</span> * <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.5</span>;
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> setRegion:region animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>];
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//缩小</span> - (<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> *)zoomOutBtn {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (!_zoomOutBtn) {
        _zoomOutBtn = [[<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIButton</span> alloc] initWithFrame:CGRectMake(CGRectGetWidth(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.frame</span>)-<span class="hljs-number" style="box-sizing:border-box;color:#008800;">60</span>, CGRectGetMaxY(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.zoomInBtn</span><span class="hljs-variable" style="box-sizing:border-box;">.frame</span>), <span class="hljs-number" style="box-sizing:border-box;color:#008800;">50</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">50</span>)];
        [_zoomOutBtn setImage:[<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"zoomout.png"</span>] forState:UIControlStateNormal];
        [_zoomOutBtn addTarget:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> action:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@selector</span>(mapZoomOut) forControlEvents:UIControlEventTouchUpInside];
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> _zoomOutBtn;
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//缩小方法</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)mapZoomOut {
    MKCoordinateRegion region = <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span><span class="hljs-variable" style="box-sizing:border-box;">.region</span>;
    region<span class="hljs-variable" style="box-sizing:border-box;">.span</span><span class="hljs-variable" style="box-sizing:border-box;">.latitudeDelta</span> = region<span class="hljs-variable" style="box-sizing:border-box;">.span</span><span class="hljs-variable" style="box-sizing:border-box;">.latitudeDelta</span> * <span class="hljs-number" style="box-sizing:border-box;color:#008800;">2</span>;
    region<span class="hljs-variable" style="box-sizing:border-box;">.span</span><span class="hljs-variable" style="box-sizing:border-box;">.longitudeDelta</span> = region<span class="hljs-variable" style="box-sizing:border-box;">.span</span><span class="hljs-variable" style="box-sizing:border-box;">.longitudeDelta</span> * <span class="hljs-number" style="box-sizing:border-box;color:#008800;">2</span>;
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> setRegion:region animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>];
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">授权使用定位功能 info.plist上添加<code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:12.6px;padding:2px 4px;color:#c7254e;background-color:#f9f2f4;border-radius:4px;">Privacy - Location Always Usage Description</code>&nbsp;值随便填</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//获取授权</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)getAuthorization {
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//获取授权状态</span>     CLAuthorizationStatus status = [CLLocationManager authorizationStatus];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (status == kCLAuthorizationStatusNotDetermined) {
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.locationManager</span> requestAlwaysAuthorization];
    } <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">else</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (status == kCLAuthorizationStatusAuthorizedAlways) {
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//不跟随用户</span>         <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span><span class="hljs-variable" style="box-sizing:border-box;">.userTrackingMode</span> = MKUserTrackingModeNone;
    }
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//授权后进入</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)locationManager:(CLLocationManager *)manager didChangeAuthorizationStatus:(CLAuthorizationStatus)status{ 
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//授权后开始定位</span>     [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.locationManager</span> startUpdatingLocation];
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//加载地图信息</span>     [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> loadData];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> loadingMapInfo];
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">公开变量设置set方法用于刷新地图大头针信息</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//set方法</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)setCarModelArray:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span>&lt;CarModel&gt; *)carModelArray {

    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">for</span> (MyAnnotation *an <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">in</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span><span class="hljs-variable" style="box-sizing:border-box;">.annotations</span>) {
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (an<span class="hljs-variable" style="box-sizing:border-box;">.type</span> != CarTypeNone) {
            [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> removeAnnotation:an];
        }
    }
    [_carModelArray removeAllObjects];
    _carModelArray = carModelArray;

    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//重新加载数据</span>     [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> loadData];
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//加载模拟数据</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)loadData {

    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.annotationArray</span> removeAllObjects];
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//完善model数据</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">for</span> (CarModel *model <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">in</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carModelArray</span>) {
        CLGeocoder *coder = [[CLGeocoder alloc] init];
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//model中的位置</span>         CLLocation *location = [[CLLocation alloc] initWithLatitude:[model<span class="hljs-variable" style="box-sizing:border-box;">.location</span>[<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"lat"</span>] doubleValue] longitude:[model<span class="hljs-variable" style="box-sizing:border-box;">.location</span>[<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"long"</span>] doubleValue]];
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//反地理编码 获得 经纬度 对应的 地名 并计算与当前位置的距离</span>         [coder reverseGeocodeLocation:location completionHandler:^(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSArray</span>&lt;CLPlacemark&gt; * _Nullable placemarks, <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSError</span> * _Nullable error) {
            CLPlacemark *mark = [placemarks firstObject];
            CLLocationCoordinate2D locatio = [WGS84TOGCJ02 transformFromWGSToGCJ:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.locationManager</span><span class="hljs-variable" style="box-sizing:border-box;">.location</span><span class="hljs-variable" style="box-sizing:border-box;">.coordinate</span>];
            CLLocation *currentLocation =  [[CLLocation alloc] initWithLatitude:locatio<span class="hljs-variable" style="box-sizing:border-box;">.latitude</span> longitude:locatio<span class="hljs-variable" style="box-sizing:border-box;">.longitude</span>];
            CLLocationDistance dis = [location distanceFromLocation:currentLocation];

            model<span class="hljs-variable" style="box-sizing:border-box;">.locationName</span> = mark<span class="hljs-variable" style="box-sizing:border-box;">.name</span>;
            model<span class="hljs-variable" style="box-sizing:border-box;">.distance</span> = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> stringWithFormat:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"%.2fkm"</span>,dis/<span class="hljs-number" style="box-sizing:border-box;color:#008800;">1000</span>];
        }];
    }

    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">int</span> count = <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//加载大头针</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">for</span> (CarModel *model <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">in</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carModelArray</span>) {

        MyAnnotation *annotation = [[MyAnnotation alloc] init];
        CLLocationCoordinate2D location = CLLocationCoordinate2DMake([model<span class="hljs-variable" style="box-sizing:border-box;">.location</span>[<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"lat"</span>] doubleValue], [model<span class="hljs-variable" style="box-sizing:border-box;">.location</span>[<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"long"</span>] doubleValue]);
        annotation<span class="hljs-variable" style="box-sizing:border-box;">.coordinate</span> = location;
        annotation<span class="hljs-variable" style="box-sizing:border-box;">.index</span> = count;
        annotation<span class="hljs-variable" style="box-sizing:border-box;">.type</span> = [model<span class="hljs-variable" style="box-sizing:border-box;">.carType</span> intValue];
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> addAnnotation:annotation];
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.annotationArray</span> addObject:annotation];
        count++;
    }
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">mapview自身的代理方法，点击和取消大头针，实现回调跳转车辆信息view</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-preprocessor" style="box-sizing:border-box;color:#880000;">#pragma mark - MKMapViewDelegate</span> <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//点击大头针</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)mapView:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">MKMapView</span> *)mapView didSelectAnnotationView:(MKAnnotationView *)view {
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//重置汽车原来的颜色</span>     <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSArray</span> *array = [mapView annotations];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">for</span> (MyAnnotation *an <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">in</span> array) {
        MKAnnotationView *v = [mapView viewForAnnotation:an];
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([v<span class="hljs-variable" style="box-sizing:border-box;">.reuseIdentifier</span> isEqualToString:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"carViewID"</span>]) {
            v<span class="hljs-variable" style="box-sizing:border-box;">.image</span> = [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> getCarImageWithTypeInAnnotation:an];
        }
    }
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//点击小车换颜色</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([view<span class="hljs-variable" style="box-sizing:border-box;">.reuseIdentifier</span> isEqualToString:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"carViewID"</span>]) {
        view<span class="hljs-variable" style="box-sizing:border-box;">.image</span> = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"pickcar.png"</span>];
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//代理回调 通知界面 将 carInfoView 出现 carPickView消失</span>         <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.delegate</span> respondsToSelector:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@selector</span>(didSelectMapAnnotationViewWithCarArray:WithIndex:)]) {
            [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.delegate</span> didSelectMapAnnotationViewWithCarArray:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carModelArray</span> WithIndex:((MyAnnotation*)view<span class="hljs-variable" style="box-sizing:border-box;">.annotation</span>)<span class="hljs-variable" style="box-sizing:border-box;">.index</span>];
        }
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//设置中心点和范围</span>         [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> setRegion:MKCoordinateRegionMakeWithDistance(((MyAnnotation*)view<span class="hljs-variable" style="box-sizing:border-box;">.annotation</span>)<span class="hljs-variable" style="box-sizing:border-box;">.coordinate</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">2000</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">2000</span>) animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">NO</span>];

    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">else</span> {
        [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> setRegion:MKCoordinateRegionMakeWithDistance(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.userLocationAnnotation</span><span class="hljs-variable" style="box-sizing:border-box;">.coordinate</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">2000</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">2000</span>) animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>];
    }
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//没有选中大头针</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)mapView:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">MKMapView</span> *)mapView didDeselectAnnotationView:(MKAnnotationView *)view {
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//重置汽车原来的颜色</span>     <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSArray</span> *array = [mapView annotations];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">for</span> (MyAnnotation *an <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">in</span> array) {
        MKAnnotationView *v = [mapView viewForAnnotation:an];
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([v<span class="hljs-variable" style="box-sizing:border-box;">.reuseIdentifier</span> isEqualToString:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"carViewID"</span>]) {
            v<span class="hljs-variable" style="box-sizing:border-box;">.image</span> = [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> getCarImageWithTypeInAnnotation:an];
        }
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([view<span class="hljs-variable" style="box-sizing:border-box;">.reuseIdentifier</span> isEqualToString:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"carViewID"</span>]) {
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//代理回调 通知界面 将 carInfoView 消失 carPickView出现 小车变为未选中</span>         <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.delegate</span> respondsToSelector:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@selector</span>(didSelectMapWithoutAnnotation)]) {
            [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.delegate</span> didSelectMapWithoutAnnotation];
        }
    }
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">自定义大头针 当前位置使用标注 其他位置使用自定义的大头针视图</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;"><span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//当前位置大头针</span> - (MKPinAnnotationView*)customLocalAnnotationView:(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">id</span>&lt;MKAnnotation&gt;)annotation {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">static</span> <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *locationID = <span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"locationViewID"</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//从缓存池中获取大头针</span>     MKPinAnnotationView *pinView = ( MKPinAnnotationView *)[<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> dequeueReusableAnnotationViewWithIdentifier:locationID];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (pinView == <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">nil</span>) {
        pinView  = [[MKPinAnnotationView alloc] initWithAnnotation:annotation reuseIdentifier:locationID];
    }
    pinView<span class="hljs-variable" style="box-sizing:border-box;">.annotation</span> = annotation;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">// 取消气泡显示</span>     pinView<span class="hljs-variable" style="box-sizing:border-box;">.canShowCallout</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">// 设置大头针是否有下落动画</span>     pinView<span class="hljs-variable" style="box-sizing:border-box;">.animatesDrop</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>;
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> pinView;

}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//自定义大头针</span> - (MKAnnotationView*)customMKAnnotationView:(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">id</span>&lt;MKAnnotation&gt;)annotation {
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//自定义大头针</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">static</span> <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *carViewID = <span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"carViewID"</span>;
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//从缓存池中获取自定义大头针</span>     MKAnnotationView *annoView = [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> dequeueReusableAnnotationViewWithIdentifier:carViewID];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (annoView == <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">nil</span>) {
        <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//缓存池中没有则创建</span>         annoView = [[MKAnnotationView alloc] initWithAnnotation:annotation reuseIdentifier:carViewID];
    }
    annoView<span class="hljs-variable" style="box-sizing:border-box;">.annotation</span> = annotation;
    annoView<span class="hljs-variable" style="box-sizing:border-box;">.canShowCallout</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">NO</span>;
    annoView<span class="hljs-variable" style="box-sizing:border-box;">.draggable</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>;
    annoView<span class="hljs-variable" style="box-sizing:border-box;">.image</span> = [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> getCarImageWithTypeInAnnotation:annotation];
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> annoView;
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//根据大头针的类型返回图片</span> - (<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> *)getCarImageWithTypeInAnnotation:(MyAnnotation*)annotation {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">switch</span> (annotation<span class="hljs-variable" style="box-sizing:border-box;">.type</span>) {
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">case</span> CarTypeDaily:
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span>  [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"dailycar.png"</span>];
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">break</span>;
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">case</span> CarTypeHourly:
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"hourlycar.png"</span>];
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">break</span>;
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">case</span> CarTypeLong:
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"longcar.png"</span>];
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">break</span>;
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">case</span> CarTypeTestDrive:
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"testcar.png"</span>];
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">break</span>;
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">default</span>:
            <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">break</span>;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">nil</span>;
}</code></pre><h2 id="st-6" style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;margin-top:20px;margin-bottom:10px;font-size:30px;">viewController主界面</h2>
<ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">将三个视图定义为全局 并使用懒加载 collectionView使用流水布局，为显示翻页效果需要配合增加头尾空白</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;">- (CarInfoCollectionView *)collectionView {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (!_collectionView) {
        UICollectionViewFlowLayout *layout = [[UICollectionViewFlowLayout alloc] init];
        layout<span class="hljs-variable" style="box-sizing:border-box;">.itemSize</span> = CGSizeMake(kScreenWidth * <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.85</span>, kScreenHeight*<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.2</span>);
        layout<span class="hljs-variable" style="box-sizing:border-box;">.minimumLineSpacing</span> = kScreenWidth * <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.05</span>;

        <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">CGFloat</span> referenceWidth = (kScreenWidth - layout<span class="hljs-variable" style="box-sizing:border-box;">.itemSize</span><span class="hljs-variable" style="box-sizing:border-box;">.width</span> - <span class="hljs-number" style="box-sizing:border-box;color:#008800;">2</span>*layout<span class="hljs-variable" style="box-sizing:border-box;">.minimumLineSpacing</span>)/<span class="hljs-number" style="box-sizing:border-box;color:#008800;">2</span> + layout<span class="hljs-variable" style="box-sizing:border-box;">.minimumLineSpacing</span>;

        layout<span class="hljs-variable" style="box-sizing:border-box;">.headerReferenceSize</span> = CGSizeMake(referenceWidth, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>);
        layout<span class="hljs-variable" style="box-sizing:border-box;">.footerReferenceSize</span> = CGSizeMake(referenceWidth, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>);
        layout<span class="hljs-variable" style="box-sizing:border-box;">.scrollDirection</span> = UICollectionViewScrollDirectionHorizontal;
        _collectionView = [[CarInfoCollectionView alloc] initWithFrame:CGRectMake(<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>, kScreenHeight*<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.8</span>, <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.view</span><span class="hljs-variable" style="box-sizing:border-box;">.frame</span><span class="hljs-variable" style="box-sizing:border-box;">.size</span><span class="hljs-variable" style="box-sizing:border-box;">.width</span>, kScreenHeight*<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.2</span>) collectionViewLayout:layout];
        _collectionView<span class="hljs-variable" style="box-sizing:border-box;">.hidden</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>;
        _collectionView<span class="hljs-variable" style="box-sizing:border-box;">.delegate2</span> = <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span>;

    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> _collectionView;
}</code></pre><pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;">- (MapView *)mapView {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (!_mapView) {
        _mapView = [[MapView alloc] initWithFrame:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.view</span><span class="hljs-variable" style="box-sizing:border-box;">.bounds</span>];
        _mapView<span class="hljs-variable" style="box-sizing:border-box;">.delegate</span> = <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span>;
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> _mapView;
}

- (CustomSlider *)carPickView {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> (!_carPickView) {
        _carPickView = [[CustomSlider alloc] initWithFrame:CGRectMake(<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>, kScreenHeight*<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.8</span>, kScreenWidth, kScreenHeight*<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0.2</span>)];
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.backgroundColor</span> = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIColor</span> whiteColor];
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.sliderBarHeight</span> = <span class="hljs-number" style="box-sizing:border-box;color:#008800;">10</span>;
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.numberOfPart</span> = <span class="hljs-number" style="box-sizing:border-box;color:#008800;">4</span>;
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.partColor</span> = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIColor</span> grayColor];
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.sliderColor</span> = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIColor</span> grayColor];
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.thumbImage</span> = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">UIImage</span> imageNamed:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"yuanxing.png"</span>];
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.partNameOffset</span> = CGPointMake(<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>, -<span class="hljs-number" style="box-sizing:border-box;color:#008800;">30</span>);
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.thumbSize</span> = CGSizeMake(<span class="hljs-number" style="box-sizing:border-box;color:#008800;">50</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">50</span>);
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.partSize</span> = CGSizeMake(<span class="hljs-number" style="box-sizing:border-box;color:#008800;">20</span>, <span class="hljs-number" style="box-sizing:border-box;color:#008800;">20</span>);
        _carPickView<span class="hljs-variable" style="box-sizing:border-box;">.partNameArray</span> = @[<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"日租"</span>,<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"时租"</span>,<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"长租"</span>,<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"试驾"</span>];
        [_carPickView addTarget:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> action:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">@selector</span>(valuechange:) forControlEvents:UIControlEventValueChanged];
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span>  _carPickView;
}

- (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)viewDidLoad {
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">super</span> viewDidLoad];

    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.view</span> addSubview:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.mapView</span>];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.view</span> addSubview:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.collectionView</span>];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.view</span> addSubview:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carPickView</span>];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> valuechange:<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carPickView</span>];
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">从plist中加载数据</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;">- (<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span>&lt;CarModel&gt; *) selectCarWithType:(CarType)type {
    <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span> *resultArray = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span> array];
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//读取数据</span>     <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSString</span> *path = [[<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSBundle</span> mainBundle] pathForResource:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"1"</span> ofType:<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"plist"</span>];
    <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSArray</span> *array = [<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSArray</span> arrayWithContentsOfFile:path];

    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//存数据</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">for</span> (<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSDictionary</span> *dict <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">in</span> array) {
        CarModel *model = [CarModel carModelWithDict:dict];
        <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">if</span> ([model<span class="hljs-variable" style="box-sizing:border-box;">.carType</span> intValue] == type) {
            [resultArray addObject:model];
        }
    }
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">return</span> resultArray;
}</code></pre><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;"><li style="box-sizing:border-box;">实现各种委托方法</li>
</ul>
<pre style="box-sizing:border-box;overflow:auto;font-family:Menlo, Monaco, Consolas, 'Courier New', monospace;font-size:13px;padding:9.5px;margin-top:0px;margin-bottom:10px;line-height:1.42857;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #cccccc;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:4px;border-bottom-left-radius:4px;"><code class="hljs objectivec" style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0.5em;color:black;background:#f0f0f0;border-radius:0px;white-space:pre-wrap;display:block;overflow-x:auto;text-size-adjust:none;">- (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)valuechange:(CustomSlider*)sender {
    <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSLog</span>(<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"%ld"</span>,(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">long</span>)sender<span class="hljs-variable" style="box-sizing:border-box;">.value</span>);
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.mapView</span><span class="hljs-variable" style="box-sizing:border-box;">.carModelArray</span> = [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span> selectCarWithType:sender<span class="hljs-variable" style="box-sizing:border-box;">.value</span>];
    <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSLog</span>(<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"%@"</span>,<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.mapView</span><span class="hljs-variable" style="box-sizing:border-box;">.carModelArray</span>);
}

- (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)didReceiveMemoryWarning {
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">super</span> didReceiveMemoryWarning];
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">// Dispose of any resources that can be recreated.</span> }<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//collectionview 滚动结束后 调用</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)selectItemArray:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSArray</span> *)array WithIndex:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSInteger</span>)index {

    MyAnnotation *an = <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.mapView</span><span class="hljs-variable" style="box-sizing:border-box;">.annotationArray</span>[index];
    [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.mapView</span><span class="hljs-variable" style="box-sizing:border-box;">.map</span> selectAnnotation:an animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>];

}<span class="hljs-preprocessor" style="box-sizing:border-box;color:#880000;">#pragma mark - mapViewDelegate</span> <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//点击地图没有点到大头针</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)didSelectMapWithoutAnnotation {
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carPickView</span><span class="hljs-variable" style="box-sizing:border-box;">.hidden</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">NO</span>;
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.collectionView</span><span class="hljs-variable" style="box-sizing:border-box;">.hidden</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>;
}<span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//点到大头针</span> - (<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">void</span>)didSelectMapAnnotationViewWithCarArray:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSMutableArray</span>&lt;CarModel&gt; *)carArray WithIndex:(<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSInteger</span>)index {

    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.collectionView</span><span class="hljs-variable" style="box-sizing:border-box;">.carModelArray</span> = carArray;
    <span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSLog</span>(<span class="hljs-string" style="box-sizing:border-box;color:#880000;">@"cararraycoutn =  %lu"</span>,(<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">unsigned</span> <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">long</span>)carArray<span class="hljs-variable" style="box-sizing:border-box;">.count</span>);
    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//跳转到选择的车辆信息</span>     [<span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.collectionView</span> selectItemAtIndexPath:[<span class="hljs-built_in" style="box-sizing:border-box;font-weight:bold;">NSIndexPath</span> indexPathForItem:index inSection:<span class="hljs-number" style="box-sizing:border-box;color:#008800;">0</span>] animated:<span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span> scrollPosition:UICollectionViewScrollPositionCenteredHorizontally];

    <span class="hljs-comment" style="box-sizing:border-box;color:#888888;">//出现车辆信息动画</span>     <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.carPickView</span><span class="hljs-variable" style="box-sizing:border-box;">.hidden</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">YES</span>;
    <span class="hljs-keyword" style="box-sizing:border-box;font-weight:bold;">self</span><span class="hljs-variable" style="box-sizing:border-box;">.collectionView</span><span class="hljs-variable" style="box-sizing:border-box;">.hidden</span> = <span class="hljs-literal" style="box-sizing:border-box;color:#008800;">NO</span>; 
}</code></pre><h1 id="st-7" style="box-sizing:border-box;margin:20px 0px 10px;font-size:36px;font-family:inherit;font-weight:500;line-height:1.1;color:inherit;">demo地址</h1>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;text-indent:28px;line-height:24px;"><a href="https://github.com/gongxiaokai/EasyCarDemo" target="_blank" style="box-sizing:border-box;background-color:transparent;color:#eb6100;text-decoration:none;margin:0px;padding:0px;">https://github.com/gongxiaokai/EasyCarDemo</a>&nbsp;简书地址<a href="http://www.jianshu.com/users/7897b0bd4a55/latest_articles" target="_blank" style="box-sizing:border-box;background-color:transparent;color:#eb6100;text-decoration:none;margin:0px;padding:0px;">http://www.jianshu.com/users/7897b0bd4a55/latest_articles</a></p>
</div>
</div></body></html>