<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2016-10-14T11:47:21Z"/><meta name="updated" content="2016-10-14T11:47:23Z"/><title> iOS 事件响应链详解（The Responder Chain)    标签： iosPointInsid响应链  2015-10-16 12:17 740人阅读 评论(0) 收藏 举报     </title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div class="article_title" style="margin-bottom:21px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;">&nbsp;<h1 style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;font-size:18px;"><span class="link_title"><a href="http://blog.csdn.net/hello_hwc/article/details/49176867" style="text-decoration:none;color:#000000;">iOS 事件响应链详解（The Responder Chain)</a></span></h1>
</div>
<div class="article_manage clearfix" style="color:#999999;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;font-size:12px;line-height:22px;font-family:Arial;text-align:right;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ededed;margin:0px -20px 10px;padding:0px 20px 5px;overflow:hidden;widows:1;"><div class="article_l" style="width:948px;float:left;"><span class="link_categories" style="margin:0px 0px 0px 5px;float:left;">标签：&nbsp;<a href="http://www.csdn.net/tag/ios" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">ios</a><a href="http://www.csdn.net/tag/PointInsid" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">PointInsid</a><a href="http://www.csdn.net/tag/%e5%93%8d%e5%ba%94%e9%93%be" target="_blank" style="text-decoration:none;display:inline-block;margin-right:10px;color:#c88326;">响应链</a></span></div>
<div class="article_r"><span class="link_postdate" style="margin:0px 16px 0px 0px;">2015-10-16 12:17</span>&nbsp;<span class="link_view" title="阅读次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 24px;display:inline-block;background:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon.png) 0px -25px no-repeat;">740人阅读</span>&nbsp;<span class="link_comments" title="评论次数" style="margin:0px 16px 0px 5px;padding:0px 0px 0px 17px;display:inline-block;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-attachment:initial;background-color:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:0px -43px;background-repeat:no-repeat;"><a href="http://blog.csdn.net/Hello_Hwc/article/details/49176867#comments" style="text-decoration:none;color:#c88326;">评论</a>(0)</span>&nbsp;<span class="link_collect tracking-ad" data-mod="popu_171" style="margin:0px 16px 0px 5px;display:inline-block;padding-left:17px;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-position:0px -62px;background-repeat:no-repeat;"><a title="收藏" target="_blank" style="color:#c88326;">收藏</a></span>&nbsp;<span class="link_report" style="margin:0px 16px 0px 5px;display:inline-block;padding-left:17px;background-image:url(http://static.blog.csdn.net/skin/skin-yellow/images/skin-type-icon-yellow.png) !important;background-position:0px -81px;background-repeat:no-repeat;"><a href="http://blog.csdn.net/Hello_Hwc/article/details/49176867#report" title="举报" style="text-decoration:none;color:#c88326;">举报</a></span></div>
</div>
<div class="category clearfix" style="margin:0px -20px;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ededed;padding:5px 20px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;"><div class="category_l" style="display:inline-block;font-size:14px;color:#333333;width:70px;float:left;line-height:28px;"><img src="http://static.blog.csdn.net/images/category_icon.jpg" style="border:none;vertical-align:middle;" />&nbsp;<span style="display:inline-block;vertical-align:middle;">分类：</span></div>
<div class="category_r" style="display:inline-block;font-size:14px;color:#df3434;float:left;width:853.188px;"><label style="display:inline-block;margin-left:15px;cursor:pointer;line-height:28px;position:relative;">iOS Foundation（13）&nbsp;<img class="arrow-down" src="http://static.blog.csdn.net/images/arrow_triangle%20_down.jpg" style="border:none;display:inline;" /></label></div>
</div>
<div class="bog_copyright" style="padding:20px 0px;font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;"><p class="copyright_p" style="margin-top:0px;margin-bottom:0px;padding:0px 0px 0px 10px;height:14px;line-height:14px;border-left-style:solid;border-left-width:3px;border-left-color:#e41c1e;color:#666666;font-size:14px;">版权声明：本文为博主原创文章，如需转载请注明出处</p>
</div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;clear:both;"></div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;border:1px solid #cccccc;float:left;min-width:200px;padding:4px 10px;background-color:#eeeeee;background-position:initial initial;background-repeat:initial initial;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;text-align:right;"><span style="float:left;">目录<a href="http://blog.csdn.net/Hello_Hwc/article/details/49176867#" title="系统根据文章中H1到H6标签自动生成文章目录" style="text-decoration:none;">(?)</a></span><a href="http://blog.csdn.net/Hello_Hwc/article/details/49176867#" title="展开" style="text-decoration:none;">[+]</a></p>
</div>
<div style="font-family:'microsoft yahei';font-size:12px;font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;line-height:normal;widows:1;clear:both;"></div>
<div id="article_content" class="article_content" style="margin:35px 0px;font-size:15px;color:#555555;line-height:35px;font-family:'microsoft yahei';font-variant-ligatures:normal;font-variant-position:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-variant-east-asian:normal;widows:1;"><div class="markdown_views" style="font-size:14px;"><p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">原创Blog，转载请注明出处&nbsp;<br style="box-sizing:border-box;" />
<a href="http://blog.csdn.net/hello_hwc?viewmode=list" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;">http://blog.csdn.net/hello_hwc?viewmode=list</a>&nbsp;<br style="box-sizing:border-box;" />
我的stackoverflow</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><a href="http://stackexchange.com/users/4889039/leo" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;"><img src="http://stackexchange.com/users/flair/4889039.png" width="208" height="58" alt="profile for Leo on Stack Exchange, a network of free, community-driven Q&amp;A sites" title="profile for Leo on Stack Exchange, a network of free, community-driven Q&amp;A sites" style="border:none;box-sizing:border-box;" /></a></p>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">前言：在iOS编程中，经常会有复杂的时间view嵌套，例如uitableviewcell中嵌套复杂的视图。这时候的touch事件的响应者就十分重要。在这篇之前写的<a href="http://blog.csdn.net/hello_hwc/article/details/48676179" style="text-decoration:none;box-sizing:border-box;color:#0c89cf;">基础文章</a>中,我简单讲解了iOS中的事件种类，本文侧重以touch为例，讲解touch的传递。</p>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="触摸事件的响应者" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t0" style="box-sizing:border-box;color:#0c89cf;"></a>触摸事件的响应者</h2>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">window对象总会尝试把响应者设为touch产生的view，通过hit－test来判断。Touch事件会沿着第一响应者（Fist Responder）一直传递到UI Application,如果到最后也不能响应，则被抛弃。</p>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">系统如何通过hit-test找到Fist Responder的View&nbsp;<br style="box-sizing:border-box;" />
举个例子&nbsp;<br style="box-sizing:border-box;" />
点击如图的viewD&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20151008102528397" width="300" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" />&nbsp;<br style="box-sizing:border-box;" />
通过hit－test来判断触摸在那个view的顺序如下</p>
<ol style="box-sizing:border-box;"><li style="box-sizing:border-box;">Touch在ViewA的bounds中，递归检查ViewB和ViewC</li>
<li style="box-sizing:border-box;">Touch不在ViewB的bounds中，检查ViewC</li>
<li style="box-sizing:border-box;">Touch在ViewC的bounds中，检查ViewD和ViewE</li>
<li style="box-sizing:border-box;">Touch不在ViewD中，检查ViewE</li>
<li style="box-sizing:border-box;">Touch在ViewE中，所以ViewE为hit－test的结果</li>
</ol>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">每一次hit－test通过两个函数实现。&nbsp;<br style="box-sizing:border-box;" />
调用pointInside:withEvent: 返回改触摸点是否在View中，hitTest:withEvent:返回触摸点所在的View，然后递归检查起subview</p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><span style="box-sizing:border-box;color:red;">所以，可以通过重写pointInside:withEvent来限制一个View的部分区域响应视图,关于这个，最后我会写个例子。</span></p>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">Touch事件的传递顺序</p>
<blockquote style="box-sizing:border-box;margin:0px 0px 1.1em;padding:15px 20px;border-left-width:10px;border-left-style:solid;border-left-color:rgba(128, 128, 128, 0.0745098);border-radius:0px 5px 5px 0px;background-color:rgba(128, 128, 128, 0.0470588);"><p style="margin-top:0px;margin-bottom:0px;padding:0px;box-sizing:border-box;line-height:1.25;">注意，只有UIResponer的子类可以处理Touch事件，包括 UIApplication, UIViewController,和 UIView及其子类。</p>
</blockquote>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;"><img src="http://img.blog.csdn.net/20151015192629414" alt="这里写图片描述" title="" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<ol style="box-sizing:border-box;"><li style="box-sizing:border-box;">首先由View尝试处理，不能处理，则传递给Superview</li>
<li style="box-sizing:border-box;">SuperView不能处理，继续传递给SuperView</li>
<li style="box-sizing:border-box;">因为SuperView是ViewController的根视图，则传递给ViewController</li>
<li style="box-sizing:border-box;">ViewController不能处理，重复1，2，直到到达UIWindow</li>
<li style="box-sizing:border-box;">Window不能处理，传递给UIApplication</li>
<li style="box-sizing:border-box;">抛弃</li>
</ol>
<hr style="box-sizing:border-box;margin:2em 0px;border-right-width:0px;border-bottom-width:0px;border-left-width:0px;border-top-style:solid;border-top-color:rgba(128, 128, 128, 0.0980392);" />
<h2 id="重写pointinside的一个例子" style="margin:0.8em 0px;padding:0px;box-sizing:border-box;font-weight:100;"><a name="t1" style="box-sizing:border-box;color:#0c89cf;"></a>重写PointInside的一个例子</h2>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">在右下角加一个不规则Button，注意，不能只设置背景色或者mask，因为button是矩形，button的响应区域也是矩形。这时候重写pointInside就有用了。&nbsp;<br style="box-sizing:border-box;" />
<img src="http://img.blog.csdn.net/20151016121505442" width="200" style="border:none;box-sizing:border-box;max-width:602px;height:auto;" /></p>
<p style="margin-top:0px;margin-bottom:1.1em;padding:0px;box-sizing:border-box;">代码&nbsp;<br style="box-sizing:border-box;" />
为了方便，使用了hard-code 数字</p>
<pre class="prettyprint" name="code" style="white-space:nowrap;word-wrap:break-word;box-sizing:border-box;position:relative;overflow-y:hidden;overflow-x:auto;margin-top:0px;margin-bottom:1.1em;font-family:'Source Code Pro', monospace;padding:5px 5px 5px 60px;line-height:1.45;word-break:break-all;color:#333333;border:1px solid rgba(128, 128, 128, 0.0745098);border-top-left-radius:0px;border-top-right-radius:0px;border-bottom-right-radius:0px;border-bottom-left-radius:0px;background-color:rgba(128, 128, 128, 0.0470588);"><code class="hljs objectivec has-numbering" style="display:block;padding:0px;color:inherit;box-sizing:border-box;font-family:'Source Code Pro', monospace;font-size:inherit;white-space:pre;border-radius:0px;word-wrap:normal;background:transparent;"><span class="hljs-preprocessor" style="color:#444444;box-sizing:border-box;">#import <span class="hljs-title" style="box-sizing:border-box;">"CustomButton.h"</span></span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@interface</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">CustomButton</span> ()</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@property</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">strong</span>,<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">nonatomic</span>)CAShapeLayer * shapeLayer;<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@end</span> <span class="hljs-class" style="box-sizing:border-box;"><span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@implementation</span> <span class="hljs-title" style="box-sizing:border-box;color:#660066;">CustomButton</span></span> -(instancetype)initWithCoder:(NSCoder *)aDecoder{
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> = [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> initWithCoder:aDecoder]) {
        [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span> setUp];
    }
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span>;
}
-(<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">void</span>)setUp{
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.shapeLayer</span> = [CAShapeLayer layer];
    CGMutablePathRef path = CGPathCreateMutable();
    CGPathMoveToPoint(path, <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">nil</span>,<span class="hljs-number" style="color:#006666;box-sizing:border-box;">100</span>, <span class="hljs-number" style="color:#006666;box-sizing:border-box;">0</span>);
    CGPathAddLineToPoint(path, <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">nil</span>,<span class="hljs-number" style="color:#006666;box-sizing:border-box;">100</span>,<span class="hljs-number" style="color:#006666;box-sizing:border-box;">100</span>);
    CGPathAddLineToPoint(path, <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">nil</span>,<span class="hljs-number" style="color:#006666;box-sizing:border-box;">0</span>, <span class="hljs-number" style="color:#006666;box-sizing:border-box;">100</span>);
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.shapeLayer</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.path</span> = path;
    [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.layer</span> setMask:<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.shapeLayer</span>];
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.layer</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.masksToBounds</span> = <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">true</span>;
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.backgroundColor</span> = [<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">UIColor</span> lightGrayColor];
}
-(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">BOOL</span>)pointInside:(<span class="hljs-built_in" style="color:#660066;box-sizing:border-box;">CGPoint</span>)point withEvent:(UIEvent *)event{
    <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">if</span> (CGPathContainsPoint(<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">self</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.shapeLayer</span><span class="hljs-variable" style="color:#660066;box-sizing:border-box;">.path</span>, <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">nil</span>, point, <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">true</span>)) {
        <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> [<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">super</span> pointInside:point withEvent:event];
    }<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">else</span>{
        <span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">return</span> <span class="hljs-literal" style="color:#006666;box-sizing:border-box;">false</span>;
    }
}<span class="hljs-keyword" style="color:#000088;box-sizing:border-box;">@end</span></code></pre></div>
</div></body></html>