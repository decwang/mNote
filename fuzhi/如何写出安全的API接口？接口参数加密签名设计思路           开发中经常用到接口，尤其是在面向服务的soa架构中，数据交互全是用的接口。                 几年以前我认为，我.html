<?xml version="1.0" encoding="UTF-8" standalone="no"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content=mNote Mac 2.5.11"/><meta name="created" content="2016-12-28T10:42:38Z"/><meta name="updated" content="2016-12-28T10:42:53Z"/><title>如何写出安全的API接口？接口参数加密签名设计思路           开发中经常用到接口，尤其是在面向服务的soa架构中，数据交互全是用的接口。                 几年以前我认为，我</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><h1 class="postTitle" style="margin:0px 0px 20px;padding:0px;font-size:28px;font-weight:400;line-height:1.8;color:#333333;font-family:Verdana, Arial, Helvetica, sans-serif;"><a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/codeon/p/5900914.html" style="margin:0px;padding:0px;color:#333333;text-decoration:none;">如何写出安全的API接口？接口参数加密签名设计思路</a></h1>
<div class="clear" style="margin:0px;padding:0px;clear:both;color:#7d8b8d;font-family:Verdana, Arial, Helvetica, sans-serif;"></div>
<div class="postBody" style="margin:0px;padding:0px;color:#7d8b8d;font-family:Verdana, Arial, Helvetica, sans-serif;"><div id="cnblogs_post_body" style="margin:0px 0px 20px;padding:0px;word-break:break-word;color:#333333;line-height:1.8;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp; &nbsp; &nbsp; &nbsp;开发中经常用到接口，尤其是在面向服务的soa架构中，数据交互全是用的接口。</span>&nbsp;<span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp; &nbsp; &nbsp; &nbsp;几年以前我认为，我写个接口，不向任何人告知我的接口地址，我的接口就是安全的，现在回想真是too young,too simple。但凡部署在广域网的应用程序，随随便便的好多工具可以根据ip或域名扫描应用程序的所有暴露的接口，进而分析参数，注入程序，分分钟被攻击。</span>&nbsp;<span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp; &nbsp; &nbsp; &nbsp;那咋才能保证接口的安全性呢？</span></p>
<h4 id="id-对互联网开放接口的安全规范-正式版v10-（一）面临的主要安全问题" style="margin:10px 0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">（一）面临的主要安全问题</span></h4>
<h5 id="id-对互联网开放接口的安全规范-正式版v10-a网络环境假设：" style="margin:10px 0px;padding:0px;font-size:12px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">a.网络环境假设：</span></h5>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">a1.假设公共网络（Internet，如：WIFI、非家庭网络、非办公网络等） 是不安全的，一切基于HTTP协议的请求/响应(Request or Response)都是可以被截获的、篡改、重放(重发)的。</span></p>
<h5 id="id-对互联网开放接口的安全规范-正式版v10-b接口安全要求：" style="margin:10px 0px;padding:0px;font-size:12px;"><br style="margin:0px;padding:0px;" />
<span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">b.接口安全要求：</span></h5>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">b1.防伪装攻击（案例：在公共网络环境中，第三方 有意或恶意 的调用我们的接口）</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">b2.防篡改攻击（案例：在公共网络环境中，请求头/查询字符串/内容 在传输过程被修改）</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">b3.防重放攻击（案例：在公共网络环境中，请求被截获，稍后被重放或多次重放）</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">b4.防数据信息泄漏（案例：截获用户登录请求，截获到账号、密码等）</span></p>
<h4 id="id-对互联网开放接口的安全规范-正式版v10-（二）可参考的商业标准" style="margin:10px 0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">（二）可参考的商业标准</span></h4>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">可参见： HTTP数据传输安全方案 &nbsp;HTTPS（HTTP安全商业标准）</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><a class="external-link" href="http://baike.baidu.com/view/14121.htm" rel="nofollow" target="_blank" style="margin:0px;padding:0px;color:#000000;">http://baike.baidu.com/view/14121.htm</a></span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<h4 id="id-对互联网开放接口的安全规范-正式版v10-（三）可参考国内互联网厂商参考" style="margin:10px 0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">（三）可参考国内互联网厂商参考</span></h4>
<h4 id="id-对互联网开放接口的安全规范-正式版v10-新浪OpenAPI、腾讯、淘宝等。" style="margin:10px 0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">新浪OpenAPI、腾讯、淘宝 等。</span></h4>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<h4 id="id-对互联网开放接口的安全规范-正式版v10-（四）我们的设计原则" style="margin:10px 0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">（四）设计原则</span></h4>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">1.轻量级</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">2.适合于异构系统（跨操作系统、多语言简易实现）</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">3.易于开发</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">4.易于测试</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">5.易于部署</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">6.满足接口安全需求（满足b1 b2 b3要求），无过度设计。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">其它：接口安全要求b4部分，主要针对目前用户中心的登录接口</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">设计原则是：使用HTTPS安全协议 或 传输内容使用非对称加密，目前我们采用的后者。&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<h4 id="id-对互联网开放接口的安全规范-正式版v10-（五）适用范围" style="margin:10px 0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">（五）适用范围</span></h4>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">1.所有写操作接口（增、删、改 操作）</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">2.非公开的读接口（如：涉密/敏感/隐私 等信息）</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<h4 id="id-对互联网开放接口的安全规范-正式版v10-（六）接口参数签名实现参考" style="margin:10px 0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">（六）接口参数签名 实现思路参考</span></h4>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">必要的输入参数</span></p>
<div class="table-wrap" style="margin:0px;padding:0px;"><table class="confluenceTable" style="margin:0px;padding:0px;border-spacing:0px;max-width:850px;border:1px solid silver;word-break:break-word;"><tbody style="margin:0px;padding:0px;"><tr style="margin:0px;padding:0px;"><td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">参数名</strong></span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">类型</strong></span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p align="center" style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">必选</strong></span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">描述</strong></span></p>
</td>
</tr>
<tr style="margin:0px;padding:0px;"><td class="confluenceTd" colspan="1" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">_appid</strong></span></td>
<td class="confluenceTd" colspan="1" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">string</span></td>
<td class="confluenceTd" colspan="1" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">是</span></td>
<td class="confluenceTd" colspan="1" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">调用方身份ID，接口提供方用此来识别调不同的调用者，该参数是API基本规范的一部分，请详见API公共规范。</span></td>
</tr>
<tr style="margin:0px;padding:0px;"><td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">_sign</strong></span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">string</span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p align="center" style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">是&nbsp;</span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">一次接口调用的签名值，服务器端 “防止 伪装请求/防篡改/ 防重发” 识别的重要依据。</span></p>
</td>
</tr>
<tr style="margin:0px;padding:0px;"><td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">_timestamp</strong></span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">Int</span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p align="center" style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">是</span></p>
</td>
<td class="confluenceTd" style="margin:0px;padding:3px;border:1px solid silver;border-collapse:collapse;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">时间戳（</span><span style="margin:0px;padding:0px;color:#ff0000;">long&nbsp;Timestamp&nbsp;=&nbsp;DateTime.Now.Ticks;</span><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">）</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<h5 id="id-对互联网开放接口的安全规范-正式版v10-签名算法过程：" style="margin:10px 0px;padding:0px;font-size:12px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">签名算法过程：</span></h5>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">1.对除签名外的所有请求参数按key做的升序排列,value无需编码。</span><br style="margin:0px;padding:0px;" />
<span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;（假设当前时间的时间戳是12345678）</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">例如：有c=3,b=2,a=1 三个参，另加上时间戳后， 按key排序后为：a=1，b=2，c=3，_timestamp=12345678。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">2 把参数名和参数值连接成字符串，得到拼装字符：a1b2c3_timestamp12345678</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">3 用申请到的appkey 连接到接拼装字符串头部和尾部，然后进行32位MD5加密，最后将到得MD5加密摘要转化成大写。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">示例：假设appkey=test，md5(testa1b2c3_timestamp12345678test)，取得MD5摘要值&nbsp;C5F3EB5D7DC2748AED89E90AF00081E6&nbsp;。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">再看一个更具体的Sample Code:</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">如何得取如下请求的签名值：</span><br style="margin:0px;padding:0px;" />
<span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">http://api.demo.com/dog/add?1=壹&amp;A=aaa&amp;Z=zzz&amp;_appid=club&amp;_timestamp=12345678&amp;a=AAA&amp;z=ZZZ</strong></span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">C#实现代码如下 ( 请新建一个C#代码文件&nbsp;SampleCode.cs&nbsp;)：</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">test()方法展示了如何取得该请的签名参数值 ( _sign=8B0E081689789CF66490E65BB8E1B0E7&nbsp;)，现实业务中依据自己的情况，把创建请求的过程封装成公共方法，使得请求url的创建过程对开发人员透明，简化处理。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">[下方会提供 .Net的 Sample Code]&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">.Net</strong></span></p>
<div class="code panel" style="margin:0px;padding:0px;"><div class="codeContent panelContent" style="margin:0px;padding:0px;"><div id="highlighter_860105" class="syntaxhighlighter csharp" style="padding:0px;margin:1em 0px !important;width:100% !important;position:relative !important;overflow:auto !important;font-size:1em !important;"><div class="cnblogs_code" style="color:#000000;margin:0px !important;padding:0px !important;border:0px !important;overflow:visible !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;font-size:12px !important;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;outline:0px !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:auto !important;"><div class="cnblogs_code_toolbar" style="margin:0px !important;padding:0px !important;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;outline:0px !important;overflow:visible !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:auto !important;"><span class="cnblogs_code_copy" style="margin:0px;padding:0px 5px 0px 0px;font-family:'Courier New' !important;line-height:1.5 !important;"><a title="复制代码" style="text-decoration:underline;margin:0px !important;padding:0px !important;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;background-color:#f5f5f5 !important;border:none !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;outline:0px !important;overflow:visible !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;min-height:auto !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px;padding:0px;max-width:800px;border:none !important;" /></a></span></div>
<pre style="margin-top:0px;margin-bottom:0px;padding:0px;white-space:pre-wrap;word-wrap:break-word;font-family:'Courier New' !important;"><span style="margin:0px;padding:0px;line-height:1.5 !important;"><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">using</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> System;</span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">using</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> System.Collections.Generic;</span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">using</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> System.Linq;</span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">using</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> System.Text;</span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">namespace</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> test3
{
    </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">public</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">class</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> SampleCode
    {
        </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">public</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">static</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> test()
        {
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">int</span> _timestamp = <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">12345678</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">var</span> param = <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">new</span> SortedDictionary&lt;<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span>, <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span>&gt;(<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">new</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> AsciiComparer());
            param.Add(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">z</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>, <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">ZZZ</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            param.Add(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">a</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>, <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">AAA</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            param.Add(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">Z</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>, <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">zzz</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            param.Add(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">A</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>, <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">aaa</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            param.Add(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">2</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>, <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">贰</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            param.Add(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>, <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">壹</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            param.Add(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">_appid</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>, <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">club</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            param.Add(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">_timestamp</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">, _timestamp.ToString());
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span> _sign =<span style="margin:0px;padding:0px;line-height:1.5 !important;"> GetSign(param);
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span> urlParam = <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span>.Join(<span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">&amp;</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>, param.Select(i =&gt; i.Key + <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">=</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span> +<span style="margin:0px;padding:0px;line-height:1.5 !important;"> i.Value));
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span> url = <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">http://api.demo.com/dog/add?</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span> + urlParam + <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">&amp;_sign=</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span> +<span style="margin:0px;padding:0px;line-height:1.5 !important;"> _sign;
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> url;
        }
        </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">public</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">static</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span> GetSign(SortedDictionary&lt;<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span>, <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span>&gt; paramList, <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span> appKey = <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">test</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">)
        {
            paramList.Remove(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">_sign</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            StringBuilder sb </span>= <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">new</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> StringBuilder(appKey);
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">foreach</span> (<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">var</span> p <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">in</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> paramList)
                sb.Append(p.Key).Append(p.Value);
            sb.Append(appKey);
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> GetMD5(sb.ToString());
        }
        </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">public</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">static</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span> GetMD5(<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> str)
        {
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">.IsNullOrEmpty(str))
                </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> str;
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">var</span> sb = <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">new</span> StringBuilder(<span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">32</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">);
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">var</span> md5 =<span style="margin:0px;padding:0px;line-height:1.5 !important;"> System.Security.Cryptography.MD5.Create();
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">var</span> output =<span style="margin:0px;padding:0px;line-height:1.5 !important;"> md5.ComputeHash(Encoding.UTF8.GetBytes(str));
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">for</span> (<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">int</span> i = <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">0</span>; i &lt; output.Length; i++<span style="margin:0px;padding:0px;line-height:1.5 !important;">)
                sb.Append(output[i].ToString(</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">X</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">"</span>).PadLeft(<span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">2</span>, <span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">'</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">0</span><span style="margin:0px;padding:0px;color:#800000;line-height:1.5 !important;">'</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">));
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> sb.ToString();
        }
    }
    </span><span style="margin:0px;padding:0px;color:#808080;line-height:1.5 !important;">///</span> <span style="margin:0px;padding:0px;color:#808080;line-height:1.5 !important;">&lt;summary&gt;</span>     <span style="margin:0px;padding:0px;color:#808080;line-height:1.5 !important;">///</span><span style="margin:0px;padding:0px;color:#008000;line-height:1.5 !important;"> 基于ASCII码排序规则的String比较器
    </span><span style="margin:0px;padding:0px;color:#808080;line-height:1.5 !important;">///</span><span style="margin:0px;padding:0px;color:#008000;line-height:1.5 !important;"> Author：HeDaHong
    </span><span style="margin:0px;padding:0px;color:#808080;line-height:1.5 !important;">///</span> <span style="margin:0px;padding:0px;color:#808080;line-height:1.5 !important;">&lt;/summary&gt;</span>     <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">public</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">class</span> AsciiComparer : System.Collections.Generic.IComparer&lt;<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span>&gt;<span style="margin:0px;padding:0px;line-height:1.5 !important;">     {
        </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">public</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">int</span> Compare(<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span> a, <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span><span style="margin:0px;padding:0px;line-height:1.5 !important;"> b)
        {
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (a ==<span style="margin:0px;padding:0px;line-height:1.5 !important;"> b)
                </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">0</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">else</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">.IsNullOrEmpty(a))
                </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> -<span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">else</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">string</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">.IsNullOrEmpty(b))
                </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (a.Length &lt;=<span style="margin:0px;padding:0px;line-height:1.5 !important;"> b.Length)
            {
                </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">for</span> (<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">int</span> i = <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">0</span>; i &lt; a.Length; i++<span style="margin:0px;padding:0px;line-height:1.5 !important;">)
                {
                    </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (a[i] &lt;<span style="margin:0px;padding:0px;line-height:1.5 !important;"> b[i])
                        </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> -<span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
                    </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">else</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (a[i] &gt;<span style="margin:0px;padding:0px;line-height:1.5 !important;"> b[i])
                        </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
                    </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">else</span>                         <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">continue</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
                }
                </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> a.Length == b.Length ? <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">0</span> : -<span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
            }
            </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">else</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">             {
                </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">for</span> (<span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">int</span> i = <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">0</span>; i &lt; b.Length; i++<span style="margin:0px;padding:0px;line-height:1.5 !important;">)
                {
                    </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (a[i] &lt;<span style="margin:0px;padding:0px;line-height:1.5 !important;"> b[i])
                        </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> -<span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
                    </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">else</span> <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">if</span> (a[i] &gt;<span style="margin:0px;padding:0px;line-height:1.5 !important;"> b[i])
                        </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
                    </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">else</span>                         <span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">continue</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
                }
                </span><span style="margin:0px;padding:0px;color:#0000ff;line-height:1.5 !important;">return</span> <span style="margin:0px;padding:0px;color:#800080;line-height:1.5 !important;">1</span><span style="margin:0px;padding:0px;line-height:1.5 !important;">;
            }
        }
    }
}</span></span></pre><div class="cnblogs_code_toolbar" style="margin:0px !important;padding:0px !important;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;border:0px !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;outline:0px !important;overflow:visible !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;min-height:auto !important;"><span class="cnblogs_code_copy" style="margin:0px;padding:0px 5px 0px 0px;font-family:'Courier New' !important;line-height:1.5 !important;"><a title="复制代码" style="text-decoration:underline;margin:0px !important;padding:0px !important;border-top-left-radius:0px !important;border-top-right-radius:0px !important;border-bottom-right-radius:0px !important;border-bottom-left-radius:0px !important;background-image:none !important;background-color:#f5f5f5 !important;border:none !important;bottom:auto !important;float:none !important;height:auto !important;left:auto !important;line-height:1.1em !important;outline:0px !important;overflow:visible !important;position:static !important;right:auto !important;top:auto !important;vertical-align:baseline !important;width:auto !important;box-sizing:content-box !important;font-family:Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important;min-height:auto !important;"><img src="http://common.cnblogs.com/images/copycode.gif" alt="复制代码" style="margin:0px;padding:0px;max-width:800px;border:none !important;" /></a></span></div>
</div>
</div>
</div>
</div>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;"><strong style="margin:0px;padding:0px;">&nbsp;</strong></span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-size:14pt;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;">&nbsp;总结：</span></strong></span></p>
<ol style="margin:0px 0px 1em 40px;padding:0px;"><li style="margin:0px;padding:0px;list-style-type:decimal;"><span style="margin:0px;padding:0px;font-size:14pt;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;">接口调用方和接口提供方约定好统一的参数加密算法</span></strong></span></li>
<li style="margin:0px;padding:0px;list-style-type:decimal;"><span style="margin:0px;padding:0px;font-size:14pt;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;">接口调用方在调用时把加密后的_sign放在参数中去请求接口</span></strong></span></li>
<li style="margin:0px;padding:0px;list-style-type:decimal;"><span style="margin:0px;padding:0px;font-size:14pt;"><span style="margin:0px;padding:0px;font-size:14pt;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;">接口提供方接到响应后，判断时间戳是不是在有效时间内（这个时间间隔根据你的安全范围可以是10分钟，5分钟，20秒等，过期失效，前提是需要保证接口提供方和调用方的服务器时间为准确的网络同步时间）<br style="margin:0px;padding:0px;" />
</span></strong></span></span></li>
<li style="margin:0px;padding:0px;list-style-type:decimal;"><span style="margin:0px;padding:0px;font-size:14pt;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;">把参数中除了_sign以外的参数进行加密，然后把加密结果和传过来的_sign比较，相同则执行调用请求。</span></strong></span></li>
</ol>
<p style="margin:10px auto;padding:0px;text-align:center;"><span style="margin:0px;padding:0px;font-size:18pt;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;">有同学说难以理解，我这两天写个demo，请参考下一篇文章：<a href="http://www.cnblogs.com/codeon/p/6123863.html" target="_blank" style="margin:0px;padding:0px;color:#000000;">http://www.cnblogs.com/codeon/p/6123863.html</a></span></strong></span></p>
</div>
<div id="MySignature" style="margin:0px;padding:0px;"><p style="margin-top:0px;margin-bottom:0px;padding:0px;">&nbsp;</p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;text-align:center;"><span style="margin:0px;padding:0px;font-size:16px;font-family:黑体;">&nbsp; ↓↓↓扫二维码，加入接地气的程序员基地 ↓↓↓</span></p>
<p style="margin-top:0px;margin-bottom:0px;padding:0px;"><img src="http://images2015.cnblogs.com/blog/946550/201609/946550-20160907090525441-1819483323.jpg" alt="" style="margin:0px auto;padding:0px;border:none;display:block;" /></p>
<div id="yangshicopy" style="margin:0px;padding:0px;"><div style="margin:0px 0px 0px 13px;padding:0px;">作者：<a href="http://www.cnblogs.com/codeon/" target="_blank" style="margin:0px;padding:0px;color:#000000;text-decoration:none;">码上组合</a><br style="margin:0px;padding:0px;" />
出处：<a href="http://www.cnblogs.com/codeon/" target="_blank" style="margin:0px;padding:0px;color:#000000;text-decoration:none;">http://www.cnblogs.com/codeon/</a><br style="margin:0px;padding:0px;" />
微博：<a href="http://weibo.com/codeon" target="_blank" style="margin:0px;padding:0px;color:#000000;text-decoration:none;">http://weibo.com/codeon</a><br style="margin:0px;padding:0px;" />
<p>知乎：<a href="https://www.zhihu.com/people/mszh" target="_blank" style="margin:0px;padding:0px;color:#000000;text-decoration:none;">https://www.zhihu.com/people/mszh</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h1 class="postTitle" style="margin:0px 0px 20px;padding:0px;font-size:28px;font-weight:400;line-height:1.8;color:#333333;"><a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/codeon/p/6123863.html" style="margin:0px;padding:0px;color:#333333;text-decoration:none;">如何写出安全的API接口（参数加密+超时处理+私钥验证+Https）- 续（附demo）</a></h1>
<div class="clear" style="margin:0px;padding:0px;clear:both;"></div>
<div class="postBody" style="margin:0px;padding:0px;"><div id="cnblogs_post_body" style="margin:0px 0px 20px;padding:0px;word-break:break-word;color:#333333;line-height:1.8;"><p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">上篇文章说到<a href="http://www.cnblogs.com/codeon/p/5900914.html" target="_blank" style="margin:0px;padding:0px;color:#000000;">接口安全的设计思路</a>，如果没有看到上篇博客，建议看完再来看这个。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">通过园友们的讨论，以及我自己查了些资料，然后对接口安全做一个相对完善的总结，承诺给大家写个demo，今天一并放出。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">对于安全也是相对的，下面我来根据安全级别分析</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">1.完全开放的接口</span></strong></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">有没有这样的接口，谁都可以调用，谁都可以访问，不受时间空间限制，只要能连上互联网就能调用，毫无安全可言。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">实话说，这样的接口我们天天都在接触，你查快递，你查天气预报，你查飞机，火车班次等，这些都是有公共的接口。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">我把这称之为裸奔时代。代码如下：</span></p>
<div class="cnblogs_code" style="margin:5px 0px;padding:5px;background-color:#f5f5f5;border:1px solid #cccccc;overflow:auto;color:#000000;font-family:'Courier New' !important;font-size:12px !important;"><span style="margin:0px;padding:0px;line-height:1.5 !important;"><img id="code_img_closed_701faf89-9732-49a5-ad76-a716d5551a92" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="margin:0px;padding:0px 5px 0px 0px;border:none;vertical-align:middle;max-width:800px;" /></span>&nbsp;<span class="cnblogs_code_collapse" style="margin:0px;padding:2px;border:1px solid gray;background-color:#ffffff;line-height:1.5 !important;">View Code</span></div>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">2.接口参数加密（基础加密）</span></strong></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;你写个接口，你只想让特定的调用方使用，你把这些调用的人叫到一个小屋子，给他们宣布说我这里有个接口只打算给你们用，我给你们每人一把钥匙，你们用的时候拿着这把钥匙即可。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">这把钥匙就是我上文说到的参数加密规则，有了这个规则就能调用。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">这有安全问题啊，这里面的某个成员如果哪个不小心丢了钥匙或者被人窃取，掌握钥匙的人是不是也可以来掉用接口了呢？而且他可以复制很多钥匙给不明不白的人用。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">相当于有人拿到了你的请求链接，如果业务没有对链接唯一性做判断（实际上业务逻辑通常不会把每次请求的加密签名记录下来，所以不会做唯一性判断），就会被重复调用，有一定安全漏洞，怎么破？先看这个场景的代码，然后继续往下看！</span></p>
<div class="cnblogs_code" style="margin:5px 0px;padding:5px;background-color:#f5f5f5;border:1px solid #cccccc;overflow:auto;color:#000000;font-family:'Courier New' !important;font-size:12px !important;"><span style="margin:0px;padding:0px;line-height:1.5 !important;"><img id="code_img_closed_268ad06e-5047-4ad6-9d68-679d8df47463" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="margin:0px;padding:0px 5px 0px 0px;border:none;vertical-align:middle;max-width:800px;" /></span>&nbsp;<span class="cnblogs_code_collapse" style="margin:0px;padding:2px;border:1px solid gray;background-color:#ffffff;line-height:1.5 !important;">View Code</span></div>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">3.接口参数加密+接口时效性验证（一般达到这个级别已经非常安全了）</span></strong></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">继上一步，你发现有不明不白的人调用你的接口，你很不爽，随即把真正需要调用接口的人又叫来，告诉他们每天给他们换一把钥匙。和往常一样，有个别伙伴的钥匙被小偷偷走了，小偷煞费苦心，经过数天的踩点观察，准备在一个月黑风高的夜晚动手。拿出钥匙，捣鼓了半天也无法开启你的神圣之门，因为小偷不知道你天天都在换新钥匙。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">小偷不服，经过一段时间琢磨，小偷发现了你们换钥匙的规律。在一次获得钥匙之后，不加思索，当天就动手了，因为他知道他手里的钥匙在第二天你更换钥匙后就失效了。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">结果，小偷如愿。怎么破？先看这个场景的代码，然后继续往下看！</span></p>
<div class="cnblogs_code" style="margin:5px 0px;padding:5px;background-color:#f5f5f5;border:1px solid #cccccc;overflow:auto;color:#000000;font-family:'Courier New' !important;font-size:12px !important;"><span style="margin:0px;padding:0px;line-height:1.5 !important;"><img id="code_img_closed_b2b38f92-eb4f-4b20-9b6f-5634a31db127" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="margin:0px;padding:0px 5px 0px 0px;border:none;vertical-align:middle;max-width:800px;" /></span>&nbsp;<span class="cnblogs_code_collapse" style="margin:0px;padding:2px;border:1px solid gray;background-color:#ffffff;line-height:1.5 !important;">View Code</span></div>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">4.接口参数加密+时效性验证+私钥（达到这个级别安全性固若金汤）</span></strong></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;继上一步，你发现道高一尺魔高一丈，仍然有偷盗事情发生。咋办呢？你打算下血本，给每个人配一把钥匙的基础上，再给每个人发个暗号，即使钥匙被小偷弄去了，小偷没有暗号，任然无法如愿，而且这样很容易定位是谁的暗号泄漏问题，找到问题根源，只需要给当前这个人换下钥匙就行了，不用大动干戈。</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">但这个并不是万无一失的，因为钥匙毕竟还有可能被小偷搞到。代码如下：</span></p>
<div class="cnblogs_code" style="margin:5px 0px;padding:5px;background-color:#f5f5f5;border:1px solid #cccccc;overflow:auto;color:#000000;font-family:'Courier New' !important;font-size:12px !important;"><span style="margin:0px;padding:0px;line-height:1.5 !important;"><img id="code_img_closed_53898ed9-a6ec-4f9c-88ae-0f246333285f" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt="" style="margin:0px;padding:0px 5px 0px 0px;border:none;vertical-align:middle;max-width:800px;" /></span>&nbsp;<span class="cnblogs_code_collapse" style="margin:0px;padding:2px;border:1px solid gray;background-color:#ffffff;line-height:1.5 !important;">View Code</span></div>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;">5.接口参数加密+时效性验证+私钥+Https（我把这个级别称之为金钟罩，世间最安全莫过于此）</span></strong></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">继上一步，我们给传输机制改为Https，这下小偷彻底懵逼了。那么问题来了，Https咋玩儿呢？可以在本地搭个环境，参考此文：<a href="http://www.cnblogs.com/naniannayue/archive/2012/11/19/2776948.html" target="_blank" style="margin:0px;padding:0px;color:#000000;">http://www.cnblogs.com/naniannayue/archive/2012/11/19/2776948.html</a></span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">&nbsp;</span></p>
<p style="margin:10px auto;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:16px;">另：本文的接口是用的MVC WebAPI写的，完全基于RESTful标准。如对此不是特别了解可以参考此文：<a href="http://www.cnblogs.com/landeanfen/p/5501490.html" target="_blank" style="margin:0px;padding:0px;color:#000000;">http://www.cnblogs.com/landeanfen/p/5501490.html</a></span></p>
<p style="margin:10px auto;padding:0px;text-align:center;">&nbsp;</p>
<p style="margin:10px auto;padding:0px;text-align:center;"><strong style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';font-size:18pt;color:#ff0000;"><span style="margin:0px;padding:0px;color:#3366ff;"><a href="https://github.com/mszhtech/WebApiDemo" target="_blank" style="margin:0px;padding:0px;color:#000000;"><span style="margin:0px;padding:0px;color:#3366ff;">完整demo下载</span></a></span><br style="margin:0px;padding:0px;" />
</span></strong></p>
<p style="margin:10px auto;padding:0px;text-align:center;">&nbsp;</p>
<p style="margin:10px auto;padding:0px;text-align:center;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;font-size:16px;">注：demo不能直接运行，需要把两个web项目配置到iis中，api代表接口提供方，他的主域需要配置到business的webconfig中，在浏览器地址栏分别请求business中的各个调用接口方法来实现接口调用。</span></p>
<p style="margin:10px auto;padding:0px;text-align:center;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;font-size:16px;">1、如果想验证参数错误，需要在请求接口时打个断点把接口url取出，篡改url参数，然后在浏览器中模拟请求</span></p>
<p style="margin:10px auto;padding:0px;text-align:center;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;font-size:16px;">2、如果想验证接口超时，需要在请求接口时打个断点把接口url取出，然后等到了超时时间，然后在浏览器中模拟请求</span></p>
<p style="margin:10px auto;padding:0px;text-align:center;"><span style="margin:0px;padding:0px;font-family:'Microsoft YaHei';color:#ff0000;font-size:16px;">3、如果想验证私钥错误，需要在请求接口时打个断点把接口url取出，然后修改business的私钥配置，然后在浏览器中模拟请求</span></p>
</div>
</div>
</div>
</div>
</div>
</div></body></html>